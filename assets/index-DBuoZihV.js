import{r as e,a as t,g as s}from"./react-DiZ9e1Sl.js";import{r,R as n}from"./leaflet-D9Qn1H0p.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var o,a,i={exports:{}},c={};var l,d=(a||(a=1,i.exports=function(){if(o)return c;o=1;var t=e(),s=Symbol.for("react.element"),r=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,a=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function l(e,t,r){var o,c={},l=null,d=null;for(o in void 0!==r&&(l=""+r),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(d=t.ref),t)n.call(t,o)&&!i.hasOwnProperty(o)&&(c[o]=t[o]);if(e&&e.defaultProps)for(o in t=e.defaultProps)void 0===c[o]&&(c[o]=t[o]);return{$$typeof:s,type:e,key:l,ref:d,props:c,_owner:a.current}}return c.Fragment=r,c.jsx=l,c.jsxs=l,c}()),i.exports),m={};const u=s(function(){if(l)return m;l=1;var e=t();return m.createRoot=e.createRoot,m.hydrateRoot=e.hydrateRoot,m}());var h=(e=>(e.OWNER="OWNER",e.ADMIN="ADMIN",e.PROJECT_MANAGER="PROJECT_MANAGER",e.FOREMAN="FOREMAN",e.OPERATIVE="OPERATIVE",e.CLIENT="CLIENT",e.PRINCIPAL_ADMIN="PRINCIPAL_ADMIN",e))(h||{}),p=(e=>(e.VIEW_ALL_PROJECTS="VIEW_ALL_PROJECTS",e.VIEW_ASSIGNED_PROJECTS="VIEW_ASSIGNED_PROJECTS",e.CREATE_PROJECT="CREATE_PROJECT",e.MANAGE_PROJECT_DETAILS="MANAGE_PROJECT_DETAILS",e.MANAGE_PROJECT_TEMPLATES="MANAGE_PROJECT_TEMPLATES",e.VIEW_ALL_TASKS="VIEW_ALL_TASKS",e.MANAGE_ALL_TASKS="MANAGE_ALL_TASKS",e.SUBMIT_TIMESHEET="SUBMIT_TIMESHEET",e.VIEW_ALL_TIMESHEETS="VIEW_ALL_TIMESHEETS",e.MANAGE_TIMESHEETS="MANAGE_TIMESHEETS",e.UPLOAD_DOCUMENTS="UPLOAD_DOCUMENTS",e.VIEW_DOCUMENTS="VIEW_DOCUMENTS",e.SUBMIT_SAFETY_REPORT="SUBMIT_SAFETY_REPORT",e.VIEW_SAFETY_REPORTS="VIEW_SAFETY_REPORTS",e.MANAGE_SAFETY_REPORTS="MANAGE_SAFETY_REPORTS",e.VIEW_FINANCES="VIEW_FINANCES",e.MANAGE_FINANCES="MANAGE_FINANCES",e.VIEW_TEAM="VIEW_TEAM",e.MANAGE_TEAM="MANAGE_TEAM",e.MANAGE_EQUIPMENT="MANAGE_EQUIPMENT",e.VIEW_AUDIT_LOG="VIEW_AUDIT_LOG",e.SEND_DIRECT_MESSAGE="SEND_DIRECT_MESSAGE",e.ACCESS_ALL_TOOLS="ACCESS_ALL_TOOLS",e.SUBMIT_EXPENSE="SUBMIT_EXPENSE",e))(p||{}),g=(e=>(e.TODO="TODO",e.IN_PROGRESS="IN_PROGRESS",e.DONE="DONE",e))(g||{}),f=(e=>(e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH",e))(f||{}),w=(e=>(e.PENDING="PENDING",e.APPROVED="APPROVED",e.REJECTED="REJECTED",e.PAID="PAID",e))(w||{}),E=(e=>(e.DRAFT="DRAFT",e.SENT="SENT",e.PAID="PAID",e.OVERDUE="OVERDUE",e.CANCELLED="CANCELLED",e))(E||{}),x=(e=>(e.PENDING="PENDING",e.APPROVED="APPROVED",e.REJECTED="REJECTED",e.DRAFT="DRAFT",e))(x||{}),A=(e=>(e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH",e.CRITICAL="CRITICAL",e))(A||{}),y=(e=>(e.REPORTED="REPORTED",e.UNDER_INVESTIGATION="UNDER_INVESTIGATION",e.RESOLVED="RESOLVED",e))(y||{}),S=(e=>(e.AVAILABLE="AVAILABLE",e.IN_USE="IN_USE",e.MAINTENANCE="MAINTENANCE",e.OUT_OF_ORDER="OUT_OF_ORDER",e))(S||{});const v={OWNER:new Set(Object.values(p)),ADMIN:new Set(["VIEW_ALL_PROJECTS","CREATE_PROJECT","MANAGE_PROJECT_DETAILS","VIEW_ALL_TASKS","MANAGE_ALL_TASKS","VIEW_ALL_TIMESHEETS","MANAGE_TIMESHEETS","UPLOAD_DOCUMENTS","VIEW_DOCUMENTS","VIEW_SAFETY_REPORTS","MANAGE_SAFETY_REPORTS","VIEW_FINANCES","MANAGE_FINANCES","VIEW_TEAM","MANAGE_TEAM","MANAGE_EQUIPMENT","VIEW_AUDIT_LOG","SEND_DIRECT_MESSAGE","ACCESS_ALL_TOOLS","SUBMIT_EXPENSE","MANAGE_PROJECT_TEMPLATES"]),PROJECT_MANAGER:new Set(["VIEW_ALL_PROJECTS","MANAGE_PROJECT_DETAILS","VIEW_ALL_TASKS","MANAGE_ALL_TASKS","VIEW_ALL_TIMESHEETS","MANAGE_TIMESHEETS","UPLOAD_DOCUMENTS","VIEW_DOCUMENTS","VIEW_SAFETY_REPORTS","VIEW_FINANCES","VIEW_TEAM","MANAGE_EQUIPMENT","SEND_DIRECT_MESSAGE","SUBMIT_EXPENSE"]),FOREMAN:new Set(["VIEW_ASSIGNED_PROJECTS","SUBMIT_TIMESHEET","UPLOAD_DOCUMENTS","VIEW_DOCUMENTS","SUBMIT_SAFETY_REPORT","VIEW_SAFETY_REPORTS","SEND_DIRECT_MESSAGE","SUBMIT_EXPENSE"]),OPERATIVE:new Set(["VIEW_ASSIGNED_PROJECTS","SUBMIT_TIMESHEET","VIEW_DOCUMENTS","SUBMIT_SAFETY_REPORT","SUBMIT_EXPENSE"]),CLIENT:new Set(["VIEW_ASSIGNED_PROJECTS","VIEW_DOCUMENTS"]),PRINCIPAL_ADMIN:new Set(Object.values(p))},I={companies:[{id:"0",name:"Platform Administration"},{id:"1",name:"ConstructCo"},{id:"2",name:"Renovate Ltd."},{id:"3",name:"As Cladding and Roofing Ltd"}],users:[{id:"demo",firstName:"Demo",lastName:"User",email:"demo@example.com",role:h.ADMIN,companyId:"1",avatar:"https://i.pravatar.cc/150?u=demo",password:"password",mfaEnabled:!1},{id:"0",firstName:"Adrian",lastName:"Admin",email:"adrian@ascladdingltd.co.uk",role:h.PRINCIPAL_ADMIN,companyId:"0",avatar:"https://i.pravatar.cc/150?u=0",password:"Cumparavinde1",mfaEnabled:!1},{id:"1",firstName:"Samantha",lastName:"Lee",email:"sam@constructco.com",role:h.ADMIN,companyId:"1",avatar:"https://i.pravatar.cc/150?u=1",phone:"07123456781",password:"password123",mfaEnabled:!1},{id:"2",firstName:"David",lastName:"Chen",email:"david@constructco.com",role:h.PROJECT_MANAGER,companyId:"1",avatar:"https://i.pravatar.cc/150?u=2",phone:"07123456782",password:"password123",mfaEnabled:!0},{id:"3",firstName:"Maria",lastName:"Garcia",email:"maria@constructco.com",role:h.FOREMAN,companyId:"1",avatar:"https://i.pravatar.cc/150?u=3",phone:"07123456783",password:"password123",mfaEnabled:!1},{id:"4",firstName:"Bob",lastName:"Williams",email:"bob@constructco.com",role:h.OPERATIVE,companyId:"1",avatar:"https://i.pravatar.cc/150?u=4",phone:"07123456784",password:"password123",mfaEnabled:!1},{id:"5",firstName:"John",lastName:"Smith",email:"john@renovate.com",role:h.ADMIN,companyId:"2",avatar:"https://i.pravatar.cc/150?u=5",phone:"07123456785",password:"password123",mfaEnabled:!1},{id:"6",firstName:"Emily",lastName:"White",email:"emily@renovate.com",role:h.PROJECT_MANAGER,companyId:"2",avatar:"https://i.pravatar.cc/150?u=6",phone:"07123456786",password:"password123",mfaEnabled:!1},{id:"7",firstName:"Carlos",lastName:"Diaz",email:"carlos@constructco.com",role:h.OPERATIVE,companyId:"1",avatar:"https://i.pravatar.cc/150?u=7",phone:"07123456787",password:"password123",mfaEnabled:!1},{id:"8",firstName:"Admin",lastName:"User",email:"admin@ascladding.com",role:h.OWNER,companyId:"3",avatar:"https://i.pravatar.cc/150?u=8",phone:"07123456788",password:"password123",mfaEnabled:!1}],projects:[{id:"101",companyId:"1",name:"Downtown Tower",location:{address:"123 Main St, London",lat:51.5074,lng:-.1278},budget:5e6,spent:325e4,actualCost:325e4,startDate:"2023-01-15",status:"ACTIVE",image:"https://picsum.photos/seed/tower/800/400"},{id:"102",companyId:"1",name:"North Bridge Retrofit",location:{address:"456 Oak Ave, Manchester",lat:53.4808,lng:-2.2426},budget:12e5,spent:135e4,actualCost:135e4,startDate:"2022-11-01",status:"COMPLETED",image:"https://picsum.photos/seed/bridge/800/400"},{id:"201",companyId:"2",name:"Victorian House Reno",location:{address:"789 Pine Ln, Bristol",lat:51.4545,lng:-2.5879},budget:25e4,spent:18e4,actualCost:18e4,startDate:"2023-03-10",status:"ACTIVE",image:"https://picsum.photos/seed/house/800/400"}],todos:[{id:"t-1",text:"Finalize foundation pouring",title:"Finalize foundation pouring",status:g.IN_PROGRESS,priority:f.HIGH,assignedTo:"3",projectId:"101"},{id:"t-2",text:"Install HVAC system on floor 5",title:"Install HVAC system on floor 5",status:g.TODO,priority:f.MEDIUM,assignedTo:"4",projectId:"101"},{id:"t-3",text:"Source interior fixtures",title:"Source interior fixtures",status:g.TODO,priority:f.LOW,assignedTo:"2",projectId:"101"},{id:"t-4",text:"Strip wallpaper in living room",title:"Strip wallpaper in living room",status:g.DONE,priority:f.MEDIUM,assignedTo:"6",projectId:"201"}],expenses:[{id:"e-1",description:"Client Lunch",amount:150,category:"Other",projectId:"101",userId:"2",date:"2024-01-15",status:w.APPROVED}],invoices:[{id:"inv-1",companyId:"1",invoiceNumber:"INV-001",projectId:"101",clientId:"c-1",issueDate:"2024-01-20",dueDate:"2024-02-20",status:E.PAID,lineItems:[{id:"li-1",description:"Phase 1",quantity:1,rate:1e5,amount:1e5}],subtotal:1e5,taxRate:.2,taxAmount:2e4,retentionRate:.05,retentionAmount:5e3,total:115e3,amountPaid:115e3,balance:0}],siteUpdates:[{id:"su-1",projectId:"101",userId:"3",message:"Concrete pour for the ground floor is complete.",timestamp:new Date(Date.now()-72e5).toISOString(),images:["https://picsum.photos/seed/concrete/400/200"]}],projectMessages:[{id:"pm-1",projectId:"101",senderId:"2",message:"Team, please remember the safety briefing at 7 AM sharp tomorrow.",timestamp:new Date(Date.now()-12e5).toISOString()}],safetyIncidents:[{id:"si-1",title:"Minor Slip",description:"Minor slip on wet surface, no injury.",severity:A.LOW,projectId:"101",reportedBy:"3",incidentDate:(new Date).toISOString(),status:y.RESOLVED}],equipment:[{id:"eq-1",name:"Excavator CAT 320",status:S.AVAILABLE,companyId:"1"}],timeEntries:[{id:"te-1",userId:"4",projectId:"101",startTime:new Date(Date.now()-288e5).toISOString(),endTime:(new Date).toISOString(),status:x.PENDING}],projectInsights:[],financialForecasts:[],clients:[{id:"c-1",companyId:"1",name:"Global Real Estate Inc.",contactPerson:"Ava Harris",contactEmail:"ava.harris@gre.com",contactPhone:"+44 20 7946 0101",email:"accounts@gre.com",phone:"+44 20 7946 0101",billingAddress:"Accounts Payable, 100 Market Street, London SW1A 1AA",paymentTerms:"Net 30",isActive:!0,createdAt:"2024-01-15T09:00:00Z",updatedAt:"2024-12-10T10:30:00Z",address:{street:"100 Market Street",city:"London",state:"Greater London",zipCode:"SW1A 1AA",country:"United Kingdom"}},{id:"c-2",companyId:"1",name:"Northbridge Retail Group",contactPerson:"Leo Patel",contactEmail:"leo.patel@northbridge.com",contactPhone:"+44 161 555 0198",email:"finance@northbridge.com",phone:"+44 161 555 0198",billingAddress:"Finance Office, 50 King Street, Manchester M2 4LY",paymentTerms:"Net 45",isActive:!0,createdAt:"2024-11-28T12:00:00Z",updatedAt:"2024-12-15T08:15:00Z",address:{street:"50 King Street",city:"Manchester",state:"Greater Manchester",zipCode:"M2 4LY",country:"United Kingdom"}}]};var N={};class T{constructor(e={}){this.cache=new Map,this.defaultTtl=e.ttl||3e5,this.maxSize=e.maxSize||100,this.persistent=e.persistent||!1,this.namespace=e.namespace||"app-cache",this.persistent&&this.loadFromStorage(),"undefined"==typeof window||this.isTestEnv()||setInterval(()=>this.cleanup(),6e4)}isTestEnv(){try{return"undefined"!=typeof process&&!(!N?.VITEST&&!N?.VITEST_WORKER_ID)}catch{return!1}}set(e,t,s){const r=Date.now(),n={data:t,timestamp:r,ttl:s||this.defaultTtl,accessCount:0,lastAccessed:r};this.cache.size>=this.maxSize&&this.evictLRU(),this.cache.set(e,n),this.persistent&&this.saveToStorage()}get(e){const t=this.cache.get(e);if(!t)return null;const s=Date.now();return s-t.timestamp>t.ttl?(this.cache.delete(e),this.persistent&&this.saveToStorage(),null):(t.accessCount++,t.lastAccessed=s,t.data)}has(e){return null!==this.get(e)}delete(e){const t=this.cache.delete(e);return t&&this.persistent&&this.saveToStorage(),t}clear(){this.cache.clear(),this.persistent&&this.saveToStorage()}keys(){return Array.from(this.cache.keys())}size(){return this.cache.size}getStats(){const e=Array.from(this.cache.values());return{size:this.cache.size,maxSize:this.maxSize,totalAccesses:e.reduce((e,t)=>e+t.accessCount,0),averageAge:e.length>0?e.reduce((e,t)=>e+(Date.now()-t.timestamp),0)/e.length:0}}evictLRU(){let e="",t=Date.now();for(const[s,r]of this.cache.entries())r.lastAccessed<t&&(t=r.lastAccessed,e=s);e&&this.cache.delete(e)}cleanup(){const e=Date.now(),t=[];for(const[s,r]of this.cache.entries())e-r.timestamp>r.ttl&&t.push(s);t.forEach(e=>this.cache.delete(e)),t.length>0&&this.persistent&&this.saveToStorage()}saveToStorage(){if("undefined"!=typeof window&&window.localStorage)try{const e=JSON.stringify(Array.from(this.cache.entries()));localStorage.setItem(`${this.namespace}-cache`,e)}catch(e){console.warn("Failed to save cache to localStorage:",e)}}loadFromStorage(){if("undefined"!=typeof window&&window.localStorage)try{const e=localStorage.getItem(`${this.namespace}-cache`);if(e){const t=JSON.parse(e);this.cache=new Map(t),this.cleanup()}}catch(e){console.warn("Failed to load cache from localStorage:",e)}}}new T({ttl:3e5,maxSize:200,persistent:!0,namespace:"api-cache"}),new T({ttl:18e5,maxSize:50,persistent:!0,namespace:"user-cache"}),new T({ttl:6e5,maxSize:100,persistent:!0,namespace:"project-cache"});const b=class{static validate(e,t){const s={},r={...e};for(const n of t){const t=String(n.field),o=e[n.field],a=[];if(!n.required||null!=o&&""!==o){if(n.required||null!=o&&""!==o){if(n.type){const e=this.validateType(o,n.type,t);e&&a.push(e)}if("string"==typeof o&&(n.minLength&&o.length<n.minLength&&a.push(`${t} must be at least ${n.minLength} characters`),n.maxLength&&o.length>n.maxLength&&a.push(`${t} must not exceed ${n.maxLength} characters`)),"number"==typeof o&&(void 0!==n.min&&o<n.min&&a.push(`${t} must be at least ${n.min}`),void 0!==n.max&&o>n.max&&a.push(`${t} must not exceed ${n.max}`)),n.pattern&&"string"==typeof o&&!n.pattern.test(o)&&a.push(`${t} format is invalid`),n.custom){const e=n.custom(o);e&&a.push(e)}n.sanitize&&(r[n.field]=n.sanitize(o)),a.length>0&&(s[t]=a)}}else a.push(`${t} is required`)}return{isValid:0===Object.keys(s).length,errors:s,sanitizedData:0===Object.keys(s).length?r:void 0}}static validateType(e,t,s){switch(t){case"string":return"string"!=typeof e?`${s} must be a string`:null;case"number":return"number"!=typeof e||isNaN(e)?`${s} must be a valid number`:null;case"boolean":return"boolean"!=typeof e?`${s} must be true or false`:null;case"email":return"string"==typeof e&&this.emailRegex.test(e)?null:`${s} must be a valid email address`;case"phone":return"string"==typeof e&&this.phoneRegex.test(e.replace(/\s/g,""))?null:`${s} must be a valid phone number`;case"url":return"string"==typeof e&&this.urlRegex.test(e)?null:`${s} must be a valid URL`;case"date":const t=new Date(e);return isNaN(t.getTime())?`${s} must be a valid date`:null;default:return null}}};b.emailRegex=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,b.phoneRegex=/^[\+]?[1-9][\d]{0,15}$/,b.urlRegex=/^https?:\/\/.+/,b.sanitizers={trim:e=>"string"==typeof e?e.trim():e,toLowerCase:e=>"string"==typeof e?e.toLowerCase():e,toUpperCase:e=>"string"==typeof e?e.toUpperCase():e,removeSpecialChars:e=>"string"==typeof e?e.replace(/[^a-zA-Z0-9\s]/g,""):e,normalizePhone:e=>"string"==typeof e?e.replace(/\D/g,""):e,normalizeEmail:e=>"string"==typeof e?e.toLowerCase().trim():e,escapeHtml:e=>"string"!=typeof e?e:e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;"),limitLength:e=>t=>"string"==typeof t?t.substring(0,e):t},b.commonRules={email:{field:"email",required:!0,type:"email",sanitize:b.sanitizers.normalizeEmail},password:{field:"password",required:!0,type:"string",minLength:8,custom:e=>/(?=.*[a-z])/.test(e)?/(?=.*[A-Z])/.test(e)?/(?=.*\d)/.test(e)?null:"Password must contain at least one number":"Password must contain at least one uppercase letter":"Password must contain at least one lowercase letter"},phone:{field:"phone",type:"phone",sanitize:b.sanitizers.normalizePhone},name:{field:"name",required:!0,type:"string",minLength:2,maxLength:50,sanitize:b.sanitizers.trim},currency:{field:"amount",required:!0,type:"number",min:0,custom:e=>e<0?"Amount cannot be negative":e>1e6?"Amount exceeds maximum limit":null}};let _=b;let j=null;const R=()=>{if(j)return j;try{const e=globalThis;if(e&&e.localStorage){const t="__asagents_storage_test__";return e.localStorage.setItem(t,"1"),e.localStorage.removeItem(t),j=e.localStorage,j}}catch(e){console.warn("Falling back to in-memory storage adapter.",e)}return j=(()=>{const e=new Map;return{getItem:t=>e.has(t)?e.get(t):null,setItem(t,s){e.set(t,String(s))},removeItem(t){e.delete(t)},clear(){e.clear()},key:t=>Array.from(e.keys())[t]??null,get length(){return e.size}}})(),j},M=(()=>{if(void 0!==globalThis.crypto)return globalThis.crypto;throw new Error("Secure crypto APIs are not available in this environment.")})(),k=new TextEncoder,C=e=>Array.from(new Uint8Array(e)).map(e=>e.toString(16).padStart(2,"0")).join(""),P=async(e,t)=>{const s=k.encode(`${t}:${e}`),r=await M.subtle.digest("SHA-256",s);return C(r)},L=async e=>{const t=((e=16)=>{const t=new Uint8Array(e);return M.getRandomValues(t),C(t.buffer)})();return{hash:await P(e,t),salt:t}},O=async e=>{if(!e.passwordHash&&!e.passwordSalt&&e.password){const{hash:t,salt:s}=await L(e.password);e.passwordHash=t,e.passwordSalt=s,delete e.password}return e},D=(e=50)=>new Promise(t=>setTimeout(t,e)),V=9e5,U=6048e5,G=e=>e.trim().toLowerCase(),z=e=>e.trim().toUpperCase(),F=new Map,W=R(),B=[["JOIN-CONSTRUCTCO",{companyId:"1",allowedRoles:[h.ADMIN,h.PROJECT_MANAGER,h.FOREMAN,h.OPERATIVE],suggestedRole:h.PROJECT_MANAGER}],["JOIN-RENOVATE",{companyId:"2",allowedRoles:[h.ADMIN,h.PROJECT_MANAGER,h.FOREMAN,h.OPERATIVE],suggestedRole:h.FOREMAN}],["JOIN-CLIENT",{companyId:"3",allowedRoles:[h.CLIENT],suggestedRole:h.CLIENT}]],$=new Map;$.clear(),B.forEach(([e,t])=>{$.set(e,{...t})});const J=e=>{if("function"==typeof btoa)return btoa(e);if("undefined"!=typeof Buffer)return Buffer.from(e,"binary").toString("base64");throw new Error("Base64 encoding is not supported in this environment.")},H=(e,t)=>{const s={...e,iat:Date.now(),exp:Math.floor((Date.now()+t)/1e3)};return`${J(JSON.stringify({alg:"HS256",typ:"JWT"}))}.${J(JSON.stringify(s))}.${J("your-super-secret-key-for-mock-jwt")}`},q=e=>{try{const t=JSON.parse((e=>{if("function"==typeof atob)return atob(e);if("undefined"!=typeof Buffer)return Buffer.from(e,"base64").toString("binary");throw new Error("Base64 decoding is not supported in this environment.")})(e.split(".")[1]));if(1e3*t.exp<Date.now())throw new Error("Token expired");return t}catch(t){return console.error("Token decode/validation failed:",t),null}},Y="asagents_",K=e=>JSON.parse(JSON.stringify(e)),Z=(e,t)=>{try{const s=W.getItem(e);return s?JSON.parse(s):t}catch(s){return console.error(`Failed to read ${e} from storage`,s),t}},X={companies:K(I.companies),users:K(I.users),projects:K(I.projects),todos:K(I.todos),timeEntries:K(I.timeEntries),safetyIncidents:K(I.safetyIncidents),equipment:K(I.equipment),clients:K(I.clients),invoices:K(I.invoices),expenses:K(I.expenses||[]),siteUpdates:K(I.siteUpdates),projectMessages:K(I.projectMessages),notifications:K(I.notifications||[]),quotes:K(I.quotes||[]),auditLogs:[],resourceAssignments:[],conversations:[],messages:[],projectAssignments:[],projectTemplates:[],whiteboardNotes:[],documents:[],projectInsights:K(I.projectInsights||[]),financialForecasts:K(I.financialForecasts||[])},Q=e=>{const t=`${Y}${String(e)}`;try{const e=W.getItem(t);if(e)return JSON.parse(e)}catch(r){console.error(`Failed to hydrate ${String(e)} from storage`,r)}const s=K(X[e]);return W.setItem(t,JSON.stringify(s)),s};let ee={companies:Q("companies"),users:Q("users"),projects:Q("projects"),todos:Q("todos"),timeEntries:Q("timeEntries"),safetyIncidents:Q("safetyIncidents"),equipment:Q("equipment"),clients:Q("clients"),invoices:Q("invoices"),expenses:Q("expenses"),siteUpdates:Q("siteUpdates"),projectMessages:Q("projectMessages"),notifications:Q("notifications"),quotes:Q("quotes"),auditLogs:Q("auditLogs"),resourceAssignments:Q("resourceAssignments"),conversations:Q("conversations"),messages:Q("messages"),projectAssignments:Q("projectAssignments"),projectTemplates:Q("projectTemplates"),whiteboardNotes:Q("whiteboardNotes"),documents:Q("documents"),financialForecasts:Q("financialForecasts"),projectInsights:Q("projectInsights")};const te=()=>{Object.keys(ee).forEach(e=>{W.setItem(`${Y}${String(e)}`,JSON.stringify(ee[e]))})},se=e=>{const t=G(e);return ee.users.find(e=>e.email&&e.email.toLowerCase()===t)},re=e=>(e=>{const{password:t,passwordHash:s,passwordSalt:r,...n}=e;return n})(e);(()=>{const e=ee.users.filter(e=>e.password&&(!e.passwordHash||!e.passwordSalt));0!==e.length&&Promise.all(e.map(e=>O(e))).then(()=>{te()}).catch(e=>console.error("Failed to upgrade legacy user credentials",e))})();(()=>{let e=!1;ee.users.forEach(t=>{!t.role||t.permissions&&0!==t.permissions.length||(t.permissions=Array.from(v[t.role]),e=!0)}),e&&te()})();const ne=(e,t,s)=>{const r={id:String(Date.now()+Math.random()),actorId:e,action:t,target:s,timestamp:(new Date).toISOString()};ee.auditLogs.push(r),te()},oe={register:async e=>{if(await D(),!e.email||!e.password)throw new Error("Email and password are required.");if(!e.termsAccepted)throw new Error("You must accept the terms and conditions to create an account.");const t=G(e.email);if(se(t))throw new Error("An account with this email already exists.");const s=e.password.trim();if(![s.length>=8,/[A-Z]/.test(s),/[a-z]/.test(s),/\d/.test(s),/[^A-Za-z0-9]/.test(s)].every(Boolean))throw new Error("Password does not meet the minimum complexity requirements.");const r=e.firstName?.trim(),n=e.lastName?.trim(),o=e.phone?.trim();let a,i,c=e.role||h.OPERATIVE;if("create"===e.companySelection){const t=e.companyName?.trim(),s=e.companyType,r=e.companyEmail?G(e.companyEmail):void 0,n=e.companyPhone?.trim(),o=e.companyWebsite?.trim();if(!t||!s)throw new Error("Company information is incomplete.");const l=String(Date.now());a=l,i={id:a,name:t,type:s,email:r,phone:n,website:o,status:"Active",subscriptionPlan:"FREE",storageUsageGB:0,settings:{theme:"light",accessibility:{highContrast:!1},timeZone:"Europe/London",dateFormat:"DD/MM/YYYY",currency:"GBP",workingHours:{start:"08:00",end:"17:00",workDays:[1,2,3,4,5]},features:{projectManagement:!0,timeTracking:!0,financials:!0,documents:!0,safety:!0,equipment:!0,reporting:!0}},address:{street:"",city:"",state:"",zipCode:"",country:"United Kingdom"},createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()},ee.companies.push(i),$.set(`JOIN-${a}`,{companyId:a,allowedRoles:[h.ADMIN,h.PROJECT_MANAGER,h.FOREMAN,h.OPERATIVE],suggestedRole:h.ADMIN}),c=h.OWNER}else{if("join"!==e.companySelection)throw new Error("Invalid company selection.");{const t=e.inviteToken?z(e.inviteToken):"";if(!t)throw new Error("An invite token is required to join an existing company.");const s=$.get(t);if(!s)throw new Error("Invalid invite token.");if(a=s.companyId,i=ee.companies.find(e=>e.id===a),!i)throw new Error("Company not found for invite token.");if(e.role&&!s.allowedRoles.includes(e.role))throw new Error("Selected role is not permitted for this invite.");c=e.role&&s.allowedRoles.includes(e.role)?e.role:s.suggestedRole||s.allowedRoles[0]}}const l=await L(s),d=(new Date).toISOString(),m={id:String(Date.now()+Math.random()),firstName:r,lastName:n,email:t,passwordHash:l.hash,passwordSalt:l.salt,phone:o,role:c,permissions:Array.from(v[c]),companyId:a,isActive:!0,isEmailVerified:!0,mfaEnabled:!1,createdAt:d,updatedAt:d,preferences:{theme:"system",language:"en",notifications:{email:!0,push:!1,sms:!1,taskReminders:!0,projectUpdates:!0,systemAlerts:!0},dashboard:{defaultView:"dashboard",pinnedWidgets:[],hiddenWidgets:[]}}};!1===e.updatesOptIn&&(m.preferences.notifications.projectUpdates=!1),ee.users.push(m);const u=i||ee.companies.find(e=>e.id===a);u?.name&&(ne(m.id,"USER_REGISTERED",{type:"Company",id:a,name:u.name}),"create"===e.companySelection&&ne(m.id,"COMPANY_CREATED",{type:"Company",id:a,name:u.name})),te();const p=ee.users.find(e=>e.id===m.id),g=ee.companies.find(e=>e.id===a);return{success:!0,token:H({userId:p.id,companyId:g.id,role:p.role},V),refreshToken:H({userId:p.id},U),user:re(p),company:g}},checkEmailAvailability:async e=>{if(await D(120),!e)return{available:!1};const t=G(e);return{available:!se(t)}},lookupInviteToken:async e=>{if(await D(200),!e)throw new Error("An invite token is required.");const t=z(e),s=$.get(t);if(!s)throw new Error("Invite token not recognized.");const r=ee.companies.find(e=>e.id===s.companyId);if(!r)throw new Error("Company not found for invite token.");return{companyId:r.id,companyName:r.name||"Unnamed Company",companyType:r.type,allowedRoles:s.allowedRoles,suggestedRole:s.suggestedRole}},login:async e=>{await D(200);const t=G(e.email),s=se(t);if(!s)throw new Error("Invalid email or password.");if(!(!s.password||s.passwordHash&&s.passwordSalt)&&(await O(s),te()),!s.passwordHash||!s.passwordSalt)throw new Error("Invalid email or password.");if(!(await(async(e,t,s)=>((e,t)=>{if(e.length!==t.length)return!1;let s=0;for(let r=0;r<e.length;r++)s|=e.charCodeAt(r)^t.charCodeAt(r);return 0===s})(await P(e,s),t))(e.password,s.passwordHash,s.passwordSalt)))throw new Error("Invalid email or password.");return s.mfaEnabled?{success:!0,mfaRequired:!0,userId:s.id}:oe.finalizeLogin(s.id)},verifyMfa:async(e,t)=>{if(await D(200),"123456"!==t)throw new Error("Invalid MFA code.");return oe.finalizeLogin(e)},finalizeLogin:async e=>{await D();const t=ee.users.find(t=>t.id===e);if(!t)throw new Error("User not found during finalization.");const s=ee.companies.find(e=>e.id===t.companyId);if(!s)throw new Error("Company not found for user.");return{success:!0,token:H({userId:t.id,companyId:s.id,role:t.role},V),refreshToken:H({userId:t.id},U),user:re(t),company:s}},refreshToken:async e=>{await D();const t=q(e);if(!t)throw new Error("Invalid refresh token");const s=ee.users.find(e=>e.id===t.userId);if(!s)throw new Error("User not found for refresh token");return{token:H({userId:s.id,companyId:s.companyId,role:s.role},V)}},me:async e=>{await D();const t=q(e);if(!t)throw new Error("Invalid or expired token");const s=ee.users.find(e=>e.id===t.userId),r=ee.companies.find(e=>e.id===t.companyId);if(!s||!r)throw new Error("User or company not found");return{user:re(s),company:r}},requestPasswordReset:async e=>{await D(300);const t=e?se(e):void 0;if(t){const s=`reset-${Date.now()}-${Math.random()}`;F.set(s,{userId:t.id,expires:Date.now()+36e5}),console.log(`Password reset for ${e}. Token: ${s}`)}return{success:!0}},resetPassword:async(e,t)=>{await D(300);const s=F.get(e);if(!s||s.expires<Date.now())throw new Error("Invalid or expired password reset token.");const r=ee.users.findIndex(e=>e.id===s.userId);if(-1===r)throw new Error("User not found.");const n=await L(t);return ee.users[r].passwordHash=n.hash,ee.users[r].passwordSalt=n.salt,delete ee.users[r].password,te(),F.delete(e),{success:!0}}};Z("asagents_offline_queue",[]),Z("asagents_failed_sync_actions",[]);const ae=async(e,t,s,r)=>{const n=ee.users.findIndex(t=>t.id===e);if(-1===n)throw new Error("User not found");const o={...t};if(o.email&&(o.email=G(o.email)),t?.password){const e=await L(t.password);o.passwordHash=e.hash,o.passwordSalt=e.salt,delete o.password}return ee.users[n]={...ee.users[n],...o},delete ee.users[n].password,void 0!==s&&(ee.projectAssignments=ee.projectAssignments.filter(t=>t.userId!==e),s.forEach(t=>ee.projectAssignments.push({userId:e,projectId:String(t)}))),te(),re(ee.users[n])},ie={};var ce={};class le extends Error{constructor(e,t){super(e),this.cause=t,this.name="BackendUnavailableError"}}const de=e=>{if(!e)return null;const t=e.trim();return t?t.replace(/\/+$/,""):null},me="undefined"!=typeof process&&(ce?.VITEST||ce?.VITEST_WORKER_ID)?null:"undefined"!=typeof window&&"string"==typeof window.__ASAGENTS_API_BASE_URL__?de(window.__ASAGENTS_API_BASE_URL__):void 0!==import.meta&&ie?.VITE_API_BASE_URL?de(void 0):"undefined"!=typeof process&&"string"==typeof ce?.VITE_API_BASE_URL?de(ce.VITE_API_BASE_URL):null;let ue=me,he=!me;const pe=(e,t)=>{const s=new Headers(e??{});return s.has("Accept")||s.set("Accept","application/json"),null==t||""===t||s.has("Content-Type")||s.set("Content-Type","application/json"),s},ge=async(e,t,s)=>{if(!ue)return s();try{return await(async(e,t)=>{if(!ue)throw new le("No authentication backend configured.");const s=`${ue}${(e=>e.startsWith("/")?e:`/${e}`)(e)}`;let r;try{r=await fetch(s,{...t,headers:pe(t.headers,t.body??void 0)})}catch(a){throw new le("Unable to reach authentication service.",a)}let n=null;const o=r.headers.get("content-type");if(o&&o.includes("application/json"))n=await r.json();else{const e=await r.text();n=e?{message:e}:{}}if(!r.ok){const e=n?.message||n?.error||`Request failed with status ${r.status}`,t=new Error(e);throw t.status=r.status,t.details=n,t}return n})(e,t)}catch(r){if(r instanceof le){if(he)return console.warn("[authClient] Falling back to local mock authentication.",r),s();const e=new Error("Authentication service is currently unavailable. Please try again later.");throw e.cause=r,e}throw r}},fe=e=>ge("/auth/register",{method:"POST",body:JSON.stringify(e)},()=>oe.register(e)),we=(e,t)=>ge("/auth/mfa/verify",{method:"POST",body:JSON.stringify({userId:e,code:t})},()=>oe.verifyMfa(e,t)),Ee=e=>ge("/auth/token/refresh",{method:"POST",body:JSON.stringify({refreshToken:e})},()=>oe.refreshToken(e)),xe=e=>ge("/auth/me",{method:"GET",headers:{Authorization:`Bearer ${e}`}},()=>oe.me(e)),Ae=e=>ge("/auth/password/request-reset",{method:"POST",body:JSON.stringify({email:e})},()=>oe.requestPasswordReset(e)),ye=(e,t)=>ge("/auth/password/reset",{method:"POST",body:JSON.stringify({token:e,newPassword:t})},()=>oe.resetPassword(e,t));class Se{constructor(){this.loginAttempts=new Map,this.activeSessions=new Map,this.maxLoginAttempts=5,this.lockoutDuration=9e5,this.sessionTimeout=18e5}static getInstance(){return Se.instance||(Se.instance=new Se),Se.instance}hasPermission(e,t,s){if(!e)return!1;if(e.role===h.PRINCIPAL_ADMIN)return!0;const r=v[e.role];if(!r)return!1;const n=r.has(t);return n&&s?this.checkContextualPermissions(e,t,s):n}isAccountLocked(e){return(this.loginAttempts.get(e)||[]).filter(e=>!e.success&&Date.now()-e.timestamp<this.lockoutDuration).length>=this.maxLoginAttempts}recordLoginAttempt(e,t,s){const r=this.loginAttempts.get(e)||[];r.push({email:e,timestamp:Date.now(),success:t,...s});const n=Date.now()-864e5,o=r.filter(e=>e.timestamp>n);this.loginAttempts.set(e,o)}validatePasswordStrength(e){const t=[];return e.length<8&&t.push("Password must be at least 8 characters long"),/[a-z]/.test(e)||t.push("Password must contain at least one lowercase letter"),/[A-Z]/.test(e)||t.push("Password must contain at least one uppercase letter"),/\d/.test(e)||t.push("Password must contain at least one number"),/[!@#$%^&*(),.?":{}|<>]/.test(e)||t.push("Password must contain at least one special character"),this.isCommonPassword(e)&&t.push("Password is too common, please choose a more unique password"),{isValid:0===t.length,errors:t}}createSession(e,t){const s=this.generateSessionId(),r=new Set(v[e.role]||[]),n={user:e,sessionId:s,lastActivity:Date.now(),permissions:r,...t};return this.activeSessions.set(s,n),this.cleanupExpiredSessions(),s}validateSession(e){const t=this.activeSessions.get(e);return t?Date.now()-t.lastActivity>this.sessionTimeout?(this.activeSessions.delete(e),null):(t.lastActivity=Date.now(),t):null}revokeSession(e){return this.activeSessions.delete(e)}revokeAllUserSessions(e){let t=0;for(const[s,r]of this.activeSessions.entries())r.user.id===e&&(this.activeSessions.delete(s),t++);return t}getSecurityMetrics(){const e=Date.now()-36e5;let t=0,s=0,r=0;for(const n of this.loginAttempts.values()){const o=n.filter(t=>t.timestamp>e);t+=o.length,s+=o.filter(e=>!e.success).length;o.filter(e=>!e.success).length>=this.maxLoginAttempts&&r++}return{activeSessions:this.activeSessions.size,totalLoginAttempts:t,failedLoginAttempts:s,lockedAccounts:r,successRate:t>0?(t-s)/t*100:100}}checkContextualPermissions(e,t,s){return t===p.MANAGE_TEAM&&s.userId?e.id===s.userId||this.hasPermission(e,p.MANAGE_TEAM):(t===p.VIEW_ALL_PROJECTS&&s.projectId,!0)}isCommonPassword(e){return["password","123456","123456789","qwerty","abc123","password123","admin","letmein","welcome","monkey"].includes(e.toLowerCase())}generateSessionId(){const e=new Uint8Array(32);return crypto.getRandomValues(e),Array.from(e,e=>e.toString(16).padStart(2,"0")).join("")}cleanupExpiredSessions(){const e=Date.now();for(const[t,s]of this.activeSessions.entries())e-s.lastActivity>this.sessionTimeout&&this.activeSessions.delete(t)}}const ve=(e,t)=>Se.getInstance().hasPermission(e,t),Ie=Se.getInstance();class Ne{constructor(){this.events=[],this.metrics=[],this.batchSize=50,this.flushInterval=3e4,this.maxRetries=3,this.currentSession=this.createSession(),this.setupPerformanceMonitoring(),this.setupAutoFlush(),this.setupPageVisibilityTracking()}static getInstance(){return Ne.instance||(Ne.instance=new Ne),Ne.instance}track(e,t){const s={name:e,properties:this.sanitizeProperties(t),timestamp:Date.now(),userId:this.getCurrentUserId(),sessionId:this.currentSession.id,metadata:{url:window.location.href,userAgent:navigator.userAgent,viewport:`${window.innerWidth}x${window.innerHeight}`}};this.events.push(s),this.currentSession.events.push(s),this.updateSessionActivity(),this.events.length>=this.batchSize&&this.flush()}trackPageView(e,t){this.track("page_view",{path:e,title:t||document.title,referrer:document.referrer}),this.currentSession.pageViews++}trackClick(e,t){this.track("click",{element:e,...t})}trackFormSubmit(e,t,s){this.track("form_submit",{form_name:e,success:t,errors:s})}trackSearch(e,t,s){this.track("search",{query:e,results_count:t,filters:s})}trackError(e,t){this.track("error",{error_name:e.name,error_message:e.message,error_stack:e.stack,context:t})}trackPerformance(e,t,s,r){const n={name:e,value:t,unit:s,timestamp:Date.now(),tags:r};this.metrics.push(n),this.metrics.length>=this.batchSize&&this.flushMetrics()}trackLoadTime(e,t){this.trackPerformance("page_load_time",t,"ms",{page:e})}trackApiCall(e,t,s,r){this.trackPerformance("api_call_duration",s,"ms",{endpoint:e,method:t,status:r.toString()})}identify(e,t){this.currentSession.userId=e,this.track("identify",{user_id:e,traits:this.sanitizeProperties(t)})}startNewSession(){this.endCurrentSession(),this.currentSession=this.createSession()}endCurrentSession(){this.track("session_end",{session_duration:Date.now()-this.currentSession.startTime,page_views:this.currentSession.pageViews,events_count:this.currentSession.events.length}),this.flush()}getSessionData(){return{...this.currentSession}}getEventsSummary(e){const t=e?this.events.filter(t=>t.timestamp>=e.start&&t.timestamp<=e.end):this.events,s=t.reduce((e,t)=>(e[t.name]=(e[t.name]||0)+1,e),{});return{totalEvents:t.length,eventTypes:Object.keys(s).length,breakdown:s}}getPerformanceMetrics(e){const t=e?this.metrics.filter(t=>t.name===e):this.metrics;if(0===t.length)return null;const s=t.map(e=>e.value);return{count:t.length,min:Math.min(...s),max:Math.max(...s),avg:s.reduce((e,t)=>e+t,0)/s.length,p95:this.percentile(s,95),p99:this.percentile(s,99)}}async flush(){if(0===this.events.length)return;const e=[...this.events];this.events=[];try{await this.sendEvents(e)}catch(t){console.error("Failed to send analytics events:",t),this.events.unshift(...e)}}async flushMetrics(){if(0===this.metrics.length)return;const e=[...this.metrics];this.metrics=[];try{await this.sendMetrics(e)}catch(t){console.error("Failed to send performance metrics:",t),this.metrics.unshift(...e)}}createSession(){return{id:this.generateSessionId(),startTime:Date.now(),lastActivity:Date.now(),pageViews:0,events:[],userAgent:navigator.userAgent,referrer:document.referrer}}updateSessionActivity(){this.currentSession.lastActivity=Date.now()}getCurrentUserId(){return this.currentSession.userId}generateSessionId(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}sanitizeProperties(e){if(!e)return;const t={};for(const[s,r]of Object.entries(e))"function"!=typeof r&&void 0!==r&&("string"==typeof r&&r.length>1e3?t[s]=r.substring(0,1e3)+"...":t[s]=r);return t}setupPerformanceMonitoring(){if("performance"in window&&"getEntriesByType"in performance&&window.addEventListener("load",()=>{setTimeout(()=>{const e=performance.getEntriesByType("navigation")[0];e&&this.trackLoadTime("initial_page_load",e.loadEventEnd-e.fetchStart)},0)}),"PerformanceObserver"in window)try{new PerformanceObserver(e=>{for(const t of e.getEntries())this.trackPerformance("long_task",t.duration,"ms")}).observe({entryTypes:["longtask"]})}catch(e){console.warn("Long task monitoring not supported")}}setupAutoFlush(){setInterval(()=>{this.flush(),this.flushMetrics()},this.flushInterval),window.addEventListener("beforeunload",()=>{this.endCurrentSession()})}setupPageVisibilityTracking(){document.addEventListener("visibilitychange",()=>{document.hidden?this.track("page_hidden"):(this.track("page_visible"),this.updateSessionActivity())})}async sendEvents(e){console.log("Sending analytics events:",e),await new Promise(e=>setTimeout(e,100))}async sendMetrics(e){console.log("Sending performance metrics:",e),await new Promise(e=>setTimeout(e,100))}percentile(e,t){const s=[...e].sort((e,t)=>e-t);return s[Math.ceil(t/100*s.length)-1]}}const Te=Ne.getInstance();R();const be=r.createContext(void 0);let _e=null;const je=({children:e})=>{const[t,s]=r.useState({isAuthenticated:!1,token:null,refreshToken:null,user:null,company:null,loading:!0,error:null}),n=R(),o=r.useCallback(()=>{n.removeItem("token"),n.removeItem("refreshToken"),_e&&clearTimeout(_e),s({isAuthenticated:!1,token:null,refreshToken:null,user:null,company:null,loading:!1,error:null})},[]),a=e=>{_e&&clearTimeout(_e);const t=(e=>{try{return JSON.parse(atob(e.split(".")[1]))}catch(t){return null}})(e);if(t&&t.exp){const r=1e3*t.exp-Date.now()-6e4;r>0?_e=setTimeout(async()=>{const t=n.getItem("refreshToken");if(t)try{console.log("Proactively refreshing token...");const{token:r}=await Ee(t);n.setItem("token",r),s(e=>({...e,token:r})),r!==e&&a(r)}catch(r){console.error("Proactive token refresh failed",r),n.removeItem("token"),n.removeItem("refreshToken"),_e&&clearTimeout(_e),s({isAuthenticated:!1,token:null,refreshToken:null,user:null,company:null,loading:!1,error:null})}},r):(console.warn("Token is already expired or has less than a minute left. Logging out."),n.removeItem("token"),n.removeItem("refreshToken"),_e&&clearTimeout(_e),s({isAuthenticated:!1,token:null,refreshToken:null,user:null,company:null,loading:!1,error:null}))}},i=r.useCallback(e=>{n.setItem("token",e.token),n.setItem("refreshToken",e.refreshToken),s({isAuthenticated:!0,token:e.token,refreshToken:e.refreshToken,user:e.user,company:e.company,loading:!1,error:null}),a(e.token)},[]);r.useEffect(()=>((async()=>{const e=n.getItem("token"),t=n.getItem("refreshToken");if(e&&t)try{const{user:s,company:r}=await xe(e);i({token:e,refreshToken:t,user:s,company:r})}catch(r){console.log("Access token invalid, attempting reactive refresh...");try{const{token:e}=await Ee(t),{user:s,company:r}=await xe(e);i({token:e,refreshToken:t,user:s,company:r})}catch(a){console.error("Auth init with refresh token failed, logging out.",a),o()}}else s(e=>({...e,loading:!1}))})(),()=>{_e&&clearTimeout(_e)}),[]);const c={...t,login:async e=>{s(e=>({...e,loading:!0,error:null}));const t=_.validate(e,[{field:"email",required:!0,type:"email",sanitize:_.sanitizers.normalizeEmail},{field:"password",required:!0,type:"string",minLength:1}]);if(!t.isValid){const e=new Error(`Invalid credentials: ${Object.values(t.errors).flat().join(", ")}`);throw s(t=>({...t,loading:!1,error:e.message})),e}if(Ie.isAccountLocked(e.email)){const t=new Error("Account temporarily locked due to multiple failed login attempts");throw s(e=>({...e,loading:!1,error:t.message})),Ie.recordLoginAttempt(e.email,!1,{ipAddress:"unknown",userAgent:navigator.userAgent}),t}try{const r=await oe.login(t.sanitizedData);return Ie.recordLoginAttempt(e.email,!0,{ipAddress:"unknown",userAgent:navigator.userAgent}),r.mfaRequired?(s(e=>({...e,loading:!1})),{mfaRequired:!0,userId:r.userId}):(i(r),{mfaRequired:!1})}catch(r){throw Ie.recordLoginAttempt(e.email,!1,{ipAddress:"unknown",userAgent:navigator.userAgent}),Te.trackError(r,{operation:"login",email:e.email}),s(e=>({...e,token:null,refreshToken:null,user:null,company:null,isAuthenticated:!1,loading:!1,error:r.message||"Login failed"})),r}},register:async e=>{s(e=>({...e,loading:!0,error:null}));try{const t=await fe(e);return i(t),t}catch(t){throw s(e=>({...e,loading:!1,error:t.message||"Registration failed"})),t}},logout:o,hasPermission:e=>ve(t.user,e),verifyMfaAndFinalize:async(e,t)=>{s(e=>({...e,loading:!0,error:null}));try{const s=await we(e,t);i(s)}catch(r){throw s(e=>({...e,loading:!1,error:r.message||"MFA verification failed"})),r}},updateUserProfile:async e=>{if(!t.user)throw new Error("Not authenticated");const r=await ae(t.user.id,e,void 0,t.user.id);s(e=>({...e,user:{...e.user,...r}}))},requestPasswordReset:async e=>{s(e=>({...e,loading:!0,error:null}));try{await Ae(e),s(e=>({...e,loading:!1}))}catch(t){throw s(e=>({...e,loading:!1,error:t.message||"Request failed"})),t}},resetPassword:async(e,t)=>{s(e=>({...e,loading:!0,error:null}));try{await ye(e,t),s(e=>({...e,loading:!1}))}catch(r){throw s(e=>({...e,loading:!1,error:r.message||"Password reset failed"})),r}}};return d.jsx(be.Provider,{value:c,children:e})},Re=()=>{const e=r.useContext(be);if(void 0===e)throw new Error("useAuth must be used within an AuthProvider");return e},Me=({children:e,className:t="",...s})=>d.jsx("div",{className:`bg-card text-card-foreground rounded-[--radius] border border-border p-6 shadow-sm transition-all duration-300 ${t}`,...s,children:e}),ke=({size:e})=>d.jsxs("svg",{className:`animate-spin ${{sm:"h-4 w-4",md:"h-5 w-5",lg:"h-6 w-6"}[e]}`,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[d.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),d.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),Ce=({children:e,variant:t="primary",size:s="md",className:r="",isLoading:n=!1,...o})=>d.jsx("button",{className:`inline-flex items-center justify-center rounded-md font-semibold focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:opacity-60 disabled:cursor-not-allowed transition-all duration-200 transform hover:scale-[1.02] active:scale-[0.98] ${{primary:"bg-primary text-primary-foreground hover:bg-primary/90 shadow-sm",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80 border border-border",success:"bg-green-600 hover:bg-green-700 focus:ring-green-500 text-white shadow-sm",danger:"bg-destructive text-destructive-foreground hover:bg-destructive/90 shadow-sm",ghost:"bg-transparent hover:bg-accent focus:ring-ring text-accent-foreground"}[t]} ${{sm:"px-3 py-1.5 text-xs h-9",md:"px-5 py-2 text-sm h-10",lg:"px-6 py-3 text-base h-12"}[s]} ${r}`,...o,disabled:o.disabled||n,children:n?d.jsx(ke,{size:s}):e}),Pe="asagents_remembered_email",Le=R(),Oe=(e,t)=>{try{e&&t?Le.setItem(Pe,(e=>e.trim().toLowerCase())(t)):Le.removeItem(Pe)}catch(s){console.warn("Unable to persist remembered email",s)}},De=({align:e="center",className:t=""})=>{const s="left"===e?"text-left":"text-center";return d.jsx("p",{className:`text-xs text-muted-foreground ${s} ${t}`.trim(),children:"Operating in secure offline demo mode. Accounts are stored locally in your browser."})},Ve=({onSwitchToRegister:e,onSwitchToForgotPassword:t})=>{const{login:s,verifyMfaAndFinalize:n,error:o,loading:a}=Re(),[i,c]=r.useState("credentials"),l=(()=>{try{return Le.getItem(Pe)||""}catch(y){return console.warn("Unable to read remembered email",y),""}})(),[m,u]=r.useState(l),[h,p]=r.useState(""),[g,f]=r.useState(""),[w,E]=r.useState(""!==l),[x,A]=r.useState(!1),[y,S]=r.useState(null),[v,I]=r.useState({}),[N,T]=r.useState(null),b=r.useRef(null);r.useEffect(()=>{S(o)},[o]),r.useEffect(()=>{w||Oe(!1,"")},[w]),r.useEffect(()=>{"mfa"===i&&b.current?.focus()},[i]);const _=e=>{I(t=>{if(!t[e])return t;const s={...t};return delete s[e],s})},j=async e=>{e.preventDefault(),S(null);const t={},r=m.trim();if((e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e))(r)||(t.email="Please enter a valid email."),h.length<6&&(t.password="Password is too short."),I(t),!(Object.keys(t).length>0))try{u(r);const e=await s({email:r,password:h,rememberMe:w});e.mfaRequired&&e.userId?(T(e.userId),c("mfa"),f(""),I(e=>{if(!e.mfa)return e;const t={...e};return delete t.mfa,t})):Oe(w,r.toLowerCase()),p("")}catch(n){}},R=async e=>{if(e.preventDefault(),S(null),6===g.length)try{if(!N)throw new Error("User ID not found");await n(N,g),Oe(w,m.trim().toLowerCase()),f("")}catch(t){}else I({mfa:"Code must be 6 digits."})};return d.jsxs("div",{className:"min-h-screen bg-background flex flex-col justify-center py-12 sm:px-6 lg:px-8",children:[d.jsxs("div",{className:"sm:mx-auto sm:w-full sm:max-w-md text-center",children:[d.jsxs("div",{className:"inline-flex items-center justify-center gap-2 mb-2",children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",className:"w-10 h-10 text-primary",children:d.jsx("path",{fill:"currentColor",d:"M12 2L2 22h20L12 2z"})}),d.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"AS Agents"})]}),d.jsx("h2",{className:"text-muted-foreground",children:"Sign in to your account"})]}),d.jsxs(Me,{className:"mt-8 sm:mx-auto sm:w-full sm:max-w-md",children:[d.jsx(De,{className:"mb-4"}),y&&d.jsx("div",{className:"mb-4 p-3 bg-destructive/10 text-destructive text-sm rounded-md border border-destructive/20",children:y}),"credentials"===i?d.jsxs("form",{onSubmit:j,className:"space-y-6",children:[d.jsxs("div",{children:[d.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-muted-foreground",children:"Email Address"}),d.jsx("input",{id:"email",type:"email",value:m,onChange:e=>{u(e.target.value),_("email"),S(null)},required:!0,autoComplete:"email",className:"mt-1 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm "+(v.email?"border-destructive":"border-border")}),v.email&&d.jsx("p",{className:"text-xs text-destructive mt-1",children:v.email})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-muted-foreground",children:"Password"}),d.jsxs("div",{className:"relative mt-1",children:[d.jsx("input",{id:"password",type:x?"text":"password",value:h,onChange:e=>{p(e.target.value),_("password"),S(null)},required:!0,autoComplete:"current-password",className:"block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm pr-12 "+(v.password?"border-destructive":"border-border")}),d.jsx("button",{type:"button",onClick:()=>A(e=>!e),className:"absolute inset-y-0 right-2 flex items-center text-xs font-medium text-muted-foreground hover:text-foreground","aria-label":x?"Hide password":"Show password",children:x?"Hide":"Show"})]}),v.password&&d.jsx("p",{className:"text-xs text-destructive mt-1",children:v.password})]}),d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"flex items-center",children:[d.jsx("input",{id:"remember-me",type:"checkbox",checked:w,onChange:e=>E(e.target.checked),className:"h-4 w-4 text-primary focus:ring-ring border-border rounded"}),d.jsx("label",{htmlFor:"remember-me",className:"ml-2 block text-sm text-muted-foreground",children:"Remember me"})]}),d.jsx("div",{className:"text-sm",children:d.jsx("button",{type:"button",onClick:t,className:"font-medium text-primary hover:text-primary/90",children:"Forgot your password?"})})]}),d.jsx("div",{children:d.jsx(Ce,{type:"submit",className:"w-full",isLoading:a,children:"Sign in"})})]}):d.jsxs("form",{onSubmit:R,className:"space-y-6",children:[d.jsxs("div",{className:"text-center",children:[d.jsx("h3",{className:"text-lg font-medium text-foreground",children:"Two-Factor Authentication"}),d.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:"Enter the 6-digit code from your authenticator app."})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"mfa",className:"sr-only",children:"Authentication Code"}),d.jsx("input",{id:"mfa",type:"text",ref:b,value:g,onChange:e=>{const t=e.target.value.replace(/\D/g,"");f(t),_("mfa"),S(null)},maxLength:6,required:!0,inputMode:"numeric",autoComplete:"one-time-code",className:"block w-full text-center text-2xl tracking-[0.5em] px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary "+(v.mfa?"border-destructive":"border-border")}),v.mfa&&d.jsx("p",{className:"text-xs text-destructive mt-1 text-center",children:v.mfa})]}),d.jsx("div",{children:d.jsx(Ce,{type:"submit",className:"w-full",isLoading:a,children:"Verify"})}),d.jsx("div",{className:"text-center",children:d.jsx("button",{type:"button",onClick:()=>c("credentials"),className:"text-sm font-medium text-primary hover:text-primary/90",children:"Back to login"})})]})]}),d.jsxs("p",{className:"mt-6 text-center text-sm text-muted-foreground",children:["Not a member?"," ",d.jsx("button",{onClick:e,className:"font-semibold text-primary hover:text-primary/80",children:"Create an account"})]})]})},Ue=({view:e,label:t,icon:s,activeView:r,setActiveView:n,badgeCount:o})=>d.jsxs("button",{onClick:()=>n(e),className:"w-full flex items-center justify-between gap-3 px-3 py-2 rounded-md text-sm transition-colors "+(r===e?"bg-primary text-primary-foreground font-semibold shadow":"text-muted-foreground hover:bg-accent hover:text-accent-foreground"),children:[d.jsxs("div",{className:"flex items-center gap-3",children:[s,d.jsx("span",{children:t})]}),o&&o>0&&d.jsx("span",{className:"ml-auto bg-red-500 text-white text-xs font-bold px-2 py-0.5 rounded-full",children:o>99?"99+":o})]}),Ge=({user:e,activeView:t,setActiveView:s,onLogout:r,pendingTimesheetCount:n=0,openIncidentCount:o=0,unreadMessageCount:a=0,companyName:i})=>e?d.jsxs("aside",{className:"w-64 bg-card border-r border-border flex flex-col flex-shrink-0 h-full p-4",children:[d.jsxs("div",{className:"flex items-center gap-2 mb-6 px-2",children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",className:"w-8 h-8 text-primary",children:d.jsx("path",{fill:"currentColor",d:"M12 2L2 22h20L12 2z"})}),d.jsxs("div",{children:[d.jsx("h1",{className:"text-xl font-bold text-foreground",children:"AS Agents"}),i&&d.jsx("p",{className:"text-xs text-muted-foreground",children:i})]})]}),d.jsxs("nav",{className:"flex flex-col gap-2",children:[d.jsx(Ue,{view:"dashboard",label:"Dashboard",icon:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})}),activeView:t,setActiveView:s}),d.jsx(Ue,{view:"tools",label:"Tools",icon:d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924-1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),activeView:t,setActiveView:s,badgeCount:a}),d.jsx(Ue,{view:"timesheets",label:"Timesheets",icon:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})}),activeView:t,setActiveView:s,badgeCount:n}),d.jsx(Ue,{view:"safety",label:"Safety",icon:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})}),activeView:t,setActiveView:s,badgeCount:o}),d.jsx("div",{className:"mt-4 border-t border-border pt-4",children:d.jsx(Ue,{view:"settings",label:"Settings",icon:d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924-1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),activeView:t,setActiveView:s})})]}),d.jsx("div",{className:"mt-6",children:d.jsxs("button",{onClick:r,className:"flex w-full items-center justify-center gap-2 rounded-xl border border-red-200/70 bg-red-500/10 px-3 py-2 text-sm font-semibold text-red-600 transition hover:bg-red-500/20",children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",className:"h-5 w-5",fill:"none",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 7l-5 5 5 5M4 12h11"})}),"Sign out"]})})]}):null,ze=({name:e})=>d.jsxs(Me,{className:"p-6",children:[d.jsx("h3",{className:"font-semibold text-lg",children:e}),d.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"This tool will be restored next."})]}),Fe=({user:e,addToast:t,setActiveView:s})=>{const[n,o]=r.useState(null),a=[{id:"ai-advisor",name:"AI Advisor",description:"Chat with an AI expert on project management.",icon:"💬",component:d.jsx(ze,{name:"AI Advisor"}),permission:!0},{id:"bid-generator",name:"Bid Package Generator",description:"Generate professional bid packages and cover letters.",icon:"📝",component:d.jsx(ze,{name:"Bid Package Generator"}),permission:!0},{id:"cost-estimator",name:"Cost Estimator",description:"Estimate project costs based on specifications.",icon:"🧮",component:d.jsx(ze,{name:"Cost Estimator"}),permission:!0},{id:"daily-summary",name:"Daily Summary Generator",description:"AI-powered daily progress reports.",icon:"📰",component:d.jsx(ze,{name:"Daily Summary Generator"}),permission:!0},{id:"funding-bot",name:"FundingBot",description:"Discover grants and funding opportunities.",icon:"💰",component:d.jsx(ze,{name:"FundingBot"}),permission:!0},{id:"risk-bot",name:"RiskBot",description:"Analyze documents for compliance and financial risks.",icon:"⚠️",component:d.jsx(ze,{name:"RiskBot"}),permission:!0},{id:"safety-analysis",name:"Safety Analysis",description:"Identify trends from safety incident reports.",icon:"🛡️",component:d.jsx(ze,{name:"Safety Analysis"}),permission:!0},{id:"site-inspector",name:"AI Site Inspector",description:"Analyze site photos for progress and hazards.",icon:"📸",component:d.jsx(ze,{name:"AI Site Inspector"}),permission:!0},{id:"workforce-planner",name:"Workforce Planner",description:"Plan and allocate personnel to projects.",icon:"👥",component:d.jsx(ze,{name:"Workforce Planner"}),permission:ve(e,p.MANAGE_TEAM)},{id:"resource-scheduler",name:"Resource Scheduler",description:"View team and equipment schedules.",icon:"🗓️",component:d.jsx(ze,{name:"Resource Scheduler"}),permission:ve(e,p.MANAGE_EQUIPMENT)}].filter(e=>e.permission),i=a.find(e=>e.id===n);return i?d.jsxs("div",{children:[d.jsx("button",{onClick:()=>o(null),className:"flex items-center gap-2 text-sm text-slate-600 hover:text-slate-900 mb-4",children:"← Back to all tools"}),i.component]}):d.jsxs("div",{className:"space-y-6",children:[d.jsx("h2",{className:"text-3xl font-bold text-slate-800",children:"Tools"}),d.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:a.map(e=>d.jsxs(Me,{onClick:()=>o(e.id),className:"cursor-pointer hover:shadow-lg hover:-translate-y-1 transition-all",children:[d.jsx("div",{className:"text-3xl mb-2",children:e.icon}),d.jsx("h3",{className:"font-bold text-lg",children:e.name}),d.jsx("p",{className:"text-sm text-slate-600",children:e.description})]},e.id))})]})};class We extends r.Component{constructor(){super(...arguments),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("Uncaught error:",e,t)}render(){return this.state.hasError?d.jsxs(Me,{className:"border-destructive",children:[d.jsx("h2",{className:"text-xl font-bold text-destructive",children:"Something went wrong."}),d.jsx("p",{className:"text-muted-foreground mt-2",children:"A component on this dashboard has crashed. You can try refreshing the page."}),d.jsxs("details",{className:"mt-4 text-sm bg-muted p-2 rounded",children:[d.jsx("summary",{children:"Error Details"}),d.jsx("pre",{className:"whitespace-pre-wrap text-xs mt-2",children:this.state.error?.toString()})]}),d.jsx(Ce,{variant:"secondary",className:"mt-4",onClick:()=>window.location.reload(),children:"Refresh Page"})]}):this.props.children}}const Be=()=>{const{user:e,logout:t,loading:s}=Re(),[n,o]=r.useState("login"),[a,i]=r.useState("tools");if(s)return d.jsx("div",{className:"min-h-screen grid place-items-center p-6",children:d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),d.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Loading..."})]})});if(!e){if("register"===n)return d.jsx("div",{className:"min-h-screen grid place-items-center p-6",children:d.jsx("div",{className:"w-full max-w-lg",children:d.jsxs(Me,{className:"p-6",children:[d.jsx("h2",{className:"text-lg font-semibold",children:"Registration temporarily unavailable"}),d.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Please contact support or use an existing account."}),d.jsx("div",{className:"mt-4",children:d.jsx("button",{type:"button",className:"text-primary hover:underline",onClick:()=>o("login"),children:"Back to login"})})]})})});try{return d.jsx("div",{className:"min-h-screen grid place-items-center p-6",children:d.jsxs("div",{className:"w-full max-w-md",children:[d.jsx(Me,{className:"mb-6",children:d.jsxs("div",{className:"p-4",children:[d.jsx("h1",{className:"text-xl font-bold",children:"AS Agents CMS"}),d.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Sign in to continue"})]})}),d.jsx(Ve,{onSwitchToRegister:()=>o("register"),onSwitchToForgotPassword:()=>o("forgot")})]})})}catch(c){return console.error("Login component error:",c),d.jsx("div",{className:"min-h-screen grid place-items-center p-6",children:d.jsxs(Me,{className:"p-6 border-destructive",children:[d.jsx("h2",{className:"text-lg font-semibold text-destructive",children:"Login Error"}),d.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"There was an error loading the login form."}),d.jsx("button",{type:"button",className:"mt-4 px-4 py-2 bg-primary text-primary-foreground rounded",onClick:()=>window.location.reload(),children:"Reload Page"})]})})}}return d.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[d.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",className:"h-6 w-6 text-primary","aria-hidden":!0,children:[d.jsx("path",{fill:"currentColor",d:"M12 2l9.196 5.31a1 1 0 01.5.866v10.648a1 1 0 01-.5.866L12 24l-9.196-4.31a1 1 0 01-.5.866V8.176a1 1 0 01.5-.866L12 2z",opacity:.12}),d.jsx("path",{fill:"currentColor",d:"M12 4.5l-6.5 3.752v7.496L12 19.5l6.5-3.752V8.252L12 4.5zm0 1.732l5 2.886v5.764l-5 2.886-5-2.886V9.118l5-2.886z"})]}),d.jsx("h1",{className:"text-lg font-semibold",children:"AS Agents"})]}),d.jsx("button",{type:"button",onClick:t,className:"text-sm text-red-600 hover:underline",children:"Logout"})]}),d.jsxs("div",{className:"flex flex-1 min-h-0",children:[d.jsx(Ge,{user:e,activeView:a,setActiveView:i,onLogout:t,pendingTimesheetCount:0,openIncidentCount:0,unreadMessageCount:0,companyName:void 0}),d.jsx("main",{className:"flex-1 p-4 overflow-auto",children:"tools"===a?d.jsx(Fe,{user:e,addToast:(e,t)=>{"error"===t?console.error(e):console.log(e)},setActiveView:i}):d.jsxs(Me,{className:"p-6",children:[d.jsx("h2",{className:"text-xl font-semibold text-foreground",children:"Coming soon"}),d.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:['The "',a,'" view will be restored next.']})]})})]})]})},$e=()=>d.jsx(We,{children:d.jsx(je,{children:d.jsx(Be,{})})}),Je=document.getElementById("root");if(!Je)throw new Error("Could not find root element to mount to");u.createRoot(Je).render(d.jsx(n.StrictMode,{children:d.jsx($e,{})}));
