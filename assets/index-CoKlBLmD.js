import{r as e,a as t,g as s}from"./react-DiZ9e1Sl.js";import{r,R as a}from"./leaflet-D9Qn1H0p.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var n,o,i={exports:{}},c={};var l,d=(o||(o=1,i.exports=function(){if(n)return c;n=1;var t=e(),s=Symbol.for("react.element"),r=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,o=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function l(e,t,r){var n,c={},l=null,d=null;for(n in void 0!==r&&(l=""+r),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(d=t.ref),t)a.call(t,n)&&!i.hasOwnProperty(n)&&(c[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===c[n]&&(c[n]=t[n]);return{$$typeof:s,type:e,key:l,ref:d,props:c,_owner:o.current}}return c.Fragment=r,c.jsx=l,c.jsxs=l,c}()),i.exports),u={};const m=s(function(){if(l)return u;l=1;var e=t();return u.createRoot=e.createRoot,u.hydrateRoot=e.hydrateRoot,u}());var h=(e=>(e.OWNER="OWNER",e.ADMIN="ADMIN",e.PROJECT_MANAGER="PROJECT_MANAGER",e.FOREMAN="FOREMAN",e.OPERATIVE="OPERATIVE",e.CLIENT="CLIENT",e.PRINCIPAL_ADMIN="PRINCIPAL_ADMIN",e))(h||{}),p=(e=>(e.VIEW_ALL_PROJECTS="VIEW_ALL_PROJECTS",e.VIEW_ASSIGNED_PROJECTS="VIEW_ASSIGNED_PROJECTS",e.CREATE_PROJECT="CREATE_PROJECT",e.MANAGE_PROJECT_DETAILS="MANAGE_PROJECT_DETAILS",e.MANAGE_PROJECT_TEMPLATES="MANAGE_PROJECT_TEMPLATES",e.VIEW_ALL_TASKS="VIEW_ALL_TASKS",e.MANAGE_ALL_TASKS="MANAGE_ALL_TASKS",e.SUBMIT_TIMESHEET="SUBMIT_TIMESHEET",e.VIEW_ALL_TIMESHEETS="VIEW_ALL_TIMESHEETS",e.MANAGE_TIMESHEETS="MANAGE_TIMESHEETS",e.UPLOAD_DOCUMENTS="UPLOAD_DOCUMENTS",e.VIEW_DOCUMENTS="VIEW_DOCUMENTS",e.SUBMIT_SAFETY_REPORT="SUBMIT_SAFETY_REPORT",e.VIEW_SAFETY_REPORTS="VIEW_SAFETY_REPORTS",e.MANAGE_SAFETY_REPORTS="MANAGE_SAFETY_REPORTS",e.VIEW_FINANCES="VIEW_FINANCES",e.MANAGE_FINANCES="MANAGE_FINANCES",e.VIEW_TEAM="VIEW_TEAM",e.MANAGE_TEAM="MANAGE_TEAM",e.MANAGE_EQUIPMENT="MANAGE_EQUIPMENT",e.VIEW_AUDIT_LOG="VIEW_AUDIT_LOG",e.SEND_DIRECT_MESSAGE="SEND_DIRECT_MESSAGE",e.ACCESS_ALL_TOOLS="ACCESS_ALL_TOOLS",e.SUBMIT_EXPENSE="SUBMIT_EXPENSE",e))(p||{}),f=(e=>(e.TODO="TODO",e.IN_PROGRESS="IN_PROGRESS",e.DONE="DONE",e))(f||{}),g=(e=>(e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH",e))(g||{}),y=(e=>(e.PENDING="PENDING",e.APPROVED="APPROVED",e.REJECTED="REJECTED",e.PAID="PAID",e))(y||{}),w=(e=>(e.DRAFT="DRAFT",e.SENT="SENT",e.PAID="PAID",e.OVERDUE="OVERDUE",e.CANCELLED="CANCELLED",e))(w||{}),x=(e=>(e.PENDING="PENDING",e.APPROVED="APPROVED",e.REJECTED="REJECTED",e.DRAFT="DRAFT",e))(x||{}),E=(e=>(e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH",e.CRITICAL="CRITICAL",e))(E||{}),v=(e=>(e.REPORTED="REPORTED",e.UNDER_INVESTIGATION="UNDER_INVESTIGATION",e.RESOLVED="RESOLVED",e))(v||{}),N=(e=>(e.AVAILABLE="AVAILABLE",e.IN_USE="IN_USE",e.MAINTENANCE="MAINTENANCE",e.OUT_OF_ORDER="OUT_OF_ORDER",e))(N||{});const b={OWNER:new Set(Object.values(p)),ADMIN:new Set(["VIEW_ALL_PROJECTS","CREATE_PROJECT","MANAGE_PROJECT_DETAILS","VIEW_ALL_TASKS","MANAGE_ALL_TASKS","VIEW_ALL_TIMESHEETS","MANAGE_TIMESHEETS","UPLOAD_DOCUMENTS","VIEW_DOCUMENTS","VIEW_SAFETY_REPORTS","MANAGE_SAFETY_REPORTS","VIEW_FINANCES","MANAGE_FINANCES","VIEW_TEAM","MANAGE_TEAM","MANAGE_EQUIPMENT","VIEW_AUDIT_LOG","SEND_DIRECT_MESSAGE","ACCESS_ALL_TOOLS","SUBMIT_EXPENSE","MANAGE_PROJECT_TEMPLATES"]),PROJECT_MANAGER:new Set(["VIEW_ALL_PROJECTS","MANAGE_PROJECT_DETAILS","VIEW_ALL_TASKS","MANAGE_ALL_TASKS","VIEW_ALL_TIMESHEETS","MANAGE_TIMESHEETS","UPLOAD_DOCUMENTS","VIEW_DOCUMENTS","VIEW_SAFETY_REPORTS","VIEW_FINANCES","VIEW_TEAM","MANAGE_EQUIPMENT","SEND_DIRECT_MESSAGE","SUBMIT_EXPENSE"]),FOREMAN:new Set(["VIEW_ASSIGNED_PROJECTS","SUBMIT_TIMESHEET","UPLOAD_DOCUMENTS","VIEW_DOCUMENTS","SUBMIT_SAFETY_REPORT","VIEW_SAFETY_REPORTS","SEND_DIRECT_MESSAGE","SUBMIT_EXPENSE"]),OPERATIVE:new Set(["VIEW_ASSIGNED_PROJECTS","SUBMIT_TIMESHEET","VIEW_DOCUMENTS","SUBMIT_SAFETY_REPORT","SUBMIT_EXPENSE"]),CLIENT:new Set(["VIEW_ASSIGNED_PROJECTS","VIEW_DOCUMENTS"]),PRINCIPAL_ADMIN:new Set(Object.values(p))},S={companies:[{id:"0",name:"Platform Administration"},{id:"1",name:"ConstructCo"},{id:"2",name:"Renovate Ltd."},{id:"3",name:"As Cladding and Roofing Ltd"}],users:[{id:"demo",firstName:"Demo",lastName:"User",email:"demo@example.com",role:h.ADMIN,companyId:"1",avatar:"https://i.pravatar.cc/150?u=demo",password:"password",mfaEnabled:!1},{id:"0",firstName:"Adrian",lastName:"Admin",email:"adrian@ascladdingltd.co.uk",role:h.PRINCIPAL_ADMIN,companyId:"0",avatar:"https://i.pravatar.cc/150?u=0",password:"Cumparavinde1",mfaEnabled:!1},{id:"1",firstName:"Samantha",lastName:"Lee",email:"sam@constructco.com",role:h.ADMIN,companyId:"1",avatar:"https://i.pravatar.cc/150?u=1",phone:"07123456781",password:"password123",mfaEnabled:!1},{id:"2",firstName:"David",lastName:"Chen",email:"david@constructco.com",role:h.PROJECT_MANAGER,companyId:"1",avatar:"https://i.pravatar.cc/150?u=2",phone:"07123456782",password:"password123",mfaEnabled:!0},{id:"3",firstName:"Maria",lastName:"Garcia",email:"maria@constructco.com",role:h.FOREMAN,companyId:"1",avatar:"https://i.pravatar.cc/150?u=3",phone:"07123456783",password:"password123",mfaEnabled:!1},{id:"4",firstName:"Bob",lastName:"Williams",email:"bob@constructco.com",role:h.OPERATIVE,companyId:"1",avatar:"https://i.pravatar.cc/150?u=4",phone:"07123456784",password:"password123",mfaEnabled:!1},{id:"5",firstName:"John",lastName:"Smith",email:"john@renovate.com",role:h.ADMIN,companyId:"2",avatar:"https://i.pravatar.cc/150?u=5",phone:"07123456785",password:"password123",mfaEnabled:!1},{id:"6",firstName:"Emily",lastName:"White",email:"emily@renovate.com",role:h.PROJECT_MANAGER,companyId:"2",avatar:"https://i.pravatar.cc/150?u=6",phone:"07123456786",password:"password123",mfaEnabled:!1},{id:"7",firstName:"Carlos",lastName:"Diaz",email:"carlos@constructco.com",role:h.OPERATIVE,companyId:"1",avatar:"https://i.pravatar.cc/150?u=7",phone:"07123456787",password:"password123",mfaEnabled:!1},{id:"8",firstName:"Admin",lastName:"User",email:"admin@ascladding.com",role:h.OWNER,companyId:"3",avatar:"https://i.pravatar.cc/150?u=8",phone:"07123456788",password:"password123",mfaEnabled:!1}],projects:[{id:"101",companyId:"1",name:"Downtown Tower",location:{address:"123 Main St, London",lat:51.5074,lng:-.1278},budget:5e6,spent:325e4,actualCost:325e4,startDate:"2023-01-15",status:"ACTIVE",image:"https://picsum.photos/seed/tower/800/400"},{id:"102",companyId:"1",name:"North Bridge Retrofit",location:{address:"456 Oak Ave, Manchester",lat:53.4808,lng:-2.2426},budget:12e5,spent:135e4,actualCost:135e4,startDate:"2022-11-01",status:"COMPLETED",image:"https://picsum.photos/seed/bridge/800/400"},{id:"201",companyId:"2",name:"Victorian House Reno",location:{address:"789 Pine Ln, Bristol",lat:51.4545,lng:-2.5879},budget:25e4,spent:18e4,actualCost:18e4,startDate:"2023-03-10",status:"ACTIVE",image:"https://picsum.photos/seed/house/800/400"}],todos:[{id:"t-1",text:"Finalize foundation pouring",title:"Finalize foundation pouring",status:f.IN_PROGRESS,priority:g.HIGH,assignedTo:"3",projectId:"101"},{id:"t-2",text:"Install HVAC system on floor 5",title:"Install HVAC system on floor 5",status:f.TODO,priority:g.MEDIUM,assignedTo:"4",projectId:"101"},{id:"t-3",text:"Source interior fixtures",title:"Source interior fixtures",status:f.TODO,priority:g.LOW,assignedTo:"2",projectId:"101"},{id:"t-4",text:"Strip wallpaper in living room",title:"Strip wallpaper in living room",status:f.DONE,priority:g.MEDIUM,assignedTo:"6",projectId:"201"}],expenses:[{id:"e-1",description:"Client Lunch",amount:150,category:"Other",projectId:"101",userId:"2",date:"2024-01-15",status:y.APPROVED}],invoices:[{id:"inv-1",companyId:"1",invoiceNumber:"INV-001",projectId:"101",clientId:"c-1",issueDate:"2024-01-20",dueDate:"2024-02-20",status:w.PAID,lineItems:[{id:"li-1",description:"Phase 1",quantity:1,rate:1e5,amount:1e5}],subtotal:1e5,taxRate:.2,taxAmount:2e4,retentionRate:.05,retentionAmount:5e3,total:115e3,amountPaid:115e3,balance:0}],siteUpdates:[{id:"su-1",projectId:"101",userId:"3",message:"Concrete pour for the ground floor is complete.",timestamp:new Date(Date.now()-72e5).toISOString(),images:["https://picsum.photos/seed/concrete/400/200"]}],projectMessages:[{id:"pm-1",projectId:"101",senderId:"2",message:"Team, please remember the safety briefing at 7 AM sharp tomorrow.",timestamp:new Date(Date.now()-12e5).toISOString()}],safetyIncidents:[{id:"si-1",title:"Minor Slip",description:"Minor slip on wet surface, no injury.",severity:E.LOW,projectId:"101",reportedBy:"3",incidentDate:(new Date).toISOString(),status:v.RESOLVED}],equipment:[{id:"eq-1",name:"Excavator CAT 320",status:N.AVAILABLE,companyId:"1"}],timeEntries:[{id:"te-1",userId:"4",projectId:"101",startTime:new Date(Date.now()-288e5).toISOString(),endTime:(new Date).toISOString(),status:x.PENDING}],projectInsights:[],financialForecasts:[],clients:[{id:"c-1",companyId:"1",name:"Global Real Estate Inc.",contactPerson:"Ava Harris",contactEmail:"ava.harris@gre.com",contactPhone:"+44 20 7946 0101",email:"accounts@gre.com",phone:"+44 20 7946 0101",billingAddress:"Accounts Payable, 100 Market Street, London SW1A 1AA",paymentTerms:"Net 30",isActive:!0,createdAt:"2024-01-15T09:00:00Z",updatedAt:"2024-12-10T10:30:00Z",address:{street:"100 Market Street",city:"London",state:"Greater London",zipCode:"SW1A 1AA",country:"United Kingdom"}},{id:"c-2",companyId:"1",name:"Northbridge Retail Group",contactPerson:"Leo Patel",contactEmail:"leo.patel@northbridge.com",contactPhone:"+44 161 555 0198",email:"finance@northbridge.com",phone:"+44 161 555 0198",billingAddress:"Finance Office, 50 King Street, Manchester M2 4LY",paymentTerms:"Net 45",isActive:!0,createdAt:"2024-11-28T12:00:00Z",updatedAt:"2024-12-15T08:15:00Z",address:{street:"50 King Street",city:"Manchester",state:"Greater Manchester",zipCode:"M2 4LY",country:"United Kingdom"}}]};var A={};class j{constructor(e={}){this.cache=new Map,this.defaultTtl=e.ttl||3e5,this.maxSize=e.maxSize||100,this.persistent=e.persistent||!1,this.namespace=e.namespace||"app-cache",this.persistent&&this.loadFromStorage(),"undefined"==typeof window||this.isTestEnv()||setInterval(()=>this.cleanup(),6e4)}isTestEnv(){try{return"undefined"!=typeof process&&!(!A?.VITEST&&!A?.VITEST_WORKER_ID)}catch{return!1}}set(e,t,s){const r=Date.now(),a={data:t,timestamp:r,ttl:s||this.defaultTtl,accessCount:0,lastAccessed:r};this.cache.size>=this.maxSize&&this.evictLRU(),this.cache.set(e,a),this.persistent&&this.saveToStorage()}get(e){const t=this.cache.get(e);if(!t)return null;const s=Date.now();return s-t.timestamp>t.ttl?(this.cache.delete(e),this.persistent&&this.saveToStorage(),null):(t.accessCount++,t.lastAccessed=s,t.data)}has(e){return null!==this.get(e)}delete(e){const t=this.cache.delete(e);return t&&this.persistent&&this.saveToStorage(),t}clear(){this.cache.clear(),this.persistent&&this.saveToStorage()}keys(){return Array.from(this.cache.keys())}size(){return this.cache.size}getStats(){const e=Array.from(this.cache.values());return{size:this.cache.size,maxSize:this.maxSize,totalAccesses:e.reduce((e,t)=>e+t.accessCount,0),averageAge:e.length>0?e.reduce((e,t)=>e+(Date.now()-t.timestamp),0)/e.length:0}}evictLRU(){let e="",t=Date.now();for(const[s,r]of this.cache.entries())r.lastAccessed<t&&(t=r.lastAccessed,e=s);e&&this.cache.delete(e)}cleanup(){const e=Date.now(),t=[];for(const[s,r]of this.cache.entries())e-r.timestamp>r.ttl&&t.push(s);t.forEach(e=>this.cache.delete(e)),t.length>0&&this.persistent&&this.saveToStorage()}saveToStorage(){if("undefined"!=typeof window&&window.localStorage)try{const e=JSON.stringify(Array.from(this.cache.entries()));localStorage.setItem(`${this.namespace}-cache`,e)}catch(e){console.warn("Failed to save cache to localStorage:",e)}}loadFromStorage(){if("undefined"!=typeof window&&window.localStorage)try{const e=localStorage.getItem(`${this.namespace}-cache`);if(e){const t=JSON.parse(e);this.cache=new Map(t),this.cleanup()}}catch(e){console.warn("Failed to load cache from localStorage:",e)}}}new j({ttl:3e5,maxSize:200,persistent:!0,namespace:"api-cache"}),new j({ttl:18e5,maxSize:50,persistent:!0,namespace:"user-cache"}),new j({ttl:6e5,maxSize:100,persistent:!0,namespace:"project-cache"});const I=class{static validate(e,t){const s={},r={...e};for(const a of t){const t=String(a.field),n=e[a.field],o=[];if(!a.required||null!=n&&""!==n){if(a.required||null!=n&&""!==n){if(a.type){const e=this.validateType(n,a.type,t);e&&o.push(e)}if("string"==typeof n&&(a.minLength&&n.length<a.minLength&&o.push(`${t} must be at least ${a.minLength} characters`),a.maxLength&&n.length>a.maxLength&&o.push(`${t} must not exceed ${a.maxLength} characters`)),"number"==typeof n&&(void 0!==a.min&&n<a.min&&o.push(`${t} must be at least ${a.min}`),void 0!==a.max&&n>a.max&&o.push(`${t} must not exceed ${a.max}`)),a.pattern&&"string"==typeof n&&!a.pattern.test(n)&&o.push(`${t} format is invalid`),a.custom){const e=a.custom(n);e&&o.push(e)}a.sanitize&&(r[a.field]=a.sanitize(n)),o.length>0&&(s[t]=o)}}else o.push(`${t} is required`)}return{isValid:0===Object.keys(s).length,errors:s,sanitizedData:0===Object.keys(s).length?r:void 0}}static validateType(e,t,s){switch(t){case"string":return"string"!=typeof e?`${s} must be a string`:null;case"number":return"number"!=typeof e||isNaN(e)?`${s} must be a valid number`:null;case"boolean":return"boolean"!=typeof e?`${s} must be true or false`:null;case"email":return"string"==typeof e&&this.emailRegex.test(e)?null:`${s} must be a valid email address`;case"phone":return"string"==typeof e&&this.phoneRegex.test(e.replace(/\s/g,""))?null:`${s} must be a valid phone number`;case"url":return"string"==typeof e&&this.urlRegex.test(e)?null:`${s} must be a valid URL`;case"date":const t=new Date(e);return isNaN(t.getTime())?`${s} must be a valid date`:null;default:return null}}};I.emailRegex=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,I.phoneRegex=/^[\+]?[1-9][\d]{0,15}$/,I.urlRegex=/^https?:\/\/.+/,I.sanitizers={trim:e=>"string"==typeof e?e.trim():e,toLowerCase:e=>"string"==typeof e?e.toLowerCase():e,toUpperCase:e=>"string"==typeof e?e.toUpperCase():e,removeSpecialChars:e=>"string"==typeof e?e.replace(/[^a-zA-Z0-9\s]/g,""):e,normalizePhone:e=>"string"==typeof e?e.replace(/\D/g,""):e,normalizeEmail:e=>"string"==typeof e?e.toLowerCase().trim():e,escapeHtml:e=>"string"!=typeof e?e:e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;"),limitLength:e=>t=>"string"==typeof t?t.substring(0,e):t},I.commonRules={email:{field:"email",required:!0,type:"email",sanitize:I.sanitizers.normalizeEmail},password:{field:"password",required:!0,type:"string",minLength:8,custom:e=>/(?=.*[a-z])/.test(e)?/(?=.*[A-Z])/.test(e)?/(?=.*\d)/.test(e)?null:"Password must contain at least one number":"Password must contain at least one uppercase letter":"Password must contain at least one lowercase letter"},phone:{field:"phone",type:"phone",sanitize:I.sanitizers.normalizePhone},name:{field:"name",required:!0,type:"string",minLength:2,maxLength:50,sanitize:I.sanitizers.trim},currency:{field:"amount",required:!0,type:"number",min:0,custom:e=>e<0?"Amount cannot be negative":e>1e6?"Amount exceeds maximum limit":null}};let T=I;let k=null;const _=()=>{if(k)return k;try{const e=globalThis;if(e&&e.localStorage){const t="__asagents_storage_test__";return e.localStorage.setItem(t,"1"),e.localStorage.removeItem(t),k=e.localStorage,k}}catch(e){console.warn("Falling back to in-memory storage adapter.",e)}return k=(()=>{const e=new Map;return{getItem:t=>e.has(t)?e.get(t):null,setItem(t,s){e.set(t,String(s))},removeItem(t){e.delete(t)},clear(){e.clear()},key:t=>Array.from(e.keys())[t]??null,get length(){return e.size}}})(),k},R=(()=>{if(void 0!==globalThis.crypto)return globalThis.crypto;throw new Error("Secure crypto APIs are not available in this environment.")})(),M=new TextEncoder,C=e=>Array.from(new Uint8Array(e)).map(e=>e.toString(16).padStart(2,"0")).join(""),P=async(e,t)=>{const s=M.encode(`${t}:${e}`),r=await R.subtle.digest("SHA-256",s);return C(r)},D=async e=>{const t=((e=16)=>{const t=new Uint8Array(e);return R.getRandomValues(t),C(t.buffer)})();return{hash:await P(e,t),salt:t}},O=async e=>{if(!e.passwordHash&&!e.passwordSalt&&e.password){const{hash:t,salt:s}=await D(e.password);e.passwordHash=t,e.passwordSalt=s,delete e.password}return e},L=(e=50)=>new Promise(t=>setTimeout(t,e)),U=9e5,V=6048e5,$=e=>e.trim().toLowerCase(),F=e=>e.trim().toUpperCase(),H=new Map,G=_(),z=[["JOIN-CONSTRUCTCO",{companyId:"1",allowedRoles:[h.ADMIN,h.PROJECT_MANAGER,h.FOREMAN,h.OPERATIVE],suggestedRole:h.PROJECT_MANAGER}],["JOIN-RENOVATE",{companyId:"2",allowedRoles:[h.ADMIN,h.PROJECT_MANAGER,h.FOREMAN,h.OPERATIVE],suggestedRole:h.FOREMAN}],["JOIN-CLIENT",{companyId:"3",allowedRoles:[h.CLIENT],suggestedRole:h.CLIENT}]],W=new Map;W.clear(),z.forEach(([e,t])=>{W.set(e,{...t})});const B=e=>{if("function"==typeof btoa)return btoa(e);if("undefined"!=typeof Buffer)return Buffer.from(e,"binary").toString("base64");throw new Error("Base64 encoding is not supported in this environment.")},q=(e,t)=>{const s={...e,iat:Date.now(),exp:Math.floor((Date.now()+t)/1e3)};return`${B(JSON.stringify({alg:"HS256",typ:"JWT"}))}.${B(JSON.stringify(s))}.${B("your-super-secret-key-for-mock-jwt")}`},J=e=>{try{const t=JSON.parse((e=>{if("function"==typeof atob)return atob(e);if("undefined"!=typeof Buffer)return Buffer.from(e,"base64").toString("binary");throw new Error("Base64 decoding is not supported in this environment.")})(e.split(".")[1]));if(1e3*t.exp<Date.now())throw new Error("Token expired");return t}catch(t){return console.error("Token decode/validation failed:",t),null}},Y="asagents_",K=e=>JSON.parse(JSON.stringify(e)),Z=(e,t)=>{try{const s=G.getItem(e);return s?JSON.parse(s):t}catch(s){return console.error(`Failed to read ${e} from storage`,s),t}},X={companies:K(S.companies),users:K(S.users),projects:K(S.projects),todos:K(S.todos),timeEntries:K(S.timeEntries),safetyIncidents:K(S.safetyIncidents),equipment:K(S.equipment),clients:K(S.clients),invoices:K(S.invoices),expenses:K(S.expenses||[]),siteUpdates:K(S.siteUpdates),projectMessages:K(S.projectMessages),notifications:K(S.notifications||[]),quotes:K(S.quotes||[]),auditLogs:[],resourceAssignments:[],conversations:[],messages:[],projectAssignments:[],projectTemplates:[],whiteboardNotes:[],documents:[],projectInsights:K(S.projectInsights||[]),financialForecasts:K(S.financialForecasts||[])},Q=e=>{const t=`${Y}${String(e)}`;try{const e=G.getItem(t);if(e)return JSON.parse(e)}catch(r){console.error(`Failed to hydrate ${String(e)} from storage`,r)}const s=K(X[e]);return G.setItem(t,JSON.stringify(s)),s};let ee={companies:Q("companies"),users:Q("users"),projects:Q("projects"),todos:Q("todos"),timeEntries:Q("timeEntries"),safetyIncidents:Q("safetyIncidents"),equipment:Q("equipment"),clients:Q("clients"),invoices:Q("invoices"),expenses:Q("expenses"),siteUpdates:Q("siteUpdates"),projectMessages:Q("projectMessages"),notifications:Q("notifications"),quotes:Q("quotes"),auditLogs:Q("auditLogs"),resourceAssignments:Q("resourceAssignments"),conversations:Q("conversations"),messages:Q("messages"),projectAssignments:Q("projectAssignments"),projectTemplates:Q("projectTemplates"),whiteboardNotes:Q("whiteboardNotes"),documents:Q("documents"),financialForecasts:Q("financialForecasts"),projectInsights:Q("projectInsights")};const te=()=>{Object.keys(ee).forEach(e=>{G.setItem(`${Y}${String(e)}`,JSON.stringify(ee[e]))})},se=e=>{const t=$(e);return ee.users.find(e=>e.email&&e.email.toLowerCase()===t)},re=e=>(e=>{const{password:t,passwordHash:s,passwordSalt:r,...a}=e;return a})(e);(()=>{const e=ee.users.filter(e=>e.password&&(!e.passwordHash||!e.passwordSalt));0!==e.length&&Promise.all(e.map(e=>O(e))).then(()=>{te()}).catch(e=>console.error("Failed to upgrade legacy user credentials",e))})();(()=>{let e=!1;ee.users.forEach(t=>{!t.role||t.permissions&&0!==t.permissions.length||(t.permissions=Array.from(b[t.role]),e=!0)}),e&&te()})();const ae=(e,t,s)=>{const r={id:String(Date.now()+Math.random()),actorId:e,action:t,target:s,timestamp:(new Date).toISOString()};ee.auditLogs.push(r),te()},ne={register:async e=>{if(await L(),!e.email||!e.password)throw new Error("Email and password are required.");if(!e.termsAccepted)throw new Error("You must accept the terms and conditions to create an account.");const t=$(e.email);if(se(t))throw new Error("An account with this email already exists.");const s=e.password.trim();if(![s.length>=8,/[A-Z]/.test(s),/[a-z]/.test(s),/\d/.test(s),/[^A-Za-z0-9]/.test(s)].every(Boolean))throw new Error("Password does not meet the minimum complexity requirements.");const r=e.firstName?.trim(),a=e.lastName?.trim(),n=e.phone?.trim();let o,i,c=e.role||h.OPERATIVE;if("create"===e.companySelection){const t=e.companyName?.trim(),s=e.companyType,r=e.companyEmail?$(e.companyEmail):void 0,a=e.companyPhone?.trim(),n=e.companyWebsite?.trim();if(!t||!s)throw new Error("Company information is incomplete.");const l=String(Date.now());o=l,i={id:o,name:t,type:s,email:r,phone:a,website:n,status:"Active",subscriptionPlan:"FREE",storageUsageGB:0,settings:{theme:"light",accessibility:{highContrast:!1},timeZone:"Europe/London",dateFormat:"DD/MM/YYYY",currency:"GBP",workingHours:{start:"08:00",end:"17:00",workDays:[1,2,3,4,5]},features:{projectManagement:!0,timeTracking:!0,financials:!0,documents:!0,safety:!0,equipment:!0,reporting:!0}},address:{street:"",city:"",state:"",zipCode:"",country:"United Kingdom"},createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()},ee.companies.push(i),W.set(`JOIN-${o}`,{companyId:o,allowedRoles:[h.ADMIN,h.PROJECT_MANAGER,h.FOREMAN,h.OPERATIVE],suggestedRole:h.ADMIN}),c=h.OWNER}else{if("join"!==e.companySelection)throw new Error("Invalid company selection.");{const t=e.inviteToken?F(e.inviteToken):"";if(!t)throw new Error("An invite token is required to join an existing company.");const s=W.get(t);if(!s)throw new Error("Invalid invite token.");if(o=s.companyId,i=ee.companies.find(e=>e.id===o),!i)throw new Error("Company not found for invite token.");if(e.role&&!s.allowedRoles.includes(e.role))throw new Error("Selected role is not permitted for this invite.");c=e.role&&s.allowedRoles.includes(e.role)?e.role:s.suggestedRole||s.allowedRoles[0]}}const l=await D(s),d=(new Date).toISOString(),u={id:String(Date.now()+Math.random()),firstName:r,lastName:a,email:t,passwordHash:l.hash,passwordSalt:l.salt,phone:n,role:c,permissions:Array.from(b[c]),companyId:o,isActive:!0,isEmailVerified:!0,mfaEnabled:!1,createdAt:d,updatedAt:d,preferences:{theme:"system",language:"en",notifications:{email:!0,push:!1,sms:!1,taskReminders:!0,projectUpdates:!0,systemAlerts:!0},dashboard:{defaultView:"dashboard",pinnedWidgets:[],hiddenWidgets:[]}}};!1===e.updatesOptIn&&(u.preferences.notifications.projectUpdates=!1),ee.users.push(u);const m=i||ee.companies.find(e=>e.id===o);m?.name&&(ae(u.id,"USER_REGISTERED",{type:"Company",id:o,name:m.name}),"create"===e.companySelection&&ae(u.id,"COMPANY_CREATED",{type:"Company",id:o,name:m.name})),te();const p=ee.users.find(e=>e.id===u.id),f=ee.companies.find(e=>e.id===o);return{success:!0,token:q({userId:p.id,companyId:f.id,role:p.role},U),refreshToken:q({userId:p.id},V),user:re(p),company:f}},checkEmailAvailability:async e=>{if(await L(120),!e)return{available:!1};const t=$(e);return{available:!se(t)}},lookupInviteToken:async e=>{if(await L(200),!e)throw new Error("An invite token is required.");const t=F(e),s=W.get(t);if(!s)throw new Error("Invite token not recognized.");const r=ee.companies.find(e=>e.id===s.companyId);if(!r)throw new Error("Company not found for invite token.");return{companyId:r.id,companyName:r.name||"Unnamed Company",companyType:r.type,allowedRoles:s.allowedRoles,suggestedRole:s.suggestedRole}},login:async e=>{await L(200);const t=$(e.email),s=se(t);if(!s)throw new Error("Invalid email or password.");if(!(!s.password||s.passwordHash&&s.passwordSalt)&&(await O(s),te()),!s.passwordHash||!s.passwordSalt)throw new Error("Invalid email or password.");if(!(await(async(e,t,s)=>((e,t)=>{if(e.length!==t.length)return!1;let s=0;for(let r=0;r<e.length;r++)s|=e.charCodeAt(r)^t.charCodeAt(r);return 0===s})(await P(e,s),t))(e.password,s.passwordHash,s.passwordSalt)))throw new Error("Invalid email or password.");return s.mfaEnabled?{success:!0,mfaRequired:!0,userId:s.id}:ne.finalizeLogin(s.id)},verifyMfa:async(e,t)=>{if(await L(200),"123456"!==t)throw new Error("Invalid MFA code.");return ne.finalizeLogin(e)},finalizeLogin:async e=>{await L();const t=ee.users.find(t=>t.id===e);if(!t)throw new Error("User not found during finalization.");const s=ee.companies.find(e=>e.id===t.companyId);if(!s)throw new Error("Company not found for user.");return{success:!0,token:q({userId:t.id,companyId:s.id,role:t.role},U),refreshToken:q({userId:t.id},V),user:re(t),company:s}},refreshToken:async e=>{await L();const t=J(e);if(!t)throw new Error("Invalid refresh token");const s=ee.users.find(e=>e.id===t.userId);if(!s)throw new Error("User not found for refresh token");return{token:q({userId:s.id,companyId:s.companyId,role:s.role},U)}},me:async e=>{await L();const t=J(e);if(!t)throw new Error("Invalid or expired token");const s=ee.users.find(e=>e.id===t.userId),r=ee.companies.find(e=>e.id===t.companyId);if(!s||!r)throw new Error("User or company not found");return{user:re(s),company:r}},requestPasswordReset:async e=>{await L(300);const t=e?se(e):void 0;if(t){const s=`reset-${Date.now()}-${Math.random()}`;H.set(s,{userId:t.id,expires:Date.now()+36e5}),console.log(`Password reset for ${e}. Token: ${s}`)}return{success:!0}},resetPassword:async(e,t)=>{await L(300);const s=H.get(e);if(!s||s.expires<Date.now())throw new Error("Invalid or expired password reset token.");const r=ee.users.findIndex(e=>e.id===s.userId);if(-1===r)throw new Error("User not found.");const a=await D(t);return ee.users[r].passwordHash=a.hash,ee.users[r].passwordSalt=a.salt,delete ee.users[r].password,te(),H.delete(e),{success:!0}}};Z("asagents_offline_queue",[]),Z("asagents_failed_sync_actions",[]);const oe=async(e,t,s,r)=>{const a=ee.users.findIndex(t=>t.id===e);if(-1===a)throw new Error("User not found");const n={...t};if(n.email&&(n.email=$(n.email)),t?.password){const e=await D(t.password);n.passwordHash=e.hash,n.passwordSalt=e.salt,delete n.password}return ee.users[a]={...ee.users[a],...n},delete ee.users[a].password,void 0!==s&&(ee.projectAssignments=ee.projectAssignments.filter(t=>t.userId!==e),s.forEach(t=>ee.projectAssignments.push({userId:e,projectId:String(t)}))),te(),re(ee.users[a])},ie={};var ce={};class le extends Error{constructor(e,t){super(e),this.cause=t,this.name="BackendUnavailableError"}}const de=e=>{if(!e)return null;const t=e.trim();return t?t.replace(/\/+$/,""):null},ue="undefined"!=typeof process&&(ce?.VITEST||ce?.VITEST_WORKER_ID)?null:"undefined"!=typeof window&&"string"==typeof window.__ASAGENTS_API_BASE_URL__?de(window.__ASAGENTS_API_BASE_URL__):void 0!==import.meta&&ie?.VITE_API_BASE_URL?de(void 0):"undefined"!=typeof process&&"string"==typeof ce?.VITE_API_BASE_URL?de(ce.VITE_API_BASE_URL):null;let me=ue,he=!ue;const pe=(e,t)=>{const s=new Headers(e??{});return s.has("Accept")||s.set("Accept","application/json"),null==t||""===t||s.has("Content-Type")||s.set("Content-Type","application/json"),s},fe=async(e,t,s)=>{if(!me)return s();try{return await(async(e,t)=>{if(!me)throw new le("No authentication backend configured.");const s=`${me}${(e=>e.startsWith("/")?e:`/${e}`)(e)}`;let r;try{r=await fetch(s,{...t,headers:pe(t.headers,t.body??void 0)})}catch(o){throw new le("Unable to reach authentication service.",o)}let a=null;const n=r.headers.get("content-type");if(n&&n.includes("application/json"))a=await r.json();else{const e=await r.text();a=e?{message:e}:{}}if(!r.ok){const e=a?.message||a?.error||`Request failed with status ${r.status}`,t=new Error(e);throw t.status=r.status,t.details=a,t}return a})(e,t)}catch(r){if(r instanceof le){if(he)return console.warn("[authClient] Falling back to local mock authentication.",r),s();const e=new Error("Authentication service is currently unavailable. Please try again later.");throw e.cause=r,e}throw r}},ge=e=>fe("/auth/register",{method:"POST",body:JSON.stringify(e)},()=>ne.register(e)),ye=(e,t)=>fe("/auth/mfa/verify",{method:"POST",body:JSON.stringify({userId:e,code:t})},()=>ne.verifyMfa(e,t)),we=e=>fe("/auth/token/refresh",{method:"POST",body:JSON.stringify({refreshToken:e})},()=>ne.refreshToken(e)),xe=e=>fe("/auth/me",{method:"GET",headers:{Authorization:`Bearer ${e}`}},()=>ne.me(e)),Ee=e=>fe("/auth/password/request-reset",{method:"POST",body:JSON.stringify({email:e})},()=>ne.requestPasswordReset(e)),ve=(e,t)=>fe("/auth/password/reset",{method:"POST",body:JSON.stringify({token:e,newPassword:t})},()=>ne.resetPassword(e,t));class Ne{constructor(){this.loginAttempts=new Map,this.activeSessions=new Map,this.maxLoginAttempts=5,this.lockoutDuration=9e5,this.sessionTimeout=18e5}static getInstance(){return Ne.instance||(Ne.instance=new Ne),Ne.instance}hasPermission(e,t,s){if(!e)return!1;if(e.role===h.PRINCIPAL_ADMIN)return!0;const r=b[e.role];if(!r)return!1;const a=r.has(t);return a&&s?this.checkContextualPermissions(e,t,s):a}isAccountLocked(e){return(this.loginAttempts.get(e)||[]).filter(e=>!e.success&&Date.now()-e.timestamp<this.lockoutDuration).length>=this.maxLoginAttempts}recordLoginAttempt(e,t,s){const r=this.loginAttempts.get(e)||[];r.push({email:e,timestamp:Date.now(),success:t,...s});const a=Date.now()-864e5,n=r.filter(e=>e.timestamp>a);this.loginAttempts.set(e,n)}validatePasswordStrength(e){const t=[];return e.length<8&&t.push("Password must be at least 8 characters long"),/[a-z]/.test(e)||t.push("Password must contain at least one lowercase letter"),/[A-Z]/.test(e)||t.push("Password must contain at least one uppercase letter"),/\d/.test(e)||t.push("Password must contain at least one number"),/[!@#$%^&*(),.?":{}|<>]/.test(e)||t.push("Password must contain at least one special character"),this.isCommonPassword(e)&&t.push("Password is too common, please choose a more unique password"),{isValid:0===t.length,errors:t}}createSession(e,t){const s=this.generateSessionId(),r=new Set(b[e.role]||[]),a={user:e,sessionId:s,lastActivity:Date.now(),permissions:r,...t};return this.activeSessions.set(s,a),this.cleanupExpiredSessions(),s}validateSession(e){const t=this.activeSessions.get(e);return t?Date.now()-t.lastActivity>this.sessionTimeout?(this.activeSessions.delete(e),null):(t.lastActivity=Date.now(),t):null}revokeSession(e){return this.activeSessions.delete(e)}revokeAllUserSessions(e){let t=0;for(const[s,r]of this.activeSessions.entries())r.user.id===e&&(this.activeSessions.delete(s),t++);return t}getSecurityMetrics(){const e=Date.now()-36e5;let t=0,s=0,r=0;for(const a of this.loginAttempts.values()){const n=a.filter(t=>t.timestamp>e);t+=n.length,s+=n.filter(e=>!e.success).length;n.filter(e=>!e.success).length>=this.maxLoginAttempts&&r++}return{activeSessions:this.activeSessions.size,totalLoginAttempts:t,failedLoginAttempts:s,lockedAccounts:r,successRate:t>0?(t-s)/t*100:100}}checkContextualPermissions(e,t,s){return t===p.MANAGE_TEAM&&s.userId?e.id===s.userId||this.hasPermission(e,p.MANAGE_TEAM):(t===p.VIEW_ALL_PROJECTS&&s.projectId,!0)}isCommonPassword(e){return["password","123456","123456789","qwerty","abc123","password123","admin","letmein","welcome","monkey"].includes(e.toLowerCase())}generateSessionId(){const e=new Uint8Array(32);return crypto.getRandomValues(e),Array.from(e,e=>e.toString(16).padStart(2,"0")).join("")}cleanupExpiredSessions(){const e=Date.now();for(const[t,s]of this.activeSessions.entries())e-s.lastActivity>this.sessionTimeout&&this.activeSessions.delete(t)}}const be=(e,t)=>Ne.getInstance().hasPermission(e,t),Se=Ne.getInstance();class Ae{constructor(){this.events=[],this.metrics=[],this.batchSize=50,this.flushInterval=3e4,this.maxRetries=3,this.currentSession=this.createSession(),this.setupPerformanceMonitoring(),this.setupAutoFlush(),this.setupPageVisibilityTracking()}static getInstance(){return Ae.instance||(Ae.instance=new Ae),Ae.instance}track(e,t){const s={name:e,properties:this.sanitizeProperties(t),timestamp:Date.now(),userId:this.getCurrentUserId(),sessionId:this.currentSession.id,metadata:{url:window.location.href,userAgent:navigator.userAgent,viewport:`${window.innerWidth}x${window.innerHeight}`}};this.events.push(s),this.currentSession.events.push(s),this.updateSessionActivity(),this.events.length>=this.batchSize&&this.flush()}trackPageView(e,t){this.track("page_view",{path:e,title:t||document.title,referrer:document.referrer}),this.currentSession.pageViews++}trackClick(e,t){this.track("click",{element:e,...t})}trackFormSubmit(e,t,s){this.track("form_submit",{form_name:e,success:t,errors:s})}trackSearch(e,t,s){this.track("search",{query:e,results_count:t,filters:s})}trackError(e,t){this.track("error",{error_name:e.name,error_message:e.message,error_stack:e.stack,context:t})}trackPerformance(e,t,s,r){const a={name:e,value:t,unit:s,timestamp:Date.now(),tags:r};this.metrics.push(a),this.metrics.length>=this.batchSize&&this.flushMetrics()}trackLoadTime(e,t){this.trackPerformance("page_load_time",t,"ms",{page:e})}trackApiCall(e,t,s,r){this.trackPerformance("api_call_duration",s,"ms",{endpoint:e,method:t,status:r.toString()})}identify(e,t){this.currentSession.userId=e,this.track("identify",{user_id:e,traits:this.sanitizeProperties(t)})}startNewSession(){this.endCurrentSession(),this.currentSession=this.createSession()}endCurrentSession(){this.track("session_end",{session_duration:Date.now()-this.currentSession.startTime,page_views:this.currentSession.pageViews,events_count:this.currentSession.events.length}),this.flush()}getSessionData(){return{...this.currentSession}}getEventsSummary(e){const t=e?this.events.filter(t=>t.timestamp>=e.start&&t.timestamp<=e.end):this.events,s=t.reduce((e,t)=>(e[t.name]=(e[t.name]||0)+1,e),{});return{totalEvents:t.length,eventTypes:Object.keys(s).length,breakdown:s}}getPerformanceMetrics(e){const t=e?this.metrics.filter(t=>t.name===e):this.metrics;if(0===t.length)return null;const s=t.map(e=>e.value);return{count:t.length,min:Math.min(...s),max:Math.max(...s),avg:s.reduce((e,t)=>e+t,0)/s.length,p95:this.percentile(s,95),p99:this.percentile(s,99)}}async flush(){if(0===this.events.length)return;const e=[...this.events];this.events=[];try{await this.sendEvents(e)}catch(t){console.error("Failed to send analytics events:",t),this.events.unshift(...e)}}async flushMetrics(){if(0===this.metrics.length)return;const e=[...this.metrics];this.metrics=[];try{await this.sendMetrics(e)}catch(t){console.error("Failed to send performance metrics:",t),this.metrics.unshift(...e)}}createSession(){return{id:this.generateSessionId(),startTime:Date.now(),lastActivity:Date.now(),pageViews:0,events:[],userAgent:navigator.userAgent,referrer:document.referrer}}updateSessionActivity(){this.currentSession.lastActivity=Date.now()}getCurrentUserId(){return this.currentSession.userId}generateSessionId(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}sanitizeProperties(e){if(!e)return;const t={};for(const[s,r]of Object.entries(e))"function"!=typeof r&&void 0!==r&&("string"==typeof r&&r.length>1e3?t[s]=r.substring(0,1e3)+"...":t[s]=r);return t}setupPerformanceMonitoring(){if("performance"in window&&"getEntriesByType"in performance&&window.addEventListener("load",()=>{setTimeout(()=>{const e=performance.getEntriesByType("navigation")[0];e&&this.trackLoadTime("initial_page_load",e.loadEventEnd-e.fetchStart)},0)}),"PerformanceObserver"in window)try{new PerformanceObserver(e=>{for(const t of e.getEntries())this.trackPerformance("long_task",t.duration,"ms")}).observe({entryTypes:["longtask"]})}catch(e){console.warn("Long task monitoring not supported")}}setupAutoFlush(){setInterval(()=>{this.flush(),this.flushMetrics()},this.flushInterval),window.addEventListener("beforeunload",()=>{this.endCurrentSession()})}setupPageVisibilityTracking(){document.addEventListener("visibilitychange",()=>{document.hidden?this.track("page_hidden"):(this.track("page_visible"),this.updateSessionActivity())})}async sendEvents(e){console.log("Sending analytics events:",e),await new Promise(e=>setTimeout(e,100))}async sendMetrics(e){console.log("Sending performance metrics:",e),await new Promise(e=>setTimeout(e,100))}percentile(e,t){const s=[...e].sort((e,t)=>e-t);return s[Math.ceil(t/100*s.length)-1]}}const je=Ae.getInstance();_();const Ie=r.createContext(void 0);let Te=null;const ke=({children:e})=>{const[t,s]=r.useState({isAuthenticated:!1,token:null,refreshToken:null,user:null,company:null,loading:!0,error:null}),a=_(),n=r.useCallback(()=>{a.removeItem("token"),a.removeItem("refreshToken"),Te&&clearTimeout(Te),s({isAuthenticated:!1,token:null,refreshToken:null,user:null,company:null,loading:!1,error:null})},[]),o=e=>{Te&&clearTimeout(Te);const t=(e=>{try{return JSON.parse(atob(e.split(".")[1]))}catch(t){return null}})(e);if(t&&t.exp){const r=1e3*t.exp-Date.now()-6e4;r>0?Te=setTimeout(async()=>{const t=a.getItem("refreshToken");if(t)try{console.log("Proactively refreshing token...");const{token:r}=await we(t);a.setItem("token",r),s(e=>({...e,token:r})),r!==e&&o(r)}catch(r){console.error("Proactive token refresh failed",r),a.removeItem("token"),a.removeItem("refreshToken"),Te&&clearTimeout(Te),s({isAuthenticated:!1,token:null,refreshToken:null,user:null,company:null,loading:!1,error:null})}},r):(console.warn("Token is already expired or has less than a minute left. Logging out."),a.removeItem("token"),a.removeItem("refreshToken"),Te&&clearTimeout(Te),s({isAuthenticated:!1,token:null,refreshToken:null,user:null,company:null,loading:!1,error:null}))}},i=r.useCallback(e=>{a.setItem("token",e.token),a.setItem("refreshToken",e.refreshToken),s({isAuthenticated:!0,token:e.token,refreshToken:e.refreshToken,user:e.user,company:e.company,loading:!1,error:null}),o(e.token)},[]);r.useEffect(()=>((async()=>{const e=a.getItem("token"),t=a.getItem("refreshToken");if(e&&t)try{const{user:s,company:r}=await xe(e);i({token:e,refreshToken:t,user:s,company:r})}catch(r){console.log("Access token invalid, attempting reactive refresh...");try{const{token:e}=await we(t),{user:s,company:r}=await xe(e);i({token:e,refreshToken:t,user:s,company:r})}catch(n){console.error("Auth init with refresh token failed, clearing auth state.",n),a.removeItem("token"),a.removeItem("refreshToken"),s({isAuthenticated:!1,token:null,refreshToken:null,user:null,company:null,loading:!1,error:null})}}else s(e=>({...e,loading:!1}))})(),()=>{Te&&clearTimeout(Te)}),[]);const c={...t,login:async e=>{s(e=>({...e,loading:!0,error:null}));const t=T.validate(e,[{field:"email",required:!0,type:"email",sanitize:T.sanitizers.normalizeEmail},{field:"password",required:!0,type:"string",minLength:1}]);if(!t.isValid){const e=new Error(`Invalid credentials: ${Object.values(t.errors).flat().join(", ")}`);throw s(t=>({...t,loading:!1,error:e.message})),e}if(Se.isAccountLocked(e.email)){const t=new Error("Account temporarily locked due to multiple failed login attempts");throw s(e=>({...e,loading:!1,error:t.message})),Se.recordLoginAttempt(e.email,!1,{ipAddress:"unknown",userAgent:navigator.userAgent}),t}try{const r=await ne.login(t.sanitizedData);return Se.recordLoginAttempt(e.email,!0,{ipAddress:"unknown",userAgent:navigator.userAgent}),r.mfaRequired?(s(e=>({...e,loading:!1})),{mfaRequired:!0,userId:r.userId}):(i(r),{mfaRequired:!1})}catch(r){throw Se.recordLoginAttempt(e.email,!1,{ipAddress:"unknown",userAgent:navigator.userAgent}),je.trackError(r,{operation:"login",email:e.email}),s(e=>({...e,token:null,refreshToken:null,user:null,company:null,isAuthenticated:!1,loading:!1,error:r.message||"Login failed"})),r}},register:async e=>{s(e=>({...e,loading:!0,error:null}));try{const t=await ge(e);return i(t),t}catch(t){throw s(e=>({...e,loading:!1,error:t.message||"Registration failed"})),t}},logout:n,hasPermission:e=>be(t.user,e),verifyMfaAndFinalize:async(e,t)=>{s(e=>({...e,loading:!0,error:null}));try{const s=await ye(e,t);i(s)}catch(r){throw s(e=>({...e,loading:!1,error:r.message||"MFA verification failed"})),r}},updateUserProfile:async e=>{if(!t.user)throw new Error("Not authenticated");const r=await oe(t.user.id,e,void 0,t.user.id);s(e=>({...e,user:{...e.user,...r}}))},requestPasswordReset:async e=>{s(e=>({...e,loading:!0,error:null}));try{await Ee(e),s(e=>({...e,loading:!1}))}catch(t){throw s(e=>({...e,loading:!1,error:t.message||"Request failed"})),t}},resetPassword:async(e,t)=>{s(e=>({...e,loading:!0,error:null}));try{await ve(e,t),s(e=>({...e,loading:!1}))}catch(r){throw s(e=>({...e,loading:!1,error:r.message||"Password reset failed"})),r}}};return d.jsx(Ie.Provider,{value:c,children:e})},_e=()=>{const e=r.useContext(Ie);if(void 0===e)throw new Error("useAuth must be used within an AuthProvider");return e},Re=({children:e,className:t="",...s})=>d.jsx("div",{className:`bg-card text-card-foreground rounded-[--radius] border border-border p-6 shadow-sm transition-all duration-300 ${t}`,...s,children:e}),Me=({size:e})=>d.jsxs("svg",{className:`animate-spin ${{sm:"h-4 w-4",md:"h-5 w-5",lg:"h-6 w-6"}[e]}`,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[d.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),d.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),Ce=({children:e,variant:t="primary",size:s="md",className:r="",isLoading:a=!1,...n})=>d.jsx("button",{className:`inline-flex items-center justify-center rounded-md font-semibold focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:opacity-60 disabled:cursor-not-allowed transition-all duration-200 transform hover:scale-[1.02] active:scale-[0.98] ${{primary:"bg-primary text-primary-foreground hover:bg-primary/90 shadow-sm",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80 border border-border",success:"bg-green-600 hover:bg-green-700 focus:ring-green-500 text-white shadow-sm",danger:"bg-destructive text-destructive-foreground hover:bg-destructive/90 shadow-sm",ghost:"bg-transparent hover:bg-accent focus:ring-ring text-accent-foreground"}[t]} ${{sm:"px-3 py-1.5 text-xs h-9",md:"px-5 py-2 text-sm h-10",lg:"px-6 py-3 text-base h-12"}[s]} ${r}`,...n,disabled:n.disabled||a,children:a?d.jsx(Me,{size:s}):e}),Pe="asagents_remembered_email",De=_(),Oe=(e,t)=>{try{e&&t?De.setItem(Pe,(e=>e.trim().toLowerCase())(t)):De.removeItem(Pe)}catch(s){console.warn("Unable to persist remembered email",s)}},Le=({align:e="center",className:t=""})=>{const s="left"===e?"text-left":"text-center";return d.jsx("p",{className:`text-xs text-muted-foreground ${s} ${t}`.trim(),children:"Operating in secure offline demo mode. Accounts are stored locally in your browser."})},Ue=({onSwitchToRegister:e,onSwitchToForgotPassword:t})=>{const{login:s,verifyMfaAndFinalize:a,error:n,loading:o}=_e(),[i,c]=r.useState("credentials"),l=(()=>{try{return De.getItem(Pe)||""}catch(v){return console.warn("Unable to read remembered email",v),""}})(),[u,m]=r.useState(l),[h,p]=r.useState(""),[f,g]=r.useState(""),[y,w]=r.useState(""!==l),[x,E]=r.useState(!1),[v,N]=r.useState(null),[b,S]=r.useState({}),[A,j]=r.useState(null),I=r.useRef(null);r.useEffect(()=>{N(n)},[n]),r.useEffect(()=>{y||Oe(!1,"")},[y]),r.useEffect(()=>{"mfa"===i&&I.current?.focus()},[i]);const T=e=>{S(t=>{if(!t[e])return t;const s={...t};return delete s[e],s})},k=async e=>{e.preventDefault(),N(null);const t={},r=u.trim();if((e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e))(r)||(t.email="Please enter a valid email."),h.length<6&&(t.password="Password is too short."),S(t),!(Object.keys(t).length>0))try{m(r);const e=await s({email:r,password:h,rememberMe:y});e.mfaRequired&&e.userId?(j(e.userId),c("mfa"),g(""),S(e=>{if(!e.mfa)return e;const t={...e};return delete t.mfa,t})):Oe(y,r.toLowerCase()),p("")}catch(a){}},_=async e=>{if(e.preventDefault(),N(null),6===f.length)try{if(!A)throw new Error("User ID not found");await a(A,f),Oe(y,u.trim().toLowerCase()),g("")}catch(t){}else S({mfa:"Code must be 6 digits."})};return d.jsxs("div",{className:"min-h-screen bg-background flex flex-col justify-center py-12 sm:px-6 lg:px-8",children:[d.jsxs("div",{className:"sm:mx-auto sm:w-full sm:max-w-md text-center",children:[d.jsxs("div",{className:"inline-flex items-center justify-center gap-2 mb-2",children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",className:"w-10 h-10 text-primary",children:d.jsx("path",{fill:"currentColor",d:"M12 2L2 22h20L12 2z"})}),d.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"AS Agents"})]}),d.jsx("h2",{className:"text-muted-foreground",children:"Sign in to your account"})]}),d.jsxs(Re,{className:"mt-8 sm:mx-auto sm:w-full sm:max-w-md",children:[d.jsx(Le,{className:"mb-4"}),v&&d.jsx("div",{className:"mb-4 p-3 bg-destructive/10 text-destructive text-sm rounded-md border border-destructive/20",children:v}),"credentials"===i?d.jsxs("form",{onSubmit:k,className:"space-y-6",children:[d.jsxs("div",{children:[d.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-muted-foreground",children:"Email Address"}),d.jsx("input",{id:"email",type:"email",value:u,onChange:e=>{m(e.target.value),T("email"),N(null)},required:!0,autoComplete:"email",className:"mt-1 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm "+(b.email?"border-destructive":"border-border")}),b.email&&d.jsx("p",{className:"text-xs text-destructive mt-1",children:b.email})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-muted-foreground",children:"Password"}),d.jsxs("div",{className:"relative mt-1",children:[d.jsx("input",{id:"password",type:x?"text":"password",value:h,onChange:e=>{p(e.target.value),T("password"),N(null)},required:!0,autoComplete:"current-password",className:"block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm pr-12 "+(b.password?"border-destructive":"border-border")}),d.jsx("button",{type:"button",onClick:()=>E(e=>!e),className:"absolute inset-y-0 right-2 flex items-center text-xs font-medium text-muted-foreground hover:text-foreground","aria-label":x?"Hide password":"Show password",children:x?"Hide":"Show"})]}),b.password&&d.jsx("p",{className:"text-xs text-destructive mt-1",children:b.password})]}),d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"flex items-center",children:[d.jsx("input",{id:"remember-me",type:"checkbox",checked:y,onChange:e=>w(e.target.checked),className:"h-4 w-4 text-primary focus:ring-ring border-border rounded"}),d.jsx("label",{htmlFor:"remember-me",className:"ml-2 block text-sm text-muted-foreground",children:"Remember me"})]}),d.jsx("div",{className:"text-sm",children:d.jsx("button",{type:"button",onClick:t,className:"font-medium text-primary hover:text-primary/90",children:"Forgot your password?"})})]}),d.jsx("div",{children:d.jsx(Ce,{type:"submit",className:"w-full",isLoading:o,children:"Sign in"})})]}):d.jsxs("form",{onSubmit:_,className:"space-y-6",children:[d.jsxs("div",{className:"text-center",children:[d.jsx("h3",{className:"text-lg font-medium text-foreground",children:"Two-Factor Authentication"}),d.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:"Enter the 6-digit code from your authenticator app."})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"mfa",className:"sr-only",children:"Authentication Code"}),d.jsx("input",{id:"mfa",type:"text",ref:I,value:f,onChange:e=>{const t=e.target.value.replace(/\D/g,"");g(t),T("mfa"),N(null)},maxLength:6,required:!0,inputMode:"numeric",autoComplete:"one-time-code",className:"block w-full text-center text-2xl tracking-[0.5em] px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary "+(b.mfa?"border-destructive":"border-border")}),b.mfa&&d.jsx("p",{className:"text-xs text-destructive mt-1 text-center",children:b.mfa})]}),d.jsx("div",{children:d.jsx(Ce,{type:"submit",className:"w-full",isLoading:o,children:"Verify"})}),d.jsx("div",{className:"text-center",children:d.jsx("button",{type:"button",onClick:()=>c("credentials"),className:"text-sm font-medium text-primary hover:text-primary/90",children:"Back to login"})})]})]}),d.jsxs("p",{className:"mt-6 text-center text-sm text-muted-foreground",children:["Not a member?"," ",d.jsx("button",{onClick:e,className:"font-semibold text-primary hover:text-primary/80",children:"Create an account"})]})]})},Ve=({view:e,label:t,icon:s,activeView:r,setActiveView:a,badgeCount:n})=>d.jsxs("button",{onClick:()=>a(e),className:"w-full flex items-center justify-between gap-3 px-3 py-2 rounded-md text-sm transition-colors "+(r===e?"bg-primary text-primary-foreground font-semibold shadow":"text-muted-foreground hover:bg-accent hover:text-accent-foreground"),children:[d.jsxs("div",{className:"flex items-center gap-3",children:[s,d.jsx("span",{children:t})]}),n&&n>0&&d.jsx("span",{className:"ml-auto bg-red-500 text-white text-xs font-bold px-2 py-0.5 rounded-full",children:n>99?"99+":n})]}),$e=({user:e,activeView:t,setActiveView:s,onLogout:r,pendingTimesheetCount:a=0,openIncidentCount:n=0,unreadMessageCount:o=0,companyName:i})=>e?d.jsxs("aside",{className:"w-64 bg-card border-r border-border flex flex-col flex-shrink-0 h-full p-4",children:[d.jsxs("div",{className:"flex items-center gap-2 mb-6 px-2",children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",className:"w-8 h-8 text-primary",children:d.jsx("path",{fill:"currentColor",d:"M12 2L2 22h20L12 2z"})}),d.jsxs("div",{children:[d.jsx("h1",{className:"text-xl font-bold text-foreground",children:"AS Agents"}),i&&d.jsx("p",{className:"text-xs text-muted-foreground",children:i})]})]}),d.jsxs("nav",{className:"flex flex-col gap-2",children:[d.jsx(Ve,{view:"dashboard",label:"Dashboard",icon:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})}),activeView:t,setActiveView:s}),d.jsx(Ve,{view:"tools",label:"Tools",icon:d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924-1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),activeView:t,setActiveView:s,badgeCount:o}),d.jsx(Ve,{view:"timesheets",label:"Timesheets",icon:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})}),activeView:t,setActiveView:s,badgeCount:a}),d.jsx(Ve,{view:"safety",label:"Safety",icon:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})}),activeView:t,setActiveView:s,badgeCount:n}),d.jsx(Ve,{view:"field",label:"Field Management",icon:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002-2h2a2 2 0 002 2m-6 8l2 2 4-4"})}),activeView:t,setActiveView:s}),d.jsx("div",{className:"mt-4 border-t border-border pt-4",children:d.jsx(Ve,{view:"settings",label:"Settings",icon:d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924-1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),activeView:t,setActiveView:s})})]}),d.jsx("div",{className:"mt-6",children:d.jsxs("button",{onClick:r,className:"flex w-full items-center justify-center gap-2 rounded-xl border border-red-200/70 bg-red-500/10 px-3 py-2 text-sm font-semibold text-red-600 transition hover:bg-red-500/20",children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",className:"h-5 w-5",fill:"none",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 7l-5 5 5 5M4 12h11"})}),"Sign out"]})})]}):null,Fe=({name:e})=>d.jsxs(Re,{className:"p-6",children:[d.jsx("h3",{className:"font-semibold text-lg",children:e}),d.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"This tool will be restored next."})]}),He=({user:e,addToast:t,setActiveView:s})=>{const[a,n]=r.useState(null),o=[{id:"ai-advisor",name:"AI Advisor",description:"Chat with an AI expert on project management.",icon:"💬",component:d.jsx(Fe,{name:"AI Advisor"}),permission:!0},{id:"bid-generator",name:"Bid Package Generator",description:"Generate professional bid packages and cover letters.",icon:"📝",component:d.jsx(Fe,{name:"Bid Package Generator"}),permission:!0},{id:"cost-estimator",name:"Cost Estimator",description:"Estimate project costs based on specifications.",icon:"🧮",component:d.jsx(Fe,{name:"Cost Estimator"}),permission:!0},{id:"daily-summary",name:"Daily Summary Generator",description:"AI-powered daily progress reports.",icon:"📰",component:d.jsx(Fe,{name:"Daily Summary Generator"}),permission:!0},{id:"funding-bot",name:"FundingBot",description:"Discover grants and funding opportunities.",icon:"💰",component:d.jsx(Fe,{name:"FundingBot"}),permission:!0},{id:"risk-bot",name:"RiskBot",description:"Analyze documents for compliance and financial risks.",icon:"⚠️",component:d.jsx(Fe,{name:"RiskBot"}),permission:!0},{id:"safety-analysis",name:"Safety Analysis",description:"Identify trends from safety incident reports.",icon:"🛡️",component:d.jsx(Fe,{name:"Safety Analysis"}),permission:!0},{id:"site-inspector",name:"AI Site Inspector",description:"Analyze site photos for progress and hazards.",icon:"📸",component:d.jsx(Fe,{name:"AI Site Inspector"}),permission:!0},{id:"workforce-planner",name:"Workforce Planner",description:"Plan and allocate personnel to projects.",icon:"👥",component:d.jsx(Fe,{name:"Workforce Planner"}),permission:be(e,p.MANAGE_TEAM)},{id:"resource-scheduler",name:"Resource Scheduler",description:"View team and equipment schedules.",icon:"🗓️",component:d.jsx(Fe,{name:"Resource Scheduler"}),permission:be(e,p.MANAGE_EQUIPMENT)}].filter(e=>e.permission),i=o.find(e=>e.id===a);return i?d.jsxs("div",{children:[d.jsx("button",{onClick:()=>n(null),className:"flex items-center gap-2 text-sm text-slate-600 hover:text-slate-900 mb-4",children:"← Back to all tools"}),i.component]}):d.jsxs("div",{className:"space-y-6",children:[d.jsx("h2",{className:"text-3xl font-bold text-slate-800",children:"Tools"}),d.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:o.map(e=>d.jsxs(Re,{onClick:()=>n(e.id),className:"cursor-pointer hover:shadow-lg hover:-translate-y-1 transition-all",children:[d.jsx("div",{className:"text-3xl mb-2",children:e.icon}),d.jsx("h3",{className:"font-bold text-lg",children:e.name}),d.jsx("p",{className:"text-sm text-slate-600",children:e.description})]},e.id))})]})};var Ge,ze,We={exports:{}},Be={};function qe(){if(Ge)return Be;Ge=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),n=Symbol.for("react.consumer"),o=Symbol.for("react.context"),i=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),l=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),u=Symbol.iterator;var m={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},h=Object.assign,p={};function f(e,t,s){this.props=e,this.context=t,this.refs=p,this.updater=s||m}function g(){}function y(e,t,s){this.props=e,this.context=t,this.refs=p,this.updater=s||m}f.prototype.isReactComponent={},f.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},f.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},g.prototype=f.prototype;var w=y.prototype=new g;w.constructor=y,h(w,f.prototype),w.isPureReactComponent=!0;var x=Array.isArray,E={H:null,A:null,T:null,S:null,V:null},v=Object.prototype.hasOwnProperty;function N(t,s,r,a,n,o){return r=o.ref,{$$typeof:e,type:t,key:s,ref:void 0!==r?r:null,props:o}}function b(t){return"object"==typeof t&&null!==t&&t.$$typeof===e}var S=/\/+/g;function A(e,t){return"object"==typeof e&&null!==e&&null!=e.key?(s=""+e.key,r={"=":"=0",":":"=2"},"$"+s.replace(/[=:]/g,function(e){return r[e]})):t.toString(36);var s,r}function j(){}function I(s,r,a,n,o){var i=typeof s;"undefined"!==i&&"boolean"!==i||(s=null);var c,l,m=!1;if(null===s)m=!0;else switch(i){case"bigint":case"string":case"number":m=!0;break;case"object":switch(s.$$typeof){case e:case t:m=!0;break;case d:return I((m=s._init)(s._payload),r,a,n,o)}}if(m)return o=o(s),m=""===n?"."+A(s,0):n,x(o)?(a="",null!=m&&(a=m.replace(S,"$&/")+"/"),I(o,r,a,"",function(e){return e})):null!=o&&(b(o)&&(c=o,l=a+(null==o.key||s&&s.key===o.key?"":(""+o.key).replace(S,"$&/")+"/")+m,o=N(c.type,l,void 0,0,0,c.props)),r.push(o)),1;m=0;var h,p=""===n?".":n+":";if(x(s))for(var f=0;f<s.length;f++)m+=I(n=s[f],r,a,i=p+A(n,f),o);else if("function"==typeof(f=null===(h=s)||"object"!=typeof h?null:"function"==typeof(h=u&&h[u]||h["@@iterator"])?h:null))for(s=f.call(s),f=0;!(n=s.next()).done;)m+=I(n=n.value,r,a,i=p+A(n,f++),o);else if("object"===i){if("function"==typeof s.then)return I(function(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch("string"==typeof e.status?e.then(j,j):(e.status="pending",e.then(function(t){"pending"===e.status&&(e.status="fulfilled",e.value=t)},function(t){"pending"===e.status&&(e.status="rejected",e.reason=t)})),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}(s),r,a,n,o);throw r=String(s),Error("Objects are not valid as a React child (found: "+("[object Object]"===r?"object with keys {"+Object.keys(s).join(", ")+"}":r)+"). If you meant to render a collection of children, use an array instead.")}return m}function T(e,t,s){if(null==e)return e;var r=[],a=0;return I(e,r,"","",function(e){return t.call(s,e,a++)}),r}function k(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var _="function"==typeof reportError?reportError:function(e){if("object"==typeof window&&"function"==typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"==typeof e&&null!==e&&"string"==typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"==typeof process&&"function"==typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)};function R(){}return Be.Children={map:T,forEach:function(e,t,s){T(e,function(){t.apply(this,arguments)},s)},count:function(e){var t=0;return T(e,function(){t++}),t},toArray:function(e){return T(e,function(e){return e})||[]},only:function(e){if(!b(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},Be.Component=f,Be.Fragment=s,Be.Profiler=a,Be.PureComponent=y,Be.StrictMode=r,Be.Suspense=c,Be.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=E,Be.__COMPILER_RUNTIME={__proto__:null,c:function(e){return E.H.useMemoCache(e)}},Be.cache=function(e){return function(){return e.apply(null,arguments)}},Be.cloneElement=function(e,t,s){if(null==e)throw Error("The argument must be a React element, but you passed "+e+".");var r=h({},e.props),a=e.key;if(null!=t)for(n in void 0!==t.ref&&void 0,void 0!==t.key&&(a=""+t.key),t)!v.call(t,n)||"key"===n||"__self"===n||"__source"===n||"ref"===n&&void 0===t.ref||(r[n]=t[n]);var n=arguments.length-2;if(1===n)r.children=s;else if(1<n){for(var o=Array(n),i=0;i<n;i++)o[i]=arguments[i+2];r.children=o}return N(e.type,a,void 0,0,0,r)},Be.createContext=function(e){return(e={$$typeof:o,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider=e,e.Consumer={$$typeof:n,_context:e},e},Be.createElement=function(e,t,s){var r,a={},n=null;if(null!=t)for(r in void 0!==t.key&&(n=""+t.key),t)v.call(t,r)&&"key"!==r&&"__self"!==r&&"__source"!==r&&(a[r]=t[r]);var o=arguments.length-2;if(1===o)a.children=s;else if(1<o){for(var i=Array(o),c=0;c<o;c++)i[c]=arguments[c+2];a.children=i}if(e&&e.defaultProps)for(r in o=e.defaultProps)void 0===a[r]&&(a[r]=o[r]);return N(e,n,void 0,0,0,a)},Be.createRef=function(){return{current:null}},Be.forwardRef=function(e){return{$$typeof:i,render:e}},Be.isValidElement=b,Be.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:k}},Be.memo=function(e,t){return{$$typeof:l,type:e,compare:void 0===t?null:t}},Be.startTransition=function(e){var t=E.T,s={};E.T=s;try{var r=e(),a=E.S;null!==a&&a(s,r),"object"==typeof r&&null!==r&&"function"==typeof r.then&&r.then(R,_)}catch(n){_(n)}finally{E.T=t}},Be.unstable_useCacheRefresh=function(){return E.H.useCacheRefresh()},Be.use=function(e){return E.H.use(e)},Be.useActionState=function(e,t,s){return E.H.useActionState(e,t,s)},Be.useCallback=function(e,t){return E.H.useCallback(e,t)},Be.useContext=function(e){return E.H.useContext(e)},Be.useDebugValue=function(){},Be.useDeferredValue=function(e,t){return E.H.useDeferredValue(e,t)},Be.useEffect=function(e,t,s){var r=E.H;if("function"==typeof s)throw Error("useEffect CRUD overload is not enabled in this build of React.");return r.useEffect(e,t)},Be.useId=function(){return E.H.useId()},Be.useImperativeHandle=function(e,t,s){return E.H.useImperativeHandle(e,t,s)},Be.useInsertionEffect=function(e,t){return E.H.useInsertionEffect(e,t)},Be.useLayoutEffect=function(e,t){return E.H.useLayoutEffect(e,t)},Be.useMemo=function(e,t){return E.H.useMemo(e,t)},Be.useOptimistic=function(e,t){return E.H.useOptimistic(e,t)},Be.useReducer=function(e,t,s){return E.H.useReducer(e,t,s)},Be.useRef=function(e){return E.H.useRef(e)},Be.useState=function(e){return E.H.useState(e)},Be.useSyncExternalStore=function(e,t,s){return E.H.useSyncExternalStore(e,t,s)},Be.useTransition=function(){return E.H.useTransition()},Be.version="19.1.1",Be}var Je=(ze||(ze=1,We.exports=qe()),We.exports);
/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=e=>{const t=(e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,s)=>s?s.toUpperCase():t.toLowerCase()))(e);return t.charAt(0).toUpperCase()+t.slice(1)},Ke=(...e)=>e.filter((e,t,s)=>Boolean(e)&&""!==e.trim()&&s.indexOf(e)===t).join(" ").trim(),Ze=e=>{for(const t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0};
/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
var Xe={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};
/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=Je.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:s=2,absoluteStrokeWidth:r,className:a="",children:n,iconNode:o,...i},c)=>Je.createElement("svg",{ref:c,...Xe,width:t,height:t,stroke:e,strokeWidth:r?24*Number(s)/Number(t):s,className:Ke("lucide",a),...!n&&!Ze(i)&&{"aria-hidden":"true"},...i},[...o.map(([e,t])=>Je.createElement(e,t)),...Array.isArray(n)?n:[n]])),et=(e,t)=>{const s=Je.forwardRef(({className:s,...r},a)=>{return Je.createElement(Qe,{ref:a,iconNode:t,className:Ke(`lucide-${n=Ye(e),n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,s),...r});var n});return s.displayName=Ye(e),s},tt=et("camera",[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),st=et("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),rt=et("file-text",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]),at=et("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]),nt=et("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),ot=et("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),it=et("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]),ct=et("square-check-big",[["path",{d:"M21 10.656V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.344",key:"2acyp4"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),lt=et("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),dt=et("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]),ut=et("wifi-off",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),mt=et("wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]);
/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var ht=(e=>(e.ARCHITECTURAL="architectural",e.STRUCTURAL="structural",e.MECHANICAL="mechanical",e.ELECTRICAL="electrical",e.PLUMBING="plumbing",e.HVAC="hvac",e.FIRE_SAFETY="fire_safety",e.LANDSCAPING="landscaping",e.CLEANUP="cleanup",e.OTHER="other",e))(ht||{}),pt=(e=>(e.OPEN="open",e.IN_PROGRESS="in_progress",e.READY_FOR_REVIEW="ready_for_review",e.COMPLETED="completed",e.VERIFIED="verified",e.REJECTED="rejected",e))(pt||{}),ft=(e=>(e.NOT_STARTED="not_started",e.IN_PROGRESS="in_progress",e.ON_HOLD="on_hold",e.COMPLETED="completed",e.CANCELLED="cancelled",e))(ft||{}),gt=(e=>(e.LOW="low",e.MEDIUM="medium",e.HIGH="high",e.CRITICAL="critical",e))(gt||{});const yt=new class{constructor(){this.baseUrl="/api/field",this.offlineStorage="asagents_offline_data"}async getPunchLists(e,t){try{const s=new URLSearchParams;t&&Object.entries(t).forEach(([e,t])=>{t&&s.append(e,String(t))});const r=await fetch(`${this.baseUrl}/projects/${e}/punch-lists?${s}`);if(!r.ok)throw new Error("Failed to fetch punch lists");return await r.json()}catch(s){return console.error("Error fetching punch lists:",s),this.getMockPunchLists(e)}}async createPunchList(e,t){try{const s=await fetch(`${this.baseUrl}/projects/${e}/punch-lists`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok)throw new Error("Failed to create punch list");return await s.json()}catch(s){return console.error("Error creating punch list:",s),this.createMockPunchList(e,t)}}async updatePunchList(e,t,s){try{const r=await fetch(`${this.baseUrl}/projects/${e}/punch-lists/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!r.ok)throw new Error("Failed to update punch list");return await r.json()}catch(r){return console.error("Error updating punch list:",r),this.getMockPunchLists(e)[0]}}async deletePunchList(e,t){try{if(!(await fetch(`${this.baseUrl}/projects/${e}/punch-lists/${t}`,{method:"DELETE"})).ok)throw new Error("Failed to delete punch list")}catch(s){console.error("Error deleting punch list:",s)}}async getDailyReports(e,t){try{const s=new URLSearchParams;t&&(s.append("start",t.start.toISOString()),s.append("end",t.end.toISOString()));const r=await fetch(`${this.baseUrl}/projects/${e}/daily-reports?${s}`);if(!r.ok)throw new Error("Failed to fetch daily reports");return await r.json()}catch(s){return console.error("Error fetching daily reports:",s),this.getMockDailyReports(e)}}async createDailyReport(e,t){try{const s=await fetch(`${this.baseUrl}/projects/${e}/daily-reports`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok)throw new Error("Failed to create daily report");return await s.json()}catch(s){return console.error("Error creating daily report:",s),this.createMockDailyReport(e,t)}}async updateDailyReport(e,t,s){try{const r=await fetch(`${this.baseUrl}/projects/${e}/daily-reports/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!r.ok)throw new Error("Failed to update daily report");return await r.json()}catch(r){return console.error("Error updating daily report:",r),this.getMockDailyReports(e)[0]}}async getTasks(e,t){try{const s=new URLSearchParams;t&&Object.entries(t).forEach(([e,t])=>{t&&s.append(e,String(t))});const r=await fetch(`${this.baseUrl}/projects/${e}/tasks?${s}`);if(!r.ok)throw new Error("Failed to fetch tasks");return await r.json()}catch(s){return console.error("Error fetching tasks:",s),this.getMockTasks(e)}}async createTask(e,t){try{const s=await fetch(`${this.baseUrl}/projects/${e}/tasks`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok)throw new Error("Failed to create task");return await s.json()}catch(s){return console.error("Error creating task:",s),this.createMockTask(e,t)}}async updateTask(e,t,s){try{const r=await fetch(`${this.baseUrl}/projects/${e}/tasks/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!r.ok)throw new Error("Failed to update task");return await r.json()}catch(r){return console.error("Error updating task:",r),this.getMockTasks(e)[0]}}async uploadPhoto(e,t,s){try{const r=new FormData;r.append("file",t),r.append("metadata",JSON.stringify(s));const a=await fetch(`${this.baseUrl}/projects/${e}/photos`,{method:"POST",body:r});if(!a.ok)throw new Error("Failed to upload photo");return await a.json()}catch(r){return console.error("Error uploading photo:",r),this.createMockPhoto(t,s)}}async getPhotos(e,t){try{const s=new URLSearchParams;t&&Object.entries(t).forEach(([e,t])=>{t&&s.append(e,String(t))});const r=await fetch(`${this.baseUrl}/projects/${e}/photos?${s}`);if(!r.ok)throw new Error("Failed to fetch photos");return await r.json()}catch(s){return console.error("Error fetching photos:",s),this.getMockPhotos(e)}}async deletePhoto(e,t){try{if(!(await fetch(`${this.baseUrl}/projects/${e}/photos/${t}`,{method:"DELETE"})).ok)throw new Error("Failed to delete photo")}catch(s){console.error("Error deleting photo:",s)}}async createTimeEntry(e,t){try{const s=await fetch(`${this.baseUrl}/projects/${e}/time-entries`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok)throw new Error("Failed to create time entry");return await s.json()}catch(s){return console.error("Error creating time entry:",s),this.createMockTimeEntry(e,t)}}async getTimeEntries(e,t,s){try{const r=new URLSearchParams;t&&r.append("userId",t),s&&(r.append("start",s.start.toISOString()),r.append("end",s.end.toISOString()));const a=await fetch(`${this.baseUrl}/projects/${e}/time-entries?${r}`);if(!a.ok)throw new Error("Failed to fetch time entries");return await a.json()}catch(r){return console.error("Error fetching time entries:",r),this.getMockTimeEntries(e)}}async getDrawings(e){try{const t=await fetch(`${this.baseUrl}/projects/${e}/drawings`);if(!t.ok)throw new Error("Failed to fetch drawings");return await t.json()}catch(t){return console.error("Error fetching drawings:",t),this.getMockDrawings(e)}}async addDrawingMarkup(e,t,s){try{const r=await fetch(`${this.baseUrl}/projects/${e}/drawings/${t}/markups`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!r.ok)throw new Error("Failed to add drawing markup");return await r.json()}catch(r){return console.error("Error adding drawing markup:",r),{id:`markup-${Date.now()}`,...s}}}async syncOfflineData(){try{this.getOfflineData();const e=this.getPendingSyncOperations();for(const t of e)await this.processSyncOperation(t);await this.updateOfflineData()}catch(e){console.error("Error syncing offline data:",e)}}getOfflineData(){const e=localStorage.getItem(this.offlineStorage);return e?JSON.parse(e):{punchLists:[],tasks:[],photos:[],drawings:[],lastSync:new Date}}saveOfflineData(e){localStorage.setItem(this.offlineStorage,JSON.stringify(e))}getPendingSyncOperations(){const e=localStorage.getItem(`${this.offlineStorage}_sync`);return e?JSON.parse(e):[]}async processSyncOperation(e){try{console.log("Processing sync operation:",e)}catch(t){console.error("Error processing sync operation:",t),e.status="failed",e.error=t instanceof Error?t.message:"Unknown error",e.retryCount++}}async updateOfflineData(){console.log("Updating offline data...")}getMockPunchLists(e){return[{id:"punch-1",projectId:e,title:"Paint touch-up required in lobby",description:"Several scuff marks and scratches on walls need touch-up paint",category:ht.ARCHITECTURAL,priority:gt.MEDIUM,status:pt.OPEN,assignedTo:"painter-1",assignedCompany:"ABC Painting",dueDate:new Date(Date.now()+6048e5),location:{building:"Main Building",floor:"1st Floor",room:"Lobby",area:"East Wall"},trade:"Painting",room:"Lobby",floor:"1st Floor",photos:[],attachments:[],verificationPhotos:[],comments:[],createdBy:"inspector-1",createdAt:new Date,updatedAt:new Date}]}createMockPunchList(e,t){return{id:`punch-${Date.now()}`,projectId:e,title:t.title||"New Punch Item",description:t.description||"",category:t.category||ht.OTHER,priority:t.priority||gt.MEDIUM,status:pt.OPEN,assignedTo:t.assignedTo||"",assignedCompany:t.assignedCompany||"",dueDate:t.dueDate||new Date(Date.now()+6048e5),location:t.location||{},trade:t.trade||"",room:t.room||"",floor:t.floor||"",photos:[],attachments:[],verificationPhotos:[],comments:[],createdBy:"current-user",createdAt:new Date,updatedAt:new Date}}getMockDailyReports(e){return[{id:"report-1",projectId:e,date:new Date,reportedBy:"foreman-1",weather:"clear",temperature:{high:75,low:55,unit:"F"},crew:[],workPerformed:[],materials:[],equipment:[],safety:[],visitors:[],delays:[],issues:[],photos:[],notes:"Good progress on foundation work",submittedAt:new Date}]}createMockDailyReport(e,t){return{id:`report-${Date.now()}`,projectId:e,date:t.date||new Date,reportedBy:t.reportedBy||"current-user",weather:t.weather||"clear",temperature:t.temperature||{high:70,low:50,unit:"F"},crew:t.crew||[],workPerformed:t.workPerformed||[],materials:t.materials||[],equipment:t.equipment||[],safety:t.safety||[],visitors:t.visitors||[],delays:t.delays||[],issues:t.issues||[],photos:t.photos||[],notes:t.notes||"",submittedAt:new Date}}getMockTasks(e){return[{id:"task-1",projectId:e,title:"Install electrical outlets",description:"Install 20 electrical outlets in office areas",type:"construction",category:"electrical",priority:gt.HIGH,status:ft.IN_PROGRESS,assignedTo:["electrician-1"],assignedCompany:"XYZ Electric",dueDate:new Date(Date.now()+2592e5),estimatedHours:16,actualHours:8,location:{building:"Main Building",floor:"2nd Floor"},trade:"Electrical",phase:"Rough-in",prerequisites:[],dependencies:[],photos:[],attachments:[],comments:[],timeEntries:[],materials:[],equipment:[],safetyRequirements:[],qualityChecks:[],createdBy:"pm-1",createdAt:new Date,updatedAt:new Date,startedAt:new Date}]}createMockTask(e,t){return{id:`task-${Date.now()}`,projectId:e,title:t.title||"New Task",description:t.description||"",type:t.type||"construction",category:t.category||"other",priority:t.priority||gt.MEDIUM,status:ft.NOT_STARTED,assignedTo:t.assignedTo||[],assignedCompany:t.assignedCompany||"",dueDate:t.dueDate||new Date(Date.now()+6048e5),estimatedHours:t.estimatedHours||8,actualHours:0,location:t.location||{},trade:t.trade||"",phase:t.phase||"",prerequisites:[],dependencies:[],photos:[],attachments:[],comments:[],timeEntries:[],materials:[],equipment:[],safetyRequirements:[],qualityChecks:[],createdBy:"current-user",createdAt:new Date,updatedAt:new Date}}createMockPhoto(e,t){return{id:`photo-${Date.now()}`,url:URL.createObjectURL(e),thumbnailUrl:URL.createObjectURL(e),filename:e.name,size:e.size,mimeType:e.type,timestamp:new Date,metadata:{width:1920,height:1080,...t},tags:[],annotations:[],uploadedBy:"current-user",uploadedAt:new Date}}getMockPhotos(e){return[]}createMockTimeEntry(e,t){return{id:`time-${Date.now()}`,userId:t.userId||"current-user",projectId:e,taskId:t.taskId,date:t.date||new Date,startTime:t.startTime||new Date,endTime:t.endTime,duration:t.duration||480,breakTime:t.breakTime||60,overtimeHours:t.overtimeHours||0,description:t.description||"",location:t.location||"",costCode:t.costCode||"",billable:t.billable||!0,approved:!1,createdAt:new Date,updatedAt:new Date}}getMockTimeEntries(e){return[]}getMockDrawings(e){return[{id:"drawing-1",projectId:e,name:"Floor Plan - Level 1",number:"A-101",discipline:"Architectural",version:"1.0",url:"/mock-drawing.pdf",thumbnailUrl:"/mock-drawing-thumb.jpg",scale:"1/4\" = 1'",size:{width:36,height:24,units:"in"},layers:[],markups:[],lastModified:new Date}]}},wt=({projectId:e,userId:t,isOnline:s})=>{const[a,n]=r.useState("overview"),[o,i]=r.useState(!0),[c,l]=r.useState(!1),[u,m]=r.useState({punchLists:[],tasks:[],dailyReports:[],photos:[]});r.useEffect(()=>{h()},[e]);const h=async()=>{i(!0);try{const[t,s,r,a]=await Promise.all([yt.getPunchLists(e),yt.getTasks(e),yt.getDailyReports(e),yt.getPhotos(e)]);m({punchLists:t,tasks:s,dailyReports:r,photos:a})}catch(t){console.error("Error loading field data:",t)}finally{i(!1)}},p=[{id:"overview",label:"Overview",icon:rt},{id:"punch",label:"Punch Lists",icon:ct},{id:"tasks",label:"Tasks",icon:st},{id:"photos",label:"Photos",icon:tt},{id:"reports",label:"Daily Reports",icon:dt}];return o?d.jsx("div",{className:"flex items-center justify-center h-64",children:d.jsxs("div",{className:"text-center",children:[d.jsx(ot,{className:"w-8 h-8 animate-spin text-blue-600 mx-auto mb-2"}),d.jsx("span",{className:"text-gray-600",children:"Loading field data..."})]})}):d.jsxs("div",{className:"bg-white rounded-lg shadow-lg min-h-screen",children:[d.jsx("div",{className:"border-b border-gray-200 px-4 py-3",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Field Management"}),d.jsx("div",{className:"flex items-center mt-1",children:s?d.jsxs("div",{className:"flex items-center text-green-600",children:[d.jsx(mt,{className:"w-4 h-4 mr-1"}),d.jsx("span",{className:"text-sm",children:"Online"})]}):d.jsxs("div",{className:"flex items-center text-orange-600",children:[d.jsx(ut,{className:"w-4 h-4 mr-1"}),d.jsx("span",{className:"text-sm",children:"Offline"})]})})]}),d.jsx("div",{className:"flex space-x-2",children:d.jsxs("button",{onClick:async()=>{l(!0);try{await yt.syncOfflineData(),await h()}catch(e){console.error("Error syncing data:",e)}finally{l(!1)}},disabled:c,className:"flex items-center px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:[d.jsx(ot,{className:"w-4 h-4 mr-1 "+(c?"animate-spin":"")}),"Sync"]})})]})}),d.jsx("div",{className:"border-b border-gray-200 overflow-x-auto",children:d.jsx("nav",{className:"flex space-x-0",children:p.map(e=>{const t=e.icon;return d.jsxs("button",{onClick:()=>n(e.id),className:"flex flex-col items-center py-3 px-4 min-w-0 flex-1 "+(a===e.id?"border-b-2 border-blue-500 text-blue-600 bg-blue-50":"text-gray-500 hover:text-gray-700"),children:[d.jsx(t,{className:"w-5 h-5 mb-1"}),d.jsx("span",{className:"text-xs font-medium truncate",children:e.label})]},e.id)})})}),d.jsxs("div",{className:"p-4",children:["overview"===a&&d.jsx(xt,{fieldData:u}),"punch"===a&&d.jsx(Et,{punchLists:u.punchLists,projectId:e}),"tasks"===a&&d.jsx(vt,{tasks:u.tasks,projectId:e}),"photos"===a&&d.jsx(Nt,{photos:u.photos,projectId:e}),"reports"===a&&d.jsx(bt,{reports:u.dailyReports,projectId:e})]})]})},xt=({fieldData:e})=>{const{punchLists:t,tasks:s,dailyReports:r,photos:a}=e,n={openPunches:t.filter(e=>e.status===pt.OPEN).length,activeTasks:s.filter(e=>e.status===ft.IN_PROGRESS).length,todayPhotos:a.filter(e=>{const t=new Date;return new Date(e.timestamp).toDateString()===t.toDateString()}).length,recentReports:r.length};return d.jsxs("div",{className:"space-y-6",children:[d.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[d.jsx("div",{className:"bg-red-50 p-4 rounded-lg",children:d.jsxs("div",{className:"flex items-center",children:[d.jsx(lt,{className:"w-6 h-6 text-red-600"}),d.jsxs("div",{className:"ml-3",children:[d.jsx("p",{className:"text-sm font-medium text-red-600",children:"Open Punches"}),d.jsx("p",{className:"text-2xl font-bold text-gray-900",children:n.openPunches})]})]})}),d.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:d.jsxs("div",{className:"flex items-center",children:[d.jsx(st,{className:"w-6 h-6 text-blue-600"}),d.jsxs("div",{className:"ml-3",children:[d.jsx("p",{className:"text-sm font-medium text-blue-600",children:"Active Tasks"}),d.jsx("p",{className:"text-2xl font-bold text-gray-900",children:n.activeTasks})]})]})}),d.jsx("div",{className:"bg-green-50 p-4 rounded-lg",children:d.jsxs("div",{className:"flex items-center",children:[d.jsx(tt,{className:"w-6 h-6 text-green-600"}),d.jsxs("div",{className:"ml-3",children:[d.jsx("p",{className:"text-sm font-medium text-green-600",children:"Today's Photos"}),d.jsx("p",{className:"text-2xl font-bold text-gray-900",children:n.todayPhotos})]})]})}),d.jsx("div",{className:"bg-purple-50 p-4 rounded-lg",children:d.jsxs("div",{className:"flex items-center",children:[d.jsx(rt,{className:"w-6 h-6 text-purple-600"}),d.jsxs("div",{className:"ml-3",children:[d.jsx("p",{className:"text-sm font-medium text-purple-600",children:"Reports"}),d.jsx("p",{className:"text-2xl font-bold text-gray-900",children:n.recentReports})]})]})})]}),d.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[d.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Recent Activity"}),d.jsxs("div",{className:"space-y-3",children:[d.jsxs("div",{className:"flex items-center p-3 bg-gray-50 rounded-lg",children:[d.jsx(ct,{className:"w-5 h-5 text-blue-600"}),d.jsxs("div",{className:"ml-3",children:[d.jsx("p",{className:"text-sm font-medium text-gray-900",children:"New punch item created"}),d.jsx("p",{className:"text-xs text-gray-600",children:"2 hours ago"})]})]}),d.jsxs("div",{className:"flex items-center p-3 bg-gray-50 rounded-lg",children:[d.jsx(tt,{className:"w-5 h-5 text-green-600"}),d.jsxs("div",{className:"ml-3",children:[d.jsx("p",{className:"text-sm font-medium text-gray-900",children:"5 photos uploaded"}),d.jsx("p",{className:"text-xs text-gray-600",children:"4 hours ago"})]})]}),d.jsxs("div",{className:"flex items-center p-3 bg-gray-50 rounded-lg",children:[d.jsx(st,{className:"w-5 h-5 text-orange-600"}),d.jsxs("div",{className:"ml-3",children:[d.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Task completed"}),d.jsx("p",{className:"text-xs text-gray-600",children:"1 day ago"})]})]})]})]})]})},Et=({punchLists:e,projectId:t})=>{const[s,a]=r.useState("all"),[n,o]=r.useState(""),i=e.filter(e=>{const t="all"===s||e.status===s,r=e.title.toLowerCase().includes(n.toLowerCase())||e.description.toLowerCase().includes(n.toLowerCase());return t&&r}),c=e=>{switch(e){case pt.OPEN:return"bg-red-100 text-red-800";case pt.IN_PROGRESS:return"bg-blue-100 text-blue-800";case pt.COMPLETED:return"bg-green-100 text-green-800";case pt.VERIFIED:return"bg-purple-100 text-purple-800";default:return"bg-gray-100 text-gray-800"}},l=e=>{switch(e){case gt.CRITICAL:return"bg-red-500";case gt.HIGH:return"bg-orange-500";case gt.MEDIUM:return"bg-yellow-500";case gt.LOW:return"bg-green-500";default:return"bg-gray-500"}};return d.jsxs("div",{className:"space-y-4",children:[d.jsxs("div",{className:"flex flex-col space-y-3",children:[d.jsxs("div",{className:"relative",children:[d.jsx(it,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),d.jsx("input",{type:"text",placeholder:"Search punch items...",value:n,onChange:e=>o(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),d.jsxs("div",{className:"flex space-x-2 overflow-x-auto",children:[d.jsx("button",{onClick:()=>a("all"),className:"px-3 py-1 text-sm rounded-full whitespace-nowrap "+("all"===s?"bg-blue-600 text-white":"bg-gray-200 text-gray-700"),children:"All"}),Object.values(pt).map(e=>d.jsx("button",{onClick:()=>a(e),className:"px-3 py-1 text-sm rounded-full whitespace-nowrap "+(s===e?"bg-blue-600 text-white":"bg-gray-200 text-gray-700"),children:e.replace("_"," ")},e))]})]}),d.jsxs("button",{className:"w-full flex items-center justify-center py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[d.jsx(nt,{className:"w-5 h-5 mr-2"}),"Add Punch Item"]}),d.jsx("div",{className:"space-y-3",children:i.map(e=>d.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[d.jsxs("div",{className:"flex items-start justify-between mb-2",children:[d.jsxs("div",{className:"flex-1",children:[d.jsx("h4",{className:"font-semibold text-gray-900",children:e.title}),d.jsx("p",{className:"text-sm text-gray-600 mt-1",children:e.description})]}),d.jsx("div",{className:`w-3 h-3 rounded-full ${l(e.priority)}`})]}),d.jsxs("div",{className:"flex items-center justify-between mt-3",children:[d.jsxs("div",{className:"flex items-center space-x-2",children:[d.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${c(e.status)}`,children:e.status.replace("_"," ")}),d.jsx("span",{className:"text-xs text-gray-500",children:e.trade})]}),d.jsxs("div",{className:"flex items-center text-xs text-gray-500",children:[d.jsx(at,{className:"w-3 h-3 mr-1"}),e.location.room||e.location.area||"Location TBD"]})]}),d.jsxs("div",{className:"flex items-center justify-between mt-2 text-xs text-gray-500",children:[d.jsxs("span",{children:["Assigned to: ",e.assignedCompany]}),d.jsxs("span",{children:["Due: ",e.dueDate.toLocaleDateString()]})]})]},e.id))}),0===i.length&&d.jsxs("div",{className:"text-center py-8 text-gray-500",children:[d.jsx(ct,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),d.jsx("p",{children:"No punch items found"})]})]})},vt=({tasks:e,projectId:t})=>d.jsxs("div",{className:"space-y-4",children:[d.jsxs("button",{className:"w-full flex items-center justify-center py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[d.jsx(nt,{className:"w-5 h-5 mr-2"}),"Add Task"]}),d.jsx("div",{className:"space-y-3",children:e.map(e=>d.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[d.jsx("h4",{className:"font-semibold text-gray-900",children:e.title}),d.jsx("p",{className:"text-sm text-gray-600 mt-1",children:e.description}),d.jsxs("div",{className:"flex items-center justify-between mt-3",children:[d.jsx("span",{className:"px-2 py-1 text-xs font-semibold rounded-full "+(e.status===ft.COMPLETED?"bg-green-100 text-green-800":e.status===ft.IN_PROGRESS?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"),children:e.status.replace("_"," ")}),d.jsxs("span",{className:"text-xs text-gray-500",children:["Due: ",e.dueDate.toLocaleDateString()]})]})]},e.id))}),0===e.length&&d.jsxs("div",{className:"text-center py-8 text-gray-500",children:[d.jsx(st,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),d.jsx("p",{children:"No tasks found"})]})]}),Nt=({photos:e,projectId:t})=>d.jsxs("div",{className:"space-y-4",children:[d.jsxs("button",{className:"w-full flex items-center justify-center py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[d.jsx(tt,{className:"w-5 h-5 mr-2"}),"Take Photo"]}),d.jsx("div",{className:"grid grid-cols-2 gap-3",children:e.map(e=>d.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg overflow-hidden",children:[d.jsx("img",{src:e.thumbnailUrl,alt:e.filename,className:"w-full h-32 object-cover"}),d.jsxs("div",{className:"p-2",children:[d.jsx("p",{className:"text-xs text-gray-600 truncate",children:e.filename}),d.jsx("p",{className:"text-xs text-gray-500",children:e.timestamp.toLocaleDateString()})]})]},e.id))}),0===e.length&&d.jsxs("div",{className:"text-center py-8 text-gray-500",children:[d.jsx(tt,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),d.jsx("p",{children:"No photos found"})]})]}),bt=({reports:e,projectId:t})=>d.jsxs("div",{className:"space-y-4",children:[d.jsxs("button",{className:"w-full flex items-center justify-center py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[d.jsx(nt,{className:"w-5 h-5 mr-2"}),"Create Daily Report"]}),d.jsx("div",{className:"space-y-3",children:e.map(e=>d.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[d.jsxs("div",{className:"flex items-center justify-between mb-2",children:[d.jsx("h4",{className:"font-semibold text-gray-900",children:"Daily Report"}),d.jsx("span",{className:"text-sm text-gray-500",children:e.date.toLocaleDateString()})]}),d.jsx("p",{className:"text-sm text-gray-600",children:e.notes}),d.jsxs("div",{className:"flex items-center mt-3 space-x-4",children:[d.jsxs("span",{className:"text-xs text-gray-500",children:["Weather: ",e.weather]}),d.jsxs("span",{className:"text-xs text-gray-500",children:["Crew: ",e.crew.length]}),d.jsxs("span",{className:"text-xs text-gray-500",children:["Photos: ",e.photos.length]})]})]},e.id))}),0===e.length&&d.jsxs("div",{className:"text-center py-8 text-gray-500",children:[d.jsx(rt,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),d.jsx("p",{children:"No daily reports found"})]})]});class St extends r.Component{constructor(){super(...arguments),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("Uncaught error:",e,t)}render(){return this.state.hasError?d.jsxs(Re,{className:"border-destructive",children:[d.jsx("h2",{className:"text-xl font-bold text-destructive",children:"Something went wrong."}),d.jsx("p",{className:"text-muted-foreground mt-2",children:"A component on this dashboard has crashed. You can try refreshing the page."}),d.jsxs("details",{className:"mt-4 text-sm bg-muted p-2 rounded",children:[d.jsx("summary",{children:"Error Details"}),d.jsx("pre",{className:"whitespace-pre-wrap text-xs mt-2",children:this.state.error?.toString()})]}),d.jsx(Ce,{variant:"secondary",className:"mt-4",onClick:()=>window.location.reload(),children:"Refresh Page"})]}):this.props.children}}const At=()=>{const{user:e,logout:t,loading:s}=_e(),[a,n]=r.useState("login"),[o,i]=r.useState("tools");if(s)return d.jsx("div",{className:"min-h-screen grid place-items-center p-6",children:d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),d.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Loading..."})]})});if(!e){if("register"===a)return d.jsx("div",{className:"min-h-screen grid place-items-center p-6",children:d.jsx("div",{className:"w-full max-w-lg",children:d.jsxs(Re,{className:"p-6",children:[d.jsx("h2",{className:"text-lg font-semibold",children:"Registration temporarily unavailable"}),d.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Please contact support or use an existing account."}),d.jsx("div",{className:"mt-4",children:d.jsx("button",{type:"button",className:"text-primary hover:underline",onClick:()=>n("login"),children:"Back to login"})})]})})});try{return d.jsx("div",{className:"min-h-screen grid place-items-center p-6",children:d.jsxs("div",{className:"w-full max-w-md",children:[d.jsx(Re,{className:"mb-6",children:d.jsxs("div",{className:"p-4",children:[d.jsx("h1",{className:"text-xl font-bold",children:"AS Agents CMS"}),d.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Sign in to continue"})]})}),d.jsx(Ue,{onSwitchToRegister:()=>n("register"),onSwitchToForgotPassword:()=>n("forgot")})]})})}catch(c){return console.error("Login component error:",c),d.jsx("div",{className:"min-h-screen grid place-items-center p-6",children:d.jsxs(Re,{className:"p-6 border-destructive",children:[d.jsx("h2",{className:"text-lg font-semibold text-destructive",children:"Login Error"}),d.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"There was an error loading the login form."}),d.jsx("button",{type:"button",className:"mt-4 px-4 py-2 bg-primary text-primary-foreground rounded",onClick:()=>window.location.reload(),children:"Reload Page"})]})})}}return d.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[d.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",className:"h-6 w-6 text-primary","aria-hidden":!0,children:[d.jsx("path",{fill:"currentColor",d:"M12 2l9.196 5.31a1 1 0 01.5.866v10.648a1 1 0 01-.5.866L12 24l-9.196-4.31a1 1 0 01-.5.866V8.176a1 1 0 01.5-.866L12 2z",opacity:.12}),d.jsx("path",{fill:"currentColor",d:"M12 4.5l-6.5 3.752v7.496L12 19.5l6.5-3.752V8.252L12 4.5zm0 1.732l5 2.886v5.764l-5 2.886-5-2.886V9.118l5-2.886z"})]}),d.jsx("h1",{className:"text-lg font-semibold",children:"AS Agents"})]}),d.jsx("button",{type:"button",onClick:t,className:"text-sm text-red-600 hover:underline",children:"Logout"})]}),d.jsxs("div",{className:"flex flex-1 min-h-0",children:[d.jsx($e,{user:e,activeView:o,setActiveView:i,onLogout:t,pendingTimesheetCount:0,openIncidentCount:0,unreadMessageCount:0,companyName:void 0}),d.jsx("main",{className:"flex-1 p-4 overflow-auto",children:"tools"===o?d.jsx(He,{user:e,addToast:(e,t)=>{"error"===t?console.error(e):console.log(e)},setActiveView:i}):"field"===o?d.jsx(wt,{projectId:"demo-project-1",userId:e.id,isOnline:navigator.onLine}):d.jsxs(Re,{className:"p-6",children:[d.jsx("h2",{className:"text-xl font-semibold text-foreground",children:"Coming soon"}),d.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:['The "',o,'" view will be restored next.']})]})})]})]})},jt=()=>d.jsx(St,{children:d.jsx(ke,{children:d.jsx(At,{})})}),It=document.getElementById("root");if(!It)throw new Error("Could not find root element to mount to");m.createRoot(It).render(d.jsx(a.StrictMode,{children:d.jsx(jt,{})}));
