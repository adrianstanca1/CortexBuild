import{r as e,a as t,g as s}from"./react-DiZ9e1Sl.js";import{r,R as a}from"./leaflet-D9Qn1H0p.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var n,i,o={exports:{}},l={};var c,d=(i||(i=1,o.exports=function(){if(n)return l;n=1;var t=e(),s=Symbol.for("react.element"),r=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,i=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,r){var n,l={},c=null,d=null;for(n in void 0!==r&&(c=""+r),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(d=t.ref),t)a.call(t,n)&&!o.hasOwnProperty(n)&&(l[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===l[n]&&(l[n]=t[n]);return{$$typeof:s,type:e,key:c,ref:d,props:l,_owner:i.current}}return l.Fragment=r,l.jsx=c,l.jsxs=c,l}()),o.exports),m={};const u=s(function(){if(c)return m;c=1;var e=t();return m.createRoot=e.createRoot,m.hydrateRoot=e.hydrateRoot,m}());var h=(e=>(e.OWNER="OWNER",e.ADMIN="ADMIN",e.PROJECT_MANAGER="PROJECT_MANAGER",e.FOREMAN="FOREMAN",e.OPERATIVE="OPERATIVE",e.CLIENT="CLIENT",e.PRINCIPAL_ADMIN="PRINCIPAL_ADMIN",e))(h||{}),p=(e=>(e.VIEW_ALL_PROJECTS="VIEW_ALL_PROJECTS",e.VIEW_ASSIGNED_PROJECTS="VIEW_ASSIGNED_PROJECTS",e.CREATE_PROJECT="CREATE_PROJECT",e.MANAGE_PROJECT_DETAILS="MANAGE_PROJECT_DETAILS",e.MANAGE_PROJECT_TEMPLATES="MANAGE_PROJECT_TEMPLATES",e.VIEW_ALL_TASKS="VIEW_ALL_TASKS",e.MANAGE_ALL_TASKS="MANAGE_ALL_TASKS",e.SUBMIT_TIMESHEET="SUBMIT_TIMESHEET",e.VIEW_ALL_TIMESHEETS="VIEW_ALL_TIMESHEETS",e.MANAGE_TIMESHEETS="MANAGE_TIMESHEETS",e.UPLOAD_DOCUMENTS="UPLOAD_DOCUMENTS",e.VIEW_DOCUMENTS="VIEW_DOCUMENTS",e.SUBMIT_SAFETY_REPORT="SUBMIT_SAFETY_REPORT",e.VIEW_SAFETY_REPORTS="VIEW_SAFETY_REPORTS",e.MANAGE_SAFETY_REPORTS="MANAGE_SAFETY_REPORTS",e.VIEW_FINANCES="VIEW_FINANCES",e.MANAGE_FINANCES="MANAGE_FINANCES",e.VIEW_TEAM="VIEW_TEAM",e.MANAGE_TEAM="MANAGE_TEAM",e.MANAGE_EQUIPMENT="MANAGE_EQUIPMENT",e.VIEW_AUDIT_LOG="VIEW_AUDIT_LOG",e.SEND_DIRECT_MESSAGE="SEND_DIRECT_MESSAGE",e.ACCESS_ALL_TOOLS="ACCESS_ALL_TOOLS",e.SUBMIT_EXPENSE="SUBMIT_EXPENSE",e))(p||{}),x=(e=>(e.TODO="TODO",e.IN_PROGRESS="IN_PROGRESS",e.DONE="DONE",e))(x||{}),g=(e=>(e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH",e))(g||{}),y=(e=>(e.PENDING="PENDING",e.APPROVED="APPROVED",e.REJECTED="REJECTED",e.PAID="PAID",e))(y||{}),f=(e=>(e.DRAFT="DRAFT",e.SENT="SENT",e.PAID="PAID",e.OVERDUE="OVERDUE",e.CANCELLED="CANCELLED",e))(f||{}),b=(e=>(e.PENDING="PENDING",e.APPROVED="APPROVED",e.REJECTED="REJECTED",e.DRAFT="DRAFT",e))(b||{}),j=(e=>(e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH",e.CRITICAL="CRITICAL",e))(j||{}),w=(e=>(e.REPORTED="REPORTED",e.UNDER_INVESTIGATION="UNDER_INVESTIGATION",e.RESOLVED="RESOLVED",e))(w||{}),v=(e=>(e.AVAILABLE="AVAILABLE",e.IN_USE="IN_USE",e.MAINTENANCE="MAINTENANCE",e.OUT_OF_ORDER="OUT_OF_ORDER",e))(v||{});const N={OWNER:new Set(Object.values(p)),ADMIN:new Set(["VIEW_ALL_PROJECTS","CREATE_PROJECT","MANAGE_PROJECT_DETAILS","VIEW_ALL_TASKS","MANAGE_ALL_TASKS","VIEW_ALL_TIMESHEETS","MANAGE_TIMESHEETS","UPLOAD_DOCUMENTS","VIEW_DOCUMENTS","VIEW_SAFETY_REPORTS","MANAGE_SAFETY_REPORTS","VIEW_FINANCES","MANAGE_FINANCES","VIEW_TEAM","MANAGE_TEAM","MANAGE_EQUIPMENT","VIEW_AUDIT_LOG","SEND_DIRECT_MESSAGE","ACCESS_ALL_TOOLS","SUBMIT_EXPENSE","MANAGE_PROJECT_TEMPLATES"]),PROJECT_MANAGER:new Set(["VIEW_ALL_PROJECTS","MANAGE_PROJECT_DETAILS","VIEW_ALL_TASKS","MANAGE_ALL_TASKS","VIEW_ALL_TIMESHEETS","MANAGE_TIMESHEETS","UPLOAD_DOCUMENTS","VIEW_DOCUMENTS","VIEW_SAFETY_REPORTS","VIEW_FINANCES","VIEW_TEAM","MANAGE_EQUIPMENT","SEND_DIRECT_MESSAGE","SUBMIT_EXPENSE"]),FOREMAN:new Set(["VIEW_ASSIGNED_PROJECTS","SUBMIT_TIMESHEET","UPLOAD_DOCUMENTS","VIEW_DOCUMENTS","SUBMIT_SAFETY_REPORT","VIEW_SAFETY_REPORTS","SEND_DIRECT_MESSAGE","SUBMIT_EXPENSE"]),OPERATIVE:new Set(["VIEW_ASSIGNED_PROJECTS","SUBMIT_TIMESHEET","VIEW_DOCUMENTS","SUBMIT_SAFETY_REPORT","SUBMIT_EXPENSE"]),CLIENT:new Set(["VIEW_ASSIGNED_PROJECTS","VIEW_DOCUMENTS"]),PRINCIPAL_ADMIN:new Set(Object.values(p))},k={companies:[{id:"0",name:"Platform Administration"},{id:"1",name:"ConstructCo"},{id:"2",name:"Renovate Ltd."},{id:"3",name:"As Cladding and Roofing Ltd"}],users:[{id:"demo",firstName:"Demo",lastName:"User",email:"demo@example.com",role:h.ADMIN,companyId:"1",avatar:"https://i.pravatar.cc/150?u=demo",password:"password",mfaEnabled:!1},{id:"0",firstName:"Adrian",lastName:"Admin",email:"adrian@ascladdingltd.co.uk",role:h.PRINCIPAL_ADMIN,companyId:"0",avatar:"https://i.pravatar.cc/150?u=0",password:"Cumparavinde1",mfaEnabled:!1},{id:"1",firstName:"Samantha",lastName:"Lee",email:"sam@constructco.com",role:h.ADMIN,companyId:"1",avatar:"https://i.pravatar.cc/150?u=1",phone:"07123456781",password:"password123",mfaEnabled:!1},{id:"2",firstName:"David",lastName:"Chen",email:"david@constructco.com",role:h.PROJECT_MANAGER,companyId:"1",avatar:"https://i.pravatar.cc/150?u=2",phone:"07123456782",password:"password123",mfaEnabled:!0},{id:"3",firstName:"Maria",lastName:"Garcia",email:"maria@constructco.com",role:h.FOREMAN,companyId:"1",avatar:"https://i.pravatar.cc/150?u=3",phone:"07123456783",password:"password123",mfaEnabled:!1},{id:"4",firstName:"Bob",lastName:"Williams",email:"bob@constructco.com",role:h.OPERATIVE,companyId:"1",avatar:"https://i.pravatar.cc/150?u=4",phone:"07123456784",password:"password123",mfaEnabled:!1},{id:"5",firstName:"John",lastName:"Smith",email:"john@renovate.com",role:h.ADMIN,companyId:"2",avatar:"https://i.pravatar.cc/150?u=5",phone:"07123456785",password:"password123",mfaEnabled:!1},{id:"6",firstName:"Emily",lastName:"White",email:"emily@renovate.com",role:h.PROJECT_MANAGER,companyId:"2",avatar:"https://i.pravatar.cc/150?u=6",phone:"07123456786",password:"password123",mfaEnabled:!1},{id:"7",firstName:"Carlos",lastName:"Diaz",email:"carlos@constructco.com",role:h.OPERATIVE,companyId:"1",avatar:"https://i.pravatar.cc/150?u=7",phone:"07123456787",password:"password123",mfaEnabled:!1},{id:"8",firstName:"Admin",lastName:"User",email:"admin@ascladding.com",role:h.OWNER,companyId:"3",avatar:"https://i.pravatar.cc/150?u=8",phone:"07123456788",password:"password123",mfaEnabled:!1}],projects:[{id:"101",companyId:"1",name:"Downtown Tower",location:{address:"123 Main St, London",lat:51.5074,lng:-.1278},budget:5e6,spent:325e4,actualCost:325e4,startDate:"2023-01-15",status:"ACTIVE",image:"https://picsum.photos/seed/tower/800/400"},{id:"102",companyId:"1",name:"North Bridge Retrofit",location:{address:"456 Oak Ave, Manchester",lat:53.4808,lng:-2.2426},budget:12e5,spent:135e4,actualCost:135e4,startDate:"2022-11-01",status:"COMPLETED",image:"https://picsum.photos/seed/bridge/800/400"},{id:"201",companyId:"2",name:"Victorian House Reno",location:{address:"789 Pine Ln, Bristol",lat:51.4545,lng:-2.5879},budget:25e4,spent:18e4,actualCost:18e4,startDate:"2023-03-10",status:"ACTIVE",image:"https://picsum.photos/seed/house/800/400"}],todos:[{id:"t-1",text:"Finalize foundation pouring",title:"Finalize foundation pouring",status:x.IN_PROGRESS,priority:g.HIGH,assignedTo:"3",projectId:"101"},{id:"t-2",text:"Install HVAC system on floor 5",title:"Install HVAC system on floor 5",status:x.TODO,priority:g.MEDIUM,assignedTo:"4",projectId:"101"},{id:"t-3",text:"Source interior fixtures",title:"Source interior fixtures",status:x.TODO,priority:g.LOW,assignedTo:"2",projectId:"101"},{id:"t-4",text:"Strip wallpaper in living room",title:"Strip wallpaper in living room",status:x.DONE,priority:g.MEDIUM,assignedTo:"6",projectId:"201"}],expenses:[{id:"e-1",description:"Client Lunch",amount:150,category:"Other",projectId:"101",userId:"2",date:"2024-01-15",status:y.APPROVED}],invoices:[{id:"inv-1",companyId:"1",invoiceNumber:"INV-001",projectId:"101",clientId:"c-1",issueDate:"2024-01-20",dueDate:"2024-02-20",status:f.PAID,lineItems:[{id:"li-1",description:"Phase 1",quantity:1,rate:1e5,amount:1e5}],subtotal:1e5,taxRate:.2,taxAmount:2e4,retentionRate:.05,retentionAmount:5e3,total:115e3,amountPaid:115e3,balance:0}],siteUpdates:[{id:"su-1",projectId:"101",userId:"3",message:"Concrete pour for the ground floor is complete.",timestamp:new Date(Date.now()-72e5).toISOString(),images:["https://picsum.photos/seed/concrete/400/200"]}],projectMessages:[{id:"pm-1",projectId:"101",senderId:"2",message:"Team, please remember the safety briefing at 7 AM sharp tomorrow.",timestamp:new Date(Date.now()-12e5).toISOString()}],safetyIncidents:[{id:"si-1",title:"Minor Slip",description:"Minor slip on wet surface, no injury.",severity:j.LOW,projectId:"101",reportedBy:"3",incidentDate:(new Date).toISOString(),status:w.RESOLVED}],equipment:[{id:"eq-1",name:"Excavator CAT 320",status:v.AVAILABLE,companyId:"1"}],timeEntries:[{id:"te-1",userId:"4",projectId:"101",startTime:new Date(Date.now()-288e5).toISOString(),endTime:(new Date).toISOString(),status:b.PENDING}],projectInsights:[],financialForecasts:[],clients:[{id:"c-1",companyId:"1",name:"Global Real Estate Inc.",contactPerson:"Ava Harris",contactEmail:"ava.harris@gre.com",contactPhone:"+44 20 7946 0101",email:"accounts@gre.com",phone:"+44 20 7946 0101",billingAddress:"Accounts Payable, 100 Market Street, London SW1A 1AA",paymentTerms:"Net 30",isActive:!0,createdAt:"2024-01-15T09:00:00Z",updatedAt:"2024-12-10T10:30:00Z",address:{street:"100 Market Street",city:"London",state:"Greater London",zipCode:"SW1A 1AA",country:"United Kingdom"}},{id:"c-2",companyId:"1",name:"Northbridge Retail Group",contactPerson:"Leo Patel",contactEmail:"leo.patel@northbridge.com",contactPhone:"+44 161 555 0198",email:"finance@northbridge.com",phone:"+44 161 555 0198",billingAddress:"Finance Office, 50 King Street, Manchester M2 4LY",paymentTerms:"Net 45",isActive:!0,createdAt:"2024-11-28T12:00:00Z",updatedAt:"2024-12-15T08:15:00Z",address:{street:"50 King Street",city:"Manchester",state:"Greater Manchester",zipCode:"M2 4LY",country:"United Kingdom"}}]};var E={};class S{constructor(e={}){this.cache=new Map,this.defaultTtl=e.ttl||3e5,this.maxSize=e.maxSize||100,this.persistent=e.persistent||!1,this.namespace=e.namespace||"app-cache",this.persistent&&this.loadFromStorage(),"undefined"==typeof window||this.isTestEnv()||setInterval(()=>this.cleanup(),6e4)}isTestEnv(){try{return"undefined"!=typeof process&&!(!E?.VITEST&&!E?.VITEST_WORKER_ID)}catch{return!1}}set(e,t,s){const r=Date.now(),a={data:t,timestamp:r,ttl:s||this.defaultTtl,accessCount:0,lastAccessed:r};this.cache.size>=this.maxSize&&this.evictLRU(),this.cache.set(e,a),this.persistent&&this.saveToStorage()}get(e){const t=this.cache.get(e);if(!t)return null;const s=Date.now();return s-t.timestamp>t.ttl?(this.cache.delete(e),this.persistent&&this.saveToStorage(),null):(t.accessCount++,t.lastAccessed=s,t.data)}has(e){return null!==this.get(e)}delete(e){const t=this.cache.delete(e);return t&&this.persistent&&this.saveToStorage(),t}clear(){this.cache.clear(),this.persistent&&this.saveToStorage()}keys(){return Array.from(this.cache.keys())}size(){return this.cache.size}getStats(){const e=Array.from(this.cache.values());return{size:this.cache.size,maxSize:this.maxSize,totalAccesses:e.reduce((e,t)=>e+t.accessCount,0),averageAge:e.length>0?e.reduce((e,t)=>e+(Date.now()-t.timestamp),0)/e.length:0}}evictLRU(){let e="",t=Date.now();for(const[s,r]of this.cache.entries())r.lastAccessed<t&&(t=r.lastAccessed,e=s);e&&this.cache.delete(e)}cleanup(){const e=Date.now(),t=[];for(const[s,r]of this.cache.entries())e-r.timestamp>r.ttl&&t.push(s);t.forEach(e=>this.cache.delete(e)),t.length>0&&this.persistent&&this.saveToStorage()}saveToStorage(){if("undefined"!=typeof window&&window.localStorage)try{const e=JSON.stringify(Array.from(this.cache.entries()));localStorage.setItem(`${this.namespace}-cache`,e)}catch(e){console.warn("Failed to save cache to localStorage:",e)}}loadFromStorage(){if("undefined"!=typeof window&&window.localStorage)try{const e=localStorage.getItem(`${this.namespace}-cache`);if(e){const t=JSON.parse(e);this.cache=new Map(t),this.cleanup()}}catch(e){console.warn("Failed to load cache from localStorage:",e)}}}new S({ttl:3e5,maxSize:200,persistent:!0,namespace:"api-cache"}),new S({ttl:18e5,maxSize:50,persistent:!0,namespace:"user-cache"}),new S({ttl:6e5,maxSize:100,persistent:!0,namespace:"project-cache"});const C=class{static validate(e,t){const s={},r={...e};for(const a of t){const t=String(a.field),n=e[a.field],i=[];if(!a.required||null!=n&&""!==n){if(a.required||null!=n&&""!==n){if(a.type){const e=this.validateType(n,a.type,t);e&&i.push(e)}if("string"==typeof n&&(a.minLength&&n.length<a.minLength&&i.push(`${t} must be at least ${a.minLength} characters`),a.maxLength&&n.length>a.maxLength&&i.push(`${t} must not exceed ${a.maxLength} characters`)),"number"==typeof n&&(void 0!==a.min&&n<a.min&&i.push(`${t} must be at least ${a.min}`),void 0!==a.max&&n>a.max&&i.push(`${t} must not exceed ${a.max}`)),a.pattern&&"string"==typeof n&&!a.pattern.test(n)&&i.push(`${t} format is invalid`),a.custom){const e=a.custom(n);e&&i.push(e)}a.sanitize&&(r[a.field]=a.sanitize(n)),i.length>0&&(s[t]=i)}}else i.push(`${t} is required`)}return{isValid:0===Object.keys(s).length,errors:s,sanitizedData:0===Object.keys(s).length?r:void 0}}static validateType(e,t,s){switch(t){case"string":return"string"!=typeof e?`${s} must be a string`:null;case"number":return"number"!=typeof e||isNaN(e)?`${s} must be a valid number`:null;case"boolean":return"boolean"!=typeof e?`${s} must be true or false`:null;case"email":return"string"==typeof e&&this.emailRegex.test(e)?null:`${s} must be a valid email address`;case"phone":return"string"==typeof e&&this.phoneRegex.test(e.replace(/\s/g,""))?null:`${s} must be a valid phone number`;case"url":return"string"==typeof e&&this.urlRegex.test(e)?null:`${s} must be a valid URL`;case"date":const t=new Date(e);return isNaN(t.getTime())?`${s} must be a valid date`:null;default:return null}}};C.emailRegex=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,C.phoneRegex=/^[\+]?[1-9][\d]{0,15}$/,C.urlRegex=/^https?:\/\/.+/,C.sanitizers={trim:e=>"string"==typeof e?e.trim():e,toLowerCase:e=>"string"==typeof e?e.toLowerCase():e,toUpperCase:e=>"string"==typeof e?e.toUpperCase():e,removeSpecialChars:e=>"string"==typeof e?e.replace(/[^a-zA-Z0-9\s]/g,""):e,normalizePhone:e=>"string"==typeof e?e.replace(/\D/g,""):e,normalizeEmail:e=>"string"==typeof e?e.toLowerCase().trim():e,escapeHtml:e=>"string"!=typeof e?e:e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;"),limitLength:e=>t=>"string"==typeof t?t.substring(0,e):t},C.commonRules={email:{field:"email",required:!0,type:"email",sanitize:C.sanitizers.normalizeEmail},password:{field:"password",required:!0,type:"string",minLength:8,custom:e=>/(?=.*[a-z])/.test(e)?/(?=.*[A-Z])/.test(e)?/(?=.*\d)/.test(e)?null:"Password must contain at least one number":"Password must contain at least one uppercase letter":"Password must contain at least one lowercase letter"},phone:{field:"phone",type:"phone",sanitize:C.sanitizers.normalizePhone},name:{field:"name",required:!0,type:"string",minLength:2,maxLength:50,sanitize:C.sanitizers.trim},currency:{field:"amount",required:!0,type:"number",min:0,custom:e=>e<0?"Amount cannot be negative":e>1e6?"Amount exceeds maximum limit":null}};let I=C;let A=null;const D=()=>{if(A)return A;try{const e=globalThis;if(e&&e.localStorage){const t="__asagents_storage_test__";return e.localStorage.setItem(t,"1"),e.localStorage.removeItem(t),A=e.localStorage,A}}catch(e){console.warn("Falling back to in-memory storage adapter.",e)}return A=(()=>{const e=new Map;return{getItem:t=>e.has(t)?e.get(t):null,setItem(t,s){e.set(t,String(s))},removeItem(t){e.delete(t)},clear(){e.clear()},key:t=>Array.from(e.keys())[t]??null,get length(){return e.size}}})(),A},T=(()=>{if(void 0!==globalThis.crypto)return globalThis.crypto;throw new Error("Secure crypto APIs are not available in this environment.")})(),R=new TextEncoder,M=e=>Array.from(new Uint8Array(e)).map(e=>e.toString(16).padStart(2,"0")).join(""),P=async(e,t)=>{const s=R.encode(`${t}:${e}`),r=await T.subtle.digest("SHA-256",s);return M(r)},O=async e=>{const t=((e=16)=>{const t=new Uint8Array(e);return T.getRandomValues(t),M(t.buffer)})();return{hash:await P(e,t),salt:t}},_=async e=>{if(!e.passwordHash&&!e.passwordSalt&&e.password){const{hash:t,salt:s}=await O(e.password);e.passwordHash=t,e.passwordSalt=s,delete e.password}return e},L=(e=50)=>new Promise(t=>setTimeout(t,e)),$=9e5,U=6048e5,F=e=>e.trim().toLowerCase(),V=e=>e.trim().toUpperCase(),q=new Map,H=D(),W=[["JOIN-CONSTRUCTCO",{companyId:"1",allowedRoles:[h.ADMIN,h.PROJECT_MANAGER,h.FOREMAN,h.OPERATIVE],suggestedRole:h.PROJECT_MANAGER}],["JOIN-RENOVATE",{companyId:"2",allowedRoles:[h.ADMIN,h.PROJECT_MANAGER,h.FOREMAN,h.OPERATIVE],suggestedRole:h.FOREMAN}],["JOIN-CLIENT",{companyId:"3",allowedRoles:[h.CLIENT],suggestedRole:h.CLIENT}]],B=new Map;B.clear(),W.forEach(([e,t])=>{B.set(e,{...t})});const z=e=>{if("function"==typeof btoa)return btoa(e);if("undefined"!=typeof Buffer)return Buffer.from(e,"binary").toString("base64");throw new Error("Base64 encoding is not supported in this environment.")},G=(e,t)=>{const s={...e,iat:Date.now(),exp:Math.floor((Date.now()+t)/1e3)};return`${z(JSON.stringify({alg:"HS256",typ:"JWT"}))}.${z(JSON.stringify(s))}.${z("your-super-secret-key-for-mock-jwt")}`},J=e=>{try{const t=JSON.parse((e=>{if("function"==typeof atob)return atob(e);if("undefined"!=typeof Buffer)return Buffer.from(e,"base64").toString("binary");throw new Error("Base64 decoding is not supported in this environment.")})(e.split(".")[1]));if(1e3*t.exp<Date.now())throw new Error("Token expired");return t}catch(t){return console.error("Token decode/validation failed:",t),null}},Q="asagents_",Y=e=>JSON.parse(JSON.stringify(e)),K=(e,t)=>{try{const s=H.getItem(e);return s?JSON.parse(s):t}catch(s){return console.error(`Failed to read ${e} from storage`,s),t}},Z={companies:Y(k.companies),users:Y(k.users),projects:Y(k.projects),todos:Y(k.todos),timeEntries:Y(k.timeEntries),safetyIncidents:Y(k.safetyIncidents),equipment:Y(k.equipment),clients:Y(k.clients),invoices:Y(k.invoices),expenses:Y(k.expenses||[]),siteUpdates:Y(k.siteUpdates),projectMessages:Y(k.projectMessages),notifications:Y(k.notifications||[]),quotes:Y(k.quotes||[]),auditLogs:[],resourceAssignments:[],conversations:[],messages:[],projectAssignments:[],projectTemplates:[],whiteboardNotes:[],documents:[],projectInsights:Y(k.projectInsights||[]),financialForecasts:Y(k.financialForecasts||[])},ee=e=>{const t=`${Q}${String(e)}`;try{const e=H.getItem(t);if(e)return JSON.parse(e)}catch(r){console.error(`Failed to hydrate ${String(e)} from storage`,r)}const s=Y(Z[e]);return H.setItem(t,JSON.stringify(s)),s};let te={companies:ee("companies"),users:ee("users"),projects:ee("projects"),todos:ee("todos"),timeEntries:ee("timeEntries"),safetyIncidents:ee("safetyIncidents"),equipment:ee("equipment"),clients:ee("clients"),invoices:ee("invoices"),expenses:ee("expenses"),siteUpdates:ee("siteUpdates"),projectMessages:ee("projectMessages"),notifications:ee("notifications"),quotes:ee("quotes"),auditLogs:ee("auditLogs"),resourceAssignments:ee("resourceAssignments"),conversations:ee("conversations"),messages:ee("messages"),projectAssignments:ee("projectAssignments"),projectTemplates:ee("projectTemplates"),whiteboardNotes:ee("whiteboardNotes"),documents:ee("documents"),financialForecasts:ee("financialForecasts"),projectInsights:ee("projectInsights")};const se=()=>{Object.keys(te).forEach(e=>{H.setItem(`${Q}${String(e)}`,JSON.stringify(te[e]))})},re=e=>{const t=F(e);return te.users.find(e=>e.email&&e.email.toLowerCase()===t)},ae=e=>(e=>{const{password:t,passwordHash:s,passwordSalt:r,...a}=e;return a})(e);(()=>{const e=te.users.filter(e=>e.password&&(!e.passwordHash||!e.passwordSalt));0!==e.length&&Promise.all(e.map(e=>_(e))).then(()=>{se()}).catch(e=>console.error("Failed to upgrade legacy user credentials",e))})();(()=>{let e=!1;te.users.forEach(t=>{!t.role||t.permissions&&0!==t.permissions.length||(t.permissions=Array.from(N[t.role]),e=!0)}),e&&se()})();const ne=(e,t,s)=>{const r={id:String(Date.now()+Math.random()),actorId:e,action:t,target:s,timestamp:(new Date).toISOString()};te.auditLogs.push(r),se()},ie={register:async e=>{if(await L(),!e.email||!e.password)throw new Error("Email and password are required.");if(!e.termsAccepted)throw new Error("You must accept the terms and conditions to create an account.");const t=F(e.email);if(re(t))throw new Error("An account with this email already exists.");const s=e.password.trim();if(![s.length>=8,/[A-Z]/.test(s),/[a-z]/.test(s),/\d/.test(s),/[^A-Za-z0-9]/.test(s)].every(Boolean))throw new Error("Password does not meet the minimum complexity requirements.");const r=e.firstName?.trim(),a=e.lastName?.trim(),n=e.phone?.trim();let i,o,l=e.role||h.OPERATIVE;if("create"===e.companySelection){const t=e.companyName?.trim(),s=e.companyType,r=e.companyEmail?F(e.companyEmail):void 0,a=e.companyPhone?.trim(),n=e.companyWebsite?.trim();if(!t||!s)throw new Error("Company information is incomplete.");const c=String(Date.now());i=c,o={id:i,name:t,type:s,email:r,phone:a,website:n,status:"Active",subscriptionPlan:"FREE",storageUsageGB:0,settings:{theme:"light",accessibility:{highContrast:!1},timeZone:"Europe/London",dateFormat:"DD/MM/YYYY",currency:"GBP",workingHours:{start:"08:00",end:"17:00",workDays:[1,2,3,4,5]},features:{projectManagement:!0,timeTracking:!0,financials:!0,documents:!0,safety:!0,equipment:!0,reporting:!0}},address:{street:"",city:"",state:"",zipCode:"",country:"United Kingdom"},createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()},te.companies.push(o),B.set(`JOIN-${i}`,{companyId:i,allowedRoles:[h.ADMIN,h.PROJECT_MANAGER,h.FOREMAN,h.OPERATIVE],suggestedRole:h.ADMIN}),l=h.OWNER}else{if("join"!==e.companySelection)throw new Error("Invalid company selection.");{const t=e.inviteToken?V(e.inviteToken):"";if(!t)throw new Error("An invite token is required to join an existing company.");const s=B.get(t);if(!s)throw new Error("Invalid invite token.");if(i=s.companyId,o=te.companies.find(e=>e.id===i),!o)throw new Error("Company not found for invite token.");if(e.role&&!s.allowedRoles.includes(e.role))throw new Error("Selected role is not permitted for this invite.");l=e.role&&s.allowedRoles.includes(e.role)?e.role:s.suggestedRole||s.allowedRoles[0]}}const c=await O(s),d=(new Date).toISOString(),m={id:String(Date.now()+Math.random()),firstName:r,lastName:a,email:t,passwordHash:c.hash,passwordSalt:c.salt,phone:n,role:l,permissions:Array.from(N[l]),companyId:i,isActive:!0,isEmailVerified:!0,mfaEnabled:!1,createdAt:d,updatedAt:d,preferences:{theme:"system",language:"en",notifications:{email:!0,push:!1,sms:!1,taskReminders:!0,projectUpdates:!0,systemAlerts:!0},dashboard:{defaultView:"dashboard",pinnedWidgets:[],hiddenWidgets:[]}}};!1===e.updatesOptIn&&(m.preferences.notifications.projectUpdates=!1),te.users.push(m);const u=o||te.companies.find(e=>e.id===i);u?.name&&(ne(m.id,"USER_REGISTERED",{type:"Company",id:i,name:u.name}),"create"===e.companySelection&&ne(m.id,"COMPANY_CREATED",{type:"Company",id:i,name:u.name})),se();const p=te.users.find(e=>e.id===m.id),x=te.companies.find(e=>e.id===i);return{success:!0,token:G({userId:p.id,companyId:x.id,role:p.role},$),refreshToken:G({userId:p.id},U),user:ae(p),company:x}},checkEmailAvailability:async e=>{if(await L(120),!e)return{available:!1};const t=F(e);return{available:!re(t)}},lookupInviteToken:async e=>{if(await L(200),!e)throw new Error("An invite token is required.");const t=V(e),s=B.get(t);if(!s)throw new Error("Invite token not recognized.");const r=te.companies.find(e=>e.id===s.companyId);if(!r)throw new Error("Company not found for invite token.");return{companyId:r.id,companyName:r.name||"Unnamed Company",companyType:r.type,allowedRoles:s.allowedRoles,suggestedRole:s.suggestedRole}},login:async e=>{await L(200);const t=F(e.email),s=re(t);if(!s)throw new Error("Invalid email or password.");if(!(!s.password||s.passwordHash&&s.passwordSalt)&&(await _(s),se()),!s.passwordHash||!s.passwordSalt)throw new Error("Invalid email or password.");if(!(await(async(e,t,s)=>((e,t)=>{if(e.length!==t.length)return!1;let s=0;for(let r=0;r<e.length;r++)s|=e.charCodeAt(r)^t.charCodeAt(r);return 0===s})(await P(e,s),t))(e.password,s.passwordHash,s.passwordSalt)))throw new Error("Invalid email or password.");return s.mfaEnabled?{success:!0,mfaRequired:!0,userId:s.id}:ie.finalizeLogin(s.id)},verifyMfa:async(e,t)=>{if(await L(200),"123456"!==t)throw new Error("Invalid MFA code.");return ie.finalizeLogin(e)},finalizeLogin:async e=>{await L();const t=te.users.find(t=>t.id===e);if(!t)throw new Error("User not found during finalization.");const s=te.companies.find(e=>e.id===t.companyId);if(!s)throw new Error("Company not found for user.");return{success:!0,token:G({userId:t.id,companyId:s.id,role:t.role},$),refreshToken:G({userId:t.id},U),user:ae(t),company:s}},refreshToken:async e=>{await L();const t=J(e);if(!t)throw new Error("Invalid refresh token");const s=te.users.find(e=>e.id===t.userId);if(!s)throw new Error("User not found for refresh token");return{token:G({userId:s.id,companyId:s.companyId,role:s.role},$)}},me:async e=>{await L();const t=J(e);if(!t)throw new Error("Invalid or expired token");const s=te.users.find(e=>e.id===t.userId),r=te.companies.find(e=>e.id===t.companyId);if(!s||!r)throw new Error("User or company not found");return{user:ae(s),company:r}},requestPasswordReset:async e=>{await L(300);const t=e?re(e):void 0;if(t){const s=`reset-${Date.now()}-${Math.random()}`;q.set(s,{userId:t.id,expires:Date.now()+36e5}),console.log(`Password reset for ${e}. Token: ${s}`)}return{success:!0}},resetPassword:async(e,t)=>{await L(300);const s=q.get(e);if(!s||s.expires<Date.now())throw new Error("Invalid or expired password reset token.");const r=te.users.findIndex(e=>e.id===s.userId);if(-1===r)throw new Error("User not found.");const a=await O(t);return te.users[r].passwordHash=a.hash,te.users[r].passwordSalt=a.salt,delete te.users[r].password,se(),q.delete(e),{success:!0}}};K("asagents_offline_queue",[]),K("asagents_failed_sync_actions",[]);const oe=async(e,t,s,r)=>{const a=te.users.findIndex(t=>t.id===e);if(-1===a)throw new Error("User not found");const n={...t};if(n.email&&(n.email=F(n.email)),t?.password){const e=await O(t.password);n.passwordHash=e.hash,n.passwordSalt=e.salt,delete n.password}return te.users[a]={...te.users[a],...n},delete te.users[a].password,void 0!==s&&(te.projectAssignments=te.projectAssignments.filter(t=>t.userId!==e),s.forEach(t=>te.projectAssignments.push({userId:e,projectId:String(t)}))),se(),ae(te.users[a])},le={};var ce={};class de extends Error{constructor(e,t){super(e),this.cause=t,this.name="BackendUnavailableError"}}const me=e=>{if(!e)return null;const t=e.trim();return t?t.replace(/\/+$/,""):null},ue="undefined"!=typeof process&&(ce?.VITEST||ce?.VITEST_WORKER_ID)?null:"undefined"!=typeof window&&"string"==typeof window.__ASAGENTS_API_BASE_URL__?me(window.__ASAGENTS_API_BASE_URL__):void 0!==import.meta&&le?.VITE_API_BASE_URL?me(void 0):"undefined"!=typeof process&&"string"==typeof ce?.VITE_API_BASE_URL?me(ce.VITE_API_BASE_URL):null;let he=ue,pe=!ue;const xe=(e,t)=>{const s=new Headers(e??{});return s.has("Accept")||s.set("Accept","application/json"),null==t||""===t||s.has("Content-Type")||s.set("Content-Type","application/json"),s},ge=async(e,t,s)=>{if(!he)return s();try{return await(async(e,t)=>{if(!he)throw new de("No authentication backend configured.");const s=`${he}${(e=>e.startsWith("/")?e:`/${e}`)(e)}`;let r;try{r=await fetch(s,{...t,headers:xe(t.headers,t.body??void 0)})}catch(i){throw new de("Unable to reach authentication service.",i)}let a=null;const n=r.headers.get("content-type");if(n&&n.includes("application/json"))a=await r.json();else{const e=await r.text();a=e?{message:e}:{}}if(!r.ok){const e=a?.message||a?.error||`Request failed with status ${r.status}`,t=new Error(e);throw t.status=r.status,t.details=a,t}return a})(e,t)}catch(r){if(r instanceof de){if(pe)return console.warn("[authClient] Falling back to local mock authentication.",r),s();const e=new Error("Authentication service is currently unavailable. Please try again later.");throw e.cause=r,e}throw r}},ye=e=>ge("/auth/register",{method:"POST",body:JSON.stringify(e)},()=>ie.register(e)),fe=(e,t)=>ge("/auth/mfa/verify",{method:"POST",body:JSON.stringify({userId:e,code:t})},()=>ie.verifyMfa(e,t)),be=e=>ge("/auth/token/refresh",{method:"POST",body:JSON.stringify({refreshToken:e})},()=>ie.refreshToken(e)),je=e=>ge("/auth/me",{method:"GET",headers:{Authorization:`Bearer ${e}`}},()=>ie.me(e)),we=e=>ge("/auth/password/request-reset",{method:"POST",body:JSON.stringify({email:e})},()=>ie.requestPasswordReset(e)),ve=(e,t)=>ge("/auth/password/reset",{method:"POST",body:JSON.stringify({token:e,newPassword:t})},()=>ie.resetPassword(e,t));class Ne{constructor(){this.loginAttempts=new Map,this.activeSessions=new Map,this.maxLoginAttempts=5,this.lockoutDuration=9e5,this.sessionTimeout=18e5}static getInstance(){return Ne.instance||(Ne.instance=new Ne),Ne.instance}hasPermission(e,t,s){if(!e)return!1;if(e.role===h.PRINCIPAL_ADMIN)return!0;const r=N[e.role];if(!r)return!1;const a=r.has(t);return a&&s?this.checkContextualPermissions(e,t,s):a}isAccountLocked(e){return(this.loginAttempts.get(e)||[]).filter(e=>!e.success&&Date.now()-e.timestamp<this.lockoutDuration).length>=this.maxLoginAttempts}recordLoginAttempt(e,t,s){const r=this.loginAttempts.get(e)||[];r.push({email:e,timestamp:Date.now(),success:t,...s});const a=Date.now()-864e5,n=r.filter(e=>e.timestamp>a);this.loginAttempts.set(e,n)}validatePasswordStrength(e){const t=[];return e.length<8&&t.push("Password must be at least 8 characters long"),/[a-z]/.test(e)||t.push("Password must contain at least one lowercase letter"),/[A-Z]/.test(e)||t.push("Password must contain at least one uppercase letter"),/\d/.test(e)||t.push("Password must contain at least one number"),/[!@#$%^&*(),.?":{}|<>]/.test(e)||t.push("Password must contain at least one special character"),this.isCommonPassword(e)&&t.push("Password is too common, please choose a more unique password"),{isValid:0===t.length,errors:t}}createSession(e,t){const s=this.generateSessionId(),r=new Set(N[e.role]||[]),a={user:e,sessionId:s,lastActivity:Date.now(),permissions:r,...t};return this.activeSessions.set(s,a),this.cleanupExpiredSessions(),s}validateSession(e){const t=this.activeSessions.get(e);return t?Date.now()-t.lastActivity>this.sessionTimeout?(this.activeSessions.delete(e),null):(t.lastActivity=Date.now(),t):null}revokeSession(e){return this.activeSessions.delete(e)}revokeAllUserSessions(e){let t=0;for(const[s,r]of this.activeSessions.entries())r.user.id===e&&(this.activeSessions.delete(s),t++);return t}getSecurityMetrics(){const e=Date.now()-36e5;let t=0,s=0,r=0;for(const a of this.loginAttempts.values()){const n=a.filter(t=>t.timestamp>e);t+=n.length,s+=n.filter(e=>!e.success).length;n.filter(e=>!e.success).length>=this.maxLoginAttempts&&r++}return{activeSessions:this.activeSessions.size,totalLoginAttempts:t,failedLoginAttempts:s,lockedAccounts:r,successRate:t>0?(t-s)/t*100:100}}checkContextualPermissions(e,t,s){return t===p.MANAGE_TEAM&&s.userId?e.id===s.userId||this.hasPermission(e,p.MANAGE_TEAM):(t===p.VIEW_ALL_PROJECTS&&s.projectId,!0)}isCommonPassword(e){return["password","123456","123456789","qwerty","abc123","password123","admin","letmein","welcome","monkey"].includes(e.toLowerCase())}generateSessionId(){const e=new Uint8Array(32);return crypto.getRandomValues(e),Array.from(e,e=>e.toString(16).padStart(2,"0")).join("")}cleanupExpiredSessions(){const e=Date.now();for(const[t,s]of this.activeSessions.entries())e-s.lastActivity>this.sessionTimeout&&this.activeSessions.delete(t)}}const ke=(e,t)=>Ne.getInstance().hasPermission(e,t),Ee=Ne.getInstance();class Se{constructor(){this.events=[],this.metrics=[],this.batchSize=50,this.flushInterval=3e4,this.maxRetries=3,this.currentSession=this.createSession(),this.setupPerformanceMonitoring(),this.setupAutoFlush(),this.setupPageVisibilityTracking()}static getInstance(){return Se.instance||(Se.instance=new Se),Se.instance}track(e,t){const s={name:e,properties:this.sanitizeProperties(t),timestamp:Date.now(),userId:this.getCurrentUserId(),sessionId:this.currentSession.id,metadata:{url:window.location.href,userAgent:navigator.userAgent,viewport:`${window.innerWidth}x${window.innerHeight}`}};this.events.push(s),this.currentSession.events.push(s),this.updateSessionActivity(),this.events.length>=this.batchSize&&this.flush()}trackPageView(e,t){this.track("page_view",{path:e,title:t||document.title,referrer:document.referrer}),this.currentSession.pageViews++}trackClick(e,t){this.track("click",{element:e,...t})}trackFormSubmit(e,t,s){this.track("form_submit",{form_name:e,success:t,errors:s})}trackSearch(e,t,s){this.track("search",{query:e,results_count:t,filters:s})}trackError(e,t){this.track("error",{error_name:e.name,error_message:e.message,error_stack:e.stack,context:t})}trackPerformance(e,t,s,r){const a={name:e,value:t,unit:s,timestamp:Date.now(),tags:r};this.metrics.push(a),this.metrics.length>=this.batchSize&&this.flushMetrics()}trackLoadTime(e,t){this.trackPerformance("page_load_time",t,"ms",{page:e})}trackApiCall(e,t,s,r){this.trackPerformance("api_call_duration",s,"ms",{endpoint:e,method:t,status:r.toString()})}identify(e,t){this.currentSession.userId=e,this.track("identify",{user_id:e,traits:this.sanitizeProperties(t)})}startNewSession(){this.endCurrentSession(),this.currentSession=this.createSession()}endCurrentSession(){this.track("session_end",{session_duration:Date.now()-this.currentSession.startTime,page_views:this.currentSession.pageViews,events_count:this.currentSession.events.length}),this.flush()}getSessionData(){return{...this.currentSession}}getEventsSummary(e){const t=e?this.events.filter(t=>t.timestamp>=e.start&&t.timestamp<=e.end):this.events,s=t.reduce((e,t)=>(e[t.name]=(e[t.name]||0)+1,e),{});return{totalEvents:t.length,eventTypes:Object.keys(s).length,breakdown:s}}getPerformanceMetrics(e){const t=e?this.metrics.filter(t=>t.name===e):this.metrics;if(0===t.length)return null;const s=t.map(e=>e.value);return{count:t.length,min:Math.min(...s),max:Math.max(...s),avg:s.reduce((e,t)=>e+t,0)/s.length,p95:this.percentile(s,95),p99:this.percentile(s,99)}}async flush(){if(0===this.events.length)return;const e=[...this.events];this.events=[];try{await this.sendEvents(e)}catch(t){console.error("Failed to send analytics events:",t),this.events.unshift(...e)}}async flushMetrics(){if(0===this.metrics.length)return;const e=[...this.metrics];this.metrics=[];try{await this.sendMetrics(e)}catch(t){console.error("Failed to send performance metrics:",t),this.metrics.unshift(...e)}}createSession(){return{id:this.generateSessionId(),startTime:Date.now(),lastActivity:Date.now(),pageViews:0,events:[],userAgent:navigator.userAgent,referrer:document.referrer}}updateSessionActivity(){this.currentSession.lastActivity=Date.now()}getCurrentUserId(){return this.currentSession.userId}generateSessionId(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}sanitizeProperties(e){if(!e)return;const t={};for(const[s,r]of Object.entries(e))"function"!=typeof r&&void 0!==r&&("string"==typeof r&&r.length>1e3?t[s]=r.substring(0,1e3)+"...":t[s]=r);return t}setupPerformanceMonitoring(){if("performance"in window&&"getEntriesByType"in performance&&window.addEventListener("load",()=>{setTimeout(()=>{const e=performance.getEntriesByType("navigation")[0];e&&this.trackLoadTime("initial_page_load",e.loadEventEnd-e.fetchStart)},0)}),"PerformanceObserver"in window)try{new PerformanceObserver(e=>{for(const t of e.getEntries())this.trackPerformance("long_task",t.duration,"ms")}).observe({entryTypes:["longtask"]})}catch(e){console.warn("Long task monitoring not supported")}}setupAutoFlush(){setInterval(()=>{this.flush(),this.flushMetrics()},this.flushInterval),window.addEventListener("beforeunload",()=>{this.endCurrentSession()})}setupPageVisibilityTracking(){document.addEventListener("visibilitychange",()=>{document.hidden?this.track("page_hidden"):(this.track("page_visible"),this.updateSessionActivity())})}async sendEvents(e){console.log("Sending analytics events:",e),await new Promise(e=>setTimeout(e,100))}async sendMetrics(e){console.log("Sending performance metrics:",e),await new Promise(e=>setTimeout(e,100))}percentile(e,t){const s=[...e].sort((e,t)=>e-t);return s[Math.ceil(t/100*s.length)-1]}}const Ce=Se.getInstance();D();const Ie=r.createContext(void 0);let Ae=null;const De=({children:e})=>{const[t,s]=r.useState({isAuthenticated:!1,token:null,refreshToken:null,user:null,company:null,loading:!0,error:null}),a=D(),n=r.useCallback(()=>{a.removeItem("token"),a.removeItem("refreshToken"),Ae&&clearTimeout(Ae),s({isAuthenticated:!1,token:null,refreshToken:null,user:null,company:null,loading:!1,error:null})},[]),i=e=>{Ae&&clearTimeout(Ae);const t=(e=>{try{return JSON.parse(atob(e.split(".")[1]))}catch(t){return null}})(e);if(t&&t.exp){const r=1e3*t.exp-Date.now()-6e4;r>0?Ae=setTimeout(async()=>{const t=a.getItem("refreshToken");if(t)try{console.log("Proactively refreshing token...");const{token:r}=await be(t);a.setItem("token",r),s(e=>({...e,token:r})),r!==e&&i(r)}catch(r){console.error("Proactive token refresh failed",r),a.removeItem("token"),a.removeItem("refreshToken"),Ae&&clearTimeout(Ae),s({isAuthenticated:!1,token:null,refreshToken:null,user:null,company:null,loading:!1,error:null})}},r):(console.warn("Token is already expired or has less than a minute left. Logging out."),a.removeItem("token"),a.removeItem("refreshToken"),Ae&&clearTimeout(Ae),s({isAuthenticated:!1,token:null,refreshToken:null,user:null,company:null,loading:!1,error:null}))}},o=r.useCallback(e=>{a.setItem("token",e.token),a.setItem("refreshToken",e.refreshToken),s({isAuthenticated:!0,token:e.token,refreshToken:e.refreshToken,user:e.user,company:e.company,loading:!1,error:null}),i(e.token)},[]);r.useEffect(()=>((async()=>{const e=a.getItem("token"),t=a.getItem("refreshToken");if(e&&t)try{const{user:s,company:r}=await je(e);o({token:e,refreshToken:t,user:s,company:r})}catch(r){console.log("Access token invalid, attempting reactive refresh...");try{const{token:e}=await be(t),{user:s,company:r}=await je(e);o({token:e,refreshToken:t,user:s,company:r})}catch(n){console.error("Auth init with refresh token failed, clearing auth state.",n),a.removeItem("token"),a.removeItem("refreshToken"),s({isAuthenticated:!1,token:null,refreshToken:null,user:null,company:null,loading:!1,error:null})}}else s(e=>({...e,loading:!1}))})(),()=>{Ae&&clearTimeout(Ae)}),[]);const l={...t,login:async e=>{s(e=>({...e,loading:!0,error:null}));const t=I.validate(e,[{field:"email",required:!0,type:"email",sanitize:I.sanitizers.normalizeEmail},{field:"password",required:!0,type:"string",minLength:1}]);if(!t.isValid){const e=new Error(`Invalid credentials: ${Object.values(t.errors).flat().join(", ")}`);throw s(t=>({...t,loading:!1,error:e.message})),e}if(Ee.isAccountLocked(e.email)){const t=new Error("Account temporarily locked due to multiple failed login attempts");throw s(e=>({...e,loading:!1,error:t.message})),Ee.recordLoginAttempt(e.email,!1,{ipAddress:"unknown",userAgent:navigator.userAgent}),t}try{const r=await ie.login(t.sanitizedData);return Ee.recordLoginAttempt(e.email,!0,{ipAddress:"unknown",userAgent:navigator.userAgent}),r.mfaRequired?(s(e=>({...e,loading:!1})),{mfaRequired:!0,userId:r.userId}):(o(r),{mfaRequired:!1})}catch(r){throw Ee.recordLoginAttempt(e.email,!1,{ipAddress:"unknown",userAgent:navigator.userAgent}),Ce.trackError(r,{operation:"login",email:e.email}),s(e=>({...e,token:null,refreshToken:null,user:null,company:null,isAuthenticated:!1,loading:!1,error:r.message||"Login failed"})),r}},register:async e=>{s(e=>({...e,loading:!0,error:null}));try{const t=await ye(e);return o(t),t}catch(t){throw s(e=>({...e,loading:!1,error:t.message||"Registration failed"})),t}},logout:n,hasPermission:e=>ke(t.user,e),verifyMfaAndFinalize:async(e,t)=>{s(e=>({...e,loading:!0,error:null}));try{const s=await fe(e,t);o(s)}catch(r){throw s(e=>({...e,loading:!1,error:r.message||"MFA verification failed"})),r}},updateUserProfile:async e=>{if(!t.user)throw new Error("Not authenticated");const r=await oe(t.user.id,e,void 0,t.user.id);s(e=>({...e,user:{...e.user,...r}}))},requestPasswordReset:async e=>{s(e=>({...e,loading:!0,error:null}));try{await we(e),s(e=>({...e,loading:!1}))}catch(t){throw s(e=>({...e,loading:!1,error:t.message||"Request failed"})),t}},resetPassword:async(e,t)=>{s(e=>({...e,loading:!0,error:null}));try{await ve(e,t),s(e=>({...e,loading:!1}))}catch(r){throw s(e=>({...e,loading:!1,error:r.message||"Password reset failed"})),r}}};return d.jsx(Ie.Provider,{value:l,children:e})},Te=()=>{const e=r.useContext(Ie);if(void 0===e)throw new Error("useAuth must be used within an AuthProvider");return e},Re=({children:e,className:t="",...s})=>d.jsx("div",{className:`bg-card text-card-foreground rounded-[--radius] border border-border p-6 shadow-sm transition-all duration-300 ${t}`,...s,children:e}),Me=({size:e})=>d.jsxs("svg",{className:`animate-spin ${{sm:"h-4 w-4",md:"h-5 w-5",lg:"h-6 w-6"}[e]}`,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[d.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),d.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),Pe=({children:e,variant:t="primary",size:s="md",className:r="",isLoading:a=!1,...n})=>d.jsx("button",{className:`inline-flex items-center justify-center rounded-md font-semibold focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:opacity-60 disabled:cursor-not-allowed transition-all duration-200 transform hover:scale-[1.02] active:scale-[0.98] ${{primary:"bg-primary text-primary-foreground hover:bg-primary/90 shadow-sm",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80 border border-border",success:"bg-green-600 hover:bg-green-700 focus:ring-green-500 text-white shadow-sm",danger:"bg-destructive text-destructive-foreground hover:bg-destructive/90 shadow-sm",ghost:"bg-transparent hover:bg-accent focus:ring-ring text-accent-foreground"}[t]} ${{sm:"px-3 py-1.5 text-xs h-9",md:"px-5 py-2 text-sm h-10",lg:"px-6 py-3 text-base h-12"}[s]} ${r}`,...n,disabled:n.disabled||a,children:a?d.jsx(Me,{size:s}):e}),Oe="asagents_remembered_email",_e=D(),Le=(e,t)=>{try{e&&t?_e.setItem(Oe,(e=>e.trim().toLowerCase())(t)):_e.removeItem(Oe)}catch(s){console.warn("Unable to persist remembered email",s)}},$e=({align:e="center",className:t=""})=>{const s="left"===e?"text-left":"text-center";return d.jsx("p",{className:`text-xs text-muted-foreground ${s} ${t}`.trim(),children:"Operating in secure offline demo mode. Accounts are stored locally in your browser."})},Ue=({onSwitchToRegister:e,onSwitchToForgotPassword:t})=>{const{login:s,verifyMfaAndFinalize:a,error:n,loading:i}=Te(),[o,l]=r.useState("credentials"),c=(()=>{try{return _e.getItem(Oe)||""}catch(w){return console.warn("Unable to read remembered email",w),""}})(),[m,u]=r.useState(c),[h,p]=r.useState(""),[x,g]=r.useState(""),[y,f]=r.useState(""!==c),[b,j]=r.useState(!1),[w,v]=r.useState(null),[N,k]=r.useState({}),[E,S]=r.useState(null),C=r.useRef(null);r.useEffect(()=>{v(n)},[n]),r.useEffect(()=>{y||Le(!1,"")},[y]),r.useEffect(()=>{"mfa"===o&&C.current?.focus()},[o]);const I=e=>{k(t=>{if(!t[e])return t;const s={...t};return delete s[e],s})},A=async e=>{e.preventDefault(),v(null);const t={},r=m.trim();if((e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e))(r)||(t.email="Please enter a valid email."),h.length<6&&(t.password="Password is too short."),k(t),!(Object.keys(t).length>0))try{u(r);const e=await s({email:r,password:h,rememberMe:y});e.mfaRequired&&e.userId?(S(e.userId),l("mfa"),g(""),k(e=>{if(!e.mfa)return e;const t={...e};return delete t.mfa,t})):Le(y,r.toLowerCase()),p("")}catch(a){}},D=async e=>{if(e.preventDefault(),v(null),6===x.length)try{if(!E)throw new Error("User ID not found");await a(E,x),Le(y,m.trim().toLowerCase()),g("")}catch(t){}else k({mfa:"Code must be 6 digits."})};return d.jsxs("div",{className:"min-h-screen bg-background flex flex-col justify-center py-12 sm:px-6 lg:px-8",children:[d.jsxs("div",{className:"sm:mx-auto sm:w-full sm:max-w-md text-center",children:[d.jsxs("div",{className:"inline-flex items-center justify-center gap-2 mb-2",children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",className:"w-10 h-10 text-primary",children:d.jsx("path",{fill:"currentColor",d:"M12 2L2 22h20L12 2z"})}),d.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"AS Agents"})]}),d.jsx("h2",{className:"text-muted-foreground",children:"Sign in to your account"})]}),d.jsxs(Re,{className:"mt-8 sm:mx-auto sm:w-full sm:max-w-md",children:[d.jsx($e,{className:"mb-4"}),w&&d.jsx("div",{className:"mb-4 p-3 bg-destructive/10 text-destructive text-sm rounded-md border border-destructive/20",children:w}),"credentials"===o?d.jsxs("form",{onSubmit:A,className:"space-y-6",children:[d.jsxs("div",{children:[d.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-muted-foreground",children:"Email Address"}),d.jsx("input",{id:"email",type:"email",value:m,onChange:e=>{u(e.target.value),I("email"),v(null)},required:!0,autoComplete:"email",className:"mt-1 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm "+(N.email?"border-destructive":"border-border")}),N.email&&d.jsx("p",{className:"text-xs text-destructive mt-1",children:N.email})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-muted-foreground",children:"Password"}),d.jsxs("div",{className:"relative mt-1",children:[d.jsx("input",{id:"password",type:b?"text":"password",value:h,onChange:e=>{p(e.target.value),I("password"),v(null)},required:!0,autoComplete:"current-password",className:"block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm pr-12 "+(N.password?"border-destructive":"border-border")}),d.jsx("button",{type:"button",onClick:()=>j(e=>!e),className:"absolute inset-y-0 right-2 flex items-center text-xs font-medium text-muted-foreground hover:text-foreground","aria-label":b?"Hide password":"Show password",children:b?"Hide":"Show"})]}),N.password&&d.jsx("p",{className:"text-xs text-destructive mt-1",children:N.password})]}),d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"flex items-center",children:[d.jsx("input",{id:"remember-me",type:"checkbox",checked:y,onChange:e=>f(e.target.checked),className:"h-4 w-4 text-primary focus:ring-ring border-border rounded"}),d.jsx("label",{htmlFor:"remember-me",className:"ml-2 block text-sm text-muted-foreground",children:"Remember me"})]}),d.jsx("div",{className:"text-sm",children:d.jsx("button",{type:"button",onClick:t,className:"font-medium text-primary hover:text-primary/90",children:"Forgot your password?"})})]}),d.jsx("div",{children:d.jsx(Pe,{type:"submit",className:"w-full",isLoading:i,children:"Sign in"})})]}):d.jsxs("form",{onSubmit:D,className:"space-y-6",children:[d.jsxs("div",{className:"text-center",children:[d.jsx("h3",{className:"text-lg font-medium text-foreground",children:"Two-Factor Authentication"}),d.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:"Enter the 6-digit code from your authenticator app."})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"mfa",className:"sr-only",children:"Authentication Code"}),d.jsx("input",{id:"mfa",type:"text",ref:C,value:x,onChange:e=>{const t=e.target.value.replace(/\D/g,"");g(t),I("mfa"),v(null)},maxLength:6,required:!0,inputMode:"numeric",autoComplete:"one-time-code",className:"block w-full text-center text-2xl tracking-[0.5em] px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary "+(N.mfa?"border-destructive":"border-border")}),N.mfa&&d.jsx("p",{className:"text-xs text-destructive mt-1 text-center",children:N.mfa})]}),d.jsx("div",{children:d.jsx(Pe,{type:"submit",className:"w-full",isLoading:i,children:"Verify"})}),d.jsx("div",{className:"text-center",children:d.jsx("button",{type:"button",onClick:()=>l("credentials"),className:"text-sm font-medium text-primary hover:text-primary/90",children:"Back to login"})})]})]}),d.jsxs("p",{className:"mt-6 text-center text-sm text-muted-foreground",children:["Not a member?"," ",d.jsx("button",{onClick:e,className:"font-semibold text-primary hover:text-primary/80",children:"Create an account"})]})]})},Fe=({view:e,label:t,icon:s,activeView:r,setActiveView:a,badgeCount:n})=>d.jsxs("button",{onClick:()=>a(e),className:"w-full flex items-center justify-between gap-3 px-3 py-2 rounded-md text-sm transition-colors "+(r===e?"bg-primary text-primary-foreground font-semibold shadow":"text-muted-foreground hover:bg-accent hover:text-accent-foreground"),children:[d.jsxs("div",{className:"flex items-center gap-3",children:[s,d.jsx("span",{children:t})]}),n&&n>0&&d.jsx("span",{className:"ml-auto bg-red-500 text-white text-xs font-bold px-2 py-0.5 rounded-full",children:n>99?"99+":n})]}),Ve=({user:e,activeView:t,setActiveView:s,onLogout:r,pendingTimesheetCount:a=0,openIncidentCount:n=0,unreadMessageCount:i=0,companyName:o})=>e?d.jsxs("aside",{className:"w-64 bg-card border-r border-border flex flex-col flex-shrink-0 h-full p-4",children:[d.jsxs("div",{className:"flex items-center gap-2 mb-6 px-2",children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",className:"w-8 h-8 text-primary",children:d.jsx("path",{fill:"currentColor",d:"M12 2L2 22h20L12 2z"})}),d.jsxs("div",{children:[d.jsx("h1",{className:"text-xl font-bold text-foreground",children:"AS Agents"}),o&&d.jsx("p",{className:"text-xs text-muted-foreground",children:o})]})]}),d.jsxs("nav",{className:"flex flex-col gap-2",children:[d.jsx(Fe,{view:"dashboard",label:"Dashboard",icon:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})}),activeView:t,setActiveView:s}),d.jsx(Fe,{view:"tools",label:"Tools",icon:d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924-1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),activeView:t,setActiveView:s,badgeCount:i}),d.jsx(Fe,{view:"timesheets",label:"Timesheets",icon:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})}),activeView:t,setActiveView:s,badgeCount:a}),d.jsx(Fe,{view:"safety",label:"Safety",icon:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})}),activeView:t,setActiveView:s,badgeCount:n}),d.jsx(Fe,{view:"field",label:"Field Management",icon:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002-2h2a2 2 0 002 2m-6 8l2 2 4-4"})}),activeView:t,setActiveView:s}),d.jsx(Fe,{view:"document-management",label:"Document Control",icon:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),activeView:t,setActiveView:s}),d.jsx(Fe,{view:"project-analytics",label:"Project Analytics",icon:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),activeView:t,setActiveView:s}),d.jsx(Fe,{view:"advanced-reporting",label:"Advanced Reports",icon:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),activeView:t,setActiveView:s}),d.jsx(Fe,{view:"collaboration",label:"Team Collaboration",icon:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),activeView:t,setActiveView:s}),d.jsx(Fe,{view:"quality-control",label:"Quality Control",icon:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),activeView:t,setActiveView:s}),d.jsx("div",{className:"mt-4 border-t border-border pt-4",children:d.jsx(Fe,{view:"settings",label:"Settings",icon:d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924-1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),activeView:t,setActiveView:s})})]}),d.jsx("div",{className:"mt-6",children:d.jsxs("button",{onClick:r,className:"flex w-full items-center justify-center gap-2 rounded-xl border border-red-200/70 bg-red-500/10 px-3 py-2 text-sm font-semibold text-red-600 transition hover:bg-red-500/20",children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",className:"h-5 w-5",fill:"none",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 7l-5 5 5 5M4 12h11"})}),"Sign out"]})})]}):null,qe=({name:e})=>d.jsxs(Re,{className:"p-6",children:[d.jsx("h3",{className:"font-semibold text-lg",children:e}),d.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"This tool will be restored next."})]}),He=({user:e,addToast:t,setActiveView:s})=>{const[a,n]=r.useState(null),i=[{id:"ai-advisor",name:"AI Advisor",description:"Chat with an AI expert on project management.",icon:"",component:d.jsx(qe,{name:"AI Advisor"}),permission:!0},{id:"bid-generator",name:"Bid Package Generator",description:"Generate professional bid packages and cover letters.",icon:"",component:d.jsx(qe,{name:"Bid Package Generator"}),permission:!0},{id:"cost-estimator",name:"Cost Estimator",description:"Estimate project costs based on specifications.",icon:"",component:d.jsx(qe,{name:"Cost Estimator"}),permission:!0},{id:"daily-summary",name:"Daily Summary Generator",description:"AI-powered daily progress reports.",icon:"",component:d.jsx(qe,{name:"Daily Summary Generator"}),permission:!0},{id:"funding-bot",name:"FundingBot",description:"Discover grants and funding opportunities.",icon:"",component:d.jsx(qe,{name:"FundingBot"}),permission:!0},{id:"risk-bot",name:"RiskBot",description:"Analyze documents for compliance and financial risks.",icon:"",component:d.jsx(qe,{name:"RiskBot"}),permission:!0},{id:"safety-analysis",name:"Safety Analysis",description:"Identify trends from safety incident reports.",icon:"",component:d.jsx(qe,{name:"Safety Analysis"}),permission:!0},{id:"site-inspector",name:"AI Site Inspector",description:"Analyze site photos for progress and hazards.",icon:"",component:d.jsx(qe,{name:"AI Site Inspector"}),permission:!0},{id:"workforce-planner",name:"Workforce Planner",description:"Plan and allocate personnel to projects.",icon:"",component:d.jsx(qe,{name:"Workforce Planner"}),permission:ke(e,p.MANAGE_TEAM)},{id:"resource-scheduler",name:"Resource Scheduler",description:"View team and equipment schedules.",icon:"",component:d.jsx(qe,{name:"Resource Scheduler"}),permission:ke(e,p.MANAGE_EQUIPMENT)}].filter(e=>e.permission),o=i.find(e=>e.id===a);return o?d.jsxs("div",{children:[d.jsx("button",{onClick:()=>n(null),className:"flex items-center gap-2 text-sm text-slate-600 hover:text-slate-900 mb-4",children:" Back to all tools"}),o.component]}):d.jsxs("div",{className:"space-y-6",children:[d.jsx("h2",{className:"text-3xl font-bold text-slate-800",children:"Tools"}),d.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:i.map(e=>d.jsxs(Re,{onClick:()=>n(e.id),className:"cursor-pointer hover:shadow-lg hover:-translate-y-1 transition-all",children:[d.jsx("div",{className:"text-3xl mb-2",children:e.icon}),d.jsx("h3",{className:"font-bold text-lg",children:e.name}),d.jsx("p",{className:"text-sm text-slate-600",children:e.description})]},e.id))})]})};var We,Be,ze={exports:{}},Ge={};function Je(){if(We)return Ge;We=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),n=Symbol.for("react.consumer"),i=Symbol.for("react.context"),o=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),c=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),m=Symbol.iterator;var u={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},h=Object.assign,p={};function x(e,t,s){this.props=e,this.context=t,this.refs=p,this.updater=s||u}function g(){}function y(e,t,s){this.props=e,this.context=t,this.refs=p,this.updater=s||u}x.prototype.isReactComponent={},x.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},x.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},g.prototype=x.prototype;var f=y.prototype=new g;f.constructor=y,h(f,x.prototype),f.isPureReactComponent=!0;var b=Array.isArray,j={H:null,A:null,T:null,S:null,V:null},w=Object.prototype.hasOwnProperty;function v(t,s,r,a,n,i){return r=i.ref,{$$typeof:e,type:t,key:s,ref:void 0!==r?r:null,props:i}}function N(t){return"object"==typeof t&&null!==t&&t.$$typeof===e}var k=/\/+/g;function E(e,t){return"object"==typeof e&&null!==e&&null!=e.key?(s=""+e.key,r={"=":"=0",":":"=2"},"$"+s.replace(/[=:]/g,function(e){return r[e]})):t.toString(36);var s,r}function S(){}function C(s,r,a,n,i){var o=typeof s;"undefined"!==o&&"boolean"!==o||(s=null);var l,c,u=!1;if(null===s)u=!0;else switch(o){case"bigint":case"string":case"number":u=!0;break;case"object":switch(s.$$typeof){case e:case t:u=!0;break;case d:return C((u=s._init)(s._payload),r,a,n,i)}}if(u)return i=i(s),u=""===n?"."+E(s,0):n,b(i)?(a="",null!=u&&(a=u.replace(k,"$&/")+"/"),C(i,r,a,"",function(e){return e})):null!=i&&(N(i)&&(l=i,c=a+(null==i.key||s&&s.key===i.key?"":(""+i.key).replace(k,"$&/")+"/")+u,i=v(l.type,c,void 0,0,0,l.props)),r.push(i)),1;u=0;var h,p=""===n?".":n+":";if(b(s))for(var x=0;x<s.length;x++)u+=C(n=s[x],r,a,o=p+E(n,x),i);else if("function"==typeof(x=null===(h=s)||"object"!=typeof h?null:"function"==typeof(h=m&&h[m]||h["@@iterator"])?h:null))for(s=x.call(s),x=0;!(n=s.next()).done;)u+=C(n=n.value,r,a,o=p+E(n,x++),i);else if("object"===o){if("function"==typeof s.then)return C(function(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch("string"==typeof e.status?e.then(S,S):(e.status="pending",e.then(function(t){"pending"===e.status&&(e.status="fulfilled",e.value=t)},function(t){"pending"===e.status&&(e.status="rejected",e.reason=t)})),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}(s),r,a,n,i);throw r=String(s),Error("Objects are not valid as a React child (found: "+("[object Object]"===r?"object with keys {"+Object.keys(s).join(", ")+"}":r)+"). If you meant to render a collection of children, use an array instead.")}return u}function I(e,t,s){if(null==e)return e;var r=[],a=0;return C(e,r,"","",function(e){return t.call(s,e,a++)}),r}function A(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var D="function"==typeof reportError?reportError:function(e){if("object"==typeof window&&"function"==typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"==typeof e&&null!==e&&"string"==typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"==typeof process&&"function"==typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)};function T(){}return Ge.Children={map:I,forEach:function(e,t,s){I(e,function(){t.apply(this,arguments)},s)},count:function(e){var t=0;return I(e,function(){t++}),t},toArray:function(e){return I(e,function(e){return e})||[]},only:function(e){if(!N(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},Ge.Component=x,Ge.Fragment=s,Ge.Profiler=a,Ge.PureComponent=y,Ge.StrictMode=r,Ge.Suspense=l,Ge.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=j,Ge.__COMPILER_RUNTIME={__proto__:null,c:function(e){return j.H.useMemoCache(e)}},Ge.cache=function(e){return function(){return e.apply(null,arguments)}},Ge.cloneElement=function(e,t,s){if(null==e)throw Error("The argument must be a React element, but you passed "+e+".");var r=h({},e.props),a=e.key;if(null!=t)for(n in void 0!==t.ref&&void 0,void 0!==t.key&&(a=""+t.key),t)!w.call(t,n)||"key"===n||"__self"===n||"__source"===n||"ref"===n&&void 0===t.ref||(r[n]=t[n]);var n=arguments.length-2;if(1===n)r.children=s;else if(1<n){for(var i=Array(n),o=0;o<n;o++)i[o]=arguments[o+2];r.children=i}return v(e.type,a,void 0,0,0,r)},Ge.createContext=function(e){return(e={$$typeof:i,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider=e,e.Consumer={$$typeof:n,_context:e},e},Ge.createElement=function(e,t,s){var r,a={},n=null;if(null!=t)for(r in void 0!==t.key&&(n=""+t.key),t)w.call(t,r)&&"key"!==r&&"__self"!==r&&"__source"!==r&&(a[r]=t[r]);var i=arguments.length-2;if(1===i)a.children=s;else if(1<i){for(var o=Array(i),l=0;l<i;l++)o[l]=arguments[l+2];a.children=o}if(e&&e.defaultProps)for(r in i=e.defaultProps)void 0===a[r]&&(a[r]=i[r]);return v(e,n,void 0,0,0,a)},Ge.createRef=function(){return{current:null}},Ge.forwardRef=function(e){return{$$typeof:o,render:e}},Ge.isValidElement=N,Ge.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:A}},Ge.memo=function(e,t){return{$$typeof:c,type:e,compare:void 0===t?null:t}},Ge.startTransition=function(e){var t=j.T,s={};j.T=s;try{var r=e(),a=j.S;null!==a&&a(s,r),"object"==typeof r&&null!==r&&"function"==typeof r.then&&r.then(T,D)}catch(n){D(n)}finally{j.T=t}},Ge.unstable_useCacheRefresh=function(){return j.H.useCacheRefresh()},Ge.use=function(e){return j.H.use(e)},Ge.useActionState=function(e,t,s){return j.H.useActionState(e,t,s)},Ge.useCallback=function(e,t){return j.H.useCallback(e,t)},Ge.useContext=function(e){return j.H.useContext(e)},Ge.useDebugValue=function(){},Ge.useDeferredValue=function(e,t){return j.H.useDeferredValue(e,t)},Ge.useEffect=function(e,t,s){var r=j.H;if("function"==typeof s)throw Error("useEffect CRUD overload is not enabled in this build of React.");return r.useEffect(e,t)},Ge.useId=function(){return j.H.useId()},Ge.useImperativeHandle=function(e,t,s){return j.H.useImperativeHandle(e,t,s)},Ge.useInsertionEffect=function(e,t){return j.H.useInsertionEffect(e,t)},Ge.useLayoutEffect=function(e,t){return j.H.useLayoutEffect(e,t)},Ge.useMemo=function(e,t){return j.H.useMemo(e,t)},Ge.useOptimistic=function(e,t){return j.H.useOptimistic(e,t)},Ge.useReducer=function(e,t,s){return j.H.useReducer(e,t,s)},Ge.useRef=function(e){return j.H.useRef(e)},Ge.useState=function(e){return j.H.useState(e)},Ge.useSyncExternalStore=function(e,t,s){return j.H.useSyncExternalStore(e,t,s)},Ge.useTransition=function(){return j.H.useTransition()},Ge.version="19.1.1",Ge}var Qe=(Be||(Be=1,ze.exports=Je()),ze.exports);
/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=e=>{const t=(e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,s)=>s?s.toUpperCase():t.toLowerCase()))(e);return t.charAt(0).toUpperCase()+t.slice(1)},Ke=(...e)=>e.filter((e,t,s)=>Boolean(e)&&""!==e.trim()&&s.indexOf(e)===t).join(" ").trim(),Ze=e=>{for(const t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0};
/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
var Xe={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};
/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=Qe.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:s=2,absoluteStrokeWidth:r,className:a="",children:n,iconNode:i,...o},l)=>Qe.createElement("svg",{ref:l,...Xe,width:t,height:t,stroke:e,strokeWidth:r?24*Number(s)/Number(t):s,className:Ke("lucide",a),...!n&&!Ze(o)&&{"aria-hidden":"true"},...o},[...i.map(([e,t])=>Qe.createElement(e,t)),...Array.isArray(n)?n:[n]])),tt=(e,t)=>{const s=Qe.forwardRef(({className:s,...r},a)=>{return Qe.createElement(et,{ref:a,iconNode:t,className:Ke(`lucide-${n=Ye(e),n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,s),...r});var n});return s.displayName=Ye(e),s},st=tt("activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]),rt=tt("at-sign",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-4 8",key:"7n84p3"}]]),at=tt("bell",[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]]),nt=tt("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]),it=tt("camera",[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),ot=tt("chart-column",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),lt=tt("chart-line",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"m19 9-5 5-4-4-3 3",key:"2osh9i"}]]),ct=tt("chart-pie",[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]]),dt=tt("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),mt=tt("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),ut=tt("clipboard",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}]]),ht=tt("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),pt=tt("compass",[["path",{d:"m16.24 7.76-1.804 5.411a2 2 0 0 1-1.265 1.265L7.76 16.24l1.804-5.411a2 2 0 0 1 1.265-1.265z",key:"9ktpf1"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),xt=tt("dollar-sign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]),gt=tt("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]),yt=tt("ellipsis-vertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]),ft=tt("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),bt=tt("file-text",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]),jt=tt("flag",[["path",{d:"M4 22V4a1 1 0 0 1 .4-.8A6 6 0 0 1 8 2c3 0 5 2 7.333 2q2 0 3.067-.8A1 1 0 0 1 20 4v10a1 1 0 0 1-.4.8A6 6 0 0 1 16 16c-3 0-5-2-8-2a6 6 0 0 0-4 1.528",key:"1jaruq"}]]),wt=tt("folder-open",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]),vt=tt("funnel",[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]]),Nt=tt("grid-3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]),kt=tt("hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]),Et=tt("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),St=tt("list",[["path",{d:"M3 5h.01",key:"18ugdj"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 19h.01",key:"noohij"}],["path",{d:"M8 5h13",key:"1pao27"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 19h13",key:"m83p4d"}]]),Ct=tt("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]),It=tt("message-square",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]]),At=tt("navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]),Dt=tt("paperclip",[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]]),Tt=tt("phone",[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]]),Rt=tt("pin",[["path",{d:"M12 17v5",key:"bb1du9"}],["path",{d:"M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H8a2 2 0 0 0 0 4 1 1 0 0 1 1 1z",key:"1nkz8b"}]]),Mt=tt("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),Pt=tt("qr-code",[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]]),Ot=tt("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),_t=tt("scan",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}]]),Lt=tt("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]),$t=tt("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),Ut=tt("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Ft=tt("share-2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]),Vt=tt("shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]),qt=tt("smile",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]),Ht=tt("square-check-big",[["path",{d:"M21 10.656V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.344",key:"2acyp4"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),Wt=tt("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]),Bt=tt("target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),zt=tt("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]),Gt=tt("trending-down",[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]]),Jt=tt("trending-up",[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]]),Qt=tt("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),Yt=tt("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]),Kt=tt("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]),Zt=tt("video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]),Xt=tt("wifi-off",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),es=tt("wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]),ts=tt("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);
/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var ss=(e=>(e.ARCHITECTURAL="architectural",e.STRUCTURAL="structural",e.MECHANICAL="mechanical",e.ELECTRICAL="electrical",e.PLUMBING="plumbing",e.HVAC="hvac",e.FIRE_SAFETY="fire_safety",e.LANDSCAPING="landscaping",e.CLEANUP="cleanup",e.OTHER="other",e))(ss||{}),rs=(e=>(e.OPEN="open",e.IN_PROGRESS="in_progress",e.READY_FOR_REVIEW="ready_for_review",e.COMPLETED="completed",e.VERIFIED="verified",e.REJECTED="rejected",e))(rs||{}),as=(e=>(e.NOT_STARTED="not_started",e.IN_PROGRESS="in_progress",e.ON_HOLD="on_hold",e.COMPLETED="completed",e.CANCELLED="cancelled",e))(as||{}),ns=(e=>(e.LOW="low",e.MEDIUM="medium",e.HIGH="high",e.CRITICAL="critical",e))(ns||{});const is=new class{constructor(){this.baseUrl="/api/field",this.offlineStorage="asagents_offline_data"}async getPunchLists(e,t){try{const s=new URLSearchParams;t&&Object.entries(t).forEach(([e,t])=>{t&&s.append(e,String(t))});const r=await fetch(`${this.baseUrl}/projects/${e}/punch-lists?${s}`);if(!r.ok)throw new Error("Failed to fetch punch lists");return await r.json()}catch(s){return console.error("Error fetching punch lists:",s),this.getMockPunchLists(e)}}async createPunchList(e,t){try{const s=await fetch(`${this.baseUrl}/projects/${e}/punch-lists`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok)throw new Error("Failed to create punch list");return await s.json()}catch(s){return console.error("Error creating punch list:",s),this.createMockPunchList(e,t)}}async updatePunchList(e,t,s){try{const r=await fetch(`${this.baseUrl}/projects/${e}/punch-lists/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!r.ok)throw new Error("Failed to update punch list");return await r.json()}catch(r){return console.error("Error updating punch list:",r),this.getMockPunchLists(e)[0]}}async deletePunchList(e,t){try{if(!(await fetch(`${this.baseUrl}/projects/${e}/punch-lists/${t}`,{method:"DELETE"})).ok)throw new Error("Failed to delete punch list")}catch(s){console.error("Error deleting punch list:",s)}}async getDailyReports(e,t){try{const s=new URLSearchParams;t&&(s.append("start",t.start.toISOString()),s.append("end",t.end.toISOString()));const r=await fetch(`${this.baseUrl}/projects/${e}/daily-reports?${s}`);if(!r.ok)throw new Error("Failed to fetch daily reports");return await r.json()}catch(s){return console.error("Error fetching daily reports:",s),this.getMockDailyReports(e)}}async createDailyReport(e,t){try{const s=await fetch(`${this.baseUrl}/projects/${e}/daily-reports`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok)throw new Error("Failed to create daily report");return await s.json()}catch(s){return console.error("Error creating daily report:",s),this.createMockDailyReport(e,t)}}async updateDailyReport(e,t,s){try{const r=await fetch(`${this.baseUrl}/projects/${e}/daily-reports/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!r.ok)throw new Error("Failed to update daily report");return await r.json()}catch(r){return console.error("Error updating daily report:",r),this.getMockDailyReports(e)[0]}}async getTasks(e,t){try{const s=new URLSearchParams;t&&Object.entries(t).forEach(([e,t])=>{t&&s.append(e,String(t))});const r=await fetch(`${this.baseUrl}/projects/${e}/tasks?${s}`);if(!r.ok)throw new Error("Failed to fetch tasks");return await r.json()}catch(s){return console.error("Error fetching tasks:",s),this.getMockTasks(e)}}async createTask(e,t){try{const s=await fetch(`${this.baseUrl}/projects/${e}/tasks`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok)throw new Error("Failed to create task");return await s.json()}catch(s){return console.error("Error creating task:",s),this.createMockTask(e,t)}}async updateTask(e,t,s){try{const r=await fetch(`${this.baseUrl}/projects/${e}/tasks/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!r.ok)throw new Error("Failed to update task");return await r.json()}catch(r){return console.error("Error updating task:",r),this.getMockTasks(e)[0]}}async uploadPhoto(e,t,s){try{const r=new FormData;r.append("file",t),r.append("metadata",JSON.stringify(s));const a=await fetch(`${this.baseUrl}/projects/${e}/photos`,{method:"POST",body:r});if(!a.ok)throw new Error("Failed to upload photo");return await a.json()}catch(r){return console.error("Error uploading photo:",r),this.createMockPhoto(t,s)}}async getPhotos(e,t){try{const s=new URLSearchParams;t&&Object.entries(t).forEach(([e,t])=>{t&&s.append(e,String(t))});const r=await fetch(`${this.baseUrl}/projects/${e}/photos?${s}`);if(!r.ok)throw new Error("Failed to fetch photos");return await r.json()}catch(s){return console.error("Error fetching photos:",s),this.getMockPhotos(e)}}async deletePhoto(e,t){try{if(!(await fetch(`${this.baseUrl}/projects/${e}/photos/${t}`,{method:"DELETE"})).ok)throw new Error("Failed to delete photo")}catch(s){console.error("Error deleting photo:",s)}}async createTimeEntry(e,t){try{const s=await fetch(`${this.baseUrl}/projects/${e}/time-entries`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok)throw new Error("Failed to create time entry");return await s.json()}catch(s){return console.error("Error creating time entry:",s),this.createMockTimeEntry(e,t)}}async getTimeEntries(e,t,s){try{const r=new URLSearchParams;t&&r.append("userId",t),s&&(r.append("start",s.start.toISOString()),r.append("end",s.end.toISOString()));const a=await fetch(`${this.baseUrl}/projects/${e}/time-entries?${r}`);if(!a.ok)throw new Error("Failed to fetch time entries");return await a.json()}catch(r){return console.error("Error fetching time entries:",r),this.getMockTimeEntries(e)}}async getDrawings(e){try{const t=await fetch(`${this.baseUrl}/projects/${e}/drawings`);if(!t.ok)throw new Error("Failed to fetch drawings");return await t.json()}catch(t){return console.error("Error fetching drawings:",t),this.getMockDrawings(e)}}async addDrawingMarkup(e,t,s){try{const r=await fetch(`${this.baseUrl}/projects/${e}/drawings/${t}/markups`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!r.ok)throw new Error("Failed to add drawing markup");return await r.json()}catch(r){return console.error("Error adding drawing markup:",r),{id:`markup-${Date.now()}`,...s}}}async syncOfflineData(){try{this.getOfflineData();const e=this.getPendingSyncOperations();for(const t of e)await this.processSyncOperation(t);await this.updateOfflineData()}catch(e){console.error("Error syncing offline data:",e)}}getOfflineData(){const e=localStorage.getItem(this.offlineStorage);return e?JSON.parse(e):{punchLists:[],tasks:[],photos:[],drawings:[],lastSync:new Date}}saveOfflineData(e){localStorage.setItem(this.offlineStorage,JSON.stringify(e))}getPendingSyncOperations(){const e=localStorage.getItem(`${this.offlineStorage}_sync`);return e?JSON.parse(e):[]}async processSyncOperation(e){try{console.log("Processing sync operation:",e)}catch(t){console.error("Error processing sync operation:",t),e.status="failed",e.error=t instanceof Error?t.message:"Unknown error",e.retryCount++}}async updateOfflineData(){console.log("Updating offline data...")}getMockPunchLists(e){return[{id:"punch-1",projectId:e,title:"Paint touch-up required in lobby",description:"Several scuff marks and scratches on walls need touch-up paint",category:ss.ARCHITECTURAL,priority:ns.MEDIUM,status:rs.OPEN,assignedTo:"painter-1",assignedCompany:"ABC Painting",dueDate:new Date(Date.now()+6048e5),location:{building:"Main Building",floor:"1st Floor",room:"Lobby",area:"East Wall"},trade:"Painting",room:"Lobby",floor:"1st Floor",photos:[],attachments:[],verificationPhotos:[],comments:[],createdBy:"inspector-1",createdAt:new Date,updatedAt:new Date}]}createMockPunchList(e,t){return{id:`punch-${Date.now()}`,projectId:e,title:t.title||"New Punch Item",description:t.description||"",category:t.category||ss.OTHER,priority:t.priority||ns.MEDIUM,status:rs.OPEN,assignedTo:t.assignedTo||"",assignedCompany:t.assignedCompany||"",dueDate:t.dueDate||new Date(Date.now()+6048e5),location:t.location||{},trade:t.trade||"",room:t.room||"",floor:t.floor||"",photos:[],attachments:[],verificationPhotos:[],comments:[],createdBy:"current-user",createdAt:new Date,updatedAt:new Date}}getMockDailyReports(e){return[{id:"report-1",projectId:e,date:new Date,reportedBy:"foreman-1",weather:"clear",temperature:{high:75,low:55,unit:"F"},crew:[],workPerformed:[],materials:[],equipment:[],safety:[],visitors:[],delays:[],issues:[],photos:[],notes:"Good progress on foundation work",submittedAt:new Date}]}createMockDailyReport(e,t){return{id:`report-${Date.now()}`,projectId:e,date:t.date||new Date,reportedBy:t.reportedBy||"current-user",weather:t.weather||"clear",temperature:t.temperature||{high:70,low:50,unit:"F"},crew:t.crew||[],workPerformed:t.workPerformed||[],materials:t.materials||[],equipment:t.equipment||[],safety:t.safety||[],visitors:t.visitors||[],delays:t.delays||[],issues:t.issues||[],photos:t.photos||[],notes:t.notes||"",submittedAt:new Date}}getMockTasks(e){return[{id:"task-1",projectId:e,title:"Install electrical outlets",description:"Install 20 electrical outlets in office areas",type:"construction",category:"electrical",priority:ns.HIGH,status:as.IN_PROGRESS,assignedTo:["electrician-1"],assignedCompany:"XYZ Electric",dueDate:new Date(Date.now()+2592e5),estimatedHours:16,actualHours:8,location:{building:"Main Building",floor:"2nd Floor"},trade:"Electrical",phase:"Rough-in",prerequisites:[],dependencies:[],photos:[],attachments:[],comments:[],timeEntries:[],materials:[],equipment:[],safetyRequirements:[],qualityChecks:[],createdBy:"pm-1",createdAt:new Date,updatedAt:new Date,startedAt:new Date}]}createMockTask(e,t){return{id:`task-${Date.now()}`,projectId:e,title:t.title||"New Task",description:t.description||"",type:t.type||"construction",category:t.category||"other",priority:t.priority||ns.MEDIUM,status:as.NOT_STARTED,assignedTo:t.assignedTo||[],assignedCompany:t.assignedCompany||"",dueDate:t.dueDate||new Date(Date.now()+6048e5),estimatedHours:t.estimatedHours||8,actualHours:0,location:t.location||{},trade:t.trade||"",phase:t.phase||"",prerequisites:[],dependencies:[],photos:[],attachments:[],comments:[],timeEntries:[],materials:[],equipment:[],safetyRequirements:[],qualityChecks:[],createdBy:"current-user",createdAt:new Date,updatedAt:new Date}}createMockPhoto(e,t){return{id:`photo-${Date.now()}`,url:URL.createObjectURL(e),thumbnailUrl:URL.createObjectURL(e),filename:e.name,size:e.size,mimeType:e.type,timestamp:new Date,metadata:{width:1920,height:1080,...t},tags:[],annotations:[],uploadedBy:"current-user",uploadedAt:new Date}}getMockPhotos(e){return[]}createMockTimeEntry(e,t){return{id:`time-${Date.now()}`,userId:t.userId||"current-user",projectId:e,taskId:t.taskId,date:t.date||new Date,startTime:t.startTime||new Date,endTime:t.endTime,duration:t.duration||480,breakTime:t.breakTime||60,overtimeHours:t.overtimeHours||0,description:t.description||"",location:t.location||"",costCode:t.costCode||"",billable:t.billable||!0,approved:!1,createdAt:new Date,updatedAt:new Date}}getMockTimeEntries(e){return[]}getMockDrawings(e){return[{id:"drawing-1",projectId:e,name:"Floor Plan - Level 1",number:"A-101",discipline:"Architectural",version:"1.0",url:"/mock-drawing.pdf",thumbnailUrl:"/mock-drawing-thumb.jpg",scale:"1/4\" = 1'",size:{width:36,height:24,units:"in"},layers:[],markups:[],lastModified:new Date}]}},os=({projectId:e,userId:t,isOnline:s})=>{const[a,n]=r.useState("overview"),[i,o]=r.useState(!0),[l,c]=r.useState(!1),[m,u]=r.useState(!1),[h,p]=r.useState(null),[x,g]=r.useState({punchLists:[],tasks:[],dailyReports:[],photos:[]});r.useEffect(()=>{f(),y()},[e]);const y=()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(e=>{p(e)},e=>{console.error("Error getting location:",e)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4})},f=async()=>{o(!0);try{const[t,s,r,a]=await Promise.all([is.getPunchLists(e),is.getTasks(e),is.getDailyReports(e),is.getPhotos(e)]);g({punchLists:t,tasks:s,dailyReports:r,photos:a})}catch(t){console.error("Error loading field data:",t)}finally{o(!1)}},b=[{id:"overview",label:"Overview",icon:bt},{id:"punch",label:"Punch Lists",icon:Ht},{id:"tasks",label:"Tasks",icon:ht},{id:"photos",label:"Photos",icon:it},{id:"reports",label:"Daily Reports",icon:Kt}];return i?d.jsx("div",{className:"flex items-center justify-center h-64",children:d.jsxs("div",{className:"text-center",children:[d.jsx(Ot,{className:"w-8 h-8 animate-spin text-blue-600 mx-auto mb-2"}),d.jsx("span",{className:"text-gray-600",children:"Loading field data..."})]})}):d.jsxs("div",{className:"bg-white rounded-lg shadow-lg min-h-screen",children:[d.jsx("div",{className:"border-b border-gray-200 px-4 py-3",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Field Management"}),d.jsx("div",{className:"flex items-center mt-1",children:s?d.jsxs("div",{className:"flex items-center text-green-600",children:[d.jsx(es,{className:"w-4 h-4 mr-1"}),d.jsx("span",{className:"text-sm",children:"Online"})]}):d.jsxs("div",{className:"flex items-center text-orange-600",children:[d.jsx(Xt,{className:"w-4 h-4 mr-1"}),d.jsx("span",{className:"text-sm",children:"Offline"})]})})]}),d.jsxs("div",{className:"flex space-x-2",children:[d.jsxs("button",{onClick:()=>u(!0),className:"flex items-center px-3 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:[d.jsx(Pt,{className:"w-4 h-4 mr-1"}),"Scan"]}),d.jsxs("button",{onClick:y,className:"flex items-center px-3 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:[d.jsx(At,{className:"w-4 h-4 mr-1"}),"GPS"]}),d.jsxs("button",{onClick:async()=>{c(!0);try{await is.syncOfflineData(),await f()}catch(e){console.error("Error syncing data:",e)}finally{c(!1)}},disabled:l,className:"flex items-center px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:[d.jsx(Ot,{className:"w-4 h-4 mr-1 "+(l?"animate-spin":"")}),"Sync"]})]})]})}),d.jsx("div",{className:"border-b border-gray-200 overflow-x-auto",children:d.jsx("nav",{className:"flex space-x-0",children:b.map(e=>{const t=e.icon;return d.jsxs("button",{onClick:()=>n(e.id),className:"flex flex-col items-center py-3 px-4 min-w-0 flex-1 "+(a===e.id?"border-b-2 border-blue-500 text-blue-600 bg-blue-50":"text-gray-500 hover:text-gray-700"),children:[d.jsx(t,{className:"w-5 h-5 mb-1"}),d.jsx("span",{className:"text-xs font-medium truncate",children:e.label})]},e.id)})})}),d.jsxs("div",{className:"p-4",children:["overview"===a&&d.jsx(ls,{fieldData:x}),"punch"===a&&d.jsx(cs,{punchLists:x.punchLists,projectId:e}),"tasks"===a&&d.jsx(ds,{tasks:x.tasks,projectId:e}),"photos"===a&&d.jsx(ms,{photos:x.photos,projectId:e}),"reports"===a&&d.jsx(us,{reports:x.dailyReports,projectId:e})]}),m&&d.jsx(hs,{onScan:e=>{console.log("QR Code scanned:",e),u(!1);try{const t=JSON.parse(e);"equipment"===t.type?alert(`Equipment scanned: ${t.name} (ID: ${t.id})`):"location"===t.type?alert(`Location scanned: ${t.name} (${t.building}, ${t.floor})`):"task"===t.type&&alert(`Task scanned: ${t.title} (ID: ${t.id})`)}catch(t){alert(`QR Code content: ${e}`)}},onClose:()=>u(!1)}),h&&d.jsxs("div",{className:"fixed bottom-4 left-4 bg-white border border-gray-200 rounded-lg p-3 shadow-lg z-40",children:[d.jsxs("div",{className:"flex items-center text-sm",children:[d.jsx(pt,{className:"w-4 h-4 text-green-600 mr-2"}),d.jsxs("span",{className:"text-gray-600",children:[h.coords.latitude.toFixed(6),", ",h.coords.longitude.toFixed(6)]})]}),d.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Accuracy: ",Math.round(h.coords.accuracy),"m"]})]})]})},ls=({fieldData:e})=>{const{punchLists:t,tasks:s,dailyReports:r,photos:a}=e,n={openPunches:t.filter(e=>e.status===rs.OPEN).length,activeTasks:s.filter(e=>e.status===as.IN_PROGRESS).length,todayPhotos:a.filter(e=>{const t=new Date;return new Date(e.timestamp).toDateString()===t.toDateString()}).length,recentReports:r.length};return d.jsxs("div",{className:"space-y-6",children:[d.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[d.jsx("div",{className:"bg-red-50 p-4 rounded-lg",children:d.jsxs("div",{className:"flex items-center",children:[d.jsx(Qt,{className:"w-6 h-6 text-red-600"}),d.jsxs("div",{className:"ml-3",children:[d.jsx("p",{className:"text-sm font-medium text-red-600",children:"Open Punches"}),d.jsx("p",{className:"text-2xl font-bold text-gray-900",children:n.openPunches})]})]})}),d.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:d.jsxs("div",{className:"flex items-center",children:[d.jsx(ht,{className:"w-6 h-6 text-blue-600"}),d.jsxs("div",{className:"ml-3",children:[d.jsx("p",{className:"text-sm font-medium text-blue-600",children:"Active Tasks"}),d.jsx("p",{className:"text-2xl font-bold text-gray-900",children:n.activeTasks})]})]})}),d.jsx("div",{className:"bg-green-50 p-4 rounded-lg",children:d.jsxs("div",{className:"flex items-center",children:[d.jsx(it,{className:"w-6 h-6 text-green-600"}),d.jsxs("div",{className:"ml-3",children:[d.jsx("p",{className:"text-sm font-medium text-green-600",children:"Today's Photos"}),d.jsx("p",{className:"text-2xl font-bold text-gray-900",children:n.todayPhotos})]})]})}),d.jsx("div",{className:"bg-purple-50 p-4 rounded-lg",children:d.jsxs("div",{className:"flex items-center",children:[d.jsx(bt,{className:"w-6 h-6 text-purple-600"}),d.jsxs("div",{className:"ml-3",children:[d.jsx("p",{className:"text-sm font-medium text-purple-600",children:"Reports"}),d.jsx("p",{className:"text-2xl font-bold text-gray-900",children:n.recentReports})]})]})})]}),d.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[d.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Recent Activity"}),d.jsxs("div",{className:"space-y-3",children:[d.jsxs("div",{className:"flex items-center p-3 bg-gray-50 rounded-lg",children:[d.jsx(Ht,{className:"w-5 h-5 text-blue-600"}),d.jsxs("div",{className:"ml-3",children:[d.jsx("p",{className:"text-sm font-medium text-gray-900",children:"New punch item created"}),d.jsx("p",{className:"text-xs text-gray-600",children:"2 hours ago"})]})]}),d.jsxs("div",{className:"flex items-center p-3 bg-gray-50 rounded-lg",children:[d.jsx(it,{className:"w-5 h-5 text-green-600"}),d.jsxs("div",{className:"ml-3",children:[d.jsx("p",{className:"text-sm font-medium text-gray-900",children:"5 photos uploaded"}),d.jsx("p",{className:"text-xs text-gray-600",children:"4 hours ago"})]})]}),d.jsxs("div",{className:"flex items-center p-3 bg-gray-50 rounded-lg",children:[d.jsx(ht,{className:"w-5 h-5 text-orange-600"}),d.jsxs("div",{className:"ml-3",children:[d.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Task completed"}),d.jsx("p",{className:"text-xs text-gray-600",children:"1 day ago"})]})]})]})]})]})},cs=({punchLists:e,projectId:t})=>{const[s,a]=r.useState("all"),[n,i]=r.useState(""),o=e.filter(e=>{const t="all"===s||e.status===s,r=e.title.toLowerCase().includes(n.toLowerCase())||e.description.toLowerCase().includes(n.toLowerCase());return t&&r}),l=e=>{switch(e){case rs.OPEN:return"bg-red-100 text-red-800";case rs.IN_PROGRESS:return"bg-blue-100 text-blue-800";case rs.COMPLETED:return"bg-green-100 text-green-800";case rs.VERIFIED:return"bg-purple-100 text-purple-800";default:return"bg-gray-100 text-gray-800"}},c=e=>{switch(e){case ns.CRITICAL:return"bg-red-500";case ns.HIGH:return"bg-orange-500";case ns.MEDIUM:return"bg-yellow-500";case ns.LOW:return"bg-green-500";default:return"bg-gray-500"}};return d.jsxs("div",{className:"space-y-4",children:[d.jsxs("div",{className:"flex flex-col space-y-3",children:[d.jsxs("div",{className:"relative",children:[d.jsx(Lt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),d.jsx("input",{type:"text",placeholder:"Search punch items...",value:n,onChange:e=>i(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),d.jsxs("div",{className:"flex space-x-2 overflow-x-auto",children:[d.jsx("button",{onClick:()=>a("all"),className:"px-3 py-1 text-sm rounded-full whitespace-nowrap "+("all"===s?"bg-blue-600 text-white":"bg-gray-200 text-gray-700"),children:"All"}),Object.values(rs).map(e=>d.jsx("button",{onClick:()=>a(e),className:"px-3 py-1 text-sm rounded-full whitespace-nowrap "+(s===e?"bg-blue-600 text-white":"bg-gray-200 text-gray-700"),children:e.replace("_"," ")},e))]})]}),d.jsxs("button",{className:"w-full flex items-center justify-center py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[d.jsx(Mt,{className:"w-5 h-5 mr-2"}),"Add Punch Item"]}),d.jsx("div",{className:"space-y-3",children:o.map(e=>d.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[d.jsxs("div",{className:"flex items-start justify-between mb-2",children:[d.jsxs("div",{className:"flex-1",children:[d.jsx("h4",{className:"font-semibold text-gray-900",children:e.title}),d.jsx("p",{className:"text-sm text-gray-600 mt-1",children:e.description})]}),d.jsx("div",{className:`w-3 h-3 rounded-full ${c(e.priority)}`})]}),d.jsxs("div",{className:"flex items-center justify-between mt-3",children:[d.jsxs("div",{className:"flex items-center space-x-2",children:[d.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${l(e.status)}`,children:e.status.replace("_"," ")}),d.jsx("span",{className:"text-xs text-gray-500",children:e.trade})]}),d.jsxs("div",{className:"flex items-center text-xs text-gray-500",children:[d.jsx(Ct,{className:"w-3 h-3 mr-1"}),e.location.room||e.location.area||"Location TBD"]})]}),d.jsxs("div",{className:"flex items-center justify-between mt-2 text-xs text-gray-500",children:[d.jsxs("span",{children:["Assigned to: ",e.assignedCompany]}),d.jsxs("span",{children:["Due: ",e.dueDate.toLocaleDateString()]})]})]},e.id))}),0===o.length&&d.jsxs("div",{className:"text-center py-8 text-gray-500",children:[d.jsx(Ht,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),d.jsx("p",{children:"No punch items found"})]})]})},ds=({tasks:e,projectId:t})=>d.jsxs("div",{className:"space-y-4",children:[d.jsxs("button",{className:"w-full flex items-center justify-center py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[d.jsx(Mt,{className:"w-5 h-5 mr-2"}),"Add Task"]}),d.jsx("div",{className:"space-y-3",children:e.map(e=>d.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[d.jsx("h4",{className:"font-semibold text-gray-900",children:e.title}),d.jsx("p",{className:"text-sm text-gray-600 mt-1",children:e.description}),d.jsxs("div",{className:"flex items-center justify-between mt-3",children:[d.jsx("span",{className:"px-2 py-1 text-xs font-semibold rounded-full "+(e.status===as.COMPLETED?"bg-green-100 text-green-800":e.status===as.IN_PROGRESS?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"),children:e.status.replace("_"," ")}),d.jsxs("span",{className:"text-xs text-gray-500",children:["Due: ",e.dueDate.toLocaleDateString()]})]})]},e.id))}),0===e.length&&d.jsxs("div",{className:"text-center py-8 text-gray-500",children:[d.jsx(ht,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),d.jsx("p",{children:"No tasks found"})]})]}),ms=({photos:e,projectId:t})=>{const[s,a]=r.useState(!1),n=async e=>{try{navigator.geolocation&&navigator.geolocation.getCurrentPosition(async s=>{const r={location:{latitude:s.coords.latitude,longitude:s.coords.longitude,accuracy:s.coords.accuracy},timestamp:new Date,camera:"Mobile Camera"};await is.uploadPhoto(t,e,r),a(!1),window.location.reload()},s=>{console.error("Error getting location:",s);const r={timestamp:new Date,camera:"Mobile Camera"};is.uploadPhoto(t,e,r),a(!1)})}catch(s){console.error("Error capturing photo:",s)}};return d.jsxs("div",{className:"space-y-4",children:[d.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[d.jsxs("button",{onClick:()=>{a(!0)},className:"flex items-center justify-center py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[d.jsx(it,{className:"w-5 h-5 mr-2"}),"Take Photo"]}),d.jsxs("label",{className:"flex items-center justify-center py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 cursor-pointer",children:[d.jsx(Upload,{className:"w-5 h-5 mr-2"}),"Upload",d.jsx("input",{type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:e=>{e.target.files&&Array.from(e.target.files).forEach(e=>{n(e)})}})]})]}),d.jsx("div",{className:"grid grid-cols-2 gap-3",children:e.map(e=>d.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg overflow-hidden",children:[d.jsx("img",{src:e.thumbnailUrl,alt:e.filename,className:"w-full h-32 object-cover"}),d.jsxs("div",{className:"p-2",children:[d.jsx("p",{className:"text-xs text-gray-600 truncate",children:e.filename}),d.jsx("p",{className:"text-xs text-gray-500",children:e.timestamp.toLocaleDateString()}),e.location&&d.jsxs("div",{className:"flex items-center mt-1",children:[d.jsx(Ct,{className:"w-3 h-3 text-gray-400 mr-1"}),d.jsxs("p",{className:"text-xs text-gray-400",children:[e.location.latitude.toFixed(4),", ",e.location.longitude.toFixed(4)]})]})]})]},e.id))}),0===e.length&&d.jsxs("div",{className:"text-center py-8 text-gray-500",children:[d.jsx(it,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),d.jsx("p",{children:"No photos found"}),d.jsx("p",{className:"text-xs mt-1",children:"Take photos to document progress"})]}),s&&d.jsx(ps,{onCapture:n,onClose:()=>a(!1)})]})},us=({reports:e,projectId:t})=>d.jsxs("div",{className:"space-y-4",children:[d.jsxs("button",{className:"w-full flex items-center justify-center py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[d.jsx(Mt,{className:"w-5 h-5 mr-2"}),"Create Daily Report"]}),d.jsx("div",{className:"space-y-3",children:e.map(e=>d.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[d.jsxs("div",{className:"flex items-center justify-between mb-2",children:[d.jsx("h4",{className:"font-semibold text-gray-900",children:"Daily Report"}),d.jsx("span",{className:"text-sm text-gray-500",children:e.date.toLocaleDateString()})]}),d.jsx("p",{className:"text-sm text-gray-600",children:e.notes}),d.jsxs("div",{className:"flex items-center mt-3 space-x-4",children:[d.jsxs("span",{className:"text-xs text-gray-500",children:["Weather: ",e.weather]}),d.jsxs("span",{className:"text-xs text-gray-500",children:["Crew: ",e.crew.length]}),d.jsxs("span",{className:"text-xs text-gray-500",children:["Photos: ",e.photos.length]})]})]},e.id))}),0===e.length&&d.jsxs("div",{className:"text-center py-8 text-gray-500",children:[d.jsx(bt,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),d.jsx("p",{children:"No daily reports found"})]})]}),hs=({onScan:e,onClose:t})=>{const[s,a]=r.useState(!1),[n,i]=r.useState(null);return d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",children:d.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md mx-4",children:[d.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:d.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"QR Code Scanner"})}),d.jsxs("div",{className:"p-6",children:[!s&&!n&&d.jsxs("div",{className:"text-center",children:[d.jsx(Pt,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),d.jsx("p",{className:"text-gray-600 mb-4",children:"Scan QR codes for equipment, locations, or tasks"}),d.jsxs("button",{onClick:async()=>{try{if(a(!0),i(null),!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("Camera not available on this device");const t=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});setTimeout(()=>{const s=[JSON.stringify({type:"equipment",id:"EQ001",name:"Excavator CAT 320"}),JSON.stringify({type:"location",id:"LOC001",name:"Building A",building:"A",floor:"1"}),JSON.stringify({type:"task",id:"TASK001",title:"Install electrical outlets"}),"https://example.com/project/demo-project-1","Simple text QR code content"],r=s[Math.floor(Math.random()*s.length)];e(r),t.getTracks().forEach(e=>e.stop()),a(!1)},2e3)}catch(t){i(t instanceof Error?t.message:"Failed to access camera"),a(!1)}},className:"w-full flex items-center justify-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:[d.jsx(_t,{className:"w-4 h-4 mr-2"}),"Start Scanning"]})]}),s&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-48 h-48 bg-gray-200 rounded-lg mx-auto mb-4 flex items-center justify-center",children:d.jsx("div",{className:"animate-pulse",children:d.jsx(Pt,{className:"w-16 h-16 text-gray-400"})})}),d.jsx("p",{className:"text-gray-600 mb-4",children:"Point your camera at a QR code..."}),d.jsx("div",{className:"flex space-x-2",children:d.jsx("div",{className:"flex-1 h-2 bg-green-200 rounded-full overflow-hidden",children:d.jsx("div",{className:"h-full bg-green-600 rounded-full animate-pulse"})})})]}),n&&d.jsxs("div",{className:"text-center",children:[d.jsx(Qt,{className:"w-16 h-16 text-red-400 mx-auto mb-4"}),d.jsx("p",{className:"text-red-600 mb-4",children:n}),d.jsx("button",{onClick:()=>i(null),className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Try Again"})]})]}),d.jsx("div",{className:"px-6 py-4 border-t border-gray-200",children:d.jsx("button",{onClick:t,className:"w-full px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",children:"Close"})})]})})},ps=({onCapture:e,onClose:t})=>{const[s,a]=r.useState(!1);return d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",children:d.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md mx-4",children:[d.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:d.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Take Photo"})}),d.jsx("div",{className:"p-6",children:s?d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-48 h-36 bg-gray-200 rounded-lg mx-auto mb-4 flex items-center justify-center",children:d.jsx("div",{className:"animate-pulse",children:d.jsx(it,{className:"w-16 h-16 text-gray-400"})})}),d.jsx("p",{className:"text-gray-600",children:"Capturing photo..."})]}):d.jsxs("div",{className:"text-center space-y-4",children:[d.jsx("div",{className:"w-48 h-36 bg-gray-200 rounded-lg mx-auto flex items-center justify-center",children:d.jsx(it,{className:"w-16 h-16 text-gray-400"})}),d.jsxs("div",{className:"space-y-2",children:[d.jsxs("button",{onClick:()=>{a(!0),setTimeout(()=>{const t=document.createElement("canvas");t.width=640,t.height=480;const s=t.getContext("2d");s&&(s.fillStyle="#f0f0f0",s.fillRect(0,0,640,480),s.fillStyle="#333",s.font="24px Arial",s.textAlign="center",s.fillText("Mock Photo Capture",320,240),s.fillText((new Date).toLocaleString(),320,280),t.toBlob(t=>{if(t){const s=new File([t],`photo_${Date.now()}.jpg`,{type:"image/jpeg"});e(s)}},"image/jpeg",.8)),a(!1)},1500)},className:"w-full flex items-center justify-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[d.jsx(it,{className:"w-4 h-4 mr-2"}),"Capture Photo"]}),d.jsxs("label",{className:"w-full flex items-center justify-center px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 cursor-pointer",children:[d.jsx(Upload,{className:"w-4 h-4 mr-2"}),"Choose from Gallery",d.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:t=>{const s=t.target.files?.[0];s&&e(s)}})]})]})]})}),d.jsx("div",{className:"px-6 py-4 border-t border-gray-200",children:d.jsx("button",{onClick:t,disabled:s,className:"w-full px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 disabled:opacity-50",children:"Cancel"})})]})})};var xs=(e=>(e.DRAWING="drawing",e.SPECIFICATION="specification",e.CONTRACT="contract",e.REPORT="report",e.PHOTO="photo",e.MANUAL="manual",e.CERTIFICATE="certificate",e.PERMIT="permit",e.CORRESPONDENCE="correspondence",e.FORM="form",e.OTHER="other",e))(xs||{}),gs=(e=>(e.ARCHITECTURAL="architectural",e.STRUCTURAL="structural",e.MECHANICAL="mechanical",e.ELECTRICAL="electrical",e.PLUMBING="plumbing",e.CIVIL="civil",e.LANDSCAPE="landscape",e.FIRE_PROTECTION="fire_protection",e.SECURITY="security",e.TELECOMMUNICATIONS="telecommunications",e.GENERAL="general",e))(gs||{}),ys=(e=>(e.DRAFT="draft",e.UNDER_REVIEW="under_review",e.APPROVED="approved",e.PUBLISHED="published",e.SUPERSEDED="superseded",e.ARCHIVED="archived",e.REJECTED="rejected",e))(ys||{}),fs=(e=>(e.LOW="low",e.MEDIUM="medium",e.HIGH="high",e.CRITICAL="critical",e))(fs||{}),bs=(e=>(e.OPEN="open",e.UNDER_REVIEW="under_review",e.RESPONDED="responded",e.CLOSED="closed",e.CANCELLED="cancelled",e))(bs||{}),js=(e=>(e.NOT_SUBMITTED="not_submitted",e.SUBMITTED="submitted",e.UNDER_REVIEW="under_review",e.APPROVED="approved",e.APPROVED_WITH_COMMENTS="approved_with_comments",e.REJECTED="rejected",e.RESUBMIT="resubmit",e))(js||{}),ws=(e=>(e.DRAFT="draft",e.SUBMITTED="submitted",e.UNDER_REVIEW="under_review",e.APPROVED="approved",e.REJECTED="rejected",e.IMPLEMENTED="implemented",e.CANCELLED="cancelled",e))(ws||{});const vs=new class{constructor(){this.baseUrl="/api/documents",this.mockData=this.initializeMockData()}async getDocuments(e,t){try{const s=new URLSearchParams;t&&Object.entries(t).forEach(([e,t])=>{t&&Array.isArray(t)?t.forEach(t=>s.append(e,String(t))):t&&s.append(e,String(t))});const r=await fetch(`${this.baseUrl}/projects/${e}?${s}`);if(!r.ok)throw new Error("Failed to fetch documents");return await r.json()}catch(s){return console.error("Error fetching documents:",s),this.getMockDocuments(e,t)}}async uploadDocument(e,t,s){try{const r=new FormData;r.append("file",t),r.append("metadata",JSON.stringify(s));const a=await fetch(`${this.baseUrl}/projects/${e}/upload`,{method:"POST",body:r});if(!a.ok)throw new Error("Failed to upload document");return await a.json()}catch(r){return console.error("Error uploading document:",r),this.createMockDocument(e,t,s)}}async updateDocument(e,t,s){try{const r=await fetch(`${this.baseUrl}/projects/${e}/documents/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!r.ok)throw new Error("Failed to update document");return await r.json()}catch(r){return console.error("Error updating document:",r),this.mockData.documents[0]}}async deleteDocument(e,t){try{if(!(await fetch(`${this.baseUrl}/projects/${e}/documents/${t}`,{method:"DELETE"})).ok)throw new Error("Failed to delete document")}catch(s){console.error("Error deleting document:",s)}}async createRevision(e,t,s,r){try{const a=new FormData;a.append("file",s),a.append("description",r);const n=await fetch(`${this.baseUrl}/projects/${e}/documents/${t}/revisions`,{method:"POST",body:a});if(!n.ok)throw new Error("Failed to create revision");return await n.json()}catch(a){return console.error("Error creating revision:",a),this.createMockRevision(t,s,r)}}async addMarkup(e,t,s){try{const r=await fetch(`${this.baseUrl}/projects/${e}/documents/${t}/markups`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!r.ok)throw new Error("Failed to add markup");return await r.json()}catch(r){return console.error("Error adding markup:",r),this.createMockMarkup(t,s)}}async updateMarkup(e,t,s,r){try{const a=await fetch(`${this.baseUrl}/projects/${e}/documents/${t}/markups/${s}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!a.ok)throw new Error("Failed to update markup");return await a.json()}catch(a){return console.error("Error updating markup:",a),this.mockData.markups[0]}}async deleteMarkup(e,t,s){try{if(!(await fetch(`${this.baseUrl}/projects/${e}/documents/${t}/markups/${s}`,{method:"DELETE"})).ok)throw new Error("Failed to delete markup")}catch(r){console.error("Error deleting markup:",r)}}async getRFIs(e,t){try{const s=new URLSearchParams;t&&Object.entries(t).forEach(([e,t])=>{t&&s.append(e,String(t))});const r=await fetch(`${this.baseUrl}/projects/${e}/rfis?${s}`);if(!r.ok)throw new Error("Failed to fetch RFIs");return await r.json()}catch(s){return console.error("Error fetching RFIs:",s),this.getMockRFIs(e)}}async createRFI(e,t){try{const s=await fetch(`${this.baseUrl}/projects/${e}/rfis`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok)throw new Error("Failed to create RFI");return await s.json()}catch(s){return console.error("Error creating RFI:",s),this.createMockRFI(e,t)}}async updateRFI(e,t,s){try{const r=await fetch(`${this.baseUrl}/projects/${e}/rfis/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!r.ok)throw new Error("Failed to update RFI");return await r.json()}catch(r){return console.error("Error updating RFI:",r),this.mockData.rfis[0]}}async respondToRFI(e,t,s){try{const r=await fetch(`${this.baseUrl}/projects/${e}/rfis/${t}/respond`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!r.ok)throw new Error("Failed to respond to RFI");return await r.json()}catch(r){return console.error("Error responding to RFI:",r),this.mockData.rfis[0]}}async getSubmittals(e,t){try{const s=new URLSearchParams;t&&Object.entries(t).forEach(([e,t])=>{t&&s.append(e,String(t))});const r=await fetch(`${this.baseUrl}/projects/${e}/submittals?${s}`);if(!r.ok)throw new Error("Failed to fetch submittals");return await r.json()}catch(s){return console.error("Error fetching submittals:",s),this.getMockSubmittals(e)}}async createSubmittal(e,t){try{const s=await fetch(`${this.baseUrl}/projects/${e}/submittals`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok)throw new Error("Failed to create submittal");return await s.json()}catch(s){return console.error("Error creating submittal:",s),this.createMockSubmittal(e,t)}}async updateSubmittal(e,t,s){try{const r=await fetch(`${this.baseUrl}/projects/${e}/submittals/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!r.ok)throw new Error("Failed to update submittal");return await r.json()}catch(r){return console.error("Error updating submittal:",r),this.mockData.submittals[0]}}async reviewSubmittal(e,t,s){try{const r=await fetch(`${this.baseUrl}/projects/${e}/submittals/${t}/review`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!r.ok)throw new Error("Failed to review submittal");return await r.json()}catch(r){return console.error("Error reviewing submittal:",r),this.mockData.submittals[0]}}async getChangeOrders(e,t){try{const s=new URLSearchParams;t&&Object.entries(t).forEach(([e,t])=>{t&&s.append(e,String(t))});const r=await fetch(`${this.baseUrl}/projects/${e}/change-orders?${s}`);if(!r.ok)throw new Error("Failed to fetch change orders");return await r.json()}catch(s){return console.error("Error fetching change orders:",s),this.getMockChangeOrders(e)}}async createChangeOrder(e,t){try{const s=await fetch(`${this.baseUrl}/projects/${e}/change-orders`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok)throw new Error("Failed to create change order");return await s.json()}catch(s){return console.error("Error creating change order:",s),this.createMockChangeOrder(e,t)}}async updateChangeOrder(e,t,s){try{const r=await fetch(`${this.baseUrl}/projects/${e}/change-orders/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!r.ok)throw new Error("Failed to update change order");return await r.json()}catch(r){return console.error("Error updating change order:",r),this.mockData.changeOrders[0]}}async approveChangeOrder(e,t,s){try{const r=await fetch(`${this.baseUrl}/projects/${e}/change-orders/${t}/approve`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!r.ok)throw new Error("Failed to approve change order");return await r.json()}catch(r){return console.error("Error approving change order:",r),this.mockData.changeOrders[0]}}async updateWorkflow(e,t,s,r){try{const a=await fetch(`${this.baseUrl}/projects/${e}/documents/${t}/workflow`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:s,comments:r})});if(!a.ok)throw new Error("Failed to update workflow");return await a.json()}catch(a){return console.error("Error updating workflow:",a),this.createMockWorkflow()}}initializeMockData(){return{documents:this.createMockDocuments(),rfis:this.createMockRFIs(),submittals:this.createMockSubmittals(),changeOrders:this.createMockChangeOrders(),markups:this.createMockMarkups()}}getMockDocuments(e,t){let s=this.mockData.documents.filter(t=>t.projectId===e);if(t&&(t.type?.length&&(s=s.filter(e=>t.type.includes(e.type))),t.category?.length&&(s=s.filter(e=>t.category.includes(e.category))),t.status?.length&&(s=s.filter(e=>t.status.includes(e.status))),t.searchQuery)){const e=t.searchQuery.toLowerCase();s=s.filter(t=>t.name.toLowerCase().includes(e)||t.description.toLowerCase().includes(e))}return{documents:s,totalCount:s.length,facets:{types:{[xs.DRAWING]:5,[xs.SPECIFICATION]:3},categories:{[gs.ARCHITECTURAL]:4,[gs.STRUCTURAL]:2},statuses:{[ys.APPROVED]:6,[ys.UNDER_REVIEW]:2},disciplines:{Architecture:4,Structural:2,MEP:2},tags:{foundation:2,electrical:3,plumbing:1}}}}createMockDocument(e,t,s){return{id:`doc-${Date.now()}`,projectId:e,name:t.name,description:s.description||"",type:s.type||xs.OTHER,category:s.category||gs.GENERAL,discipline:s.discipline||"General",version:"1.0",status:ys.DRAFT,file:{id:`file-${Date.now()}`,filename:t.name,originalName:t.name,url:URL.createObjectURL(t),size:t.size,mimeType:t.type,checksum:"mock-checksum",storageLocation:"mock-storage",uploadedBy:"current-user",uploadedAt:new Date},metadata:{title:s.title,author:s.author,keywords:s.keywords||[]},permissions:[],workflow:this.createMockWorkflow(),revisions:[],markups:[],comments:[],tags:s.tags||[],customFields:[],createdBy:"current-user",createdAt:new Date,updatedAt:new Date}}createMockDocuments(){return[{id:"doc-1",projectId:"demo-project-1",name:"Architectural Floor Plans - Level 1",description:"Detailed floor plans for the first level including all rooms and dimensions",type:xs.DRAWING,category:gs.ARCHITECTURAL,discipline:"Architecture",version:"2.1",status:ys.APPROVED,file:{id:"file-1",filename:"A-101_Floor_Plan_L1_v2.1.pdf",originalName:"Floor Plan Level 1.pdf",url:"/mock-documents/floor-plan-l1.pdf",thumbnailUrl:"/mock-documents/floor-plan-l1-thumb.jpg",size:2048576,mimeType:"application/pdf",checksum:"abc123def456",storageLocation:"s3://docs/project-1/",uploadedBy:"architect-1",uploadedAt:new Date("2024-01-15")},metadata:{title:"Level 1 Floor Plan",author:"John Smith, AIA",keywords:["floor plan","level 1","architectural"],pageCount:1,dimensions:{width:36,height:24,units:"in"},scale:"1/4\" = 1'",drawingNumber:"A-101",sheetNumber:"1",revisionNumber:"2.1",issueDate:new Date("2024-01-15")},permissions:[],workflow:this.createMockWorkflow(),revisions:[],markups:[],comments:[],tags:["floor plan","architectural","level 1"],customFields:[],createdBy:"architect-1",createdAt:new Date("2024-01-10"),updatedAt:new Date("2024-01-15"),publishedAt:new Date("2024-01-15")}]}createMockWorkflow(){return{id:`workflow-${Date.now()}`,workflowId:"standard-approval",currentStep:{id:"step-1",name:"Initial Review",description:"Initial review by project manager",type:"review",order:1,required:!0,assigneeType:"role",assignees:["project-manager"],actions:[],conditions:[]},status:"in_progress",assignedTo:["pm-1"],startedAt:new Date,history:[]}}createMockRevision(e,t,s){return{id:`rev-${Date.now()}`,version:"2.0",description:s,changes:[],file:{id:`file-${Date.now()}`,filename:t.name,originalName:t.name,url:URL.createObjectURL(t),size:t.size,mimeType:t.type,checksum:"mock-checksum",storageLocation:"mock-storage",uploadedBy:"current-user",uploadedAt:new Date},createdBy:"current-user",createdAt:new Date}}createMockMarkup(e,t){return{id:`markup-${Date.now()}`,documentId:e,pageNumber:t.pageNumber||1,type:t.type||"annotation",coordinates:t.coordinates||{x:100,y:100},content:t.content||"New markup",color:t.color||"#ff0000",strokeWidth:t.strokeWidth||2,opacity:t.opacity||1,locked:!1,visible:!0,layer:"default",createdBy:"current-user",createdAt:new Date,updatedAt:new Date,replies:[],status:"open"}}createMockMarkups(){return[]}getMockRFIs(e){return this.mockData.rfis.filter(t=>t.projectId===e)}createMockRFI(e,t){return{id:`rfi-${Date.now()}`,projectId:e,number:`RFI-${String(Date.now()).slice(-3)}`,title:t.title||"New RFI",description:t.description||"",question:t.question||"",priority:t.priority||fs.MEDIUM,status:bs.OPEN,category:t.category||"design_clarification",discipline:t.discipline||"General",requestedBy:"current-user",requestedCompany:"ABC Construction",assignedTo:t.assignedTo||"architect-1",assignedCompany:"XYZ Architects",dueDate:t.dueDate||new Date(Date.now()+6048e5),relatedDocuments:[],relatedDrawings:[],attachments:[],photos:[],markups:[],comments:[],workflow:this.createMockWorkflow(),createdAt:new Date,updatedAt:new Date}}createMockRFIs(){return[{id:"rfi-1",projectId:"demo-project-1",number:"RFI-001",title:"Clarification on Foundation Details",description:"Need clarification on foundation reinforcement details in section A-A",question:"What is the required rebar spacing for the foundation footings shown in drawing S-101?",priority:fs.HIGH,status:bs.UNDER_REVIEW,category:"design_clarification",discipline:"Structural",requestedBy:"foreman-1",requestedCompany:"ABC Construction",assignedTo:"engineer-1",assignedCompany:"XYZ Engineering",dueDate:new Date(Date.now()+2592e5),relatedDocuments:["doc-1"],relatedDrawings:["S-101"],attachments:[],photos:[],markups:[],comments:[],workflow:this.createMockWorkflow(),costImpact:5e3,scheduleImpact:2,createdAt:new Date(Date.now()-1728e5),updatedAt:new Date}]}getMockSubmittals(e){return this.mockData.submittals.filter(t=>t.projectId===e)}createMockSubmittal(e,t){return{id:`submittal-${Date.now()}`,projectId:e,number:`SUB-${String(Date.now()).slice(-3)}`,title:t.title||"New Submittal",description:t.description||"",type:t.type||"product_data",category:t.category||"general",discipline:t.discipline||"General",specification:t.specification||"",submittedBy:"current-user",submittedCompany:"ABC Construction",reviewedBy:[],status:js.SUBMITTED,priority:t.priority||fs.MEDIUM,dueDate:t.dueDate||new Date(Date.now()+12096e5),submissionDate:new Date,documents:[],reviews:[],comments:[],workflow:this.createMockWorkflow(),deliveryMethod:"electronic",copies:1,distributionList:[],createdAt:new Date,updatedAt:new Date}}createMockSubmittals(){return[{id:"submittal-1",projectId:"demo-project-1",number:"SUB-001",title:"Structural Steel Shop Drawings",description:"Shop drawings for structural steel beams and connections",type:"shop_drawings",category:"structural",discipline:"Structural",specification:"05 12 00",submittedBy:"steel-contractor",submittedCompany:"Steel Works Inc",reviewedBy:["engineer-1"],status:js.UNDER_REVIEW,priority:fs.HIGH,dueDate:new Date(Date.now()+6048e5),submissionDate:new Date(Date.now()-864e5),documents:[],reviews:[],comments:[],workflow:this.createMockWorkflow(),deliveryMethod:"electronic",copies:3,distributionList:["engineer-1","architect-1","pm-1"],createdAt:new Date(Date.now()-2592e5),updatedAt:new Date}]}getMockChangeOrders(e){return this.mockData.changeOrders.filter(t=>t.projectId===e)}createMockChangeOrder(e,t){return{id:`co-${Date.now()}`,projectId:e,number:`CO-${String(Date.now()).slice(-3)}`,title:t.title||"New Change Order",description:t.description||"",type:t.type||"addition",reason:t.reason||"scope_change",status:ws.DRAFT,priority:t.priority||fs.MEDIUM,requestedBy:"current-user",assignedTo:t.assignedTo||"pm-1",costImpact:t.costImpact||0,scheduleImpact:t.scheduleImpact||0,scope:{addedWork:[],deletedWork:[],modifiedWork:[],materials:[],labor:[],equipment:[]},justification:t.justification||"",relatedDocuments:[],relatedRFIs:[],relatedSubmittals:[],attachments:[],approvals:[],workflow:this.createMockWorkflow(),implementation:{status:"not_started",photos:[]},createdAt:new Date,updatedAt:new Date}}createMockChangeOrders(){return[{id:"co-1",projectId:"demo-project-1",number:"CO-001",title:"Additional Electrical Outlets",description:"Add 20 additional electrical outlets in office areas per owner request",type:"addition",reason:"owner_request",status:ws.UNDER_REVIEW,priority:fs.MEDIUM,requestedBy:"owner-1",assignedTo:"pm-1",costImpact:15e3,scheduleImpact:3,scope:{addedWork:[{id:"work-1",description:"Install additional electrical outlets",quantity:20,unit:"EA",unitCost:750,totalCost:15e3,costCode:"16-10-00",phase:"Electrical Rough-in",location:"Office Areas"}],deletedWork:[],modifiedWork:[],materials:[],labor:[],equipment:[]},justification:"Owner requires additional outlets for increased equipment density in office areas",relatedDocuments:[],relatedRFIs:[],relatedSubmittals:[],attachments:[],approvals:[],workflow:this.createMockWorkflow(),implementation:{status:"not_started",photos:[]},createdAt:new Date(Date.now()-432e6),updatedAt:new Date}]}},Ns=({projectId:e,userId:t})=>{const[s,a]=r.useState("documents"),[n,i]=r.useState("list"),[o,l]=r.useState(!0),[c,m]=r.useState(""),[u,h]=r.useState(!1),[p,x]=r.useState([]),[g,y]=r.useState({documents:[],rfis:[],submittals:[],changeOrders:[],totalCounts:{documents:0,rfis:0,submittals:0,changeOrders:0}}),[f,b]=r.useState({type:[],category:[],status:[],discipline:[],tags:[],searchQuery:""});r.useEffect(()=>{j()},[e,f]),r.useEffect(()=>{const e=setTimeout(()=>{b(e=>({...e,searchQuery:c}))},300);return()=>clearTimeout(e)},[c]);const j=async()=>{l(!0);try{const[t,s,r,a]=await Promise.all([vs.getDocuments(e,f),vs.getRFIs(e),vs.getSubmittals(e),vs.getChangeOrders(e)]);y({documents:t.documents,rfis:s,submittals:r,changeOrders:a,totalCounts:{documents:t.totalCount,rfis:s.length,submittals:r.length,changeOrders:a.length}})}catch(t){console.error("Error loading document data:",t)}finally{l(!1)}},w=[{id:"documents",label:"Documents",icon:bt,count:g.totalCounts.documents,color:"blue"},{id:"rfis",label:"RFIs",icon:It,count:g.totalCounts.rfis,color:"orange"},{id:"submittals",label:"Submittals",icon:Yt,count:g.totalCounts.submittals,color:"green"},{id:"change-orders",label:"Change Orders",icon:Wt,count:g.totalCounts.changeOrders,color:"purple"}];return o?d.jsxs("div",{className:"flex items-center justify-center h-64",children:[d.jsx(Ot,{className:"w-8 h-8 animate-spin text-blue-600"}),d.jsx("span",{className:"ml-2 text-gray-600",children:"Loading documents..."})]}):d.jsxs("div",{className:"bg-white rounded-lg shadow-lg",children:[d.jsxs("div",{className:"border-b border-gray-200 px-6 py-4",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Document Management"}),d.jsx("p",{className:"text-gray-600",children:"Centralized document control and collaboration"})]}),d.jsxs("div",{className:"flex items-center space-x-3",children:[d.jsx("button",{onClick:()=>i("grid"===n?"list":"grid"),className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:"grid"===n?d.jsx(St,{className:"w-4 h-4"}):d.jsx(Nt,{className:"w-4 h-4"})}),d.jsxs("button",{onClick:()=>h(!u),className:"flex items-center px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:[d.jsx(vt,{className:"w-4 h-4 mr-2"}),"Filters"]}),d.jsxs("label",{className:"flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 cursor-pointer",children:[d.jsx(Yt,{className:"w-4 h-4 mr-2"}),"Upload",d.jsx("input",{type:"file",multiple:!0,className:"hidden",onChange:t=>t.target.files&&(async t=>{for(const r of Array.from(t))try{await vs.uploadDocument(e,r,{type:xs.OTHER,category:gs.GENERAL,description:`Uploaded file: ${r.name}`})}catch(s){console.error("Error uploading file:",s)}j()})(t.target.files)})]})]})]}),d.jsxs("div",{className:"mt-4 relative",children:[d.jsx(Lt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),d.jsx("input",{type:"text",placeholder:"Search documents, RFIs, submittals...",value:c,onChange:e=>m(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),u&&d.jsx("div",{className:"border-b border-gray-200 px-6 py-4 bg-gray-50",children:d.jsx(ks,{filters:f,setFilters:b})}),d.jsx("div",{className:"border-b border-gray-200",children:d.jsx("nav",{className:"flex space-x-8 px-6",children:w.map(e=>{const t=e.icon;return d.jsxs("button",{onClick:()=>a(e.id),className:"flex items-center py-4 px-1 border-b-2 font-medium text-sm "+(s===e.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[d.jsx(t,{className:"w-4 h-4 mr-2"}),e.label,e.count>0&&d.jsx("span",{className:`ml-2 px-2 py-1 text-xs rounded-full bg-${e.color}-100 text-${e.color}-800`,children:e.count})]},e.id)})})}),d.jsxs("div",{className:"p-6",children:["documents"===s&&d.jsx(Es,{documents:g.documents,viewMode:n,selectedItems:p,setSelectedItems:x,onDelete:t=>(async(t,s)=>{try{"document"===s&&await vs.deleteDocument(e,t),j()}catch(r){console.error("Error deleting item:",r)}})(t,"document"),projectId:e}),"rfis"===s&&d.jsx(Cs,{rfis:g.rfis,projectId:e,onRefresh:j}),"submittals"===s&&d.jsx(Is,{submittals:g.submittals,projectId:e,onRefresh:j}),"change-orders"===s&&d.jsx(As,{changeOrders:g.changeOrders,projectId:e,onRefresh:j})]})]})},ks=({filters:e,setFilters:t})=>{const s=(s,r)=>{t({...e,[s]:r})};return d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Type"}),d.jsx("select",{multiple:!0,value:e.type||[],onChange:e=>s("type",Array.from(e.target.selectedOptions,e=>e.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:Object.values(xs).map(e=>d.jsx("option",{value:e,children:e.replace("_"," ")},e))})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category"}),d.jsx("select",{multiple:!0,value:e.category||[],onChange:e=>s("category",Array.from(e.target.selectedOptions,e=>e.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:Object.values(gs).map(e=>d.jsx("option",{value:e,children:e.replace("_"," ")},e))})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),d.jsx("select",{multiple:!0,value:e.status||[],onChange:e=>s("status",Array.from(e.target.selectedOptions,e=>e.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:Object.values(ys).map(e=>d.jsx("option",{value:e,children:e.replace("_"," ")},e))})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Discipline"}),d.jsx("input",{type:"text",placeholder:"Enter discipline",value:e.discipline?.join(", ")||"",onChange:e=>s("discipline",e.target.value.split(",").map(e=>e.trim()).filter(Boolean)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]})},Es=({documents:e,viewMode:t,selectedItems:s,setSelectedItems:r,onDelete:a,projectId:n})=>{const i=e=>{switch(e){case ys.APPROVED:return"bg-green-100 text-green-800";case ys.UNDER_REVIEW:return"bg-yellow-100 text-yellow-800";case ys.DRAFT:return"bg-gray-100 text-gray-800";case ys.REJECTED:return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},o=e=>{switch(e){case xs.DRAWING:return d.jsx(bt,{className:"w-5 h-5 text-blue-600"});case xs.SPECIFICATION:return d.jsx(bt,{className:"w-5 h-5 text-green-600"});case xs.CONTRACT:return d.jsx(bt,{className:"w-5 h-5 text-purple-600"});case xs.PHOTO:return d.jsx(bt,{className:"w-5 h-5 text-orange-600"});default:return d.jsx(bt,{className:"w-5 h-5 text-gray-600"})}};return 0===e.length?d.jsxs("div",{className:"text-center py-12",children:[d.jsx(wt,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),d.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No documents found"}),d.jsx("p",{className:"text-gray-600 mb-4",children:"Upload your first document to get started"}),d.jsxs("label",{className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 cursor-pointer",children:[d.jsx(Yt,{className:"w-4 h-4 mr-2"}),"Upload Document",d.jsx("input",{type:"file",multiple:!0,className:"hidden"})]})]}):"grid"===t?d.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:e.map(e=>d.jsx(Ss,{document:e,onDelete:a},e.id))}):d.jsx("div",{className:"overflow-x-auto",children:d.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[d.jsx("thead",{className:"bg-gray-50",children:d.jsxs("tr",{children:[d.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:d.jsx("input",{type:"checkbox",className:"rounded border-gray-300",onChange:t=>{t.target.checked?r(e.map(e=>e.id)):r([])}})}),d.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Document"}),d.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),d.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),d.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Version"}),d.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Modified"}),d.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),d.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:e.map(e=>d.jsxs("tr",{className:"hover:bg-gray-50",children:[d.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:d.jsx("input",{type:"checkbox",className:"rounded border-gray-300",checked:s.includes(e.id),onChange:t=>{t.target.checked?r([...s,e.id]):r(s.filter(t=>t!==e.id))}})}),d.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:d.jsxs("div",{className:"flex items-center",children:[o(e.type),d.jsxs("div",{className:"ml-3",children:[d.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.name}),d.jsx("div",{className:"text-sm text-gray-500",children:e.description})]})]})}),d.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:d.jsx("span",{className:"text-sm text-gray-900",children:e.type.replace("_"," ")})}),d.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:d.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${i(e.status)}`,children:e.status.replace("_"," ")})}),d.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.version}),d.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.updatedAt.toLocaleDateString()}),d.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:d.jsxs("div",{className:"flex items-center space-x-2",children:[d.jsx("button",{className:"text-blue-600 hover:text-blue-900",children:d.jsx(ft,{className:"w-4 h-4"})}),d.jsx("button",{className:"text-green-600 hover:text-green-900",children:d.jsx(gt,{className:"w-4 h-4"})}),d.jsx("button",{className:"text-gray-600 hover:text-gray-900",children:d.jsx(Wt,{className:"w-4 h-4"})}),d.jsx("button",{onClick:()=>a(e.id),className:"text-red-600 hover:text-red-900",children:d.jsx(zt,{className:"w-4 h-4"})})]})})]},e.id))})]})})},Ss=({document:e,onDelete:t})=>d.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:[d.jsxs("div",{className:"flex items-start justify-between mb-3",children:[d.jsx(bt,{className:"w-8 h-8 text-blue-600"}),d.jsx("div",{className:"relative",children:d.jsx("button",{className:"text-gray-400 hover:text-gray-600",children:d.jsx(yt,{className:"w-4 h-4"})})})]}),d.jsx("h3",{className:"font-medium text-gray-900 mb-1 truncate",children:e.name}),d.jsx("p",{className:"text-sm text-gray-600 mb-3 line-clamp-2",children:e.description}),d.jsxs("div",{className:"flex items-center justify-between mb-3",children:[d.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${(e=>{switch(e){case ys.APPROVED:return"bg-green-100 text-green-800";case ys.UNDER_REVIEW:return"bg-yellow-100 text-yellow-800";case ys.DRAFT:return"bg-gray-100 text-gray-800";case ys.REJECTED:return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}})(e.status)}`,children:e.status.replace("_"," ")}),d.jsxs("span",{className:"text-xs text-gray-500",children:["v",e.version]})]}),d.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[d.jsx("span",{children:e.updatedAt.toLocaleDateString()}),d.jsxs("div",{className:"flex items-center space-x-2",children:[d.jsx("button",{className:"text-blue-600 hover:text-blue-800",children:d.jsx(ft,{className:"w-3 h-3"})}),d.jsx("button",{className:"text-green-600 hover:text-green-800",children:d.jsx(gt,{className:"w-3 h-3"})}),d.jsx("button",{onClick:()=>t(e.id),className:"text-red-600 hover:text-red-800",children:d.jsx(zt,{className:"w-3 h-3"})})]})]})]}),Cs=({rfis:e,projectId:t,onRefresh:s})=>{const[a,n]=r.useState(!1),[i,o]=r.useState(null),[l,c]=r.useState(!1),m=e=>{switch(e){case bs.OPEN:return"bg-red-100 text-red-800";case bs.UNDER_REVIEW:return"bg-yellow-100 text-yellow-800";case bs.RESPONDED:return"bg-blue-100 text-blue-800";case bs.CLOSED:return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},u=e=>{switch(e){case fs.CRITICAL:return"bg-red-500";case fs.HIGH:return"bg-orange-500";case fs.MEDIUM:return"bg-yellow-500";case fs.LOW:return"bg-green-500";default:return"bg-gray-500"}};return d.jsxs("div",{className:"space-y-6",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Request for Information (RFI)"}),d.jsx("p",{className:"text-sm text-gray-600",children:"Manage project clarifications and questions"})]}),d.jsxs("button",{onClick:()=>n(!0),className:"flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[d.jsx(Mt,{className:"w-4 h-4 mr-2"}),"Create RFI"]})]}),0===e.length?d.jsxs("div",{className:"text-center py-12",children:[d.jsx(It,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),d.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No RFIs found"}),d.jsx("p",{className:"text-gray-600 mb-4",children:"Create your first RFI to get clarification on project details"}),d.jsxs("button",{onClick:()=>n(!0),className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[d.jsx(Mt,{className:"w-4 h-4 mr-2"}),"Create RFI"]})]}):d.jsx("div",{className:"grid gap-4",children:e.map(e=>d.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow",children:[d.jsxs("div",{className:"flex items-start justify-between mb-4",children:[d.jsxs("div",{className:"flex-1",children:[d.jsxs("div",{className:"flex items-center mb-2",children:[d.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:e.title}),d.jsxs("span",{className:"ml-2 text-sm text-gray-500",children:["#",e.number]}),d.jsx("div",{className:`ml-2 w-3 h-3 rounded-full ${u(e.priority)}`})]}),d.jsx("p",{className:"text-gray-600 mb-3",children:e.description}),d.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg mb-3",children:[d.jsx("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"Question:"}),d.jsx("p",{className:"text-sm text-gray-900",children:e.question})]})]}),d.jsxs("div",{className:"ml-4 flex flex-col items-end space-y-2",children:[d.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${m(e.status)}`,children:e.status.replace("_"," ")}),d.jsxs("div",{className:"flex space-x-1",children:[d.jsx("button",{onClick:()=>{o(e),c(!0)},className:"p-1 text-blue-600 hover:text-blue-800",title:"Respond",children:d.jsx(It,{className:"w-4 h-4"})}),d.jsx("button",{className:"p-1 text-gray-600 hover:text-gray-800",title:"Edit",children:d.jsx(Wt,{className:"w-4 h-4"})})]})]})]}),d.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[d.jsxs("div",{children:[d.jsx("span",{className:"text-gray-500",children:"Requested by:"}),d.jsx("p",{className:"font-medium",children:e.requestedCompany})]}),d.jsxs("div",{children:[d.jsx("span",{className:"text-gray-500",children:"Assigned to:"}),d.jsx("p",{className:"font-medium",children:e.assignedCompany})]}),d.jsxs("div",{children:[d.jsx("span",{className:"text-gray-500",children:"Due date:"}),d.jsx("p",{className:"font-medium",children:e.dueDate.toLocaleDateString()})]}),d.jsxs("div",{children:[d.jsx("span",{className:"text-gray-500",children:"Discipline:"}),d.jsx("p",{className:"font-medium",children:e.discipline})]})]}),e.costImpact&&d.jsxs("div",{className:"mt-3 flex items-center space-x-4 text-sm",children:[d.jsxs("span",{className:"text-red-600",children:["Cost Impact: $",e.costImpact.toLocaleString()]}),e.scheduleImpact&&d.jsxs("span",{className:"text-orange-600",children:["Schedule Impact: ",e.scheduleImpact," days"]})]}),e.response&&d.jsxs("div",{className:"mt-4 bg-blue-50 p-3 rounded-lg",children:[d.jsx("p",{className:"text-sm font-medium text-blue-700 mb-1",children:"Response:"}),d.jsx("p",{className:"text-sm text-blue-900",children:e.response.content}),d.jsxs("p",{className:"text-xs text-blue-600 mt-2",children:["Responded by ",e.response.respondedBy," on ",e.response.respondedAt.toLocaleDateString()]})]})]},e.id))}),a&&d.jsx(Ds,{projectId:t,onClose:()=>n(!1),onSuccess:()=>{n(!1),s()}}),l&&i&&d.jsx(Ts,{rfi:i,projectId:t,onClose:()=>{c(!1),o(null)},onSuccess:()=>{c(!1),o(null),s()}})]})},Is=({submittals:e,projectId:t,onRefresh:s})=>{const[a,n]=r.useState(!1),[i,o]=r.useState(null),[l,c]=r.useState(!1),m=e=>{switch(e){case js.NOT_SUBMITTED:return"bg-gray-100 text-gray-800";case js.SUBMITTED:return"bg-blue-100 text-blue-800";case js.UNDER_REVIEW:return"bg-yellow-100 text-yellow-800";case js.APPROVED:case js.APPROVED_WITH_COMMENTS:return"bg-green-100 text-green-800";case js.REJECTED:return"bg-red-100 text-red-800";case js.RESUBMIT:return"bg-orange-100 text-orange-800";default:return"bg-gray-100 text-gray-800"}},u=e=>{switch(e){case fs.CRITICAL:return"bg-red-500";case fs.HIGH:return"bg-orange-500";case fs.MEDIUM:return"bg-yellow-500";case fs.LOW:return"bg-green-500";default:return"bg-gray-500"}};return d.jsxs("div",{className:"space-y-6",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Submittal Management"}),d.jsx("p",{className:"text-sm text-gray-600",children:"Track and review project submittals"})]}),d.jsxs("button",{onClick:()=>n(!0),className:"flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[d.jsx(Mt,{className:"w-4 h-4 mr-2"}),"Create Submittal"]})]}),0===e.length?d.jsxs("div",{className:"text-center py-12",children:[d.jsx(Yt,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),d.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No submittals found"}),d.jsx("p",{className:"text-gray-600 mb-4",children:"Create your first submittal to track project approvals"}),d.jsxs("button",{onClick:()=>n(!0),className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[d.jsx(Mt,{className:"w-4 h-4 mr-2"}),"Create Submittal"]})]}):d.jsx("div",{className:"grid gap-4",children:e.map(e=>d.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow",children:[d.jsxs("div",{className:"flex items-start justify-between mb-4",children:[d.jsxs("div",{className:"flex-1",children:[d.jsxs("div",{className:"flex items-center mb-2",children:[d.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:e.title}),d.jsxs("span",{className:"ml-2 text-sm text-gray-500",children:["#",e.number]}),d.jsx("div",{className:`ml-2 w-3 h-3 rounded-full ${u(e.priority)}`})]}),d.jsx("p",{className:"text-gray-600 mb-3",children:e.description}),d.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:[d.jsxs("span",{children:[d.jsx("strong",{children:"Type:"})," ",e.type.replace("_"," ")]}),d.jsxs("span",{children:[d.jsx("strong",{children:"Specification:"})," ",e.specification]}),d.jsxs("span",{children:[d.jsx("strong",{children:"Discipline:"})," ",e.discipline]})]})]}),d.jsxs("div",{className:"ml-4 flex flex-col items-end space-y-2",children:[d.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${m(e.status)}`,children:e.status.replace("_"," ")}),d.jsxs("div",{className:"flex space-x-1",children:[d.jsx("button",{onClick:()=>{o(e),c(!0)},className:"p-1 text-blue-600 hover:text-blue-800",title:"Review",children:d.jsx(dt,{className:"w-4 h-4"})}),d.jsx("button",{className:"p-1 text-gray-600 hover:text-gray-800",title:"Edit",children:d.jsx(Wt,{className:"w-4 h-4"})})]})]})]}),d.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[d.jsxs("div",{children:[d.jsx("span",{className:"text-gray-500",children:"Submitted by:"}),d.jsx("p",{className:"font-medium",children:e.submittedCompany})]}),d.jsxs("div",{children:[d.jsx("span",{className:"text-gray-500",children:"Due date:"}),d.jsx("p",{className:"font-medium",children:e.dueDate.toLocaleDateString()})]}),d.jsxs("div",{children:[d.jsx("span",{className:"text-gray-500",children:"Submission date:"}),d.jsx("p",{className:"font-medium",children:e.submissionDate.toLocaleDateString()})]}),d.jsxs("div",{children:[d.jsx("span",{className:"text-gray-500",children:"Copies:"}),d.jsx("p",{className:"font-medium",children:e.copies})]})]}),e.reviews.length>0&&d.jsxs("div",{className:"mt-4 bg-blue-50 p-3 rounded-lg",children:[d.jsx("p",{className:"text-sm font-medium text-blue-700 mb-1",children:"Latest Review:"}),d.jsx("p",{className:"text-sm text-blue-900",children:e.reviews[e.reviews.length-1].comments}),d.jsxs("p",{className:"text-xs text-blue-600 mt-2",children:["Reviewed by ",e.reviews[e.reviews.length-1].reviewedBy," on ",e.reviews[e.reviews.length-1].reviewedAt.toLocaleDateString()]})]})]},e.id))}),a&&d.jsx(Rs,{projectId:t,onClose:()=>n(!1),onSuccess:()=>{n(!1),s()}}),l&&i&&d.jsx(Ms,{submittal:i,projectId:t,onClose:()=>{c(!1),o(null)},onSuccess:()=>{c(!1),o(null),s()}})]})},As=({changeOrders:e,projectId:t,onRefresh:s})=>{const[a,n]=r.useState(!1),[i,o]=r.useState(null),[l,c]=r.useState(!1),m=e=>{switch(e){case ws.DRAFT:return"bg-gray-100 text-gray-800";case ws.SUBMITTED:return"bg-blue-100 text-blue-800";case ws.UNDER_REVIEW:return"bg-yellow-100 text-yellow-800";case ws.APPROVED:return"bg-green-100 text-green-800";case ws.REJECTED:return"bg-red-100 text-red-800";case ws.IMPLEMENTED:return"bg-purple-100 text-purple-800";case ws.CANCELLED:default:return"bg-gray-100 text-gray-800"}},u=e=>{switch(e){case fs.CRITICAL:return"bg-red-500";case fs.HIGH:return"bg-orange-500";case fs.MEDIUM:return"bg-yellow-500";case fs.LOW:return"bg-green-500";default:return"bg-gray-500"}};return d.jsxs("div",{className:"space-y-6",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Change Order Management"}),d.jsx("p",{className:"text-sm text-gray-600",children:"Track project scope and cost changes"})]}),d.jsxs("button",{onClick:()=>n(!0),className:"flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[d.jsx(Mt,{className:"w-4 h-4 mr-2"}),"Create Change Order"]})]}),0===e.length?d.jsxs("div",{className:"text-center py-12",children:[d.jsx(Wt,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),d.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No change orders found"}),d.jsx("p",{className:"text-gray-600 mb-4",children:"Create your first change order to track project modifications"}),d.jsxs("button",{onClick:()=>n(!0),className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[d.jsx(Mt,{className:"w-4 h-4 mr-2"}),"Create Change Order"]})]}):d.jsx("div",{className:"grid gap-4",children:e.map(e=>{return d.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow",children:[d.jsxs("div",{className:"flex items-start justify-between mb-4",children:[d.jsxs("div",{className:"flex-1",children:[d.jsxs("div",{className:"flex items-center mb-2",children:[d.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:e.title}),d.jsxs("span",{className:"ml-2 text-sm text-gray-500",children:["#",e.number]}),d.jsx("div",{className:`ml-2 w-3 h-3 rounded-full ${u(e.priority)}`})]}),d.jsx("p",{className:"text-gray-600 mb-3",children:e.description}),d.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:[d.jsxs("span",{children:[d.jsx("strong",{children:"Type:"})," ",e.type.replace("_"," ")]}),d.jsxs("span",{children:[d.jsx("strong",{children:"Reason:"})," ",e.reason.replace("_"," ")]})]})]}),d.jsxs("div",{className:"ml-4 flex flex-col items-end space-y-2",children:[d.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${m(e.status)}`,children:e.status.replace("_"," ")}),d.jsxs("div",{className:"flex space-x-1",children:[d.jsx("button",{onClick:()=>{o(e),c(!0)},className:"p-1 text-green-600 hover:text-green-800",title:"Approve",children:d.jsx(dt,{className:"w-4 h-4"})}),d.jsx("button",{className:"p-1 text-gray-600 hover:text-gray-800",title:"Edit",children:d.jsx(Wt,{className:"w-4 h-4"})})]})]})]}),d.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm mb-4",children:[d.jsxs("div",{children:[d.jsx("span",{className:"text-gray-500",children:"Cost Impact:"}),d.jsx("p",{className:"font-medium "+(e.costImpact>=0?"text-red-600":"text-green-600"),children:(t=e.costImpact,new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(t))})]}),d.jsxs("div",{children:[d.jsx("span",{className:"text-gray-500",children:"Schedule Impact:"}),d.jsxs("p",{className:"font-medium "+(e.scheduleImpact>0?"text-red-600":e.scheduleImpact<0?"text-green-600":"text-gray-900"),children:[e.scheduleImpact>0?"+":"",e.scheduleImpact," days"]})]}),d.jsxs("div",{children:[d.jsx("span",{className:"text-gray-500",children:"Requested by:"}),d.jsx("p",{className:"font-medium",children:e.requestedBy})]}),d.jsxs("div",{children:[d.jsx("span",{className:"text-gray-500",children:"Assigned to:"}),d.jsx("p",{className:"font-medium",children:e.assignedTo})]})]}),d.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg mb-3",children:[d.jsx("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"Justification:"}),d.jsx("p",{className:"text-sm text-gray-900",children:e.justification})]}),e.scope&&d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.scope.addedWork.length>0&&d.jsxs("div",{className:"bg-green-50 p-3 rounded-lg",children:[d.jsx("p",{className:"font-medium text-green-700 mb-1",children:"Added Work:"}),d.jsxs("p",{className:"text-green-900",children:[e.scope.addedWork.length," items"]})]}),e.scope.deletedWork.length>0&&d.jsxs("div",{className:"bg-red-50 p-3 rounded-lg",children:[d.jsx("p",{className:"font-medium text-red-700 mb-1",children:"Deleted Work:"}),d.jsxs("p",{className:"text-red-900",children:[e.scope.deletedWork.length," items"]})]}),e.scope.modifiedWork.length>0&&d.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg",children:[d.jsx("p",{className:"font-medium text-blue-700 mb-1",children:"Modified Work:"}),d.jsxs("p",{className:"text-blue-900",children:[e.scope.modifiedWork.length," items"]})]})]}),e.approvals.length>0&&d.jsxs("div",{className:"mt-4 bg-blue-50 p-3 rounded-lg",children:[d.jsx("p",{className:"text-sm font-medium text-blue-700 mb-1",children:"Approvals:"}),d.jsx("div",{className:"space-y-1",children:e.approvals.map((e,t)=>d.jsxs("p",{className:"text-sm text-blue-900",children:[e.approverType,": ",e.status," by ",e.approver,e.approvedAt&&` on ${e.approvedAt.toLocaleDateString()}`]},t))})]})]},e.id);var t})}),a&&d.jsx(Ps,{projectId:t,onClose:()=>n(!1),onSuccess:()=>{n(!1),s()}}),l&&i&&d.jsx(Os,{changeOrder:i,projectId:t,onClose:()=>{c(!1),o(null)},onSuccess:()=>{c(!1),o(null),s()}})]})},Ds=({projectId:e,onClose:t,onSuccess:s})=>{const[a,n]=r.useState({title:"",description:"",question:"",priority:fs.MEDIUM,category:"design_clarification",discipline:"",assignedTo:"",assignedCompany:"",dueDate:new Date(Date.now()+6048e5).toISOString().split("T")[0],costImpact:"",scheduleImpact:""}),[i,o]=r.useState(!1);return d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:d.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[d.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:d.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Create New RFI"})}),d.jsxs("form",{onSubmit:async t=>{t.preventDefault(),o(!0);try{await vs.createRFI(e,{...a,dueDate:new Date(a.dueDate),costImpact:a.costImpact?parseFloat(a.costImpact):void 0,scheduleImpact:a.scheduleImpact?parseInt(a.scheduleImpact):void 0}),s()}catch(r){console.error("Error creating RFI:",r)}finally{o(!1)}},className:"p-6 space-y-4",children:[d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[d.jsxs("div",{className:"md:col-span-2",children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Title *"}),d.jsx("input",{type:"text",required:!0,value:a.title,onChange:e=>n({...a,title:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Brief description of the RFI"})]}),d.jsxs("div",{className:"md:col-span-2",children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),d.jsx("textarea",{value:a.description,onChange:e=>n({...a,description:e.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Detailed description of the issue or context"})]}),d.jsxs("div",{className:"md:col-span-2",children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Question *"}),d.jsx("textarea",{required:!0,value:a.question,onChange:e=>n({...a,question:e.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Specific question that needs to be answered"})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Priority"}),d.jsxs("select",{value:a.priority,onChange:e=>n({...a,priority:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[d.jsx("option",{value:fs.LOW,children:"Low"}),d.jsx("option",{value:fs.MEDIUM,children:"Medium"}),d.jsx("option",{value:fs.HIGH,children:"High"}),d.jsx("option",{value:fs.CRITICAL,children:"Critical"})]})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Discipline"}),d.jsx("input",{type:"text",value:a.discipline,onChange:e=>n({...a,discipline:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"e.g., Architectural, Structural"})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Assigned To"}),d.jsx("input",{type:"text",value:a.assignedTo,onChange:e=>n({...a,assignedTo:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Person responsible for response"})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Assigned Company"}),d.jsx("input",{type:"text",value:a.assignedCompany,onChange:e=>n({...a,assignedCompany:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Company responsible for response"})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Due Date"}),d.jsx("input",{type:"date",value:a.dueDate,onChange:e=>n({...a,dueDate:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cost Impact ($)"}),d.jsx("input",{type:"number",value:a.costImpact,onChange:e=>n({...a,costImpact:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Estimated cost impact"})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Schedule Impact (days)"}),d.jsx("input",{type:"number",value:a.scheduleImpact,onChange:e=>n({...a,scheduleImpact:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Estimated schedule impact"})]})]}),d.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[d.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",children:"Cancel"}),d.jsx("button",{type:"submit",disabled:i,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:i?"Creating...":"Create RFI"})]})]})]})})},Ts=({rfi:e,projectId:t,onClose:s,onSuccess:a})=>{const[n,i]=r.useState(""),[o,l]=r.useState(!1),[c,m]=r.useState(""),[u,h]=r.useState(!1);return d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:d.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[d.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[d.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Respond to RFI #",e.number]}),d.jsx("p",{className:"text-sm text-gray-600",children:e.title})]}),d.jsxs("div",{className:"p-6",children:[d.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg mb-6",children:[d.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Original Question:"}),d.jsx("p",{className:"text-gray-700",children:e.question})]}),d.jsxs("form",{onSubmit:async s=>{s.preventDefault(),h(!0);try{await vs.respondToRFI(t,e.id,{content:n,followUpRequired:o,followUpActions:o?c.split("\n").filter(Boolean):[]}),a()}catch(r){console.error("Error responding to RFI:",r)}finally{h(!1)}},className:"space-y-4",children:[d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Response *"}),d.jsx("textarea",{required:!0,value:n,onChange:e=>i(e.target.value),rows:6,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Provide a detailed response to the question"})]}),d.jsxs("div",{className:"flex items-center",children:[d.jsx("input",{type:"checkbox",id:"followUpRequired",checked:o,onChange:e=>l(e.target.checked),className:"rounded border-gray-300"}),d.jsx("label",{htmlFor:"followUpRequired",className:"ml-2 text-sm text-gray-700",children:"Follow-up actions required"})]}),o&&d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Follow-up Actions"}),d.jsx("textarea",{value:c,onChange:e=>m(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"List required follow-up actions (one per line)"})]}),d.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[d.jsx("button",{type:"button",onClick:s,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",children:"Cancel"}),d.jsx("button",{type:"submit",disabled:u,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:u?"Submitting...":"Submit Response"})]})]})]})]})})},Rs=({projectId:e,onClose:t,onSuccess:s})=>{const[a,n]=r.useState({title:"",description:"",type:"product_data",category:"general",discipline:"",specification:"",priority:fs.MEDIUM,dueDate:new Date(Date.now()+12096e5).toISOString().split("T")[0],copies:"1",deliveryMethod:"electronic"}),[i,o]=r.useState(!1);return d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:d.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[d.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:d.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Create New Submittal"})}),d.jsxs("form",{onSubmit:async t=>{t.preventDefault(),o(!0);try{await vs.createSubmittal(e,{...a,dueDate:new Date(a.dueDate),copies:parseInt(a.copies)}),s()}catch(r){console.error("Error creating submittal:",r)}finally{o(!1)}},className:"p-6 space-y-4",children:[d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[d.jsxs("div",{className:"md:col-span-2",children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Title *"}),d.jsx("input",{type:"text",required:!0,value:a.title,onChange:e=>n({...a,title:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Submittal title"})]}),d.jsxs("div",{className:"md:col-span-2",children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),d.jsx("textarea",{value:a.description,onChange:e=>n({...a,description:e.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Detailed description of the submittal"})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Type"}),d.jsxs("select",{value:a.type,onChange:e=>n({...a,type:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[d.jsx("option",{value:"shop_drawings",children:"Shop Drawings"}),d.jsx("option",{value:"product_data",children:"Product Data"}),d.jsx("option",{value:"samples",children:"Samples"}),d.jsx("option",{value:"certificates",children:"Certificates"}),d.jsx("option",{value:"test_reports",children:"Test Reports"}),d.jsx("option",{value:"operation_manuals",children:"Operation Manuals"}),d.jsx("option",{value:"warranty",children:"Warranty"}),d.jsx("option",{value:"other",children:"Other"})]})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category"}),d.jsxs("select",{value:a.category,onChange:e=>n({...a,category:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[d.jsx("option",{value:"architectural",children:"Architectural"}),d.jsx("option",{value:"structural",children:"Structural"}),d.jsx("option",{value:"mechanical",children:"Mechanical"}),d.jsx("option",{value:"electrical",children:"Electrical"}),d.jsx("option",{value:"plumbing",children:"Plumbing"}),d.jsx("option",{value:"fire_protection",children:"Fire Protection"}),d.jsx("option",{value:"specialty",children:"Specialty"}),d.jsx("option",{value:"general",children:"General"})]})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Discipline"}),d.jsx("input",{type:"text",value:a.discipline,onChange:e=>n({...a,discipline:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"e.g., HVAC, Electrical"})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Specification"}),d.jsx("input",{type:"text",value:a.specification,onChange:e=>n({...a,specification:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"e.g., 05 12 00"})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Priority"}),d.jsxs("select",{value:a.priority,onChange:e=>n({...a,priority:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[d.jsx("option",{value:fs.LOW,children:"Low"}),d.jsx("option",{value:fs.MEDIUM,children:"Medium"}),d.jsx("option",{value:fs.HIGH,children:"High"}),d.jsx("option",{value:fs.CRITICAL,children:"Critical"})]})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Due Date"}),d.jsx("input",{type:"date",value:a.dueDate,onChange:e=>n({...a,dueDate:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Copies Required"}),d.jsx("input",{type:"number",min:"1",value:a.copies,onChange:e=>n({...a,copies:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Delivery Method"}),d.jsxs("select",{value:a.deliveryMethod,onChange:e=>n({...a,deliveryMethod:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[d.jsx("option",{value:"electronic",children:"Electronic"}),d.jsx("option",{value:"hard_copy",children:"Hard Copy"}),d.jsx("option",{value:"both",children:"Both"})]})]})]}),d.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[d.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",children:"Cancel"}),d.jsx("button",{type:"submit",disabled:i,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:i?"Creating...":"Create Submittal"})]})]})]})})},Ms=({submittal:e,projectId:t,onClose:s,onSuccess:a})=>{const[n,i]=r.useState({status:"approved",comments:"",actionRequired:!1,actions:""}),[o,l]=r.useState(!1);return d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:d.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[d.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[d.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Review Submittal #",e.number]}),d.jsx("p",{className:"text-sm text-gray-600",children:e.title})]}),d.jsxs("div",{className:"p-6",children:[d.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg mb-6",children:[d.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Submittal Details:"}),d.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[d.jsxs("div",{children:[d.jsx("strong",{children:"Type:"})," ",e.type.replace("_"," ")]}),d.jsxs("div",{children:[d.jsx("strong",{children:"Specification:"})," ",e.specification]}),d.jsxs("div",{children:[d.jsx("strong",{children:"Discipline:"})," ",e.discipline]}),d.jsxs("div",{children:[d.jsx("strong",{children:"Due Date:"})," ",e.dueDate.toLocaleDateString()]})]}),d.jsx("p",{className:"text-gray-700 mt-2",children:e.description})]}),d.jsxs("form",{onSubmit:async s=>{s.preventDefault(),l(!0);try{await vs.reviewSubmittal(t,e.id,{...n,actions:n.actionRequired?n.actions.split("\n").filter(Boolean):[]}),a()}catch(r){console.error("Error reviewing submittal:",r)}finally{l(!1)}},className:"space-y-4",children:[d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Review Status *"}),d.jsxs("select",{required:!0,value:n.status,onChange:e=>i({...n,status:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[d.jsx("option",{value:"approved",children:"Approved"}),d.jsx("option",{value:"approved_with_comments",children:"Approved with Comments"}),d.jsx("option",{value:"rejected",children:"Rejected"}),d.jsx("option",{value:"revise_and_resubmit",children:"Revise and Resubmit"})]})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Comments *"}),d.jsx("textarea",{required:!0,value:n.comments,onChange:e=>i({...n,comments:e.target.value}),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Provide detailed review comments"})]}),d.jsxs("div",{className:"flex items-center",children:[d.jsx("input",{type:"checkbox",id:"actionRequired",checked:n.actionRequired,onChange:e=>i({...n,actionRequired:e.target.checked}),className:"rounded border-gray-300"}),d.jsx("label",{htmlFor:"actionRequired",className:"ml-2 text-sm text-gray-700",children:"Action items required"})]}),n.actionRequired&&d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Action Items"}),d.jsx("textarea",{value:n.actions,onChange:e=>i({...n,actions:e.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"List required action items (one per line)"})]}),d.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[d.jsx("button",{type:"button",onClick:s,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",children:"Cancel"}),d.jsx("button",{type:"submit",disabled:o,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:o?"Submitting...":"Submit Review"})]})]})]})]})})},Ps=({projectId:e,onClose:t,onSuccess:s})=>{const[a,n]=r.useState({title:"",description:"",type:"addition",reason:"scope_change",priority:fs.MEDIUM,costImpact:"",scheduleImpact:"",justification:"",assignedTo:""}),[i,o]=r.useState(!1);return d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:d.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[d.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:d.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Create New Change Order"})}),d.jsxs("form",{onSubmit:async t=>{t.preventDefault(),o(!0);try{await vs.createChangeOrder(e,{...a,costImpact:a.costImpact?parseFloat(a.costImpact):0,scheduleImpact:a.scheduleImpact?parseInt(a.scheduleImpact):0}),s()}catch(r){console.error("Error creating change order:",r)}finally{o(!1)}},className:"p-6 space-y-4",children:[d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[d.jsxs("div",{className:"md:col-span-2",children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Title *"}),d.jsx("input",{type:"text",required:!0,value:a.title,onChange:e=>n({...a,title:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Brief description of the change"})]}),d.jsxs("div",{className:"md:col-span-2",children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),d.jsx("textarea",{value:a.description,onChange:e=>n({...a,description:e.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Detailed description of the change"})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Type"}),d.jsxs("select",{value:a.type,onChange:e=>n({...a,type:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[d.jsx("option",{value:"addition",children:"Addition"}),d.jsx("option",{value:"deletion",children:"Deletion"}),d.jsx("option",{value:"modification",children:"Modification"}),d.jsx("option",{value:"time_extension",children:"Time Extension"}),d.jsx("option",{value:"credit",children:"Credit"})]})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reason"}),d.jsxs("select",{value:a.reason,onChange:e=>n({...a,reason:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[d.jsx("option",{value:"design_change",children:"Design Change"}),d.jsx("option",{value:"scope_change",children:"Scope Change"}),d.jsx("option",{value:"unforeseen_conditions",children:"Unforeseen Conditions"}),d.jsx("option",{value:"owner_request",children:"Owner Request"}),d.jsx("option",{value:"regulatory_change",children:"Regulatory Change"}),d.jsx("option",{value:"material_substitution",children:"Material Substitution"}),d.jsx("option",{value:"error_omission",children:"Error/Omission"}),d.jsx("option",{value:"value_engineering",children:"Value Engineering"})]})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Priority"}),d.jsxs("select",{value:a.priority,onChange:e=>n({...a,priority:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[d.jsx("option",{value:fs.LOW,children:"Low"}),d.jsx("option",{value:fs.MEDIUM,children:"Medium"}),d.jsx("option",{value:fs.HIGH,children:"High"}),d.jsx("option",{value:fs.CRITICAL,children:"Critical"})]})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Assigned To"}),d.jsx("input",{type:"text",value:a.assignedTo,onChange:e=>n({...a,assignedTo:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Person responsible for review"})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cost Impact ($)"}),d.jsx("input",{type:"number",step:"0.01",value:a.costImpact,onChange:e=>n({...a,costImpact:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Positive for cost increase, negative for savings"})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Schedule Impact (days)"}),d.jsx("input",{type:"number",value:a.scheduleImpact,onChange:e=>n({...a,scheduleImpact:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Positive for delay, negative for acceleration"})]}),d.jsxs("div",{className:"md:col-span-2",children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Justification *"}),d.jsx("textarea",{required:!0,value:a.justification,onChange:e=>n({...a,justification:e.target.value}),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Detailed justification for the change order"})]})]}),d.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[d.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",children:"Cancel"}),d.jsx("button",{type:"submit",disabled:i,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:i?"Creating...":"Create Change Order"})]})]})]})})},Os=({changeOrder:e,projectId:t,onClose:s,onSuccess:a})=>{const[n,i]=r.useState({status:"approved",comments:"",conditions:""}),[o,l]=r.useState(!1);return d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:d.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[d.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[d.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Approve Change Order #",e.number]}),d.jsx("p",{className:"text-sm text-gray-600",children:e.title})]}),d.jsxs("div",{className:"p-6",children:[d.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg mb-6",children:[d.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Change Order Summary:"}),d.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm mb-3",children:[d.jsxs("div",{children:[d.jsx("strong",{children:"Type:"})," ",e.type.replace("_"," ")]}),d.jsxs("div",{children:[d.jsx("strong",{children:"Reason:"})," ",e.reason.replace("_"," ")]}),d.jsxs("div",{children:[d.jsx("strong",{children:"Cost Impact:"})," ",d.jsx("span",{className:e.costImpact>=0?"text-red-600":"text-green-600",children:(c=e.costImpact,new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(c))})]}),d.jsxs("div",{children:[d.jsx("strong",{children:"Schedule Impact:"})," ",d.jsxs("span",{className:e.scheduleImpact>0?"text-red-600":e.scheduleImpact<0?"text-green-600":"text-gray-900",children:[e.scheduleImpact>0?"+":"",e.scheduleImpact," days"]})]})]}),d.jsxs("p",{className:"text-gray-700",children:[d.jsx("strong",{children:"Description:"})," ",e.description]}),d.jsxs("p",{className:"text-gray-700 mt-2",children:[d.jsx("strong",{children:"Justification:"})," ",e.justification]})]}),d.jsxs("form",{onSubmit:async s=>{s.preventDefault(),l(!0);try{await vs.approveChangeOrder(t,e.id,{...n,conditions:n.conditions?n.conditions.split("\n").filter(Boolean):[]}),a()}catch(r){console.error("Error approving change order:",r)}finally{l(!1)}},className:"space-y-4",children:[d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Approval Status *"}),d.jsxs("select",{required:!0,value:n.status,onChange:e=>i({...n,status:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[d.jsx("option",{value:"approved",children:"Approved"}),d.jsx("option",{value:"rejected",children:"Rejected"}),d.jsx("option",{value:"conditional",children:"Conditional Approval"})]})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Comments *"}),d.jsx("textarea",{required:!0,value:n.comments,onChange:e=>i({...n,comments:e.target.value}),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Provide detailed approval comments"})]}),"conditional"===n.status&&d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Conditions"}),d.jsx("textarea",{value:n.conditions,onChange:e=>i({...n,conditions:e.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"List approval conditions (one per line)"})]}),d.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[d.jsx("button",{type:"button",onClick:s,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",children:"Cancel"}),d.jsx("button",{type:"submit",disabled:o,className:"px-4 py-2 text-white rounded-lg disabled:opacity-50 "+("approved"===n.status?"bg-green-600 hover:bg-green-700":"rejected"===n.status?"bg-red-600 hover:bg-red-700":"bg-yellow-600 hover:bg-yellow-700"),children:o?"Submitting...":""+("approved"===n.status?"Approve":"rejected"===n.status?"Reject":"Conditionally Approve")})]})]})]})]})});var c};const _s=new class{constructor(){this.baseUrl="/api/analytics"}async getProjectMetrics(e,t){try{const s=new URLSearchParams;t&&(s.append("start",t.dateRange.start.toISOString()),s.append("end",t.dateRange.end.toISOString()),t.granularity&&s.append("granularity",t.granularity),t.metrics&&t.metrics.forEach(e=>s.append("metrics",e)));const r=await fetch(`${this.baseUrl}/projects/${e}/metrics?${s}`);if(!r.ok)throw new Error("Failed to fetch project metrics");return await r.json()}catch(s){return console.error("Error fetching project metrics:",s),this.getMockProjectMetrics(e)}}async getBudgetAnalysis(e){try{const t=await fetch(`${this.baseUrl}/projects/${e}/budget`);if(!t.ok)throw new Error("Failed to fetch budget analysis");return await t.json()}catch(t){return console.error("Error fetching budget analysis:",t),this.getMockBudgetMetrics()}}async getScheduleAnalysis(e){try{const t=await fetch(`${this.baseUrl}/projects/${e}/schedule`);if(!t.ok)throw new Error("Failed to fetch schedule analysis");return await t.json()}catch(t){return console.error("Error fetching schedule analysis:",t),this.getMockScheduleMetrics()}}async getQualityMetrics(e){try{const t=await fetch(`${this.baseUrl}/projects/${e}/quality`);if(!t.ok)throw new Error("Failed to fetch quality metrics");return await t.json()}catch(t){return console.error("Error fetching quality metrics:",t),this.getMockQualityMetrics()}}async getSafetyMetrics(e){try{const t=await fetch(`${this.baseUrl}/projects/${e}/safety`);if(!t.ok)throw new Error("Failed to fetch safety metrics");return await t.json()}catch(t){return console.error("Error fetching safety metrics:",t),this.getMockSafetyMetrics()}}async getProductivityMetrics(e){try{const t=await fetch(`${this.baseUrl}/projects/${e}/productivity`);if(!t.ok)throw new Error("Failed to fetch productivity metrics");return await t.json()}catch(t){return console.error("Error fetching productivity metrics:",t),this.getMockProductivityMetrics()}}async getRiskAnalysis(e){try{const t=await fetch(`${this.baseUrl}/projects/${e}/risks`);if(!t.ok)throw new Error("Failed to fetch risk analysis");return await t.json()}catch(t){return console.error("Error fetching risk analysis:",t),this.getMockRiskMetrics()}}async getTeamMetrics(e){try{const t=await fetch(`${this.baseUrl}/projects/${e}/team`);if(!t.ok)throw new Error("Failed to fetch team metrics");return await t.json()}catch(t){return console.error("Error fetching team metrics:",t),this.getMockTeamMetrics()}}async getDashboardWidgets(e){try{const t=await fetch(`${this.baseUrl}/projects/${e}/dashboard`);if(!t.ok)throw new Error("Failed to fetch dashboard widgets");return await t.json()}catch(t){return console.error("Error fetching dashboard widgets:",t),this.getMockDashboardWidgets()}}async updateDashboardWidget(e,t,s){try{const r=await fetch(`${this.baseUrl}/projects/${e}/dashboard/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!r.ok)throw new Error("Failed to update dashboard widget");return await r.json()}catch(r){return console.error("Error updating dashboard widget:",r),this.getMockDashboardWidgets()[0]}}getMockProjectMetrics(e){const t=new Date,s=[];for(let r=30;r>=0;r--){const a=new Date(t.getTime()-24*r*60*60*1e3);s.push({id:`metrics-${r}`,projectId:e,date:a,budget:this.getMockBudgetMetrics(),schedule:this.getMockScheduleMetrics(),quality:this.getMockQualityMetrics(),safety:this.getMockSafetyMetrics(),productivity:this.getMockProductivityMetrics(),risks:this.getMockRiskMetrics(),team:this.getMockTeamMetrics()})}return s}getMockBudgetMetrics(){return{totalBudget:25e5,spentToDate:175e4,committedCosts:2e5,forecastAtCompletion:245e4,varianceAtCompletion:-5e4,costPerformanceIndex:1.02,budgetPerformanceIndex:.98,earnedValue:18e5,plannedValue:185e4,actualCost:175e4,costByCategory:{Labor:85e4,Materials:65e4,Equipment:15e4,Subcontractors:1e5},changeOrderValue:75e3,contingencyUsed:125e3,contingencyRemaining:125e3}}getMockScheduleMetrics(){return{totalDuration:365,elapsedDays:245,remainingDays:125,percentComplete:67,schedulePerformanceIndex:.97,criticalPathDelay:5,milestonesTotal:12,milestonesCompleted:8,milestonesOverdue:1,tasksTotal:156,tasksCompleted:104,tasksInProgress:28,tasksOverdue:8,forecastCompletion:new Date(Date.now()+11232e6),originalCompletion:new Date(Date.now()+108e8),scheduleVariance:5}}getMockQualityMetrics(){return{inspectionsPassed:45,inspectionsFailed:3,inspectionsTotal:48,defectRate:2.1,reworkHours:120,reworkCost:15e3,qualityScore:94,punchListItems:23,punchListResolved:18,nonConformanceReports:2,customerSatisfactionScore:4.6,qualityTrends:[{date:new Date(Date.now()-2592e6),score:92,defectRate:2.5,inspectionPassRate:92},{date:new Date(Date.now()-1296e6),score:93,defectRate:2.3,inspectionPassRate:94},{date:new Date,score:94,defectRate:2.1,inspectionPassRate:94}]}}getMockSafetyMetrics(){return{incidentRate:.8,nearMissReports:12,safetyTrainingHours:480,safetyInspections:24,safetyViolations:3,daysWithoutIncident:45,safetyScore:96,ppeComplianceRate:98,safetyMeetingsHeld:16,hazardsIdentified:28,hazardsResolved:25}}getMockProductivityMetrics(){return{laborHoursPlanned:12e3,laborHoursActual:11800,laborEfficiency:102,equipmentUtilization:87,materialWastePercentage:3.2,dailyProductionRate:95,unitsCompleted:2340,unitsPlanned:2400,productivityTrends:[{date:new Date(Date.now()-2592e6),efficiency:98,outputRate:92,laborHours:400},{date:new Date(Date.now()-1296e6),efficiency:100,outputRate:94,laborHours:420},{date:new Date,efficiency:102,outputRate:95,laborHours:380}],teamProductivity:{"team-1":105,"team-2":98,"team-3":103}}}getMockRiskMetrics(){return{totalRisks:18,highRisks:2,mediumRisks:8,lowRisks:8,mitigatedRisks:12,riskScore:24,riskTrends:[{date:new Date(Date.now()-2592e6),totalRisks:22,riskScore:32,mitigatedRisks:8},{date:new Date(Date.now()-1296e6),totalRisks:20,riskScore:28,mitigatedRisks:10},{date:new Date,totalRisks:18,riskScore:24,mitigatedRisks:12}],topRisks:[{id:"risk-1",title:"Weather delays",probability:.7,impact:.8,riskScore:.56,status:"open",category:"Schedule"},{id:"risk-2",title:"Material price increase",probability:.6,impact:.7,riskScore:.42,status:"mitigated",category:"Cost"}]}}getMockTeamMetrics(){return{totalMembers:45,activeMembers:42,utilizationRate:89,overtimeHours:240,absenteeismRate:3.2,turnoverRate:8.5,trainingHours:180,performanceScore:87,teamSatisfaction:4.2,skillsGapAnalysis:[{skill:"Advanced Welding",required:8,current:6,gap:2},{skill:"Project Management",required:5,current:3,gap:2},{skill:"Safety Training",required:45,current:42,gap:3}]}}getMockDashboardWidgets(){return[{id:"budget-overview",type:"chart",title:"Budget Performance",data:{planned:185e4,actual:175e4,forecast:245e4},config:{chartType:"bar",showTrend:!0,size:"medium"}},{id:"schedule-progress",type:"gauge",title:"Schedule Progress",data:{value:67,target:70},config:{thresholds:{warning:60,critical:50},size:"small"}},{id:"quality-score",type:"metric",title:"Quality Score",data:{value:94,trend:2,previous:92},config:{showTrend:!0,size:"small"}}]}},Ls=({projectId:e,userId:t})=>{const[s,a]=r.useState(!0),[n,i]=r.useState("overview"),[o,l]=r.useState({start:new Date(Date.now()-2592e6),end:new Date}),[c,m]=r.useState({budget:null,schedule:null,quality:null,safety:null,productivity:null,risks:null,team:null}),[u,h]=r.useState([]);r.useEffect(()=>{p()},[e,o]);const p=async()=>{a(!0);try{const[t,s,r,a,n,i,o,l]=await Promise.all([_s.getBudgetAnalysis(e),_s.getScheduleAnalysis(e),_s.getQualityMetrics(e),_s.getSafetyMetrics(e),_s.getProductivityMetrics(e),_s.getRiskAnalysis(e),_s.getTeamMetrics(e),_s.getDashboardWidgets(e)]);m({budget:t,schedule:s,quality:r,safety:a,productivity:n,risks:i,team:o}),h(l)}catch(t){console.error("Error loading analytics data:",t)}finally{a(!1)}},x=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),g=e=>`${e.toFixed(1)}%`,y=(e,t)=>e>=t.good?"text-green-600":e>=t.warning?"text-yellow-600":"text-red-600",f=[{id:"overview",label:"Overview",icon:ot},{id:"budget",label:"Budget",icon:xt},{id:"schedule",label:"Schedule",icon:ht},{id:"quality",label:"Quality",icon:Bt},{id:"safety",label:"Safety",icon:Vt},{id:"productivity",label:"Productivity",icon:st},{id:"risks",label:"Risks",icon:Qt},{id:"team",label:"Team",icon:Kt}];return s?d.jsxs("div",{className:"flex items-center justify-center h-64",children:[d.jsx(Ot,{className:"w-8 h-8 animate-spin text-blue-600"}),d.jsx("span",{className:"ml-2 text-gray-600",children:"Loading analytics..."})]}):d.jsxs("div",{className:"bg-white rounded-lg shadow-lg",children:[d.jsx("div",{className:"border-b border-gray-200 px-6 py-4",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Project Analytics"}),d.jsx("p",{className:"text-gray-600",children:"Real-time insights and performance metrics"})]}),d.jsxs("div",{className:"flex items-center space-x-3",children:[d.jsxs("div",{className:"flex items-center space-x-2",children:[d.jsx("label",{className:"text-sm text-gray-600",children:"From:"}),d.jsx("input",{type:"date",value:o.start.toISOString().split("T")[0],onChange:e=>l({...o,start:new Date(e.target.value)}),className:"px-2 py-1 border border-gray-300 rounded text-sm"}),d.jsx("label",{className:"text-sm text-gray-600",children:"To:"}),d.jsx("input",{type:"date",value:o.end.toISOString().split("T")[0],onChange:e=>l({...o,end:new Date(e.target.value)}),className:"px-2 py-1 border border-gray-300 rounded text-sm"})]}),d.jsxs("button",{onClick:p,className:"flex items-center px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:[d.jsx(Ot,{className:"w-4 h-4 mr-2"}),"Refresh"]}),d.jsxs("button",{className:"flex items-center px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[d.jsx(gt,{className:"w-4 h-4 mr-2"}),"Export"]})]})]})}),d.jsx("div",{className:"border-b border-gray-200",children:d.jsx("nav",{className:"flex space-x-8 px-6",children:f.map(e=>{const t=e.icon;return d.jsxs("button",{onClick:()=>i(e.id),className:"flex items-center py-4 px-1 border-b-2 font-medium text-sm "+(n===e.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[d.jsx(t,{className:"w-4 h-4 mr-2"}),e.label]},e.id)})})}),d.jsxs("div",{className:"p-6",children:["overview"===n&&d.jsx($s,{metrics:c,formatCurrency:x,formatPercentage:g,getHealthColor:y}),"budget"===n&&c.budget&&d.jsx(Us,{budget:c.budget,formatCurrency:x,getHealthColor:y}),"schedule"===n&&c.schedule&&d.jsx(Fs,{schedule:c.schedule,formatPercentage:g,getHealthColor:y}),"quality"===n&&c.quality&&d.jsx(Vs,{quality:c.quality,formatPercentage:g,getHealthColor:y}),"safety"===n&&c.safety&&d.jsx(qs,{safety:c.safety,formatPercentage:g,getHealthColor:y}),"productivity"===n&&c.productivity&&d.jsx(Hs,{productivity:c.productivity,formatPercentage:g,getHealthColor:y}),"risks"===n&&c.risks&&d.jsx(Ws,{risks:c.risks,getHealthColor:y}),"team"===n&&c.team&&d.jsx(Bs,{team:c.team,formatPercentage:g,getHealthColor:y})]})]})},$s=({metrics:e,formatCurrency:t,formatPercentage:s,getHealthColor:r})=>{const a=[{title:"Budget Performance",value:e.budget?s(e.budget.earnedValue/e.budget.actualCost*100):"N/A",trend:e.budget?e.budget.costPerformanceIndex>1?"up":"down":"neutral",color:e.budget?r(100*e.budget.costPerformanceIndex,{good:100,warning:95}):"text-gray-600",icon:xt,subtitle:e.budget?`CPI: ${e.budget.costPerformanceIndex.toFixed(2)}`:""},{title:"Schedule Progress",value:e.schedule?s(e.schedule.percentComplete):"N/A",trend:e.schedule?e.schedule.schedulePerformanceIndex>1?"up":"down":"neutral",color:e.schedule?r(100*e.schedule.schedulePerformanceIndex,{good:100,warning:95}):"text-gray-600",icon:ht,subtitle:e.schedule?`SPI: ${e.schedule.schedulePerformanceIndex.toFixed(2)}`:""},{title:"Quality Score",value:e.quality?`${e.quality.qualityScore}/100`:"N/A",trend:"up",color:e.quality?r(e.quality.qualityScore,{good:90,warning:80}):"text-gray-600",icon:Bt,subtitle:e.quality?`${s(e.quality.inspectionsPassed/e.quality.inspectionsTotal*100)} pass rate`:""},{title:"Safety Score",value:e.safety?`${e.safety.safetyScore}/100`:"N/A",trend:"up",color:e.safety?r(e.safety.safetyScore,{good:95,warning:90}):"text-gray-600",icon:Vt,subtitle:e.safety?`${e.safety.daysWithoutIncident} days incident-free`:""},{title:"Team Productivity",value:e.productivity?s(e.productivity.laborEfficiency):"N/A",trend:e.productivity?e.productivity.laborEfficiency>100?"up":"down":"neutral",color:e.productivity?r(e.productivity.laborEfficiency,{good:100,warning:95}):"text-gray-600",icon:st,subtitle:e.team?`${e.team.activeMembers}/${e.team.totalMembers} active`:""},{title:"Risk Level",value:e.risks?`${e.risks.riskScore}/100`:"N/A",trend:"down",color:e.risks?r(100-e.risks.riskScore,{good:80,warning:60}):"text-gray-600",icon:Qt,subtitle:e.risks?`${e.risks.highRisks} high risks`:""}];return d.jsxs("div",{className:"space-y-6",children:[d.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:a.map((e,t)=>{const s=e.icon,r="up"===e.trend?Jt:"down"===e.trend?Gt:st;return d.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow",children:[d.jsxs("div",{className:"flex items-center justify-between mb-4",children:[d.jsxs("div",{className:"flex items-center",children:[d.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:d.jsx(s,{className:"w-5 h-5 text-blue-600"})}),d.jsx("h3",{className:"ml-3 text-sm font-medium text-gray-900",children:e.title})]}),d.jsx(r,{className:`w-4 h-4 ${e.color}`})]}),d.jsxs("div",{className:"space-y-1",children:[d.jsx("p",{className:`text-2xl font-bold ${e.color}`,children:e.value}),e.subtitle&&d.jsx("p",{className:"text-sm text-gray-600",children:e.subtitle})]})]},t)})}),d.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[d.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[d.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Project Health Summary"}),d.jsxs("div",{className:"space-y-3",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("span",{className:"text-sm text-gray-600",children:"Overall Health"}),d.jsx("span",{className:"text-sm font-medium text-green-600",children:"Good"})]}),d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("span",{className:"text-sm text-gray-600",children:"Budget Variance"}),d.jsx("span",{className:"text-sm font-medium text-green-600",children:e.budget?t(e.budget.varianceAtCompletion):"N/A"})]}),d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("span",{className:"text-sm text-gray-600",children:"Schedule Variance"}),d.jsx("span",{className:"text-sm font-medium text-red-600",children:e.schedule?`${e.schedule.scheduleVariance} days`:"N/A"})]}),d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("span",{className:"text-sm text-gray-600",children:"Open Issues"}),d.jsx("span",{className:"text-sm font-medium text-yellow-600",children:e.quality?e.quality.punchListItems:"N/A"})]})]})]}),d.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[d.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Recent Activity"}),d.jsxs("div",{className:"space-y-3",children:[d.jsxs("div",{className:"flex items-center",children:[d.jsx(dt,{className:"w-4 h-4 text-green-600 mr-3"}),d.jsx("span",{className:"text-sm text-gray-900",children:"Foundation inspection passed"}),d.jsx("span",{className:"text-xs text-gray-500 ml-auto",children:"2 hours ago"})]}),d.jsxs("div",{className:"flex items-center",children:[d.jsx(Qt,{className:"w-4 h-4 text-yellow-600 mr-3"}),d.jsx("span",{className:"text-sm text-gray-900",children:"Material delivery delayed"}),d.jsx("span",{className:"text-xs text-gray-500 ml-auto",children:"4 hours ago"})]}),d.jsxs("div",{className:"flex items-center",children:[d.jsx(dt,{className:"w-4 h-4 text-green-600 mr-3"}),d.jsx("span",{className:"text-sm text-gray-900",children:"Safety training completed"}),d.jsx("span",{className:"text-xs text-gray-500 ml-auto",children:"1 day ago"})]}),d.jsxs("div",{className:"flex items-center",children:[d.jsx(st,{className:"w-4 h-4 text-blue-600 mr-3"}),d.jsx("span",{className:"text-sm text-gray-900",children:"Weekly progress report generated"}),d.jsx("span",{className:"text-xs text-gray-500 ml-auto",children:"2 days ago"})]})]})]})]})]})},Us=({budget:e})=>d.jsxs("div",{className:"text-center py-8",children:[d.jsx(xt,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),d.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Budget Analytics"}),d.jsx("p",{className:"text-gray-600",children:"Detailed budget analysis will be implemented next"}),d.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["Total Budget: ",e?`$${e.totalBudget.toLocaleString()}`:"N/A"]})]}),Fs=({schedule:e})=>d.jsxs("div",{className:"text-center py-8",children:[d.jsx(ht,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),d.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Schedule Analytics"}),d.jsx("p",{className:"text-gray-600",children:"Detailed schedule analysis will be implemented next"}),d.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["Progress: ",e?`${e.percentComplete}%`:"N/A"]})]}),Vs=({quality:e})=>d.jsxs("div",{className:"text-center py-8",children:[d.jsx(Bt,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),d.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Quality Analytics"}),d.jsx("p",{className:"text-gray-600",children:"Detailed quality analysis will be implemented next"}),d.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["Quality Score: ",e?`${e.qualityScore}/100`:"N/A"]})]}),qs=({safety:e})=>d.jsxs("div",{className:"text-center py-8",children:[d.jsx(Vt,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),d.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Safety Analytics"}),d.jsx("p",{className:"text-gray-600",children:"Detailed safety analysis will be implemented next"}),d.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["Safety Score: ",e?`${e.safetyScore}/100`:"N/A"]})]}),Hs=({productivity:e})=>d.jsxs("div",{className:"text-center py-8",children:[d.jsx(st,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),d.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Productivity Analytics"}),d.jsx("p",{className:"text-gray-600",children:"Detailed productivity analysis will be implemented next"}),d.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["Efficiency: ",e?`${e.laborEfficiency}%`:"N/A"]})]}),Ws=({risks:e})=>d.jsxs("div",{className:"text-center py-8",children:[d.jsx(Qt,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),d.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Risk Analytics"}),d.jsx("p",{className:"text-gray-600",children:"Detailed risk analysis will be implemented next"}),d.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["Total Risks: ",e?e.totalRisks:"N/A"]})]}),Bs=({team:e})=>d.jsxs("div",{className:"text-center py-8",children:[d.jsx(Kt,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),d.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Team Analytics"}),d.jsx("p",{className:"text-gray-600",children:"Detailed team analysis will be implemented next"}),d.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["Team Members: ",e?`${e.activeMembers}/${e.totalMembers}`:"N/A"]})]}),zs=({projectId:e,userId:t})=>{const[s,a]=r.useState("dashboard"),[n,i]=r.useState(!0),[o,l]=r.useState([]),[c,m]=r.useState(null),[u,h]=r.useState(!1),[p,x]=r.useState({start:new Date(Date.now()-2592e6),end:new Date}),[g,y]=r.useState(null);r.useEffect(()=>{f()},[e,p]);const f=async()=>{i(!0);try{const[t,s,r,a,n]=await Promise.all([_s.getBudgetAnalysis(e),_s.getScheduleAnalysis(e),_s.getQualityMetrics(e),_s.getSafetyMetrics(e),_s.getProductivityMetrics(e)]),i={labels:["Planned","Actual","Forecast"],datasets:[{label:"Budget ($)",data:[t.plannedValue,t.actualCost,t.forecastAtCompletion],backgroundColor:["#3B82F6","#EF4444","#F59E0B"],borderWidth:1}]},o={labels:["Completed","In Progress","Not Started","Overdue"],datasets:[{label:"Tasks",data:[s.tasksCompleted,s.tasksInProgress,s.tasksTotal-s.tasksCompleted-s.tasksInProgress,s.tasksOverdue],backgroundColor:["#10B981","#3B82F6","#6B7280","#EF4444"]}]},c={labels:["Passed","Failed"],datasets:[{label:"Inspections",data:[r.inspectionsPassed,r.inspectionsFailed],backgroundColor:["#10B981","#EF4444"]}]},d={labels:["Safety Score","PPE Compliance","Training Completion"],datasets:[{label:"Safety Metrics (%)",data:[a.safetyScore,a.ppeComplianceRate,85],backgroundColor:["#10B981","#3B82F6","#F59E0B"]}]},m={labels:["Week 1","Week 2","Week 3","Week 4"],datasets:[{label:"Labor Efficiency (%)",data:[98,102,105,n.laborEfficiency],borderColor:"#3B82F6",backgroundColor:"rgba(59, 130, 246, 0.1)",borderWidth:2}]};y({budgetChart:i,scheduleChart:o,qualityChart:c,safetyChart:d,productivityChart:m,summaryMetrics:{totalBudget:t.totalBudget,budgetVariance:t.varianceAtCompletion,scheduleProgress:s.percentComplete,qualityScore:r.qualityScore,safetyScore:a.safetyScore,productivity:n.laborEfficiency}}),l(b())}catch(t){console.error("Error loading reporting data:",t)}finally{i(!1)}},b=()=>[{id:"report-1",name:"Weekly Progress Report",description:"Comprehensive weekly project progress summary",type:"custom",chartType:"bar",dateRange:{start:new Date(Date.now()-6048e5),end:new Date},filters:{},data:{},createdBy:t,createdAt:new Date(Date.now()-6048e5),lastRun:new Date,isScheduled:!0,scheduleFrequency:"weekly"},{id:"report-2",name:"Budget Variance Analysis",description:"Detailed budget performance and variance analysis",type:"budget",chartType:"line",dateRange:{start:new Date(Date.now()-2592e6),end:new Date},filters:{},data:{},createdBy:t,createdAt:new Date(Date.now()-12096e5),lastRun:new Date(Date.now()-864e5),isScheduled:!1},{id:"report-3",name:"Safety Performance Dashboard",description:"Safety metrics and incident tracking report",type:"safety",chartType:"pie",dateRange:{start:new Date(Date.now()-2592e6),end:new Date},filters:{},data:{},createdBy:t,createdAt:new Date(Date.now()-18144e5),lastRun:new Date(Date.now()-1728e5),isScheduled:!0,scheduleFrequency:"monthly"}],j=e=>{const t=c||{name:"Dashboard Report"};console.log(`Exporting ${t.name} as ${e.toUpperCase()}`);const s=document.createElement("a"),r=new Blob([`Mock ${e.toUpperCase()} export data for ${t.name}`],{type:"text/plain"});s.href=URL.createObjectURL(r),s.download=`${t.name.replace(/\s+/g,"_")}.${e}`,document.body.appendChild(s),s.click(),document.body.removeChild(s)},w=[{id:"dashboard",label:"Dashboard",icon:ot},{id:"reports",label:"Reports",icon:bt},{id:"custom",label:"Custom Reports",icon:Ut},{id:"scheduled",label:"Scheduled",icon:nt}];return n?d.jsxs("div",{className:"flex items-center justify-center h-64",children:[d.jsx(Ot,{className:"w-8 h-8 animate-spin text-blue-600"}),d.jsx("span",{className:"ml-2 text-gray-600",children:"Loading reports..."})]}):d.jsxs("div",{className:"bg-white rounded-lg shadow-lg",children:[d.jsx("div",{className:"border-b border-gray-200 px-6 py-4",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Advanced Reporting"}),d.jsx("p",{className:"text-gray-600",children:"Comprehensive analytics and custom reports"})]}),d.jsxs("div",{className:"flex items-center space-x-3",children:[d.jsxs("div",{className:"flex items-center space-x-2",children:[d.jsx("label",{className:"text-sm text-gray-600",children:"From:"}),d.jsx("input",{type:"date",value:p.start.toISOString().split("T")[0],onChange:e=>x({...p,start:new Date(e.target.value)}),className:"px-2 py-1 border border-gray-300 rounded text-sm"}),d.jsx("label",{className:"text-sm text-gray-600",children:"To:"}),d.jsx("input",{type:"date",value:p.end.toISOString().split("T")[0],onChange:e=>x({...p,end:new Date(e.target.value)}),className:"px-2 py-1 border border-gray-300 rounded text-sm"})]}),d.jsxs("button",{onClick:()=>h(!0),className:"flex items-center px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[d.jsx(Mt,{className:"w-4 h-4 mr-2"}),"New Report"]}),d.jsxs("div",{className:"relative",children:[d.jsxs("button",{className:"flex items-center px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:[d.jsx(gt,{className:"w-4 h-4 mr-2"}),"Export"]}),d.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-white border border-gray-200 rounded-lg shadow-lg z-10 hidden group-hover:block",children:[d.jsx("button",{onClick:()=>j("pdf"),className:"w-full text-left px-4 py-2 hover:bg-gray-50",children:"Export as PDF"}),d.jsx("button",{onClick:()=>j("excel"),className:"w-full text-left px-4 py-2 hover:bg-gray-50",children:"Export as Excel"}),d.jsx("button",{onClick:()=>j("csv"),className:"w-full text-left px-4 py-2 hover:bg-gray-50",children:"Export as CSV"})]})]})]})]})}),d.jsx("div",{className:"border-b border-gray-200",children:d.jsx("nav",{className:"flex space-x-8 px-6",children:w.map(e=>{const t=e.icon;return d.jsxs("button",{onClick:()=>a(e.id),className:"flex items-center py-4 px-1 border-b-2 font-medium text-sm "+(s===e.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[d.jsx(t,{className:"w-4 h-4 mr-2"}),e.label]},e.id)})})}),d.jsxs("div",{className:"p-6",children:["dashboard"===s&&g&&d.jsx(Gs,{data:g,onExport:j}),"reports"===s&&d.jsx(Ys,{reports:o,onSelectReport:m,onExport:j}),"custom"===s&&d.jsx(Ks,{onCreateReport:()=>h(!0)}),"scheduled"===s&&d.jsx(Zs,{reports:o.filter(e=>e.isScheduled)})]}),u&&d.jsx(Xs,{projectId:e,onClose:()=>h(!1),onSuccess:e=>{l([...o,e]),h(!1)}})]})},Gs=({data:e,onExport:t})=>d.jsxs("div",{className:"space-y-6",children:[d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[d.jsx(Js,{title:"Total Budget",value:`$${e.summaryMetrics.totalBudget.toLocaleString()}`,change:e.summaryMetrics.budgetVariance,icon:xt,color:"blue"}),d.jsx(Js,{title:"Schedule Progress",value:`${e.summaryMetrics.scheduleProgress}%`,change:2.5,icon:ht,color:"green"}),d.jsx(Js,{title:"Quality Score",value:`${e.summaryMetrics.qualityScore}/100`,change:1.2,icon:Bt,color:"purple"})]}),d.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[d.jsx(Qs,{title:"Budget Performance",chartType:"bar",data:e.budgetChart}),d.jsx(Qs,{title:"Schedule Status",chartType:"pie",data:e.scheduleChart}),d.jsx(Qs,{title:"Quality Metrics",chartType:"pie",data:e.qualityChart}),d.jsx(Qs,{title:"Productivity Trend",chartType:"line",data:e.productivityChart})]})]}),Js=({title:e,value:t,change:s,icon:r,color:a})=>d.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("div",{className:`p-2 rounded-lg ${{blue:"bg-blue-100 text-blue-600",green:"bg-green-100 text-green-600",purple:"bg-purple-100 text-purple-600",red:"bg-red-100 text-red-600"}[a]}`,children:d.jsx(r,{className:"w-5 h-5"})}),d.jsxs("div",{className:"flex items-center text-sm "+(s>=0?"text-green-600":"text-red-600"),children:[s>=0?d.jsx(Jt,{className:"w-4 h-4 mr-1"}):d.jsx(Jt,{className:"w-4 h-4 mr-1 rotate-180"}),Math.abs(s),"%"]})]}),d.jsxs("div",{className:"mt-4",children:[d.jsx("h3",{className:"text-sm font-medium text-gray-600",children:e}),d.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:t})]})]}),Qs=({title:e,chartType:t,data:s})=>d.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[d.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:e}),d.jsx("div",{className:"h-64 flex items-center justify-center bg-gray-50 rounded-lg",children:d.jsxs("div",{className:"text-center",children:["bar"===t&&d.jsx(ot,{className:"w-16 h-16 text-gray-400 mx-auto mb-2"}),"line"===t&&d.jsx(lt,{className:"w-16 h-16 text-gray-400 mx-auto mb-2"}),"pie"===t&&d.jsx(ct,{className:"w-16 h-16 text-gray-400 mx-auto mb-2"}),d.jsxs("p",{className:"text-gray-600",children:[e," Chart"]}),d.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[s.datasets[0]?.data.length||0," data points"]})]})})]}),Ys=({reports:e,onSelectReport:t,onExport:s})=>d.jsxs("div",{className:"space-y-4",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Saved Reports"}),d.jsxs("button",{className:"flex items-center px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:[d.jsx(vt,{className:"w-4 h-4 mr-2"}),"Filter"]})]}),d.jsx("div",{className:"grid gap-4",children:e.map(e=>d.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:d.jsxs("div",{className:"flex items-start justify-between",children:[d.jsxs("div",{className:"flex-1",children:[d.jsx("h4",{className:"text-lg font-medium text-gray-900",children:e.name}),d.jsx("p",{className:"text-gray-600 mt-1",children:e.description}),d.jsxs("div",{className:"flex items-center space-x-4 mt-2 text-sm text-gray-500",children:[d.jsxs("span",{children:["Type: ",e.type]}),d.jsxs("span",{children:["Chart: ",e.chartType]}),d.jsxs("span",{children:["Last run: ",e.lastRun.toLocaleDateString()]}),e.isScheduled&&d.jsxs("span",{className:"inline-flex items-center px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs",children:[d.jsx(nt,{className:"w-3 h-3 mr-1"}),e.scheduleFrequency]})]})]}),d.jsxs("div",{className:"flex items-center space-x-2",children:[d.jsx("button",{onClick:()=>t(e),className:"p-2 text-blue-600 hover:text-blue-800",title:"View Report",children:d.jsx(ft,{className:"w-4 h-4"})}),d.jsx("button",{className:"p-2 text-gray-600 hover:text-gray-800",title:"Edit Report",children:d.jsx(Wt,{className:"w-4 h-4"})}),d.jsx("button",{className:"p-2 text-green-600 hover:text-green-800",title:"Share Report",children:d.jsx(Ft,{className:"w-4 h-4"})}),d.jsx("button",{className:"p-2 text-red-600 hover:text-red-800",title:"Delete Report",children:d.jsx(zt,{className:"w-4 h-4"})})]})]})},e.id))})]}),Ks=({onCreateReport:e})=>d.jsxs("div",{className:"text-center py-12",children:[d.jsx(bt,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),d.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Custom Report Builder"}),d.jsx("p",{className:"text-gray-600 mb-6",children:"Create custom reports with your own metrics and visualizations"}),d.jsxs("button",{onClick:e,className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[d.jsx(Mt,{className:"w-4 h-4 mr-2"}),"Create Custom Report"]})]}),Zs=({reports:e})=>d.jsxs("div",{className:"space-y-4",children:[d.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Scheduled Reports"}),0===e.length?d.jsxs("div",{className:"text-center py-12",children:[d.jsx(nt,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),d.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Scheduled Reports"}),d.jsx("p",{className:"text-gray-600",children:"Set up automatic report generation and delivery"})]}):d.jsx("div",{className:"grid gap-4",children:e.map(e=>d.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("h4",{className:"font-medium text-gray-900",children:e.name}),d.jsxs("p",{className:"text-sm text-gray-600",children:["Runs ",e.scheduleFrequency,"  Last run: ",e.lastRun.toLocaleDateString()]})]}),d.jsxs("div",{className:"flex items-center space-x-2",children:[d.jsx("span",{className:"inline-flex items-center px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs",children:"Active"}),d.jsx("button",{className:"p-1 text-gray-600 hover:text-gray-800",children:d.jsx(Ut,{className:"w-4 h-4"})})]})]})},e.id))})]}),Xs=({projectId:e,onClose:t,onSuccess:s})=>{const[a,n]=r.useState({name:"",description:"",type:"custom",chartType:"bar",isScheduled:!1,scheduleFrequency:"weekly"});return d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:d.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md mx-4",children:[d.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:d.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Create New Report"})}),d.jsxs("form",{onSubmit:e=>{e.preventDefault();const t={id:`report-${Date.now()}`,...a,dateRange:{start:new Date(Date.now()-2592e6),end:new Date},filters:{},data:{},createdBy:"current-user",createdAt:new Date,lastRun:new Date,scheduleFrequency:a.isScheduled?a.scheduleFrequency:void 0};s(t)},className:"p-6 space-y-4",children:[d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Report Name *"}),d.jsx("input",{type:"text",required:!0,value:a.name,onChange:e=>n({...a,name:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Enter report name"})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),d.jsx("textarea",{value:a.description,onChange:e=>n({...a,description:e.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Describe what this report shows"})]}),d.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Report Type"}),d.jsxs("select",{value:a.type,onChange:e=>n({...a,type:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[d.jsx("option",{value:"budget",children:"Budget"}),d.jsx("option",{value:"schedule",children:"Schedule"}),d.jsx("option",{value:"quality",children:"Quality"}),d.jsx("option",{value:"safety",children:"Safety"}),d.jsx("option",{value:"productivity",children:"Productivity"}),d.jsx("option",{value:"custom",children:"Custom"})]})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Chart Type"}),d.jsxs("select",{value:a.chartType,onChange:e=>n({...a,chartType:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[d.jsx("option",{value:"bar",children:"Bar Chart"}),d.jsx("option",{value:"line",children:"Line Chart"}),d.jsx("option",{value:"pie",children:"Pie Chart"}),d.jsx("option",{value:"area",children:"Area Chart"}),d.jsx("option",{value:"table",children:"Table"})]})]})]}),d.jsxs("div",{className:"flex items-center",children:[d.jsx("input",{type:"checkbox",id:"isScheduled",checked:a.isScheduled,onChange:e=>n({...a,isScheduled:e.target.checked}),className:"rounded border-gray-300"}),d.jsx("label",{htmlFor:"isScheduled",className:"ml-2 text-sm text-gray-700",children:"Schedule automatic generation"})]}),a.isScheduled&&d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Frequency"}),d.jsxs("select",{value:a.scheduleFrequency,onChange:e=>n({...a,scheduleFrequency:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[d.jsx("option",{value:"daily",children:"Daily"}),d.jsx("option",{value:"weekly",children:"Weekly"}),d.jsx("option",{value:"monthly",children:"Monthly"})]})]}),d.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[d.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",children:"Cancel"}),d.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Create Report"})]})]})]})})},er=({projectId:e,userId:t})=>{const[s,a]=r.useState("chat"),[n,i]=r.useState(null),[o,l]=r.useState([]),[c,m]=r.useState([]),[u,h]=r.useState([]),[p,x]=r.useState([]),[g,y]=r.useState(""),[f,b]=r.useState(!1),[j,w]=r.useState(!1),[v,N]=r.useState(""),[k,E]=r.useState([]),S=r.useRef(null),C=r.useRef(null);r.useEffect(()=>{I();const e=setInterval(()=>{A()},5e3);return()=>clearInterval(e)},[e]),r.useEffect(()=>{D()},[o]);const I=async()=>{try{m(R()),h(P()),x(O()),E(["user-1","user-2","user-3"]);const e=R()[0];i(e),l(M(e.id))}catch(e){console.error("Error loading collaboration data:",e)}},A=()=>{const e=["Great progress on the foundation work!","Can someone review the latest drawings?","Safety meeting at 2 PM today","Material delivery scheduled for tomorrow","Quality inspection passed "];if(Math.random()>.7&&n){const t={id:`msg-${Date.now()}`,content:e[Math.floor(Math.random()*e.length)],senderId:"user-"+Math.floor(5*Math.random()),senderName:["John Smith","Sarah Johnson","Mike Wilson","Lisa Chen","David Brown"][Math.floor(5*Math.random())],timestamp:new Date,type:"text"};l(e=>[...e,t])}},D=()=>{S.current?.scrollIntoView({behavior:"smooth"})},T=()=>{if(!g.trim()||!n)return;const e={id:`msg-${Date.now()}`,content:g,senderId:t,senderName:"You",timestamp:new Date,type:"text"};l(t=>[...t,e]),y("")},R=()=>[{id:"general",name:"General",description:"General project discussion",type:"public",members:["user-1","user-2","user-3","user-4"],isArchived:!1,unreadCount:3,isPinned:!0,createdAt:new Date(Date.now()-2592e6)},{id:"field-updates",name:"Field Updates",description:"Daily field reports and updates",type:"public",members:["user-1","user-2","user-5"],isArchived:!1,unreadCount:1,isPinned:!1,createdAt:new Date(Date.now()-1728e6)},{id:"safety",name:"Safety",description:"Safety discussions and alerts",type:"public",members:["user-1","user-3","user-4","user-5"],isArchived:!1,unreadCount:0,isPinned:!0,createdAt:new Date(Date.now()-1296e6)},{id:"management",name:"Management",description:"Project management team",type:"private",members:["user-1","user-2"],isArchived:!1,unreadCount:2,isPinned:!1,createdAt:new Date(Date.now()-864e6)}],M=e=>[{id:"msg-1",content:"Good morning team! Ready for another productive day.",senderId:"user-1",senderName:"John Smith",timestamp:new Date(Date.now()-72e5),type:"text"},{id:"msg-2",content:"Foundation work is progressing well. Should be done by Friday.",senderId:"user-2",senderName:"Sarah Johnson",timestamp:new Date(Date.now()-36e5),type:"text"},{id:"msg-3",content:"Great to hear! Can you share some photos of the progress?",senderId:"user-3",senderName:"Mike Wilson",timestamp:new Date(Date.now()-18e5),type:"text"},{id:"msg-4",content:"Here are the latest photos from the site.",senderId:"user-2",senderName:"Sarah Johnson",timestamp:new Date(Date.now()-9e5),type:"image",attachments:[{id:"att-1",name:"foundation-progress.jpg",type:"image/jpeg",size:2048576,url:"/mock-images/foundation.jpg",thumbnailUrl:"/mock-images/foundation-thumb.jpg"}]}],P=()=>[{id:"notif-1",type:"mention",title:"You were mentioned",message:"John Smith mentioned you in #general",timestamp:new Date(Date.now()-18e5),isRead:!1,priority:"medium",relatedUser:"John Smith"},{id:"notif-2",type:"task",title:"Task assigned",message:"New task: Review electrical plans",timestamp:new Date(Date.now()-72e5),isRead:!1,priority:"high"},{id:"notif-3",type:"document",title:"Document updated",message:"Architectural drawings v2.1 uploaded",timestamp:new Date(Date.now()-144e5),isRead:!0,priority:"low"}],O=()=>[{id:"activity-1",type:"document",title:"Document uploaded",description:"Sarah uploaded foundation drawings v2.1",user:"Sarah Johnson",timestamp:new Date(Date.now()-36e5)},{id:"activity-2",type:"task",title:"Task completed",description:"Mike completed electrical rough-in inspection",user:"Mike Wilson",timestamp:new Date(Date.now()-72e5)},{id:"activity-3",type:"meeting",title:"Meeting scheduled",description:"Weekly progress meeting scheduled for Friday 2 PM",user:"John Smith",timestamp:new Date(Date.now()-108e5)}],_=[{id:"chat",label:"Chat",icon:It},{id:"activity",label:"Activity",icon:ht},{id:"team",label:"Team",icon:Kt},{id:"calls",label:"Calls",icon:Tt}],L=u.filter(e=>!e.isRead).length;return d.jsxs("div",{className:"bg-white rounded-lg shadow-lg h-[calc(100vh-8rem)]",children:[d.jsx("div",{className:"border-b border-gray-200 px-6 py-4",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Team Collaboration"}),d.jsx("p",{className:"text-gray-600",children:"Real-time communication and project updates"})]}),d.jsxs("div",{className:"flex items-center space-x-3",children:[d.jsxs("div",{className:"relative",children:[d.jsx("input",{type:"text",placeholder:"Search messages...",value:v,onChange:e=>N(e.target.value),className:"pl-8 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 w-64"}),d.jsx(Lt,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"})]}),d.jsxs("div",{className:"relative",children:[d.jsxs("button",{onClick:()=>w(!j),className:"relative p-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:[d.jsx(at,{className:"w-5 h-5"}),L>0&&d.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center",children:L})]}),j&&d.jsx(rr,{notifications:u,onMarkAsRead:e=>{h(t=>t.map(t=>t.id===e?{...t,isRead:!0}:t))},onClose:()=>w(!1)})]}),d.jsx("button",{className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:d.jsx(Ut,{className:"w-5 h-5"})})]})]})}),d.jsx("div",{className:"border-b border-gray-200",children:d.jsx("nav",{className:"flex space-x-8 px-6",children:_.map(e=>{const t=e.icon;return d.jsxs("button",{onClick:()=>a(e.id),className:"flex items-center py-4 px-1 border-b-2 font-medium text-sm "+(s===e.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[d.jsx(t,{className:"w-4 h-4 mr-2"}),e.label]},e.id)})})}),d.jsxs("div",{className:"flex h-[calc(100%-8rem)]",children:["chat"===s&&d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:"w-80 border-r border-gray-200 flex flex-col",children:[d.jsx("div",{className:"p-4 border-b border-gray-200",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("h3",{className:"font-semibold text-gray-900",children:"Channels"}),d.jsx("button",{className:"p-1 hover:bg-gray-100 rounded",children:d.jsx(Mt,{className:"w-4 h-4"})})]})}),d.jsx("div",{className:"flex-1 overflow-y-auto",children:c.map(e=>d.jsx(tr,{channel:e,isSelected:n?.id===e.id,onClick:()=>{i(e),l(M(e.id))}},e.id))})]}),d.jsx("div",{className:"flex-1 flex flex-col",children:n?d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"p-4 border-b border-gray-200",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsxs("h3",{className:"font-semibold text-gray-900",children:["#",n.name]}),d.jsx("p",{className:"text-sm text-gray-600",children:n.description})]}),d.jsxs("div",{className:"flex items-center space-x-2",children:[d.jsx("button",{className:"p-2 hover:bg-gray-100 rounded",children:d.jsx(Tt,{className:"w-4 h-4"})}),d.jsx("button",{className:"p-2 hover:bg-gray-100 rounded",children:d.jsx(Zt,{className:"w-4 h-4"})}),d.jsx("button",{className:"p-2 hover:bg-gray-100 rounded",children:d.jsx(yt,{className:"w-4 h-4"})})]})]})}),d.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[o.map(e=>d.jsx(sr,{message:e,currentUserId:t},e.id)),d.jsx("div",{ref:S})]}),d.jsx("div",{className:"p-4 border-t border-gray-200",children:d.jsxs("div",{className:"flex items-center space-x-2",children:[d.jsx("button",{onClick:()=>C.current?.click(),className:"p-2 hover:bg-gray-100 rounded",children:d.jsx(Dt,{className:"w-4 h-4"})}),d.jsx("input",{type:"file",ref:C,multiple:!0,className:"hidden",onChange:e=>{const s=e.target.files;s&&n&&Array.from(s).forEach(e=>{const s={id:`msg-${Date.now()}-${e.name}`,content:`Shared a file: ${e.name}`,senderId:t,senderName:"You",timestamp:new Date,type:"file",attachments:[{id:`att-${Date.now()}`,name:e.name,type:e.type,size:e.size,url:URL.createObjectURL(e)}]};l(e=>[...e,s])})}}),d.jsxs("div",{className:"flex-1 relative",children:[d.jsx("input",{type:"text",value:g,onChange:e=>y(e.target.value),onKeyPress:e=>"Enter"===e.key&&T(),placeholder:`Message #${n.name}`,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"}),d.jsx("button",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 p-1 hover:bg-gray-100 rounded",children:d.jsx(qt,{className:"w-4 h-4"})})]}),d.jsx("button",{onClick:T,disabled:!g.trim(),className:"p-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:d.jsx($t,{className:"w-4 h-4"})})]})})]}):d.jsx("div",{className:"flex-1 flex items-center justify-center",children:d.jsxs("div",{className:"text-center",children:[d.jsx(It,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),d.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Select a channel"}),d.jsx("p",{className:"text-gray-600",children:"Choose a channel to start messaging"})]})})})]}),"activity"===s&&d.jsx("div",{className:"flex-1 p-6",children:d.jsx(ar,{activities:p})}),"team"===s&&d.jsx("div",{className:"flex-1 p-6",children:d.jsx(nr,{onlineUsers:k})}),"calls"===s&&d.jsx("div",{className:"flex-1 p-6",children:d.jsx(ir,{})})]})]})},tr=({channel:e,isSelected:t,onClick:s})=>d.jsxs("button",{onClick:s,className:"w-full text-left p-3 hover:bg-gray-50 "+(t?"bg-blue-50 border-r-2 border-blue-500":""),children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"flex items-center",children:["private"===e.type?d.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full mr-2"}):d.jsx(kt,{className:"w-4 h-4 text-gray-400 mr-2"}),d.jsx("span",{className:"font-medium text-gray-900",children:e.name}),e.isPinned&&d.jsx(Rt,{className:"w-3 h-3 text-gray-400 ml-1"})]}),e.unreadCount>0&&d.jsx("span",{className:"bg-red-500 text-white text-xs rounded-full px-2 py-1 min-w-[1.25rem] text-center",children:e.unreadCount})]}),d.jsx("p",{className:"text-sm text-gray-600 truncate mt-1",children:e.description})]}),sr=({message:e,currentUserId:t})=>{const s=e.senderId===t;return d.jsx("div",{className:"flex "+(s?"justify-end":"justify-start"),children:d.jsxs("div",{className:"max-w-xs lg:max-w-md "+(s?"order-2":"order-1"),children:[!s&&d.jsxs("div",{className:"flex items-center mb-1",children:[d.jsx("div",{className:"w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center text-white text-xs font-medium mr-2",children:e.senderName.charAt(0)}),d.jsx("span",{className:"text-sm font-medium text-gray-900",children:e.senderName}),d.jsx("span",{className:"text-xs text-gray-500 ml-2",children:e.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),d.jsxs("div",{className:"rounded-lg px-4 py-2 "+(s?"bg-blue-600 text-white":"bg-gray-100 text-gray-900"),children:[d.jsx("p",{className:"text-sm",children:e.content}),e.attachments&&e.attachments.length>0&&d.jsx("div",{className:"mt-2 space-y-2",children:e.attachments.map(e=>d.jsxs("div",{className:"flex items-center space-x-2 text-xs",children:[d.jsx(Dt,{className:"w-3 h-3"}),d.jsx("span",{children:e.name}),d.jsxs("span",{children:["(",(e.size/1024/1024).toFixed(1)," MB)"]})]},e.id))})]}),s&&d.jsx("div",{className:"text-xs text-gray-500 text-right mt-1",children:e.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})})},rr=({notifications:e,onMarkAsRead:t,onClose:s})=>d.jsxs("div",{className:"absolute right-0 mt-2 w-80 bg-white border border-gray-200 rounded-lg shadow-lg z-50",children:[d.jsx("div",{className:"p-4 border-b border-gray-200",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("h3",{className:"font-semibold text-gray-900",children:"Notifications"}),d.jsx("button",{onClick:s,className:"p-1 hover:bg-gray-100 rounded",children:d.jsx(ts,{className:"w-4 h-4"})})]})}),d.jsx("div",{className:"max-h-96 overflow-y-auto",children:0===e.length?d.jsxs("div",{className:"p-4 text-center text-gray-500",children:[d.jsx(at,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),d.jsx("p",{children:"No notifications"})]}):e.map(e=>d.jsx("div",{className:"p-4 border-b border-gray-100 hover:bg-gray-50 cursor-pointer "+(e.isRead?"":"bg-blue-50"),onClick:()=>t(e.id),children:d.jsxs("div",{className:"flex items-start space-x-3",children:[d.jsxs("div",{className:"p-1 rounded-full "+("high"===e.priority?"bg-red-100":"medium"===e.priority?"bg-yellow-100":"bg-gray-100"),children:["mention"===e.type&&d.jsx(rt,{className:"w-4 h-4 text-blue-600"}),"task"===e.type&&d.jsx(dt,{className:"w-4 h-4 text-green-600"}),"document"===e.type&&d.jsx(FileText,{className:"w-4 h-4 text-purple-600"}),"system"===e.type&&d.jsx(Et,{className:"w-4 h-4 text-gray-600"})]}),d.jsxs("div",{className:"flex-1 min-w-0",children:[d.jsx("p",{className:"text-sm font-medium text-gray-900",children:e.title}),d.jsx("p",{className:"text-sm text-gray-600 truncate",children:e.message}),d.jsx("p",{className:"text-xs text-gray-500 mt-1",children:e.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),!e.isRead&&d.jsx("div",{className:"w-2 h-2 bg-blue-600 rounded-full"})]})},e.id))})]}),ar=({activities:e})=>d.jsxs("div",{className:"space-y-4",children:[d.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Recent Activity"}),d.jsx("div",{className:"space-y-4",children:e.map(e=>d.jsxs("div",{className:"flex items-start space-x-3 p-4 bg-gray-50 rounded-lg",children:[d.jsxs("div",{className:"p-2 bg-blue-100 rounded-lg",children:["document"===e.type&&d.jsx(FileText,{className:"w-4 h-4 text-blue-600"}),"task"===e.type&&d.jsx(dt,{className:"w-4 h-4 text-green-600"}),"meeting"===e.type&&d.jsx(Calendar,{className:"w-4 h-4 text-purple-600"}),"message"===e.type&&d.jsx(It,{className:"w-4 h-4 text-orange-600"}),"file"===e.type&&d.jsx(Dt,{className:"w-4 h-4 text-gray-600"})]}),d.jsxs("div",{className:"flex-1",children:[d.jsx("p",{className:"text-sm font-medium text-gray-900",children:e.title}),d.jsx("p",{className:"text-sm text-gray-600",children:e.description}),d.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[e.user,"  ",e.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]})]},e.id))})]}),nr=({onlineUsers:e})=>d.jsxs("div",{className:"space-y-6",children:[d.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Team Members"}),d.jsx("div",{className:"space-y-4",children:[{id:"user-1",name:"John Smith",role:"Project Manager",avatar:"JS",status:"online"},{id:"user-2",name:"Sarah Johnson",role:"Site Supervisor",avatar:"SJ",status:"online"},{id:"user-3",name:"Mike Wilson",role:"Safety Officer",avatar:"MW",status:"away"},{id:"user-4",name:"Lisa Chen",role:"Quality Inspector",avatar:"LC",status:"offline"},{id:"user-5",name:"David Brown",role:"Foreman",avatar:"DB",status:"online"}].map(e=>d.jsxs("div",{className:"flex items-center space-x-3 p-3 hover:bg-gray-50 rounded-lg",children:[d.jsxs("div",{className:"relative",children:[d.jsx("div",{className:"w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center text-white font-medium",children:e.avatar}),d.jsx("div",{className:"absolute -bottom-1 -right-1 w-3 h-3 rounded-full border-2 border-white "+("online"===e.status?"bg-green-500":"away"===e.status?"bg-yellow-500":"bg-gray-400")})]}),d.jsxs("div",{className:"flex-1",children:[d.jsx("p",{className:"font-medium text-gray-900",children:e.name}),d.jsx("p",{className:"text-sm text-gray-600",children:e.role})]}),d.jsxs("div",{className:"flex items-center space-x-2",children:[d.jsx("button",{className:"p-1 hover:bg-gray-100 rounded",children:d.jsx(It,{className:"w-4 h-4"})}),d.jsx("button",{className:"p-1 hover:bg-gray-100 rounded",children:d.jsx(Tt,{className:"w-4 h-4"})})]})]},e.id))})]}),ir=()=>d.jsxs("div",{className:"text-center py-12",children:[d.jsx(Zt,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),d.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Video Calls"}),d.jsx("p",{className:"text-gray-600 mb-6",children:"Start a video call with your team members"}),d.jsxs("div",{className:"space-y-3",children:[d.jsxs("button",{className:"w-full flex items-center justify-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[d.jsx(Zt,{className:"w-4 h-4 mr-2"}),"Start Video Call"]}),d.jsxs("button",{className:"w-full flex items-center justify-center px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:[d.jsx(Tt,{className:"w-4 h-4 mr-2"}),"Start Audio Call"]})]})]}),or=({projectId:e,userId:t})=>{const[s,a]=r.useState("overview"),[n,i]=r.useState(!0),[o,l]=r.useState([]),[c,m]=r.useState([]),[u,h]=r.useState(null),[p,x]=r.useState(null),[g,y]=r.useState(!1),[f,b]=r.useState(""),[j,w]=r.useState("all"),[v,N]=r.useState("all");r.useEffect(()=>{k()},[e]);const k=async()=>{i(!0);try{const e=E(),t=S(),s=C(e,t);l(e),m(t),h(s)}catch(e){console.error("Error loading quality data:",e)}finally{i(!1)}},E=()=>[{id:"insp-1",title:"Foundation Concrete Pour",description:"Quality inspection of foundation concrete pour",type:"quality",status:"completed",priority:"high",inspector:"user-1",inspectorName:"John Smith",scheduledDate:new Date(Date.now()-1728e5),completedDate:new Date(Date.now()-864e5),location:"Building A - Foundation",trade:"Concrete",score:92,checklist:[{id:"check-1",title:"Concrete Mix Verification",description:"Verify concrete mix meets specifications",category:"Materials",isRequired:!0,status:"passed",inspector:"John Smith",inspectedAt:new Date(Date.now()-864e5)},{id:"check-2",title:"Reinforcement Placement",description:"Check rebar placement and spacing",category:"Structure",isRequired:!0,status:"passed",inspector:"John Smith",inspectedAt:new Date(Date.now()-864e5)},{id:"check-3",title:"Surface Finish",description:"Inspect concrete surface finish quality",category:"Finish",isRequired:!1,status:"failed",notes:"Minor surface imperfections noted",inspector:"John Smith",inspectedAt:new Date(Date.now()-864e5)}],photos:[{id:"photo-1",url:"/mock-photos/foundation-1.jpg",thumbnailUrl:"/mock-photos/foundation-1-thumb.jpg",caption:"Foundation concrete pour in progress",timestamp:new Date(Date.now()-864e5)}],defects:[],notes:"Overall good quality with minor surface finish issues",approvedBy:"Sarah Johnson",approvedAt:new Date(Date.now()-432e5)},{id:"insp-2",title:"Electrical Rough-In",description:"Electrical rough-in inspection before drywall",type:"safety",status:"in_progress",priority:"medium",inspector:"user-2",inspectorName:"Mike Wilson",scheduledDate:new Date,location:"Building A - 2nd Floor",trade:"Electrical",checklist:[{id:"check-4",title:"Wire Gauge Compliance",description:"Verify wire gauge meets code requirements",category:"Code Compliance",isRequired:!0,status:"pending"},{id:"check-5",title:"Junction Box Installation",description:"Check junction box placement and securing",category:"Installation",isRequired:!0,status:"pending"}],photos:[],defects:[]},{id:"insp-3",title:"HVAC Ductwork",description:"HVAC ductwork installation inspection",type:"quality",status:"scheduled",priority:"medium",inspector:"user-3",inspectorName:"Lisa Chen",scheduledDate:new Date(Date.now()+1728e5),location:"Building A - Mechanical Room",trade:"HVAC",checklist:[],photos:[],defects:[]}],S=()=>[{id:"defect-1",title:"Concrete Surface Imperfection",description:"Minor surface imperfections in foundation concrete",severity:"minor",category:"Concrete",location:"Building A - Foundation",discoveredBy:"John Smith",discoveredAt:new Date(Date.now()-864e5),status:"open",assignedTo:"Concrete Crew",dueDate:new Date(Date.now()+2592e5),photos:["/mock-photos/defect-1.jpg"]},{id:"defect-2",title:"Misaligned Window Frame",description:"Window frame not properly aligned with opening",severity:"major",category:"Windows",location:"Building A - 1st Floor",discoveredBy:"Sarah Johnson",discoveredAt:new Date(Date.now()-2592e5),status:"resolved",assignedTo:"Window Installer",dueDate:new Date(Date.now()-864e5),photos:["/mock-photos/defect-2.jpg"],resolutionNotes:"Window frame realigned and secured properly",resolvedBy:"Window Installer",resolvedAt:new Date(Date.now()-864e5)}],C=(e,t)=>{const s=e.length,r=e.filter(e=>"completed"===e.status&&(e.score||0)>=80).length,a=e.filter(e=>"failed"===e.status).length,n=e.filter(e=>["scheduled","in_progress"].includes(e.status)).length,i=e.filter(e=>"completed"===e.status&&e.score),o=i.length>0?i.reduce((e,t)=>e+(t.score||0),0)/i.length:0;return{totalInspections:s,passedInspections:r,failedInspections:a,pendingInspections:n,averageScore:o,defectRate:s>0?t.length/s*100:0,reworkCost:15e3,complianceRate:s>0?r/s*100:0,trendsData:[{date:new Date(Date.now()-2592e6),score:85,defects:5,inspections:8},{date:new Date(Date.now()-1296e6),score:88,defects:3,inspections:12},{date:new Date,score:o,defects:t.length,inspections:s}]}},I=o.filter(e=>{const t=e.title.toLowerCase().includes(f.toLowerCase())||e.location.toLowerCase().includes(f.toLowerCase())||e.trade.toLowerCase().includes(f.toLowerCase()),s="all"===j||e.status===j,r="all"===v||e.type===v;return t&&s&&r}),A=[{id:"overview",label:"Overview",icon:ot},{id:"inspections",label:"Inspections",icon:ut},{id:"defects",label:"Defects",icon:Qt},{id:"checklists",label:"Checklists",icon:Ht},{id:"compliance",label:"Compliance",icon:Vt}];return n?d.jsxs("div",{className:"flex items-center justify-center h-64",children:[d.jsx(Ot,{className:"w-8 h-8 animate-spin text-blue-600"}),d.jsx("span",{className:"ml-2 text-gray-600",children:"Loading quality data..."})]}):d.jsxs("div",{className:"bg-white rounded-lg shadow-lg",children:[d.jsx("div",{className:"border-b border-gray-200 px-6 py-4",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Quality Control"}),d.jsx("p",{className:"text-gray-600",children:"Inspection workflows, compliance tracking, and quality metrics"})]}),d.jsxs("div",{className:"flex items-center space-x-3",children:[d.jsxs("div",{className:"flex items-center space-x-2",children:[d.jsx("input",{type:"text",placeholder:"Search inspections...",value:f,onChange:e=>b(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 w-64"}),d.jsxs("select",{value:j,onChange:e=>w(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[d.jsx("option",{value:"all",children:"All Status"}),d.jsx("option",{value:"scheduled",children:"Scheduled"}),d.jsx("option",{value:"in_progress",children:"In Progress"}),d.jsx("option",{value:"completed",children:"Completed"}),d.jsx("option",{value:"failed",children:"Failed"})]}),d.jsxs("select",{value:v,onChange:e=>N(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[d.jsx("option",{value:"all",children:"All Types"}),d.jsx("option",{value:"quality",children:"Quality"}),d.jsx("option",{value:"safety",children:"Safety"}),d.jsx("option",{value:"compliance",children:"Compliance"}),d.jsx("option",{value:"final",children:"Final"})]})]}),d.jsxs("button",{onClick:()=>y(!0),className:"flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[d.jsx(Mt,{className:"w-4 h-4 mr-2"}),"New Inspection"]})]})]})}),d.jsx("div",{className:"border-b border-gray-200",children:d.jsx("nav",{className:"flex space-x-8 px-6",children:A.map(e=>{const t=e.icon;return d.jsxs("button",{onClick:()=>a(e.id),className:"flex items-center py-4 px-1 border-b-2 font-medium text-sm "+(s===e.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[d.jsx(t,{className:"w-4 h-4 mr-2"}),e.label]},e.id)})})}),d.jsxs("div",{className:"p-6",children:["overview"===s&&u&&d.jsx(lr,{metrics:u,inspections:o,defects:c}),"inspections"===s&&d.jsx(dr,{inspections:I,onSelectInspection:x,onCreateInspection:()=>y(!0)}),"defects"===s&&d.jsx(ur,{defects:c,getStatusColor:e=>{switch(e){case"completed":case"passed":case"resolved":case"closed":return"text-green-600 bg-green-100";case"in_progress":return"text-blue-600 bg-blue-100";case"scheduled":case"pending":return"text-yellow-600 bg-yellow-100";case"failed":case"open":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}}}),"checklists"===s&&d.jsx(hr,{}),"compliance"===s&&d.jsx(pr,{metrics:u})]}),g&&d.jsx(xr,{projectId:e,onClose:()=>y(!1),onSuccess:e=>{l([...o,e]),y(!1)}}),p&&d.jsx(gr,{inspection:p,onClose:()=>x(null),onUpdate:e=>{l(o.map(t=>t.id===e.id?e:t)),x(null)}})]})},lr=({metrics:e,inspections:t,defects:s})=>{const r=[{title:"Quality Score",value:`${e.averageScore.toFixed(1)}/100`,change:2.5,icon:Bt,color:"blue"},{title:"Compliance Rate",value:`${e.complianceRate.toFixed(1)}%`,change:1.8,icon:Vt,color:"green"},{title:"Defect Rate",value:`${e.defectRate.toFixed(1)}%`,change:-.5,icon:Qt,color:"red"},{title:"Rework Cost",value:`$${e.reworkCost.toLocaleString()}`,change:-12.3,icon:Jt,color:"purple"}];return d.jsxs("div",{className:"space-y-6",children:[d.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:r.map((e,t)=>{const s=e.icon;return d.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("div",{className:`p-2 rounded-lg bg-${e.color}-100`,children:d.jsx(s,{className:`w-5 h-5 text-${e.color}-600`})}),d.jsxs("div",{className:"flex items-center text-sm "+(e.change>=0?"text-green-600":"text-red-600"),children:[d.jsx(Jt,{className:"w-4 h-4 mr-1 "+(e.change<0?"rotate-180":"")}),Math.abs(e.change),"%"]})]}),d.jsxs("div",{className:"mt-4",children:[d.jsx("h3",{className:"text-sm font-medium text-gray-600",children:e.title}),d.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:e.value})]})]},t)})}),d.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[d.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[d.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Inspection Status"}),d.jsxs("div",{className:"space-y-3",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("span",{className:"text-sm text-gray-600",children:"Completed"}),d.jsx("span",{className:"text-sm font-medium text-green-600",children:e.passedInspections})]}),d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("span",{className:"text-sm text-gray-600",children:"In Progress"}),d.jsx("span",{className:"text-sm font-medium text-blue-600",children:e.pendingInspections})]}),d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("span",{className:"text-sm text-gray-600",children:"Failed"}),d.jsx("span",{className:"text-sm font-medium text-red-600",children:e.failedInspections})]})]})]}),d.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[d.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Recent Inspections"}),d.jsx("div",{className:"space-y-3",children:t.slice(0,5).map(e=>d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("p",{className:"text-sm font-medium text-gray-900",children:e.title}),d.jsx("p",{className:"text-xs text-gray-500",children:e.location})]}),d.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${cr(e.status)}`,children:e.status.replace("_"," ")})]},e.id))})]})]})]})},cr=e=>{switch(e){case"completed":case"passed":case"resolved":case"closed":return"text-green-600 bg-green-100";case"in_progress":return"text-blue-600 bg-blue-100";case"scheduled":case"pending":return"text-yellow-600 bg-yellow-100";case"failed":case"open":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}},dr=({inspections:e,onSelectInspection:t,onCreateInspection:s})=>0===e.length?d.jsxs("div",{className:"text-center py-12",children:[d.jsx(ut,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),d.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No inspections found"}),d.jsx("p",{className:"text-gray-600 mb-4",children:"Create your first inspection to get started"}),d.jsxs("button",{onClick:s,className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[d.jsx(Mt,{className:"w-4 h-4 mr-2"}),"Create Inspection"]})]}):d.jsx("div",{className:"space-y-4",children:d.jsx("div",{className:"grid gap-4",children:e.map(e=>d.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow",children:d.jsxs("div",{className:"flex items-start justify-between",children:[d.jsxs("div",{className:"flex-1",children:[d.jsxs("div",{className:"flex items-center mb-2",children:[d.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:e.title}),d.jsx("span",{className:`ml-2 inline-flex px-2 py-1 text-xs font-semibold rounded-full ${cr(e.status)}`,children:e.status.replace("_"," ")}),d.jsx(jt,{className:`ml-2 w-4 h-4 ${mr(e.priority)}`})]}),d.jsx("p",{className:"text-gray-600 mb-3",children:e.description}),d.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[d.jsxs("div",{children:[d.jsx("span",{className:"text-gray-500",children:"Inspector:"}),d.jsx("p",{className:"font-medium",children:e.inspectorName})]}),d.jsxs("div",{children:[d.jsx("span",{className:"text-gray-500",children:"Location:"}),d.jsx("p",{className:"font-medium",children:e.location})]}),d.jsxs("div",{children:[d.jsx("span",{className:"text-gray-500",children:"Trade:"}),d.jsx("p",{className:"font-medium",children:e.trade})]}),d.jsxs("div",{children:[d.jsx("span",{className:"text-gray-500",children:"Scheduled:"}),d.jsx("p",{className:"font-medium",children:e.scheduledDate.toLocaleDateString()})]})]}),e.score&&d.jsxs("div",{className:"mt-3",children:[d.jsx("span",{className:"text-sm text-gray-500",children:"Quality Score: "}),d.jsxs("span",{className:"font-medium "+(e.score>=90?"text-green-600":e.score>=70?"text-yellow-600":"text-red-600"),children:[e.score,"/100"]})]})]}),d.jsxs("div",{className:"flex items-center space-x-2",children:[d.jsx("button",{onClick:()=>t(e),className:"p-2 text-blue-600 hover:text-blue-800",title:"View Details",children:d.jsx(ft,{className:"w-4 h-4"})}),d.jsx("button",{className:"p-2 text-gray-600 hover:text-gray-800",title:"Edit",children:d.jsx(Wt,{className:"w-4 h-4"})}),d.jsx("button",{className:"p-2 text-green-600 hover:text-green-800",title:"Download Report",children:d.jsx(gt,{className:"w-4 h-4"})})]})]})},e.id))})}),mr=e=>{switch(e){case"critical":return"text-red-600";case"high":return"text-orange-600";case"medium":return"text-yellow-600";case"low":return"text-green-600";default:return"text-gray-600"}},ur=({defects:e,getStatusColor:t})=>d.jsxs("div",{className:"space-y-4",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Quality Defects"}),d.jsxs("button",{className:"flex items-center px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:[d.jsx(vt,{className:"w-4 h-4 mr-2"}),"Filter"]})]}),0===e.length?d.jsxs("div",{className:"text-center py-12",children:[d.jsx(dt,{className:"w-16 h-16 text-green-400 mx-auto mb-4"}),d.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No defects found"}),d.jsx("p",{className:"text-gray-600",children:"Great job! No quality defects have been reported."})]}):d.jsx("div",{className:"grid gap-4",children:e.map(e=>d.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:d.jsxs("div",{className:"flex items-start justify-between",children:[d.jsxs("div",{className:"flex-1",children:[d.jsxs("div",{className:"flex items-center mb-2",children:[d.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:e.title}),d.jsx("span",{className:`ml-2 inline-flex px-2 py-1 text-xs font-semibold rounded-full ${t(e.status)}`,children:e.status.replace("_"," ")}),d.jsx("span",{className:"ml-2 text-xs font-medium "+("critical"===e.severity?"text-red-600":"major"===e.severity?"text-orange-600":"text-yellow-600"),children:e.severity.toUpperCase()})]}),d.jsx("p",{className:"text-gray-600 mb-3",children:e.description}),d.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[d.jsxs("div",{children:[d.jsx("span",{className:"text-gray-500",children:"Location:"}),d.jsx("p",{className:"font-medium",children:e.location})]}),d.jsxs("div",{children:[d.jsx("span",{className:"text-gray-500",children:"Discovered by:"}),d.jsx("p",{className:"font-medium",children:e.discoveredBy})]}),d.jsxs("div",{children:[d.jsx("span",{className:"text-gray-500",children:"Assigned to:"}),d.jsx("p",{className:"font-medium",children:e.assignedTo||"Unassigned"})]}),d.jsxs("div",{children:[d.jsx("span",{className:"text-gray-500",children:"Due date:"}),d.jsx("p",{className:"font-medium",children:e.dueDate?.toLocaleDateString()||"Not set"})]})]}),e.resolutionNotes&&d.jsxs("div",{className:"mt-3 p-3 bg-green-50 rounded-lg",children:[d.jsx("p",{className:"text-sm font-medium text-green-700",children:"Resolution:"}),d.jsx("p",{className:"text-sm text-green-900",children:e.resolutionNotes})]})]}),d.jsxs("div",{className:"flex items-center space-x-2",children:[d.jsx("button",{className:"p-2 text-blue-600 hover:text-blue-800",title:"View Photos",children:d.jsx(it,{className:"w-4 h-4"})}),d.jsx("button",{className:"p-2 text-gray-600 hover:text-gray-800",title:"Edit",children:d.jsx(Wt,{className:"w-4 h-4"})})]})]})},e.id))})]}),hr=()=>d.jsxs("div",{className:"text-center py-12",children:[d.jsx(Ht,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),d.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Inspection Checklists"}),d.jsx("p",{className:"text-gray-600 mb-6",children:"Manage standardized inspection checklists and templates"}),d.jsxs("button",{className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[d.jsx(Mt,{className:"w-4 h-4 mr-2"}),"Create Checklist Template"]})]}),pr=({metrics:e})=>d.jsxs("div",{className:"text-center py-12",children:[d.jsx(Vt,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),d.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Compliance Tracking"}),d.jsx("p",{className:"text-gray-600 mb-4",children:"Monitor compliance with building codes and standards"}),e&&d.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg inline-block",children:[d.jsx("p",{className:"text-sm text-blue-600",children:"Current Compliance Rate"}),d.jsxs("p",{className:"text-2xl font-bold text-blue-900",children:[e.complianceRate.toFixed(1),"%"]})]})]}),xr=({projectId:e,onClose:t,onSuccess:s})=>{const[a,n]=r.useState({title:"",description:"",type:"quality",priority:"medium",inspector:"",scheduledDate:(new Date).toISOString().split("T")[0],location:"",trade:""});return d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:d.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl mx-4",children:[d.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:d.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Create New Inspection"})}),d.jsxs("form",{onSubmit:e=>{e.preventDefault();const t={id:`insp-${Date.now()}`,...a,status:"scheduled",inspectorName:"Current User",scheduledDate:new Date(a.scheduledDate),checklist:[],photos:[],defects:[]};s(t)},className:"p-6 space-y-4",children:[d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[d.jsxs("div",{className:"md:col-span-2",children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Title *"}),d.jsx("input",{type:"text",required:!0,value:a.title,onChange:e=>n({...a,title:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Inspection title"})]}),d.jsxs("div",{className:"md:col-span-2",children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),d.jsx("textarea",{value:a.description,onChange:e=>n({...a,description:e.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Detailed description of the inspection"})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Type"}),d.jsxs("select",{value:a.type,onChange:e=>n({...a,type:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[d.jsx("option",{value:"quality",children:"Quality"}),d.jsx("option",{value:"safety",children:"Safety"}),d.jsx("option",{value:"compliance",children:"Compliance"}),d.jsx("option",{value:"final",children:"Final"})]})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Priority"}),d.jsxs("select",{value:a.priority,onChange:e=>n({...a,priority:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[d.jsx("option",{value:"low",children:"Low"}),d.jsx("option",{value:"medium",children:"Medium"}),d.jsx("option",{value:"high",children:"High"}),d.jsx("option",{value:"critical",children:"Critical"})]})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Location"}),d.jsx("input",{type:"text",value:a.location,onChange:e=>n({...a,location:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"e.g., Building A - 2nd Floor"})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Trade"}),d.jsx("input",{type:"text",value:a.trade,onChange:e=>n({...a,trade:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"e.g., Electrical, Plumbing"})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Scheduled Date"}),d.jsx("input",{type:"date",value:a.scheduledDate,onChange:e=>n({...a,scheduledDate:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Inspector"}),d.jsx("input",{type:"text",value:a.inspector,onChange:e=>n({...a,inspector:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Inspector name"})]})]}),d.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[d.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",children:"Cancel"}),d.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Create Inspection"})]})]})]})})},gr=({inspection:e,onClose:t,onUpdate:s})=>d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:d.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl mx-4 max-h-[90vh] overflow-y-auto",children:[d.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:e.title}),d.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded",children:d.jsx(X,{className:"w-5 h-5"})})]})}),d.jsxs("div",{className:"p-6",children:[d.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[d.jsxs("div",{children:[d.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Inspection Details"}),d.jsxs("div",{className:"space-y-3 text-sm",children:[d.jsxs("div",{children:[d.jsx("span",{className:"text-gray-500",children:"Status:"}),d.jsx("span",{className:`ml-2 inline-flex px-2 py-1 text-xs font-semibold rounded-full ${cr(e.status)}`,children:e.status.replace("_"," ")})]}),d.jsxs("div",{children:[d.jsx("span",{className:"text-gray-500",children:"Inspector:"}),d.jsx("span",{className:"ml-2 font-medium",children:e.inspectorName})]}),d.jsxs("div",{children:[d.jsx("span",{className:"text-gray-500",children:"Location:"}),d.jsx("span",{className:"ml-2 font-medium",children:e.location})]}),d.jsxs("div",{children:[d.jsx("span",{className:"text-gray-500",children:"Trade:"}),d.jsx("span",{className:"ml-2 font-medium",children:e.trade})]}),e.score&&d.jsxs("div",{children:[d.jsx("span",{className:"text-gray-500",children:"Quality Score:"}),d.jsxs("span",{className:"ml-2 font-medium",children:[e.score,"/100"]})]})]})]}),d.jsxs("div",{children:[d.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Checklist Progress"}),d.jsx("div",{className:"space-y-2",children:e.checklist.map(e=>d.jsxs("div",{className:"flex items-center space-x-2",children:["passed"===e.status?d.jsx(dt,{className:"w-4 h-4 text-green-600"}):"failed"===e.status?d.jsx(mt,{className:"w-4 h-4 text-red-600"}):d.jsx(ht,{className:"w-4 h-4 text-gray-400"}),d.jsx("span",{className:"text-sm",children:e.title})]},e.id))})]})]}),e.notes&&d.jsxs("div",{className:"mt-6",children:[d.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:"Notes"}),d.jsx("p",{className:"text-sm text-gray-700 bg-gray-50 p-3 rounded-lg",children:e.notes})]})]}),d.jsx("div",{className:"px-6 py-4 border-t border-gray-200",children:d.jsxs("div",{className:"flex justify-end space-x-3",children:[d.jsx("button",{onClick:t,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",children:"Close"}),d.jsx("button",{className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Edit Inspection"})]})})]})});class yr extends r.Component{constructor(){super(...arguments),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("Uncaught error:",e,t)}render(){return this.state.hasError?d.jsxs(Re,{className:"border-destructive",children:[d.jsx("h2",{className:"text-xl font-bold text-destructive",children:"Something went wrong."}),d.jsx("p",{className:"text-muted-foreground mt-2",children:"A component on this dashboard has crashed. You can try refreshing the page."}),d.jsxs("details",{className:"mt-4 text-sm bg-muted p-2 rounded",children:[d.jsx("summary",{children:"Error Details"}),d.jsx("pre",{className:"whitespace-pre-wrap text-xs mt-2",children:this.state.error?.toString()})]}),d.jsx(Pe,{variant:"secondary",className:"mt-4",onClick:()=>window.location.reload(),children:"Refresh Page"})]}):this.props.children}}const fr=()=>{const{user:e,logout:t,loading:s}=Te(),[a,n]=r.useState("login"),[i,o]=r.useState("tools");if(s)return d.jsx("div",{className:"min-h-screen grid place-items-center p-6",children:d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),d.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Loading..."})]})});if(!e){if("register"===a)return d.jsx("div",{className:"min-h-screen grid place-items-center p-6",children:d.jsx("div",{className:"w-full max-w-lg",children:d.jsxs(Re,{className:"p-6",children:[d.jsx("h2",{className:"text-lg font-semibold",children:"Registration temporarily unavailable"}),d.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Please contact support or use an existing account."}),d.jsx("div",{className:"mt-4",children:d.jsx("button",{type:"button",className:"text-primary hover:underline",onClick:()=>n("login"),children:"Back to login"})})]})})});try{return d.jsx("div",{className:"min-h-screen grid place-items-center p-6",children:d.jsxs("div",{className:"w-full max-w-md",children:[d.jsx(Re,{className:"mb-6",children:d.jsxs("div",{className:"p-4",children:[d.jsx("h1",{className:"text-xl font-bold",children:"AS Agents CMS"}),d.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Sign in to continue"})]})}),d.jsx(Ue,{onSwitchToRegister:()=>n("register"),onSwitchToForgotPassword:()=>n("forgot")})]})})}catch(l){return console.error("Login component error:",l),d.jsx("div",{className:"min-h-screen grid place-items-center p-6",children:d.jsxs(Re,{className:"p-6 border-destructive",children:[d.jsx("h2",{className:"text-lg font-semibold text-destructive",children:"Login Error"}),d.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"There was an error loading the login form."}),d.jsx("button",{type:"button",className:"mt-4 px-4 py-2 bg-primary text-primary-foreground rounded",onClick:()=>window.location.reload(),children:"Reload Page"})]})})}}return d.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[d.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",className:"h-6 w-6 text-primary","aria-hidden":!0,children:[d.jsx("path",{fill:"currentColor",d:"M12 2l9.196 5.31a1 1 0 01.5.866v10.648a1 1 0 01-.5.866L12 24l-9.196-4.31a1 1 0 01-.5.866V8.176a1 1 0 01.5-.866L12 2z",opacity:.12}),d.jsx("path",{fill:"currentColor",d:"M12 4.5l-6.5 3.752v7.496L12 19.5l6.5-3.752V8.252L12 4.5zm0 1.732l5 2.886v5.764l-5 2.886-5-2.886V9.118l5-2.886z"})]}),d.jsx("h1",{className:"text-lg font-semibold",children:"AS Agents"})]}),d.jsx("button",{type:"button",onClick:t,className:"text-sm text-red-600 hover:underline",children:"Logout"})]}),d.jsxs("div",{className:"flex flex-1 min-h-0",children:[d.jsx(Ve,{user:e,activeView:i,setActiveView:o,onLogout:t,pendingTimesheetCount:0,openIncidentCount:0,unreadMessageCount:0,companyName:void 0}),d.jsx("main",{className:"flex-1 p-4 overflow-auto",children:"tools"===i?d.jsx(He,{user:e,addToast:(e,t)=>{"error"===t?console.error(e):console.log(e)},setActiveView:o}):"field"===i?d.jsx(os,{projectId:"demo-project-1",userId:e.id,isOnline:navigator.onLine}):"document-management"===i?d.jsx(Ns,{projectId:"demo-project-1",userId:e.id}):"project-analytics"===i?d.jsx(Ls,{projectId:"demo-project-1",userId:e.id}):"advanced-reporting"===i?d.jsx(zs,{projectId:"demo-project-1",userId:e.id}):"collaboration"===i?d.jsx(er,{projectId:"demo-project-1",userId:e.id}):"quality-control"===i?d.jsx(or,{projectId:"demo-project-1",userId:e.id}):d.jsxs(Re,{className:"p-6",children:[d.jsx("h2",{className:"text-xl font-semibold text-foreground",children:"Coming soon"}),d.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:['The "',i,'" view will be restored next.']})]})})]})]})},br=()=>d.jsx(yr,{children:d.jsx(De,{children:d.jsx(fr,{})})}),jr=document.getElementById("root");if(!jr)throw new Error("Could not find root element to mount to");u.createRoot(jr).render(d.jsx(a.StrictMode,{children:d.jsx(br,{})}));
