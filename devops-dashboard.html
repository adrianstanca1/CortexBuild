<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CortexBuild 2.0 - DevOps Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            background: white; 
            border-radius: 20px; 
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header { 
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white; 
            padding: 30px; 
            text-align: center; 
        }
        .header h1 { font-size: 2.5rem; margin-bottom: 10px; }
        .header p { opacity: 0.8; font-size: 1.1rem; }
        .status-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
            gap: 20px; 
            padding: 30px; 
        }
        .status-card { 
            background: #f8f9fa; 
            border-radius: 15px; 
            padding: 25px; 
            border-left: 5px solid #ddd;
            transition: transform 0.3s ease;
        }
        .status-card:hover { transform: translateY(-5px); }
        .status-card.healthy { border-left-color: #28a745; }
        .status-card.failed { border-left-color: #dc3545; }
        .status-card.warning { border-left-color: #ffc107; }
        .status-title { font-weight: bold; font-size: 1.2rem; margin-bottom: 10px; }
        .status-value { font-size: 2rem; font-weight: bold; margin: 10px 0; }
        .status-details { color: #666; font-size: 0.9rem; }
        .metrics-section { 
            background: #f8f9fa; 
            padding: 30px; 
            border-top: 1px solid #eee; 
        }
        .metrics-title { 
            font-size: 1.5rem; 
            margin-bottom: 20px; 
            color: #2c3e50; 
            text-align: center;
        }
        .metrics-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 15px; 
        }
        .metric-item { 
            background: white; 
            padding: 20px; 
            border-radius: 10px; 
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .metric-label { color: #666; font-size: 0.9rem; margin-bottom: 5px; }
        .metric-value { font-size: 1.5rem; font-weight: bold; color: #2c3e50; }
        .timestamp { 
            text-align: center; 
            padding: 20px; 
            color: #666; 
            border-top: 1px solid #eee;
            background: #f8f9fa;
        }
        .refresh-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            margin: 20px auto;
            display: block;
            transition: transform 0.3s ease;
        }
        .refresh-btn:hover { transform: scale(1.05); }
        .error-list {
            background: #fff5f5;
            border: 1px solid #fed7d7;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 30px;
        }
        .error-item {
            color: #c53030;
            margin: 5px 0;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸš€ CortexBuild 2.0</h1>
            <p>DevOps Operations Dashboard</p>
        </div>

        <div class="status-grid" id="statusGrid">
            <!-- Status cards will be populated by JavaScript -->
        </div>

        <div id="errorSection" style="display: none;">
            <div class="error-list">
                <h3 style="color: #c53030; margin-bottom: 15px;">ðŸš¨ Active Issues</h3>
                <div id="errorList"></div>
            </div>
        </div>

        <div class="metrics-section">
            <h2 class="metrics-title">ðŸ“Š Performance Metrics</h2>
            <div class="metrics-grid" id="metricsGrid">
                <!-- Metrics will be populated by JavaScript -->
            </div>
        </div>

        <button class="refresh-btn" onclick="refreshData()">ðŸ”„ Refresh Data</button>

        <div class="timestamp" id="timestamp">
            <!-- Timestamp will be populated by JavaScript -->
        </div>
    </div>

    <script>
        let reportData = null;

        async function loadReport() {
            try {
                // Try multiple possible locations for the report
                let response;
                const possibleUrls = [
                    './devops-report.json',
                    '/devops-report.json',
                    'devops-report.json'
                ];

                for (const url of possibleUrls) {
                    try {
                        response = await fetch(url);
                        if (response.ok) break;
                    } catch (e) {
                        continue;
                    }
                }

                if (!response || !response.ok) {
                    throw new Error('Report file not accessible');
                }

                reportData = await response.json();
                updateDashboard();
                showSuccess('DevOps report loaded successfully');
            } catch (error) {
                console.error('Failed to load report:', error);
                showError(`Failed to load DevOps report: ${error.message}`);
                loadMockData(); // Fallback to mock data
            }
        }

        function loadMockData() {
            // Provide mock data when report is not available
            reportData = {
                timestamp: new Date().toISOString(),
                services: {
                    frontend: { status: 'HEALTHY', responseTime: 150, statusCode: 200, url: 'http://localhost:3005' },
                    api: { status: 'HEALTHY', responseTime: 15, statusCode: 200, url: 'http://localhost:3001/api/health' },
                    chat: { status: 'FAILED', error: 'Report not available - using mock data', url: 'http://localhost:3001/api/chat/message' },
                    admin: { status: 'FAILED', error: 'Report not available - using mock data', url: 'http://localhost:3001/api/platformAdmin' }
                },
                performance: {
                    'Frontend Load': { average: 150, min: 116, max: 170, samples: [170, 164, 116] },
                    'API Response': { average: 15, min: 11, max: 21, samples: [12, 21, 11] }
                },
                errors: ['Using mock data - report file not accessible'],
                security: { cors: 'not_detected' },
                integration: { chat: 'failed', error: 'Mock data mode' }
            };
            updateDashboard();
        }

        function showSuccess(message) {
            const statusGrid = document.getElementById('statusGrid');
            const successDiv = document.createElement('div');
            successDiv.className = 'status-card healthy';
            successDiv.innerHTML = `
                <div class="status-title">SUCCESS</div>
                <div class="status-value">âœ…</div>
                <div class="status-details">${message}</div>
            `;
            statusGrid.insertBefore(successDiv, statusGrid.firstChild);
            setTimeout(() => successDiv.remove(), 3000);
        }

        function updateDashboard() {
            if (!reportData) return;

            updateStatusCards();
            updateMetrics();
            updateTimestamp();
            updateErrors();
        }

        function updateStatusCards() {
            const statusGrid = document.getElementById('statusGrid');
            statusGrid.innerHTML = '';

            const services = reportData.services;
            for (const [name, service] of Object.entries(services)) {
                const card = document.createElement('div');
                const statusClass = service.status === 'HEALTHY' ? 'healthy' : 
                                  service.status === 'FAILED' ? 'failed' : 'warning';
                
                card.className = `status-card ${statusClass}`;
                card.innerHTML = `
                    <div class="status-title">${name.toUpperCase()}</div>
                    <div class="status-value">${service.status}</div>
                    <div class="status-details">
                        ${service.responseTime ? `Response: ${service.responseTime}ms` : ''}
                        ${service.error ? `Error: ${service.error}` : ''}
                    </div>
                `;
                statusGrid.appendChild(card);
            }
        }

        function updateMetrics() {
            const metricsGrid = document.getElementById('metricsGrid');
            metricsGrid.innerHTML = '';

            const performance = reportData.performance;
            for (const [name, metrics] of Object.entries(performance)) {
                const metric = document.createElement('div');
                metric.className = 'metric-item';
                metric.innerHTML = `
                    <div class="metric-label">${name}</div>
                    <div class="metric-value">${metrics.average}ms</div>
                    <div class="metric-label">avg (${metrics.min}-${metrics.max}ms)</div>
                `;
                metricsGrid.appendChild(metric);
            }

            // Add summary metrics
            const totalServices = Object.keys(reportData.services).length;
            const healthyServices = Object.values(reportData.services)
                .filter(s => s.status === 'HEALTHY').length;
            const healthPercentage = Math.round((healthyServices / totalServices) * 100);

            const summaryMetric = document.createElement('div');
            summaryMetric.className = 'metric-item';
            summaryMetric.innerHTML = `
                <div class="metric-label">System Health</div>
                <div class="metric-value">${healthPercentage}%</div>
                <div class="metric-label">${healthyServices}/${totalServices} services</div>
            `;
            metricsGrid.appendChild(summaryMetric);
        }

        function updateTimestamp() {
            const timestampEl = document.getElementById('timestamp');
            const date = new Date(reportData.timestamp);
            timestampEl.textContent = `Last updated: ${date.toLocaleString()}`;
        }

        function updateErrors() {
            const errorSection = document.getElementById('errorSection');
            const errorList = document.getElementById('errorList');
            
            if (reportData.errors && reportData.errors.length > 0) {
                errorSection.style.display = 'block';
                errorList.innerHTML = reportData.errors
                    .map(error => `<div class="error-item">â€¢ ${error}</div>`)
                    .join('');
            } else {
                errorSection.style.display = 'none';
            }
        }

        function showError(message) {
            const statusGrid = document.getElementById('statusGrid');
            statusGrid.innerHTML = `
                <div class="status-card failed">
                    <div class="status-title">ERROR</div>
                    <div class="status-value">FAILED</div>
                    <div class="status-details">${message}</div>
                </div>
            `;
        }

        async function refreshData() {
            const btn = document.querySelector('.refresh-btn');
            btn.textContent = 'ðŸ”„ Refreshing...';
            btn.disabled = true;
            
            try {
                // Run monitoring script
                await fetch('/refresh-devops', { method: 'POST' });
                // Reload report
                await loadReport();
            } catch (error) {
                console.error('Refresh failed:', error);
            } finally {
                btn.textContent = 'ðŸ”„ Refresh Data';
                btn.disabled = false;
            }
        }

        // Load initial data
        loadReport();
        
        // Auto-refresh every 30 seconds
        setInterval(loadReport, 30000);
    </script>
</body>
</html>
