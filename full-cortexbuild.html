<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CortexBuild - Complete Construction Intelligence Platform</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .sidebar-transition { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .glass-effect { backdrop-filter: blur(10px); background: rgba(255, 255, 255, 0.95); }
        .sidebar-glass { backdrop-filter: blur(10px); background: rgba(255, 255, 255, 0.98); }
        .active-nav { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .desktop-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; }
        .desktop-icon { transition: all 0.3s ease; cursor: pointer; }
        .desktop-icon:hover { transform: scale(1.05); }
        .sdk-editor { font-family: 'Courier New', monospace; background: #1e1e1e; color: #d4d4d4; }
        .terminal { background: #000; color: #00ff00; font-family: 'Courier New', monospace; }
        .gantt-bar { height: 20px; border-radius: 4px; margin: 2px 0; }
        .kanban-column { min-height: 500px; }
        .draggable { cursor: move; }
        .modal-overlay { background: rgba(0, 0, 0, 0.5); }
        .notification { animation: slideIn 0.3s ease; }
        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .loading-spinner { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .progress-ring { transform: rotate(-90deg); }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); }
        .weather-widget { background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%); }
        .chat-bubble { max-width: 70%; }
        .file-icon { font-size: 2rem; }
        .timeline-item::before { content: ''; position: absolute; left: 15px; top: 0; height: 100%; width: 2px; background: #e5e7eb; }
        .timeline-dot { position: absolute; left: 11px; top: 8px; width: 10px; height: 10px; border-radius: 50%; background: #3b82f6; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef, useMemo } = React;

        // Advanced Data Management System
        const DataManager = {
            // Local Storage Management
            save: (key, data) => {
                try {
                    localStorage.setItem(`cortexbuild_${key}`, JSON.stringify(data));
                    return true;
                } catch (error) {
                    console.error('Save error:', error);
                    return false;
                }
            },
            
            load: (key, defaultValue = null) => {
                try {
                    const data = localStorage.getItem(`cortexbuild_${key}`);
                    return data ? JSON.parse(data) : defaultValue;
                } catch (error) {
                    console.error('Load error:', error);
                    return defaultValue;
                }
            },
            
            remove: (key) => {
                localStorage.removeItem(`cortexbuild_${key}`);
            },
            
            // Data Validation
            validate: {
                email: (email) => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email),
                phone: (phone) => /^\+?[\d\s\-\(\)]+$/.test(phone),
                date: (date) => !isNaN(Date.parse(date)),
                currency: (amount) => /^\d+(\.\d{2})?$/.test(amount),
                required: (value) => value !== null && value !== undefined && value !== ''
            },
            
            // Data Transformation
            transform: {
                currency: (amount) => new Intl.NumberFormat('en-GB', { style: 'currency', currency: 'GBP' }).format(amount),
                date: (date) => new Date(date).toLocaleDateString('en-GB'),
                datetime: (date) => new Date(date).toLocaleString('en-GB'),
                percentage: (value) => `${Math.round(value * 100)}%`,
                fileSize: (bytes) => {
                    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                    if (bytes === 0) return '0 Bytes';
                    const i = Math.floor(Math.log(bytes) / Math.log(1024));
                    return Math.round(bytes / Math.pow(1024, i) * 100) / 100 + ' ' + sizes[i];
                }
            }
        };

        // Advanced Mock Data with Relationships
        const mockDatabase = {
            users: [
                { id: 1, name: 'John Smith', email: 'john@cortexbuild.com', role: 'Project Manager', avatar: 'üë®‚Äçüíº', status: 'online', lastSeen: new Date(), permissions: ['projects.read', 'projects.write', 'tasks.read', 'tasks.write'] },
                { id: 2, name: 'Sarah Johnson', email: 'sarah@cortexbuild.com', role: 'Site Engineer', avatar: 'üë©‚Äçüîß', status: 'online', lastSeen: new Date(), permissions: ['projects.read', 'tasks.read', 'tasks.write', 'quality.read'] },
                { id: 3, name: 'Mike Wilson', email: 'mike@cortexbuild.com', role: 'Safety Inspector', avatar: 'üë®‚Äçüè≠', status: 'away', lastSeen: new Date(Date.now() - 300000), permissions: ['quality.read', 'quality.write', 'safety.read', 'safety.write'] },
                { id: 4, name: 'Lisa Chen', email: 'lisa@cortexbuild.com', role: 'Architect', avatar: 'üë©‚Äçüé®', status: 'online', lastSeen: new Date(), permissions: ['projects.read', 'documents.read', 'documents.write'] }
            ],
            
            projects: [
                { 
                    id: 1, 
                    name: 'Downtown Office Complex', 
                    description: 'Modern 15-story office building with sustainable features',
                    status: 'In Progress', 
                    progress: 75, 
                    budget: 2500000, 
                    spent: 1875000,
                    startDate: '2025-01-15',
                    endDate: '2025-12-20',
                    managerId: 1,
                    location: 'London, UK',
                    priority: 'High',
                    tags: ['Commercial', 'Sustainable', 'High-rise'],
                    milestones: [
                        { id: 1, name: 'Foundation Complete', date: '2025-03-01', status: 'completed' },
                        { id: 2, name: 'Structure Complete', date: '2025-08-15', status: 'in-progress' },
                        { id: 3, name: 'Interior Fit-out', date: '2025-11-01', status: 'pending' }
                    ]
                },
                { 
                    id: 2, 
                    name: 'Residential Tower A', 
                    description: '25-story luxury residential tower with amenities',
                    status: 'Planning', 
                    progress: 25, 
                    budget: 1800000, 
                    spent: 450000,
                    startDate: '2025-03-01',
                    endDate: '2026-02-28',
                    managerId: 2,
                    location: 'Manchester, UK',
                    priority: 'Medium',
                    tags: ['Residential', 'Luxury', 'High-rise'],
                    milestones: [
                        { id: 4, name: 'Planning Approval', date: '2025-02-15', status: 'completed' },
                        { id: 5, name: 'Site Preparation', date: '2025-04-01', status: 'pending' }
                    ]
                },
                { 
                    id: 3, 
                    name: 'Shopping Center Renovation', 
                    description: 'Complete renovation of existing shopping center',
                    status: 'Completed', 
                    progress: 100, 
                    budget: 950000, 
                    spent: 920000,
                    startDate: '2024-06-01',
                    endDate: '2025-01-15',
                    managerId: 1,
                    location: 'Birmingham, UK',
                    priority: 'Low',
                    tags: ['Renovation', 'Commercial', 'Retail'],
                    milestones: [
                        { id: 6, name: 'Demolition Complete', date: '2024-08-01', status: 'completed' },
                        { id: 7, name: 'New Construction', date: '2024-11-01', status: 'completed' },
                        { id: 8, name: 'Final Inspection', date: '2025-01-10', status: 'completed' }
                    ]
                }
            ],
            
            tasks: [
                { 
                    id: 1, 
                    title: 'Foundation Inspection', 
                    description: 'Comprehensive inspection of foundation work including concrete strength tests',
                    projectId: 1, 
                    assigneeId: 3, 
                    priority: 'High', 
                    dueDate: '2025-10-20', 
                    status: 'Pending',
                    estimatedHours: 8,
                    actualHours: 0,
                    tags: ['Inspection', 'Foundation', 'Critical'],
                    dependencies: [],
                    attachments: ['foundation_specs.pdf', 'concrete_test_results.xlsx']
                },
                { 
                    id: 2, 
                    title: 'Electrical Wiring Phase 2', 
                    description: 'Installation of electrical systems for floors 6-10',
                    projectId: 2, 
                    assigneeId: 2, 
                    priority: 'Medium', 
                    dueDate: '2025-10-25', 
                    status: 'In Progress',
                    estimatedHours: 40,
                    actualHours: 15,
                    tags: ['Electrical', 'Installation'],
                    dependencies: [1],
                    attachments: ['electrical_plans.dwg']
                },
                { 
                    id: 3, 
                    title: 'Final Cleanup', 
                    description: 'Complete site cleanup and preparation for handover',
                    projectId: 3, 
                    assigneeId: 1, 
                    priority: 'Low', 
                    dueDate: '2025-10-18', 
                    status: 'Completed',
                    estimatedHours: 16,
                    actualHours: 14,
                    tags: ['Cleanup', 'Handover'],
                    dependencies: [6, 7, 8],
                    attachments: []
                }
            ],
            
            documents: [
                { id: 1, name: 'Project Blueprint v2.pdf', type: 'PDF', size: 2457600, projectId: 1, uploadedBy: 4, uploadDate: '2025-10-15', category: 'Blueprints' },
                { id: 2, name: 'Safety Guidelines.docx', type: 'Word', size: 1228800, projectId: 1, uploadedBy: 3, uploadDate: '2025-10-14', category: 'Safety' },
                { id: 3, name: 'Budget Analysis.xlsx', type: 'Excel', size: 876544, projectId: 2, uploadedBy: 1, uploadDate: '2025-10-13', category: 'Financial' },
                { id: 4, name: 'Site Photos.zip', type: 'Archive', size: 16056320, projectId: 1, uploadedBy: 2, uploadDate: '2025-10-12', category: 'Photos' }
            ],
            
            inspections: [
                { id: 1, projectId: 1, type: 'Safety', inspector: 'Mike Wilson', date: '2025-10-15', status: 'Passed', score: 95, notes: 'All safety protocols followed correctly' },
                { id: 2, projectId: 2, type: 'Quality', inspector: 'Sarah Johnson', date: '2025-10-14', status: 'Failed', score: 72, notes: 'Concrete strength below specifications' },
                { id: 3, projectId: 3, type: 'Safety', inspector: 'Mike Wilson', date: '2025-10-13', status: 'Passed', score: 88, notes: 'Minor issues with signage' }
            ],
            
            timeEntries: [
                { id: 1, userId: 1, projectId: 1, taskId: 1, date: '2025-10-17', hours: 8, description: 'Project planning and coordination' },
                { id: 2, userId: 2, projectId: 1, taskId: 2, date: '2025-10-17', hours: 6, description: 'Electrical installation work' },
                { id: 3, userId: 3, projectId: 1, taskId: 1, date: '2025-10-16', hours: 4, description: 'Safety inspection preparation' }
            ],
            
            notifications: [
                { id: 1, userId: 1, type: 'task', title: 'Task Overdue', message: 'Foundation Inspection is overdue', read: false, timestamp: new Date(Date.now() - 3600000) },
                { id: 2, userId: 2, type: 'project', title: 'Budget Alert', message: 'Project budget 85% utilized', read: false, timestamp: new Date(Date.now() - 7200000) },
                { id: 3, userId: 1, type: 'system', title: 'System Update', message: 'CortexBuild updated to v2.1', read: true, timestamp: new Date(Date.now() - 86400000) }
            ]
        };

        // Business Logic Engine
        const BusinessLogic = {
            // Project Management Logic
            projects: {
                calculateProgress: (project) => {
                    const tasks = mockDatabase.tasks.filter(t => t.projectId === project.id);
                    if (tasks.length === 0) return 0;
                    const completedTasks = tasks.filter(t => t.status === 'Completed').length;
                    return Math.round((completedTasks / tasks.length) * 100);
                },
                
                calculateBudgetUtilization: (project) => {
                    return Math.round((project.spent / project.budget) * 100);
                },
                
                getProjectHealth: (project) => {
                    const progress = this.calculateProgress(project);
                    const budgetUtil = this.calculateBudgetUtilization(project);
                    const daysRemaining = Math.ceil((new Date(project.endDate) - new Date()) / (1000 * 60 * 60 * 24));
                    
                    if (budgetUtil > 90 && progress < 80) return 'critical';
                    if (daysRemaining < 30 && progress < 90) return 'warning';
                    if (progress > 90 && budgetUtil < 95) return 'excellent';
                    return 'good';
                },
                
                getPredictedCompletion: (project) => {
                    const progress = this.calculateProgress(project);
                    const startDate = new Date(project.startDate);
                    const endDate = new Date(project.endDate);
                    const totalDays = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24));
                    const progressRate = progress / 100;
                    const estimatedDays = totalDays / (progressRate || 0.01);
                    const predictedEnd = new Date(startDate.getTime() + estimatedDays * 24 * 60 * 60 * 1000);
                    return predictedEnd;
                }
            },
            
            // Task Management Logic
            tasks: {
                calculateEfficiency: (task) => {
                    if (task.actualHours === 0) return 100;
                    return Math.round((task.estimatedHours / task.actualHours) * 100);
                },
                
                getTaskPriority: (task) => {
                    const dueDate = new Date(task.dueDate);
                    const today = new Date();
                    const daysUntilDue = Math.ceil((dueDate - today) / (1000 * 60 * 60 * 24));
                    
                    if (daysUntilDue < 0) return 'overdue';
                    if (daysUntilDue <= 1) return 'urgent';
                    if (daysUntilDue <= 3) return 'high';
                    if (daysUntilDue <= 7) return 'medium';
                    return 'low';
                },
                
                canStartTask: (task) => {
                    const dependencies = mockDatabase.tasks.filter(t => task.dependencies.includes(t.id));
                    return dependencies.every(dep => dep.status === 'Completed');
                }
            },
            
            // Financial Logic
            finance: {
                calculateROI: (project) => {
                    const revenue = project.budget;
                    const cost = project.spent;
                    return ((revenue - cost) / cost) * 100;
                },
                
                getBudgetForecast: (project) => {
                    const progress = BusinessLogic.projects.calculateProgress(project);
                    const spendRate = project.spent / (progress / 100);
                    const forecastSpend = spendRate;
                    const variance = forecastSpend - project.budget;
                    return { forecastSpend, variance, variancePercentage: (variance / project.budget) * 100 };
                }
            },
            
            // Analytics Logic
            analytics: {
                getProjectMetrics: () => {
                    const projects = mockDatabase.projects;
                    const totalBudget = projects.reduce((sum, p) => sum + p.budget, 0);
                    const totalSpent = projects.reduce((sum, p) => sum + p.spent, 0);
                    const avgProgress = projects.reduce((sum, p) => sum + p.progress, 0) / projects.length;
                    const onTimeProjects = projects.filter(p => new Date(p.endDate) > new Date()).length;
                    
                    return {
                        totalProjects: projects.length,
                        totalBudget,
                        totalSpent,
                        avgProgress: Math.round(avgProgress),
                        onTimePercentage: Math.round((onTimeProjects / projects.length) * 100),
                        profitMargin: Math.round(((totalBudget - totalSpent) / totalBudget) * 100)
                    };
                },
                
                getTeamMetrics: () => {
                    const users = mockDatabase.users;
                    const timeEntries = mockDatabase.timeEntries;
                    const totalHours = timeEntries.reduce((sum, entry) => sum + entry.hours, 0);
                    const avgHoursPerUser = totalHours / users.length;
                    const activeUsers = users.filter(u => u.status === 'online').length;
                    
                    return {
                        totalUsers: users.length,
                        activeUsers,
                        totalHours,
                        avgHoursPerUser: Math.round(avgHoursPerUser * 10) / 10,
                        utilization: Math.round((activeUsers / users.length) * 100)
                    };
                }
            }
        };

        // Notification System
        const NotificationSystem = {
            notifications: [],
            listeners: [],
            
            subscribe: (callback) => {
                NotificationSystem.listeners.push(callback);
                return () => {
                    NotificationSystem.listeners = NotificationSystem.listeners.filter(l => l !== callback);
                };
            },
            
            notify: (notification) => {
                const newNotification = {
                    id: Date.now(),
                    timestamp: new Date(),
                    read: false,
                    ...notification
                };
                
                NotificationSystem.notifications.unshift(newNotification);
                NotificationSystem.listeners.forEach(callback => callback(newNotification));
                
                // Auto-remove after 5 seconds for non-persistent notifications
                if (!notification.persistent) {
                    setTimeout(() => {
                        NotificationSystem.remove(newNotification.id);
                    }, 5000);
                }
            },
            
            remove: (id) => {
                NotificationSystem.notifications = NotificationSystem.notifications.filter(n => n.id !== id);
                NotificationSystem.listeners.forEach(callback => callback({ type: 'remove', id }));
            },
            
            markAsRead: (id) => {
                const notification = NotificationSystem.notifications.find(n => n.id === id);
                if (notification) {
                    notification.read = true;
                    NotificationSystem.listeners.forEach(callback => callback({ type: 'update', notification }));
                }
            }
        };

        // Main Application Component
        function CortexBuildApp() {
            const [currentView, setCurrentView] = useState('dashboard');
            const [sidebarOpen, setSidebarOpen] = useState(true);
            const [user, setUser] = useState(null);
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [notifications, setNotifications] = useState([]);
            const [loading, setLoading] = useState(false);
            const [searchQuery, setSearchQuery] = useState('');
            const [theme, setTheme] = useState('light');

            // Initialize application
            useEffect(() => {
                const savedUser = DataManager.load('user');
                const savedTheme = DataManager.load('theme', 'light');
                
                if (savedUser) {
                    setUser(savedUser);
                    setIsLoggedIn(true);
                }
                
                setTheme(savedTheme);
                
                // Subscribe to notifications
                const unsubscribe = NotificationSystem.subscribe((notification) => {
                    if (notification.type === 'remove') {
                        setNotifications(prev => prev.filter(n => n.id !== notification.id));
                    } else if (notification.type === 'update') {
                        setNotifications(prev => prev.map(n => n.id === notification.notification.id ? notification.notification : n));
                    } else {
                        setNotifications(prev => [notification, ...prev]);
                    }
                });
                
                return unsubscribe;
            }, []);

            // Auto-save user data
            useEffect(() => {
                if (user) {
                    DataManager.save('user', user);
                }
            }, [user]);

            // Auto-save theme
            useEffect(() => {
                DataManager.save('theme', theme);
            }, [theme]);

            // Login Component with Advanced Features
            const LoginScreen = () => {
                const [email, setEmail] = useState('demo@cortexbuild.com');
                const [password, setPassword] = useState('demo-password');
                const [rememberMe, setRememberMe] = useState(false);
                const [loginAttempts, setLoginAttempts] = useState(0);
                const [isLocked, setIsLocked] = useState(false);

                const handleLogin = async (e) => {
                    e.preventDefault();

                    if (isLocked) {
                        NotificationSystem.notify({
                            type: 'error',
                            title: 'Account Locked',
                            message: 'Too many failed attempts. Please try again later.'
                        });
                        return;
                    }

                    setLoading(true);

                    // Simulate API call
                    setTimeout(() => {
                        if (email === 'demo@cortexbuild.com' && password === 'demo-password') {
                            const userData = {
                                id: 1,
                                name: 'Demo User',
                                email: email,
                                role: 'Project Manager',
                                avatar: 'üë®‚Äçüíº',
                                permissions: ['all'],
                                lastLogin: new Date(),
                                preferences: {
                                    theme: 'light',
                                    notifications: true,
                                    language: 'en'
                                }
                            };

                            setUser(userData);
                            setIsLoggedIn(true);

                            if (rememberMe) {
                                DataManager.save('rememberUser', true);
                            }

                            NotificationSystem.notify({
                                type: 'success',
                                title: 'Login Successful',
                                message: `Welcome back, ${userData.name}!`
                            });
                        } else {
                            setLoginAttempts(prev => prev + 1);
                            if (loginAttempts >= 2) {
                                setIsLocked(true);
                                setTimeout(() => setIsLocked(false), 30000); // 30 second lockout
                            }

                            NotificationSystem.notify({
                                type: 'error',
                                title: 'Login Failed',
                                message: 'Invalid credentials. Please try again.'
                            });
                        }
                        setLoading(false);
                    }, 1000);
                };

                return (
                    <div className="min-h-screen gradient-bg flex items-center justify-center p-4">
                        <div className="glass-effect rounded-2xl p-8 w-full max-w-md shadow-xl">
                            <div className="text-center mb-6">
                                <div className="text-4xl mb-4">üèóÔ∏è</div>
                                <h1 className="text-3xl font-bold text-blue-600 mb-2">CortexBuild</h1>
                                <p className="text-gray-600">AI-Powered Construction Intelligence Platform</p>
                            </div>

                            <form onSubmit={handleLogin} className="space-y-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
                                    <input
                                        type="email"
                                        value={email}
                                        onChange={(e) => setEmail(e.target.value)}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                        required
                                        disabled={isLocked}
                                    />
                                </div>

                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Password</label>
                                    <input
                                        type="password"
                                        value={password}
                                        onChange={(e) => setPassword(e.target.value)}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                        required
                                        disabled={isLocked}
                                    />
                                </div>

                                <div className="flex items-center justify-between">
                                    <label className="flex items-center">
                                        <input
                                            type="checkbox"
                                            checked={rememberMe}
                                            onChange={(e) => setRememberMe(e.target.checked)}
                                            className="mr-2"
                                            disabled={isLocked}
                                        />
                                        <span className="text-sm text-gray-600">Remember me</span>
                                    </label>
                                    <a href="#" className="text-sm text-blue-600 hover:underline">Forgot password?</a>
                                </div>

                                <button
                                    type="submit"
                                    disabled={loading || isLocked}
                                    className="w-full gradient-bg text-white py-2 px-4 rounded-lg font-semibold hover:opacity-90 transition-all disabled:opacity-50"
                                >
                                    {loading ? (
                                        <span className="flex items-center justify-center">
                                            <div className="loading-spinner w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2"></div>
                                            Logging in...
                                        </span>
                                    ) : isLocked ? (
                                        'Account Locked'
                                    ) : (
                                        'üöÄ Login to Dashboard'
                                    )}
                                </button>
                            </form>

                            {loginAttempts > 0 && !isLocked && (
                                <div className="mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
                                    <p className="text-sm text-yellow-800">
                                        {3 - loginAttempts} attempts remaining before account lockout
                                    </p>
                                </div>
                            )}

                            <div className="mt-6 p-4 bg-blue-50 rounded-lg border border-blue-200">
                                <h4 className="font-semibold text-blue-800 mb-2">üéØ Demo Credentials:</h4>
                                <p className="text-sm text-blue-700"><strong>Email:</strong> demo@cortexbuild.com</p>
                                <p className="text-sm text-blue-700"><strong>Password:</strong> demo-password</p>
                            </div>
                        </div>
                    </div>
                );
            };

            // Navigation Items with Advanced Permissions
            const navItems = [
                { id: 'dashboard', label: 'Dashboard', icon: 'üìä', permission: 'dashboard.read' },
                { id: 'projects', label: 'Projects', icon: 'üèóÔ∏è', permission: 'projects.read' },
                { id: 'tasks', label: 'Tasks', icon: 'üìã', permission: 'tasks.read' },
                { id: 'team', label: 'Team', icon: 'üë•', permission: 'team.read' },
                { id: 'analytics', label: 'Analytics', icon: 'üìà', permission: 'analytics.read' },
                { id: 'documents', label: 'Documents', icon: 'üìÑ', permission: 'documents.read' },
                { id: 'quality', label: 'Quality & Safety', icon: 'üõ°Ô∏è', permission: 'quality.read' },
                { id: 'reports', label: 'Reports', icon: 'üìä', permission: 'reports.read' },
                { id: 'calendar', label: 'Calendar', icon: 'üìÖ', permission: 'calendar.read' },
                { id: 'chat', label: 'Team Chat', icon: 'üí¨', permission: 'chat.read' },
                { id: 'mydesktop', label: 'My Desktop', icon: 'üñ•Ô∏è', permission: 'desktop.read' },
                { id: 'sdk', label: 'SDK Sandbox', icon: '‚ö°', permission: 'sdk.read' },
                { id: 'ai-insights', label: 'AI Insights', icon: 'ü§ñ', permission: 'ai.read' },
                { id: 'settings', label: 'Settings', icon: '‚öôÔ∏è', permission: 'settings.read' }
            ];

            // Advanced Sidebar Component
            const Sidebar = () => {
                const hasPermission = (permission) => {
                    return user?.permissions?.includes('all') || user?.permissions?.includes(permission);
                };

                const filteredNavItems = navItems.filter(item => hasPermission(item.permission));

                return (
                    <div className={`${sidebarOpen ? 'w-64' : 'w-16'} sidebar-glass border-r border-gray-200 sidebar-transition h-screen overflow-y-auto`}>
                        <div className="p-4">
                            <div className="flex items-center space-x-3 mb-8">
                                <div className="text-2xl">üèóÔ∏è</div>
                                {sidebarOpen && (
                                    <div>
                                        <h1 className="text-xl font-bold text-gray-800">CortexBuild</h1>
                                        <p className="text-xs text-gray-500">v2.1.0</p>
                                    </div>
                                )}
                            </div>

                            {sidebarOpen && (
                                <div className="mb-6">
                                    <input
                                        type="text"
                                        placeholder="Search..."
                                        value={searchQuery}
                                        onChange={(e) => setSearchQuery(e.target.value)}
                                        className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    />
                                </div>
                            )}

                            <nav className="space-y-2">
                                {filteredNavItems
                                    .filter(item => !searchQuery || item.label.toLowerCase().includes(searchQuery.toLowerCase()))
                                    .map(item => (
                                    <button
                                        key={item.id}
                                        onClick={() => setCurrentView(item.id)}
                                        className={`w-full flex items-center space-x-3 px-3 py-2 rounded-lg transition-all ${
                                            currentView === item.id ? 'active-nav' : 'hover:bg-gray-100'
                                        }`}
                                        title={!sidebarOpen ? item.label : ''}
                                    >
                                        <span className="text-lg">{item.icon}</span>
                                        {sidebarOpen && <span className="font-medium">{item.label}</span>}
                                    </button>
                                ))}
                            </nav>

                            {sidebarOpen && (
                                <div className="mt-8 p-3 bg-blue-50 rounded-lg">
                                    <h4 className="font-semibold text-blue-800 text-sm mb-2">Quick Stats</h4>
                                    <div className="space-y-1 text-xs text-blue-600">
                                        <div className="flex justify-between">
                                            <span>Active Projects</span>
                                            <span>{mockDatabase.projects.filter(p => p.status === 'In Progress').length}</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span>Pending Tasks</span>
                                            <span>{mockDatabase.tasks.filter(t => t.status === 'Pending').length}</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span>Team Online</span>
                                            <span>{mockDatabase.users.filter(u => u.status === 'online').length}</span>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                );
            };

            // Advanced Header Component
            const Header = () => {
                const [showNotifications, setShowNotifications] = useState(false);
                const [showUserMenu, setShowUserMenu] = useState(false);
                const unreadCount = notifications.filter(n => !n.read).length;

                const handleLogout = () => {
                    setIsLoggedIn(false);
                    setUser(null);
                    DataManager.remove('user');
                    DataManager.remove('rememberUser');
                    NotificationSystem.notify({
                        type: 'info',
                        title: 'Logged Out',
                        message: 'You have been successfully logged out.'
                    });
                };

                return (
                    <div className="glass-effect border-b border-gray-200 px-6 py-4">
                        <div className="flex items-center justify-between">
                            <div className="flex items-center space-x-4">
                                <button
                                    onClick={() => setSidebarOpen(!sidebarOpen)}
                                    className="p-2 rounded-lg hover:bg-gray-100 transition-colors"
                                >
                                    ‚ò∞
                                </button>
                                <div>
                                    <h2 className="text-xl font-semibold text-gray-800">
                                        {navItems.find(item => item.id === currentView)?.label || 'Dashboard'}
                                    </h2>
                                    <p className="text-sm text-gray-500">
                                        {new Date().toLocaleDateString('en-GB', {
                                            weekday: 'long',
                                            year: 'numeric',
                                            month: 'long',
                                            day: 'numeric'
                                        })}
                                    </p>
                                </div>
                            </div>

                            <div className="flex items-center space-x-4">
                                {/* Search */}
                                <div className="hidden md:block">
                                    <input
                                        type="text"
                                        placeholder="Global search..."
                                        className="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    />
                                </div>

                                {/* Theme Toggle */}
                                <button
                                    onClick={() => setTheme(theme === 'light' ? 'dark' : 'light')}
                                    className="p-2 rounded-lg hover:bg-gray-100 transition-colors"
                                    title="Toggle theme"
                                >
                                    {theme === 'light' ? 'üåô' : '‚òÄÔ∏è'}
                                </button>

                                {/* Notifications */}
                                <div className="relative">
                                    <button
                                        onClick={() => setShowNotifications(!showNotifications)}
                                        className="p-2 rounded-lg hover:bg-gray-100 transition-colors relative"
                                    >
                                        üîî
                                        {unreadCount > 0 && (
                                            <span className="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">
                                                {unreadCount > 9 ? '9+' : unreadCount}
                                            </span>
                                        )}
                                    </button>

                                    {showNotifications && (
                                        <div className="absolute right-0 mt-2 w-80 glass-effect rounded-lg shadow-lg border border-gray-200 z-50">
                                            <div className="p-4 border-b border-gray-200">
                                                <h3 className="font-semibold">Notifications</h3>
                                            </div>
                                            <div className="max-h-96 overflow-y-auto">
                                                {notifications.length === 0 ? (
                                                    <div className="p-4 text-center text-gray-500">
                                                        No notifications
                                                    </div>
                                                ) : (
                                                    notifications.map(notification => (
                                                        <div
                                                            key={notification.id}
                                                            className={`p-4 border-b border-gray-100 hover:bg-gray-50 cursor-pointer ${
                                                                !notification.read ? 'bg-blue-50' : ''
                                                            }`}
                                                            onClick={() => NotificationSystem.markAsRead(notification.id)}
                                                        >
                                                            <div className="flex justify-between items-start">
                                                                <div>
                                                                    <h4 className="font-medium text-sm">{notification.title}</h4>
                                                                    <p className="text-sm text-gray-600">{notification.message}</p>
                                                                    <p className="text-xs text-gray-400 mt-1">
                                                                        {DataManager.transform.datetime(notification.timestamp)}
                                                                    </p>
                                                                </div>
                                                                <button
                                                                    onClick={(e) => {
                                                                        e.stopPropagation();
                                                                        NotificationSystem.remove(notification.id);
                                                                    }}
                                                                    className="text-gray-400 hover:text-gray-600"
                                                                >
                                                                    ‚úï
                                                                </button>
                                                            </div>
                                                        </div>
                                                    ))
                                                )}
                                            </div>
                                        </div>
                                    )}
                                </div>

                                {/* User Menu */}
                                <div className="relative">
                                    <button
                                        onClick={() => setShowUserMenu(!showUserMenu)}
                                        className="flex items-center space-x-2 p-2 rounded-lg hover:bg-gray-100 transition-colors"
                                    >
                                        <span className="text-2xl">{user.avatar}</span>
                                        <div className="hidden md:block text-left">
                                            <p className="font-medium text-gray-800">{user.name}</p>
                                            <p className="text-sm text-gray-500">{user.role}</p>
                                        </div>
                                        <span className="text-gray-400">‚ñº</span>
                                    </button>

                                    {showUserMenu && (
                                        <div className="absolute right-0 mt-2 w-48 glass-effect rounded-lg shadow-lg border border-gray-200 z-50">
                                            <div className="p-2">
                                                <button
                                                    onClick={() => setCurrentView('settings')}
                                                    className="w-full text-left px-3 py-2 rounded hover:bg-gray-100 transition-colors"
                                                >
                                                    ‚öôÔ∏è Settings
                                                </button>
                                                <button
                                                    onClick={() => setCurrentView('profile')}
                                                    className="w-full text-left px-3 py-2 rounded hover:bg-gray-100 transition-colors"
                                                >
                                                    üë§ Profile
                                                </button>
                                                <hr className="my-2" />
                                                <button
                                                    onClick={handleLogout}
                                                    className="w-full text-left px-3 py-2 rounded hover:bg-red-100 text-red-600 transition-colors"
                                                >
                                                    üö™ Logout
                                                </button>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            // Advanced Dashboard with Real-time Data
            const Dashboard = () => {
                const [refreshing, setRefreshing] = useState(false);
                const [timeRange, setTimeRange] = useState('week');
                const metrics = BusinessLogic.analytics.getProjectMetrics();
                const teamMetrics = BusinessLogic.analytics.getTeamMetrics();

                const handleRefresh = () => {
                    setRefreshing(true);
                    setTimeout(() => {
                        setRefreshing(false);
                        NotificationSystem.notify({
                            type: 'success',
                            title: 'Data Refreshed',
                            message: 'Dashboard data has been updated.'
                        });
                    }, 1000);
                };

                const kpiCards = [
                    {
                        title: 'Active Projects',
                        value: metrics.totalProjects,
                        change: '+12%',
                        trend: 'up',
                        icon: 'üèóÔ∏è',
                        color: 'blue'
                    },
                    {
                        title: 'Budget Utilization',
                        value: `${Math.round((metrics.totalSpent / metrics.totalBudget) * 100)}%`,
                        change: '+5%',
                        trend: 'up',
                        icon: 'üí∞',
                        color: 'green'
                    },
                    {
                        title: 'Team Efficiency',
                        value: `${teamMetrics.utilization}%`,
                        change: '-2%',
                        trend: 'down',
                        icon: 'üë•',
                        color: 'purple'
                    },
                    {
                        title: 'On-time Delivery',
                        value: `${metrics.onTimePercentage}%`,
                        change: '+8%',
                        trend: 'up',
                        icon: '‚è∞',
                        color: 'orange'
                    }
                ];

                return (
                    <div className="p-6 space-y-6">
                        {/* Header Actions */}
                        <div className="flex justify-between items-center">
                            <div>
                                <h1 className="text-2xl font-bold text-gray-800">Welcome back, {user.name}! üëã</h1>
                                <p className="text-gray-600">Here's what's happening with your projects today.</p>
                            </div>
                            <div className="flex space-x-2">
                                <select
                                    value={timeRange}
                                    onChange={(e) => setTimeRange(e.target.value)}
                                    className="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                >
                                    <option value="day">Today</option>
                                    <option value="week">This Week</option>
                                    <option value="month">This Month</option>
                                    <option value="quarter">This Quarter</option>
                                </select>
                                <button
                                    onClick={handleRefresh}
                                    disabled={refreshing}
                                    className="px-4 py-2 gradient-bg text-white rounded-lg hover:opacity-90 disabled:opacity-50 transition-all"
                                >
                                    {refreshing ? (
                                        <span className="flex items-center">
                                            <div className="loading-spinner w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2"></div>
                                            Refreshing...
                                        </span>
                                    ) : (
                                        'üîÑ Refresh'
                                    )}
                                </button>
                            </div>
                        </div>

                        {/* KPI Cards */}
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                            {kpiCards.map((kpi, index) => (
                                <div key={index} className={`glass-effect p-6 rounded-xl card-hover border-l-4 border-${kpi.color}-500`}>
                                    <div className="flex items-center justify-between mb-4">
                                        <div className="text-2xl">{kpi.icon}</div>
                                        <span className={`text-sm font-medium px-2 py-1 rounded-full ${
                                            kpi.trend === 'up' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                                        }`}>
                                            {kpi.change}
                                        </span>
                                    </div>
                                    <h3 className="text-lg font-semibold text-gray-700 mb-2">{kpi.title}</h3>
                                    <p className={`text-3xl font-bold text-${kpi.color}-600`}>{kpi.value}</p>
                                    <p className="text-sm text-gray-500 mt-2">
                                        {kpi.trend === 'up' ? '‚ÜóÔ∏è' : '‚ÜòÔ∏è'} vs last {timeRange}
                                    </p>
                                </div>
                            ))}
                        </div>

                        {/* Charts and Analytics */}
                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div className="glass-effect p-6 rounded-xl">
                                <h3 className="text-lg font-semibold mb-4">üìä Project Progress Overview</h3>
                                <div className="space-y-4">
                                    {mockDatabase.projects.map(project => {
                                        const health = BusinessLogic.projects.getProjectHealth(project);
                                        const healthColors = {
                                            excellent: 'bg-green-500',
                                            good: 'bg-blue-500',
                                            warning: 'bg-yellow-500',
                                            critical: 'bg-red-500'
                                        };

                                        return (
                                            <div key={project.id} className="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                                <div className="flex-1">
                                                    <div className="flex items-center justify-between mb-2">
                                                        <h4 className="font-medium">{project.name}</h4>
                                                        <span className={`px-2 py-1 rounded-full text-xs font-medium text-white ${healthColors[health]}`}>
                                                            {health.toUpperCase()}
                                                        </span>
                                                    </div>
                                                    <div className="flex items-center space-x-4">
                                                        <div className="flex-1">
                                                            <div className="flex justify-between text-sm mb-1">
                                                                <span>Progress</span>
                                                                <span>{project.progress}%</span>
                                                            </div>
                                                            <div className="w-full bg-gray-200 rounded-full h-2">
                                                                <div
                                                                    className={`h-2 rounded-full ${healthColors[health]}`}
                                                                    style={{width: `${project.progress}%`}}
                                                                ></div>
                                                            </div>
                                                        </div>
                                                        <div className="text-right">
                                                            <p className="text-sm font-medium">{DataManager.transform.currency(project.spent)}</p>
                                                            <p className="text-xs text-gray-500">of {DataManager.transform.currency(project.budget)}</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>

                            <div className="glass-effect p-6 rounded-xl">
                                <h3 className="text-lg font-semibold mb-4">üìã Recent Activity</h3>
                                <div className="space-y-4">
                                    <div className="relative pl-8">
                                        <div className="timeline-item">
                                            <div className="timeline-dot"></div>
                                            <div>
                                                <h4 className="font-medium">Task Completed</h4>
                                                <p className="text-sm text-gray-600">Foundation inspection completed for Downtown Office Complex</p>
                                                <p className="text-xs text-gray-400">2 hours ago</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div className="relative pl-8">
                                        <div className="timeline-item">
                                            <div className="timeline-dot bg-yellow-500"></div>
                                            <div>
                                                <h4 className="font-medium">Budget Alert</h4>
                                                <p className="text-sm text-gray-600">Residential Tower A approaching 85% budget utilization</p>
                                                <p className="text-xs text-gray-400">4 hours ago</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div className="relative pl-8">
                                        <div className="timeline-item">
                                            <div className="timeline-dot bg-green-500"></div>
                                            <div>
                                                <h4 className="font-medium">Project Milestone</h4>
                                                <p className="text-sm text-gray-600">Shopping Center renovation reached 100% completion</p>
                                                <p className="text-xs text-gray-400">1 day ago</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            // All remaining view components
            const ProjectsView = () => <div className="p-6"><h2 className="text-2xl font-bold">üèóÔ∏è Projects</h2><p>Advanced project management with Kanban boards and Gantt charts coming soon...</p></div>;
            const TasksView = () => <div className="p-6"><h2 className="text-2xl font-bold">üìã Tasks</h2><p>Advanced task management with dependencies and time tracking coming soon...</p></div>;
            const TeamView = () => <div className="p-6"><h2 className="text-2xl font-bold">üë• Team</h2><p>Team collaboration and management tools coming soon...</p></div>;
            const AnalyticsView = () => <div className="p-6"><h2 className="text-2xl font-bold">üìà Analytics</h2><p>Advanced analytics and reporting dashboard coming soon...</p></div>;
            const DocumentsView = () => <div className="p-6"><h2 className="text-2xl font-bold">üìÑ Documents</h2><p>Document management and collaboration tools coming soon...</p></div>;
            const QualityView = () => <div className="p-6"><h2 className="text-2xl font-bold">üõ°Ô∏è Quality & Safety</h2><p>Quality control and safety management tools coming soon...</p></div>;
            const ReportsView = () => <div className="p-6"><h2 className="text-2xl font-bold">üìä Reports</h2><p>Advanced reporting and data visualization coming soon...</p></div>;
            const CalendarView = () => <div className="p-6"><h2 className="text-2xl font-bold">üìÖ Calendar</h2><p>Project scheduling and calendar management coming soon...</p></div>;
            const ChatView = () => <div className="p-6"><h2 className="text-2xl font-bold">üí¨ Team Chat</h2><p>Real-time team communication and collaboration coming soon...</p></div>;
            const MyDesktopView = () => <div className="p-6"><h2 className="text-2xl font-bold">üñ•Ô∏è My Desktop</h2><p>Personal desktop environment with apps and widgets coming soon...</p></div>;
            const SDKSandboxView = () => <div className="p-6"><h2 className="text-2xl font-bold">‚ö° SDK Sandbox</h2><p>Developer tools and API testing environment coming soon...</p></div>;
            const AIInsightsView = () => <div className="p-6"><h2 className="text-2xl font-bold">ü§ñ AI Insights</h2><p>AI-powered analytics and predictive insights coming soon...</p></div>;
            const SettingsView = () => <div className="p-6"><h2 className="text-2xl font-bold">‚öôÔ∏è Settings</h2><p>Application settings and user preferences coming soon...</p></div>;

            if (!isLoggedIn) {
                return <LoginScreen />;
            }

            return (
                <div className={`min-h-screen ${theme === 'dark' ? 'bg-gray-900' : 'bg-gray-50'} flex`}>
                    <Sidebar />
                    <div className="flex-1 flex flex-col">
                        <Header />
                        <main className="flex-1 overflow-y-auto">
                            {currentView === 'dashboard' && <Dashboard />}
                            {currentView === 'projects' && <ProjectsView />}
                            {currentView === 'tasks' && <TasksView />}
                            {currentView === 'team' && <TeamView />}
                            {currentView === 'analytics' && <AnalyticsView />}
                            {currentView === 'documents' && <DocumentsView />}
                            {currentView === 'quality' && <QualityView />}
                            {currentView === 'reports' && <ReportsView />}
                            {currentView === 'calendar' && <CalendarView />}
                            {currentView === 'chat' && <ChatView />}
                            {currentView === 'mydesktop' && <MyDesktopView />}
                            {currentView === 'sdk' && <SDKSandboxView />}
                            {currentView === 'ai-insights' && <AIInsightsView />}
                            {currentView === 'settings' && <SettingsView />}
                        </main>
                    </div>

                    {/* Notification Toast Container */}
                    <div className="fixed top-4 right-4 z-50 space-y-2">
                        {notifications.slice(0, 3).map(notification => (
                            <div
                                key={notification.id}
                                className={`notification glass-effect p-4 rounded-lg shadow-lg border-l-4 max-w-sm ${
                                    notification.type === 'success' ? 'border-green-500' :
                                    notification.type === 'error' ? 'border-red-500' :
                                    notification.type === 'warning' ? 'border-yellow-500' :
                                    'border-blue-500'
                                }`}
                            >
                                <div className="flex justify-between items-start">
                                    <div>
                                        <h4 className="font-medium text-sm">{notification.title}</h4>
                                        <p className="text-sm text-gray-600">{notification.message}</p>
                                    </div>
                                    <button
                                        onClick={() => NotificationSystem.remove(notification.id)}
                                        className="text-gray-400 hover:text-gray-600 ml-2"
                                    >
                                        ‚úï
                                    </button>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        ReactDOM.render(<CortexBuildApp />, document.getElementById('root'));
    </script>
</body>
</html>
